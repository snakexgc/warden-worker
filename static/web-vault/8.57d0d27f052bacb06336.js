"use strict";(self.webpackChunk_bitwarden_web_vault=self.webpackChunk_bitwarden_web_vault||[]).push([[8],{65008:(t,i,n)=>{n.r(i),n.d(i,{IndividualBillingModule:()=>ii});var e=n(42594),o=n(55067),s=n(86842),r=n(3867),a=n(37115),c=n(64195),l=n(2922),u=n(5253),p=n(56898),d=n(58806),b=n(78650),h=n(88016),m=function(t,i,n,e){return new(n||(n=Promise))((function(o,s){function r(t){try{c(e.next(t))}catch(i){s(i)}}function a(t){try{c(e.throw(t))}catch(i){s(i)}}function c(t){var i;t.done?o(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(r,a)}c((e=e.apply(t,i||[])).next())}))};function f(t,i){1&t&&(r.qex(0),r.nrm(1,"i",3),r.nI1(2,"i18n"),r.j41(3,"span",4),r.EFF(4),r.nI1(5,"i18n"),r.k0s(),r.bVm()),2&t&&(r.R7$(),r.FS9("title",r.bMT(2,2,"loading")),r.R7$(3),r.JRh(r.bMT(5,4,"loading")))}function g(t,i){if(1&t){const t=r.RV6();r.j41(0,"button",7),r.bIt("click",(function(){r.eBV(t);const i=r.XpG(2);return r.Njj(i.load())})),r.EFF(1),r.nI1(2,"i18n"),r.k0s()}2&t&&(r.R7$(),r.SpI(" ",r.bMT(2,1,"loadMore")," "))}function v(t,i){if(1&t&&(r.qex(0),r.nrm(1,"app-billing-history",5),r.DNE(2,g,3,3,"button",6),r.bVm()),2&t){const t=r.XpG();r.R7$(),r.Y8G("openInvoices",t.openInvoices)("paidInvoices",t.paidInvoices)("transactions",t.transactions),r.R7$(),r.Y8G("ngIf",t.hasAdditionalHistory)}}class I{constructor(t,i,n){this.platformUtilsService=t,this.router=i,this.accountBillingApiService=n,this.loading=!1,this.firstLoaded=!1,this.openInvoices=[],this.paidInvoices=[],this.transactions=[],this.hasAdditionalHistory=!1}ngOnInit(){return m(this,void 0,void 0,(function*(){this.platformUtilsService.isSelfHost()?this.router.navigate(["/settings/subscription"]):(yield this.load(),this.firstLoaded=!0)}))}load(){return m(this,void 0,void 0,(function*(){if(this.loading)return;this.loading=!0;const t=this.accountBillingApiService.getBillingInvoices("open",this.openInvoices.length>0?this.openInvoices[this.openInvoices.length-1].id:null),i=this.accountBillingApiService.getBillingInvoices("paid",this.paidInvoices.length>0?this.paidInvoices[this.paidInvoices.length-1].id:null),n=this.accountBillingApiService.getBillingTransactions(this.transactions.length>0?this.transactions[this.transactions.length-1].createdDate:null),e=yield t,o=yield i,s=yield n;this.openInvoices=[...this.openInvoices,...e],this.paidInvoices=[...this.paidInvoices,...o],this.transactions=[...this.transactions,...s],this.hasAdditionalHistory=e.length>=5||o.length>=5||s.length>=5,this.loading=!1}))}}I.ɵfac=function(t){return new(t||I)(r.rXU(a.y),r.rXU(c.Ix),r.rXU(l.k))},I.ɵcmp=r.VBU({type:I,selectors:[["ng-component"]],standalone:!1,decls:6,vars:5,consts:[[1,"tw-flex","tw-justify-between","tw-mb-2","tw-pb-2","tw-mt-6"],["bitTypography","h2"],[4,"ngIf"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","tw-text-muted",3,"title"],[1,"tw-sr-only"],[3,"openInvoices","paidInvoices","transactions"],["type","button","bitButton","","buttonType","secondary",3,"click",4,"ngIf"],["type","button","bitButton","","buttonType","secondary",3,"click"]],template:function(t,i){1&t&&(r.j41(0,"div",0)(1,"h2",1),r.EFF(2),r.nI1(3,"i18n"),r.k0s()(),r.DNE(4,f,6,6,"ng-container",2)(5,v,3,4,"ng-container",2)),2&t&&(r.R7$(2),r.SpI(" ",r.bMT(3,3,"billingHistory")," "),r.R7$(2),r.Y8G("ngIf",!i.firstLoaded&&i.loading),r.R7$(),r.Y8G("ngIf",i.openInvoices||i.paidInvoices||i.transactions))},dependencies:[u.bT,p.Q,d.r,b.D,h.$],encapsulation:2});var y=n(83731),S=n(51757),F=n(44500),R=n(33338),k=n(73276),$=n(36790),T=n(93695),w=n(36006),U=n(29377),j=n(24930),G=n(66151),E=n(39236),M=n(12012),x=n(58329),B=n(1601),X=n(50700),C=n(69855),P=n(83078),D=n(76799),L=n(35500),V=n(26657),Y=n(45154),A=n(44432),J=n(86226),N=n(99917),H=n(97553),O=n(43759),q=n(59032),_=n(88832),z=n(10010),W=function(t,i,n,e){return new(n||(n=Promise))((function(o,s){function r(t){try{c(e.next(t))}catch(i){s(i)}}function a(t){try{c(e.throw(t))}catch(i){s(i)}}function c(t){var i;t.done?o(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(r,a)}c((e=e.apply(t,i||[])).next())}))};class Q extends z.X{constructor(t,i,n,e,o,s,a){super(i,n,e,s,a),this.apiService=t,this.formBuilder=i,this.i18nService=n,this.platformUtilsService=e,this.syncService=o,this.toastService=s,this.tokenService=a,this.onLicenseFileUploaded=new r.bkB}submit(){const t=Object.create(null,{submit:{get:()=>super.submit}});return W(this,void 0,void 0,(function*(){yield t.submit.call(this);const i=new FormData;i.append("license",this.formValue.file),yield this.apiService.postAccountLicense(i),yield this.apiService.refreshIdentityToken(),yield this.syncService.fullSync(!0),this.onLicenseFileUploaded.emit()}))}get description(){return"uploadLicenseFilePremium"}get hintFileName(){return"bitwarden_premium_license.json"}}Q.ɵfac=function(t){return new(t||Q)(r.rXU(M.G),r.rXU(S.ok),r.rXU(X.W),r.rXU(a.y),r.rXU(j.H),r.rXU(C.f),r.rXU(P.B))},Q.ɵcmp=r.VBU({type:Q,selectors:[["individual-self-hosting-license-uploader"]],outputs:{onLicenseFileUploaded:"onLicenseFileUploaded"},standalone:!1,features:[r.Vt3],decls:22,vars:21,consts:[["fileSelector",""],["bitTypography","body1"],[3,"formGroup","bitSubmit"],["bitButton","","type","button","buttonType","secondary",3,"click"],["bitInput","","type","file","formControlName","file","accept","application/JSON","hidden","",1,"tw-hidden",3,"change"],["type","submit","bitButton","","bitFormButton","","buttonType","primary"]],template:function(t,i){if(1&t){const t=r.RV6();r.j41(0,"p",1),r.EFF(1),r.nI1(2,"i18n"),r.k0s(),r.j41(3,"form",2)(4,"bit-form-field")(5,"bit-label"),r.EFF(6),r.nI1(7,"i18n"),r.k0s(),r.j41(8,"div")(9,"button",3),r.bIt("click",(function(){r.eBV(t);const i=r.sdS(15);return r.Njj(i.click())})),r.EFF(10),r.nI1(11,"i18n"),r.k0s(),r.EFF(12),r.nI1(13,"i18n"),r.k0s(),r.j41(14,"input",4,0),r.bIt("change",(function(n){return r.eBV(t),r.Njj(i.onLicenseFileSelectedChanged(n))})),r.k0s(),r.j41(16,"bit-hint"),r.EFF(17),r.nI1(18,"i18n"),r.k0s()(),r.j41(19,"button",5),r.EFF(20),r.nI1(21,"i18n"),r.k0s()()}2&t&&(r.R7$(),r.JRh(r.bMT(2,8,"uploadLicenseFileOrg")),r.R7$(2),r.Y8G("formGroup",i.form)("bitSubmit",i.submit),r.R7$(3),r.JRh(r.bMT(7,10,i.description)),r.R7$(4),r.SpI(" ",r.bMT(11,12,"chooseFile")," "),r.R7$(2),r.SpI(" ",i.form.value.file?i.form.value.file.name:r.bMT(13,14,"noFileChosen")," "),r.R7$(5),r.JRh(r.i5U(18,16,"licenseFileDesc",i.hintFileName)),r.R7$(3),r.SpI(" ",r.bMT(21,19,"submit")," "))},dependencies:[S.qT,S.me,S.BC,S.cb,S.j4,S.JD,V.$,Y.L,p.Q,J.m,N.s,H.J,O.h,d.r,h.$],encapsulation:2});var K=function(t,i,n,e){return new(n||(n=Promise))((function(o,s){function r(t){try{c(e.next(t))}catch(i){s(i)}}function a(t){try{c(e.throw(t))}catch(i){s(i)}}function c(t){var i;t.done?o(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(r,a)}c((e=e.apply(t,i||[])).next())}))};const Z=t=>({"tw-mb-0":t}),tt=()=>({plan:"families"});function it(t,i){1&t&&(r.j41(0,"h2",10),r.EFF(1),r.nI1(2,"i18n"),r.k0s()),2&t&&(r.R7$(),r.JRh(r.bMT(2,1,"goPremium")))}function nt(t,i){1&t&&(r.j41(0,"bit-callout",11),r.nI1(1,"i18n"),r.EFF(2),r.nI1(3,"i18n"),r.k0s()),2&t&&(r.FS9("title",r.bMT(1,2,"youHavePremiumAccess")),r.R7$(2),r.SpI(" ",r.bMT(3,4,"alreadyPremiumFromOrg")," "))}function et(t,i){if(1&t&&(r.j41(0,"a",12),r.EFF(1),r.nI1(2,"i18n"),r.k0s()),2&t){const t=r.XpG();r.FS9("href",t.premiumURL,r.B4B),r.R7$(),r.SpI(" ",r.bMT(2,2,"purchasePremium")," ")}}function ot(t,i){if(1&t){const t=r.RV6();r.j41(0,"bit-section")(1,"individual-self-hosting-license-uploader",13),r.bIt("onLicenseFileUploaded",(function(){r.eBV(t);const i=r.XpG();return r.Njj(i.onLicenseFileSelectedChanged())})),r.k0s()()}}function st(t,i){if(1&t){const t=r.RV6();r.j41(0,"form",14)(1,"bit-section")(2,"h2",10),r.EFF(3),r.nI1(4,"i18n"),r.k0s(),r.j41(5,"div",15)(6,"bit-form-field",16)(7,"bit-label"),r.EFF(8),r.nI1(9,"i18n"),r.k0s(),r.nrm(10,"input",17),r.nI1(11,"i18n"),r.j41(12,"bit-hint"),r.EFF(13),r.nI1(14,"currency"),r.nI1(15,"i18n"),r.nI1(16,"i18n"),r.k0s()()()(),r.j41(17,"bit-section")(18,"h2",10),r.EFF(19),r.nI1(20,"i18n"),r.k0s(),r.EFF(21),r.nI1(22,"i18n"),r.nI1(23,"currency"),r.nrm(24,"br"),r.EFF(25),r.nI1(26,"i18n"),r.nI1(27,"currency"),r.nI1(28,"currency"),r.nrm(29,"hr",18),r.k0s(),r.j41(30,"bit-section")(31,"h3",10),r.EFF(32),r.nI1(33,"i18n"),r.k0s(),r.nrm(34,"app-payment",19),r.j41(35,"app-tax-info",20),r.bIt("taxInformationChanged",(function(){r.eBV(t);const i=r.XpG();return r.Njj(i.onTaxInformationChanged())})),r.k0s(),r.j41(36,"div",21)(37,"div",22)(38,"span"),r.EFF(39),r.nI1(40,"i18n"),r.nI1(41,"currency"),r.k0s(),r.j41(42,"span"),r.EFF(43),r.nI1(44,"i18n"),r.nI1(45,"currency"),r.k0s()()(),r.nrm(46,"hr",23),r.j41(47,"p",24)(48,"strong"),r.EFF(49),r.nI1(50,"i18n"),r.k0s(),r.EFF(51),r.nI1(52,"currency"),r.nI1(53,"i18n"),r.k0s(),r.j41(54,"button",25),r.EFF(55),r.nI1(56,"i18n"),r.k0s()()()}if(2&t){const t=r.XpG();r.Y8G("formGroup",t.addOnFormGroup)("bitSubmit",t.submitPayment),r.R7$(3),r.JRh(r.bMT(4,23,"addons")),r.R7$(5),r.JRh(r.bMT(9,25,"additionalStorageGb")),r.R7$(2),r.FS9("placeholder",r.bMT(11,27,"additionalStorageGbDesc")),r.R7$(3),r.JRh(r.ii3(16,34,"additionalStorageIntervalDesc","1 GB",r.i5U(14,29,t.storageGBPrice,"$"),r.bMT(15,32,"year"))),r.R7$(6),r.JRh(r.bMT(20,39,"summary")),r.R7$(2),r.Lme(" ",r.bMT(22,41,"premiumMembership"),": ",r.i5U(23,43,t.premiumPrice,"$")," "),r.R7$(4),r.LHq(" ",r.bMT(26,46,"additionalStorageGb"),": ",t.addOnFormGroup.value.additionalStorage||0," GB × ",r.i5U(27,48,t.storageGBPrice,"$")," = ",r.i5U(28,51,t.additionalStorageCost,"$")," "),r.R7$(7),r.JRh(r.bMT(33,54,"paymentInformation")),r.R7$(2),r.Y8G("showBankAccount",!1),r.R7$(5),r.Lme("",r.bMT(40,56,"planPrice"),": ",r.i5U(41,58,t.subtotal,"USD $"),""),r.R7$(4),r.Lme("",r.bMT(44,61,"estimatedTax"),": ",r.i5U(45,63,t.estimatedTax,"USD $"),""),r.R7$(6),r.SpI("",r.bMT(50,66,"total"),":"),r.R7$(2),r.Lme(" ",r.i5U(52,68,t.total,"USD $"),"/",r.bMT(53,71,"year")," "),r.R7$(4),r.SpI(" ",r.bMT(56,73,"submit")," ")}}class rt{constructor(t,i,n,e,o,s,r,a,c,l,u,p,d){this.activatedRoute=t,this.apiService=i,this.billingAccountProfileStateService=n,this.configService=e,this.environmentService=o,this.i18nService=s,this.platformUtilsService=r,this.router=a,this.syncService=c,this.toastService=l,this.tokenService=u,this.taxService=p,this.accountService=d,this.addOnFormGroup=new S.gE({additionalStorage:new S.MJ(0,[S.k0.min(0),S.k0.max(99)])}),this.licenseFormGroup=new S.gE({file:new S.MJ(null,[S.k0.required])}),this.isSelfHost=!1,this.estimatedTax=0,this.familyPlanMaxUserCount=6,this.premiumPrice=10,this.storageGBPrice=4,this.finalizeUpgrade=()=>K(this,void 0,void 0,(function*(){yield this.apiService.refreshIdentityToken(),yield this.syncService.fullSync(!0)})),this.postFinalizeUpgrade=()=>K(this,void 0,void 0,(function*(){this.toastService.showToast({variant:"success",title:null,message:this.i18nService.t("premiumUpdated")}),yield this.navigateToSubscriptionPage()})),this.navigateToSubscriptionPage=()=>this.router.navigate(["../user-subscription"],{relativeTo:this.activatedRoute}),this.onLicenseFileSelected=t=>{const i=t.target;this.licenseFormGroup.value.file=i.files.length>0?i.files[0]:null},this.submitPremiumLicense=()=>K(this,void 0,void 0,(function*(){if(this.licenseFormGroup.markAllAsTouched(),this.licenseFormGroup.invalid)return this.toastService.showToast({variant:"error",title:this.i18nService.t("errorOccurred"),message:this.i18nService.t("selectFile")});if(!(yield this.tokenService.getEmailVerified()))return this.toastService.showToast({variant:"error",title:this.i18nService.t("errorOccurred"),message:this.i18nService.t("verifyEmailFirst")});const t=new FormData;t.append("license",this.licenseFormGroup.value.file),yield this.apiService.postAccountLicense(t),yield this.finalizeUpgrade(),yield this.postFinalizeUpgrade()})),this.submitPayment=()=>K(this,void 0,void 0,(function*(){if(this.taxInfoComponent.taxFormGroup.markAllAsTouched(),this.taxInfoComponent.taxFormGroup.invalid)return;const{type:t,token:i}=yield this.paymentComponent.tokenize(),n=new FormData;n.append("paymentMethodType",t.toString()),n.append("paymentToken",i),n.append("additionalStorageGb",this.addOnFormGroup.value.additionalStorage.toString()),n.append("country",this.taxInfoComponent.country),n.append("postalCode",this.taxInfoComponent.postalCode),yield this.apiService.postPremium(n),yield this.finalizeUpgrade(),yield this.postFinalizeUpgrade()})),this.isSelfHost=this.platformUtilsService.isSelfHost(),this.hasPremiumFromAnyOrganization$=this.accountService.activeAccount$.pipe((0,F.n)((t=>this.billingAccountProfileStateService.hasPremiumFromAnyOrganization$(t.id)))),(0,R.z)([this.accountService.activeAccount$.pipe((0,F.n)((t=>this.billingAccountProfileStateService.hasPremiumPersonally$(t.id)))),this.environmentService.cloudWebVaultUrl$]).pipe((0,y.pQ)(),(0,k.H)((([t,i])=>t?(0,$.H)(this.navigateToSubscriptionPage()):(this.cloudWebVaultURL=i,(0,T.of)(!0))))).subscribe(),this.addOnFormGroup.controls.additionalStorage.valueChanges.pipe((0,w.B)(1e3),(0,y.pQ)()).subscribe((()=>{this.refreshSalesTax()}))}get additionalStorageCost(){return this.storageGBPrice*this.addOnFormGroup.value.additionalStorage}get premiumURL(){return`${this.cloudWebVaultURL}/#/settings/subscription/premium`}get subtotal(){return this.premiumPrice+this.additionalStorageCost}get total(){return this.subtotal+this.estimatedTax}onLicenseFileSelectedChanged(){return K(this,void 0,void 0,(function*(){yield this.postFinalizeUpgrade()}))}refreshSalesTax(){if(!this.taxInfoComponent.country||!this.taxInfoComponent.postalCode)return;const t={passwordManager:{additionalStorage:this.addOnFormGroup.value.additionalStorage},taxInformation:{postalCode:this.taxInfoComponent.postalCode,country:this.taxInfoComponent.country}};this.taxService.previewIndividualInvoice(t).then((t=>{this.estimatedTax=t.taxAmount})).catch((t=>{this.toastService.showToast({title:"",variant:"error",message:this.i18nService.t(t.message)})}))}onTaxInformationChanged(){this.refreshSalesTax()}}rt.ɵfac=function(t){return new(t||rt)(r.rXU(c.nX),r.rXU(M.G),r.rXU(x.Q),r.rXU(B.w),r.rXU(U.v),r.rXU(X.W),r.rXU(a.y),r.rXU(c.Ix),r.rXU(j.H),r.rXU(C.f),r.rXU(P.B),r.rXU(D.j),r.rXU(L.Di))},rt.ɵcmp=r.VBU({type:rt,selectors:[["ng-component"]],viewQuery:function(t,i){if(1&t&&(r.GBs(G.Y,5),r.GBs(E.d,5)),2&t){let t;r.mGM(t=r.lsd())&&(i.paymentComponent=t.first),r.mGM(t=r.lsd())&&(i.taxInfoComponent=t.first)}},standalone:!1,decls:47,vars:47,consts:[["bitTypography","h2",4,"ngIf"],["type","info","icon","bwi bwi-star-f",3,"title",4,"ngIf"],["type","success"],[1,"bwi-ul"],["aria-hidden","true",1,"bwi","bwi-check","tw-text-success","bwi-li"],["bitTypography","body1",3,"ngClass"],["bitLink","","linkType","primary","routerLink","/create-organization",3,"queryParams"],["bitButton","","target","_blank","rel","noreferrer","buttonType","secondary",3,"href",4,"ngIf"],[4,"ngIf"],[3,"formGroup","bitSubmit",4,"ngIf"],["bitTypography","h2"],["type","info","icon","bwi bwi-star-f",3,"title"],["bitButton","","target","_blank","rel","noreferrer","buttonType","secondary",3,"href"],[3,"onLicenseFileUploaded"],[3,"formGroup","bitSubmit"],[1,"tw-grid","tw-grid-cols-12","tw-gap-4"],[1,"tw-col-span-6"],["bitInput","","formControlName","additionalStorage","type","number","step","1",3,"placeholder"],[1,"tw-my-3"],[3,"showBankAccount"],[3,"taxInformationChanged"],[1,"tw-mb-4"],[1,"tw-text-muted","tw-text-sm","tw-flex","tw-flex-col"],[1,"tw-my-1","tw-w-1/4","tw-ml-0"],["bitTypography","body1"],["type","submit","buttonType","primary","bitButton","","bitFormButton",""]],template:function(t,i){1&t&&(r.j41(0,"bit-section"),r.DNE(1,it,3,3,"h2",0)(2,nt,4,6,"bit-callout",1),r.nI1(3,"async"),r.j41(4,"bit-callout",2)(5,"p"),r.EFF(6),r.nI1(7,"i18n"),r.k0s(),r.j41(8,"ul",3)(9,"li"),r.nrm(10,"i",4),r.EFF(11),r.nI1(12,"i18n"),r.k0s(),r.j41(13,"li"),r.nrm(14,"i",4),r.EFF(15),r.nI1(16,"i18n"),r.k0s(),r.j41(17,"li"),r.nrm(18,"i",4),r.EFF(19),r.nI1(20,"i18n"),r.k0s(),r.j41(21,"li"),r.nrm(22,"i",4),r.EFF(23),r.nI1(24,"i18n"),r.k0s(),r.j41(25,"li"),r.nrm(26,"i",4),r.EFF(27),r.nI1(28,"i18n"),r.k0s(),r.j41(29,"li"),r.nrm(30,"i",4),r.EFF(31),r.nI1(32,"i18n"),r.k0s(),r.j41(33,"li"),r.nrm(34,"i",4),r.EFF(35),r.nI1(36,"i18n"),r.k0s()(),r.j41(37,"p",5),r.EFF(38),r.nI1(39,"currency"),r.nI1(40,"i18n"),r.j41(41,"a",6),r.EFF(42),r.nI1(43,"i18n"),r.k0s()(),r.DNE(44,et,3,4,"a",7),r.k0s()(),r.DNE(45,ot,2,0,"bit-section",8)(46,st,57,75,"form",9)),2&t&&(r.R7$(),r.Y8G("ngIf",!i.isSelfHost),r.R7$(),r.Y8G("ngIf",r.bMT(3,17,i.hasPremiumFromAnyOrganization$)),r.R7$(4),r.JRh(r.bMT(7,19,"premiumUpgradeUnlockFeatures")),r.R7$(5),r.SpI(" ",r.bMT(12,21,"premiumSignUpStorage")," "),r.R7$(4),r.SpI(" ",r.bMT(16,23,"premiumSignUpTwoStepOptions")," "),r.R7$(4),r.SpI(" ",r.bMT(20,25,"premiumSignUpEmergency")," "),r.R7$(4),r.SpI(" ",r.bMT(24,27,"premiumSignUpReports")," "),r.R7$(4),r.SpI(" ",r.bMT(28,29,"premiumSignUpTotp")," "),r.R7$(4),r.SpI(" ",r.bMT(32,31,"premiumSignUpSupport")," "),r.R7$(4),r.SpI(" ",r.bMT(36,33,"premiumSignUpFuture")," "),r.R7$(2),r.Y8G("ngClass",r.eq3(44,Z,!i.isSelfHost)),r.R7$(),r.SpI(" ",r.brH(40,38,"premiumPriceWithFamilyPlan",r.i5U(39,35,i.premiumPrice,"$"),i.familyPlanMaxUserCount)," "),r.R7$(3),r.Y8G("queryParams",r.lJ4(46,tt)),r.R7$(),r.SpI(" ",r.bMT(43,42,"bitwardenFamiliesPlan")," "),r.R7$(2),r.Y8G("ngIf",i.isSelfHost),r.R7$(),r.Y8G("ngIf",i.isSelfHost),r.R7$(),r.Y8G("ngIf",!i.isSelfHost))},dependencies:[s.Wk,u.YU,u.bT,S.qT,S.me,S.Q0,S.BC,S.cb,S.j4,S.JD,V.$,Y.L,p.Q,A.G,J.m,N.s,H.J,O.h,q.L,_.n,d.r,E.d,G.Y,Q,u.Jj,u.oe,h.$],encapsulation:2});var at=n(10672),ct=n(39805),lt=n(97560),ut=n(20464);function pt(t,i){if(1&t&&(r.j41(0,"bit-tab-nav-bar",1)(1,"bit-tab-link",2),r.nI1(2,"async"),r.EFF(3),r.nI1(4,"i18n"),r.k0s(),r.j41(5,"bit-tab-link",3),r.EFF(6),r.nI1(7,"i18n"),r.k0s(),r.j41(8,"bit-tab-link",4),r.EFF(9),r.nI1(10,"i18n"),r.k0s()()),2&t){const t=r.XpG();r.R7$(),r.Y8G("route",r.bMT(2,4,t.hasPremium$)?"user-subscription":"premium"),r.R7$(2),r.JRh(r.bMT(4,6,"subscription")),r.R7$(3),r.JRh(r.bMT(7,8,"paymentMethod")),r.R7$(3),r.JRh(r.bMT(10,10,"billingHistory"))}}class dt{constructor(t,i,n){this.platformUtilsService=t,this.hasPremium$=n.activeAccount$.pipe((0,F.n)((t=>i.hasPremiumPersonally$(t.id))))}ngOnInit(){this.selfHosted=this.platformUtilsService.isSelfHost()}}dt.ɵfac=function(t){return new(t||dt)(r.rXU(a.y),r.rXU(x.Q),r.rXU(L.Di))},dt.ɵcmp=r.VBU({type:dt,selectors:[["ng-component"]],standalone:!1,decls:4,vars:1,consts:[["slot","tabs",4,"ngIf"],["slot","tabs"],[3,"route"],["route","payment-method"],["route","billing-history"]],template:function(t,i){1&t&&(r.j41(0,"app-header"),r.DNE(1,pt,11,12,"bit-tab-nav-bar",0),r.k0s(),r.j41(2,"bit-container"),r.nrm(3,"router-outlet"),r.k0s()),2&t&&(r.R7$(),r.Y8G("ngIf",!i.selfHosted))},dependencies:[c.n3,u.bT,at.H,ct.J,lt.T,ut.f,u.Jj,h.$],encapsulation:2});var bt=n(88565),ht=n(72245),mt=n(33895),ft=n(97062),gt=n(33438),vt=n(13583),It=n(21274),yt=n(11224),St=n(3892),Ft=n(7730),Rt=n(34355),kt=function(t,i,n,e){return new(n||(n=Promise))((function(o,s){function r(t){try{c(e.next(t))}catch(i){s(i)}}function a(t){try{c(e.throw(t))}catch(i){s(i)}}function c(t){var i;t.done?o(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(r,a)}c((e=e.apply(t,i||[])).next())}))};function $t(t,i){if(1&t&&(r.j41(0,"button",9),r.EFF(1),r.nI1(2,"i18n"),r.k0s()),2&t){const t=r.XpG();r.Y8G("bitAction",t.cancel),r.R7$(),r.SpI(" ",r.bMT(2,2,"cancel")," ")}}class Tt extends vt.m{constructor(t,i,n,e,o,s,r){super(i,n,e,o,s,r),this.dialogRef=t,this.submitLicenseDialog=()=>kt(this,void 0,void 0,(function*(){yield this.submitLicense()})),this.cancel=()=>kt(this,void 0,void 0,(function*(){yield this.cancel(),this.dialogRef.close(gt.Y.Cancelled)}))}submitLicense(){return kt(this,void 0,void 0,(function*(){(yield this.submit())===gt.Y.Updated&&this.dialogRef.close(gt.Y.Updated)}))}static open(t){return t.open(Tt)}}Tt.ɵfac=function(t){return new(t||Tt)(r.rXU(It.ce),r.rXU(M.G),r.rXU(X.W),r.rXU(a.y),r.rXU(yt.X),r.rXU(S.ok),r.rXU(C.f))},Tt.ɵcmp=r.VBU({type:Tt,selectors:[["ng-component"]],standalone:!1,features:[r.Vt3],decls:24,vars:22,consts:[["fileSelector",""],[3,"formGroup","bitSubmit"],["dialogSize","default",3,"title"],["bitDialogContent",""],["bitButton","","type","button","buttonType","secondary",3,"click"],["bitInput","","type","file","formControlName","file","hidden","",1,"tw-hidden",3,"change"],["bitDialogFooter",""],["type","submit","buttonType","primary","bitButton","","bitFormButton",""],["bitButton","","bitFormButton","","buttonType","secondary","type","button","bitDialogClose","",3,"bitAction",4,"ngIf"],["bitButton","","bitFormButton","","buttonType","secondary","type","button","bitDialogClose","",3,"bitAction"]],template:function(t,i){if(1&t){const t=r.RV6();r.j41(0,"form",1)(1,"bit-dialog",2),r.nI1(2,"i18n"),r.qex(3,3),r.j41(4,"bit-form-field")(5,"bit-label"),r.EFF(6),r.nI1(7,"i18n"),r.k0s(),r.j41(8,"div")(9,"button",4),r.bIt("click",(function(){r.eBV(t);const i=r.sdS(15);return r.Njj(i.click())})),r.EFF(10),r.nI1(11,"i18n"),r.k0s(),r.EFF(12),r.nI1(13,"i18n"),r.k0s(),r.j41(14,"input",5,0),r.bIt("change",(function(n){return r.eBV(t),r.Njj(i.setSelectedFile(n))})),r.k0s(),r.j41(16,"bit-hint"),r.EFF(17),r.nI1(18,"i18n"),r.k0s()(),r.bVm(),r.qex(19,6),r.j41(20,"button",7),r.EFF(21),r.nI1(22,"i18n"),r.k0s(),r.DNE(23,$t,3,4,"button",8),r.bVm(),r.k0s()()}2&t&&(r.Y8G("formGroup",i.updateLicenseForm)("bitSubmit",i.submitLicenseDialog),r.R7$(),r.Y8G("title",r.bMT(2,9,"updateLicense")),r.R7$(5),r.JRh(r.bMT(7,11,"licenseFile")),r.R7$(4),r.SpI(" ",r.bMT(11,13,"chooseFile")," "),r.R7$(2),r.SpI(" ",i.licenseFile?i.licenseFile.name:r.bMT(13,15,"noFileChosen")," "),r.R7$(5),r.JRh(r.i5U(18,17,"licenseFileDesc","bitwarden_premium_license.json")),r.R7$(4),r.SpI(" ",r.bMT(22,20,"submit")," "),r.R7$(2),r.Y8G("ngIf",i.showCancel))},dependencies:[u.bT,S.qT,S.me,S.BC,S.cb,S.j4,S.JD,St.p,V.$,Y.L,p.Q,Ft.I,Rt.m,J.m,N.s,H.J,O.h,h.$],encapsulation:2});var wt=n(56962),Ut=n(53127),jt=n(5771),Gt=n(47696),Et=n(38140),Mt=n(38410),xt=n(36572),Bt=function(t,i,n,e){return new(n||(n=Promise))((function(o,s){function r(t){try{c(e.next(t))}catch(i){s(i)}}function a(t){try{c(e.throw(t))}catch(i){s(i)}}function c(t){var i;t.done?o(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(r,a)}c((e=e.apply(t,i||[])).next())}))};function Xt(t,i){1&t&&(r.qex(0),r.nrm(1,"i",3),r.nI1(2,"i18n"),r.j41(3,"span",4),r.EFF(4),r.nI1(5,"i18n"),r.k0s(),r.bVm()),2&t&&(r.R7$(),r.FS9("title",r.bMT(2,2,"loading")),r.R7$(3),r.JRh(r.bMT(5,4,"loading")))}function Ct(t,i){1&t&&(r.j41(0,"bit-callout",7),r.nI1(1,"i18n"),r.EFF(2),r.nI1(3,"i18n"),r.k0s()),2&t&&(r.FS9("title",r.bMT(1,2,"canceled")),r.R7$(2),r.SpI(" ",r.bMT(3,4,"subscriptionCanceled"),""))}function Pt(t,i){if(1&t){const t=r.RV6();r.j41(0,"bit-callout",7),r.nI1(1,"i18n"),r.j41(2,"p",8),r.EFF(3),r.nI1(4,"i18n"),r.k0s(),r.j41(5,"button",9,0),r.bIt("click",(function(){r.eBV(t);const i=r.XpG(2);return r.Njj(i.reinstate())})),r.EFF(7),r.nI1(8,"i18n"),r.k0s()()}if(2&t){const t=r.sdS(6),i=r.XpG(2);r.FS9("title",r.bMT(1,5,"pendingCancellation")),r.R7$(3),r.JRh(r.bMT(4,7,"subscriptionPendingCanceled")),r.R7$(2),r.Y8G("appApiAction",i.reinstatePromise)("disabled",t.loading()),r.R7$(2),r.SpI(" ",r.bMT(8,9,"reinstateSubscription")," ")}}function Dt(t,i){if(1&t&&(r.j41(0,"dd"),r.EFF(1),r.nI1(2,"date"),r.k0s()),2&t){const t=r.XpG(3);r.R7$(),r.JRh(r.i5U(2,1,t.sub.expiration,"mediumDate"))}}function Lt(t,i){1&t&&(r.j41(0,"dd"),r.EFF(1),r.nI1(2,"i18n"),r.k0s()),2&t&&(r.R7$(),r.JRh(r.bMT(2,1,"neverExpires")))}function Vt(t,i){if(1&t&&(r.j41(0,"dl")(1,"dt"),r.EFF(2),r.nI1(3,"i18n"),r.k0s(),r.DNE(4,Dt,3,4,"dd",2)(5,Lt,3,3,"dd",2),r.k0s()),2&t){const t=r.XpG(2);r.R7$(2),r.JRh(r.bMT(3,3,"expiration")),r.R7$(2),r.Y8G("ngIf",t.sub.expiration),r.R7$(),r.Y8G("ngIf",!t.sub.expiration)}}function Yt(t,i){1&t&&(r.j41(0,"span",15),r.EFF(1),r.nI1(2,"i18n"),r.k0s()),2&t&&(r.R7$(),r.JRh(r.bMT(2,1,"pendingCancellation")))}function At(t,i){if(1&t&&(r.j41(0,"tr")(1,"td",20),r.EFF(2),r.nI1(3,"currency"),r.k0s(),r.j41(4,"td",20),r.EFF(5),r.nI1(6,"currency"),r.nI1(7,"i18n"),r.k0s()()),2&t){const t=i.$implicit;r.R7$(2),r.E5c(" ",t.name," ",t.quantity>1?"×"+t.quantity:""," @ ",r.i5U(3,5,t.amount,"$")," "),r.R7$(3),r.Lme("",r.i5U(6,8,t.quantity*t.amount,"$")," /",r.bMT(7,11,t.interval),"")}}function Jt(t,i){if(1&t&&r.DNE(0,At,8,13,"tr",19),2&t){const t=r.XpG(4);r.Y8G("ngForOf",t.subscription.items)}}function Nt(t,i){1&t&&(r.j41(0,"div",16)(1,"strong",17),r.EFF(2),r.nI1(3,"i18n"),r.k0s(),r.j41(4,"bit-table"),r.DNE(5,Jt,1,1,"ng-template",18),r.k0s()()),2&t&&(r.R7$(2),r.JRh(r.bMT(3,1,"details")))}function Ht(t,i){if(1&t&&(r.j41(0,"div",10)(1,"div",11)(2,"dl")(3,"dt"),r.EFF(4),r.nI1(5,"i18n"),r.k0s(),r.j41(6,"dd")(7,"span",12),r.EFF(8),r.k0s(),r.DNE(9,Yt,3,3,"span",13),r.k0s(),r.j41(10,"dt"),r.EFF(11),r.nI1(12,"i18n"),r.k0s(),r.j41(13,"dd"),r.EFF(14),r.nI1(15,"date"),r.nI1(16,"currency"),r.k0s()()(),r.DNE(17,Nt,6,3,"div",14),r.k0s()),2&t){const t=r.XpG(2);r.R7$(4),r.JRh(r.bMT(5,6,"status")),r.R7$(4),r.JRh(t.subscription&&t.subscriptionStatus||"-"),r.R7$(),r.Y8G("ngIf",t.subscriptionMarkedForCancel),r.R7$(2),r.JRh(r.bMT(12,8,"nextCharge")),r.R7$(3),r.SpI(" ",t.nextInvoice?r.i5U(15,10,t.sub.subscription.periodEndDate,"mediumDate")+", "+r.i5U(16,13,t.nextInvoice.amount,"$"):"-"," "),r.R7$(3),r.Y8G("ngIf",t.subscription)}}function Ot(t,i){if(1&t){const t=r.RV6();r.qex(0),r.j41(1,"div")(2,"button",21),r.bIt("click",(function(){r.eBV(t);const i=r.XpG(2);return r.Njj(i.updateLicense())})),r.EFF(3),r.nI1(4,"i18n"),r.k0s(),r.j41(5,"a",22),r.EFF(6),r.nI1(7,"i18n"),r.k0s()(),r.bVm()}if(2&t){const t=r.XpG(2);r.R7$(3),r.SpI(" ",r.bMT(4,4,"updateLicense")," "),r.R7$(2),r.Mz_("href","",t.cloudWebVaultUrl,"/#/settings/subscription",r.B4B),r.R7$(),r.SpI(" ",r.bMT(7,6,"launchCloudSubscription")," ")}}function qt(t,i){if(1&t){const t=r.RV6();r.j41(0,"button",28),r.bIt("click",(function(){r.eBV(t);const i=r.XpG(3);return r.Njj(i.downloadLicense())})),r.EFF(1),r.nI1(2,"i18n"),r.k0s()}2&t&&(r.R7$(),r.SpI(" ",r.bMT(2,1,"downloadLicense")," "))}function _t(t,i){if(1&t){const t=r.RV6();r.j41(0,"button",29,1),r.bIt("click",(function(){r.eBV(t);const i=r.XpG(3);return r.Njj(i.cancelSubscription())})),r.EFF(2),r.nI1(3,"i18n"),r.k0s()}if(2&t){const t=r.sdS(1),i=r.XpG(3);r.Y8G("appApiAction",i.cancelPromise)("disabled",t.loading()),r.R7$(2),r.SpI(" ",r.bMT(3,3,"cancelSubscription")," ")}}function zt(t,i){if(1&t){const t=r.RV6();r.qex(0),r.j41(1,"div",30)(2,"div",31)(3,"button",28),r.bIt("click",(function(){r.eBV(t);const i=r.XpG(3);return r.Njj(i.adjustStorage(!0))})),r.EFF(4),r.nI1(5,"i18n"),r.k0s(),r.j41(6,"button",28),r.bIt("click",(function(){r.eBV(t);const i=r.XpG(3);return r.Njj(i.adjustStorage(!1))})),r.EFF(7),r.nI1(8,"i18n"),r.k0s()()(),r.bVm()}2&t&&(r.R7$(4),r.SpI(" ",r.bMT(5,2,"addStorage")," "),r.R7$(3),r.SpI(" ",r.bMT(8,4,"removeStorage")," "))}function Wt(t,i){if(1&t&&(r.qex(0),r.j41(1,"div",23),r.DNE(2,qt,3,3,"button",24)(3,_t,4,5,"button",25),r.k0s(),r.j41(4,"h3",26),r.EFF(5),r.nI1(6,"i18n"),r.k0s(),r.j41(7,"p",8),r.EFF(8),r.nI1(9,"i18n"),r.k0s(),r.nrm(10,"bit-progress",27),r.DNE(11,zt,9,6,"ng-container",2),r.bVm()),2&t){const t=r.XpG(2);r.R7$(2),r.Y8G("ngIf",!t.subscription||!t.subscription.cancelled),r.R7$(),r.Y8G("ngIf",t.subscription&&!t.subscription.cancelled&&!t.subscriptionMarkedForCancel),r.R7$(2),r.JRh(r.bMT(6,6,"storage")),r.R7$(3),r.SpI(" ",r.brH(9,8,"subscriptionStorage",t.sub.maxStorageGb||0,t.sub.storageName||"0 MB")," "),r.R7$(2),r.Y8G("barWidth",t.storagePercentage),r.R7$(),r.Y8G("ngIf",t.subscription&&!t.subscription.cancelled&&!t.subscriptionMarkedForCancel)}}function Qt(t,i){if(1&t&&(r.qex(0),r.DNE(1,Ct,4,6,"bit-callout",5)(2,Pt,9,11,"bit-callout",5)(3,Vt,6,5,"dl",2)(4,Ht,18,16,"div",6)(5,Ot,8,8,"ng-container",2)(6,Wt,12,12,"ng-container",2),r.bVm()),2&t){const t=r.XpG();r.R7$(),r.Y8G("ngIf",t.subscription&&t.subscription.cancelled),r.R7$(),r.Y8G("ngIf",t.subscriptionMarkedForCancel),r.R7$(),r.Y8G("ngIf",t.selfHosted),r.R7$(),r.Y8G("ngIf",!t.selfHosted),r.R7$(),r.Y8G("ngIf",t.selfHosted),r.R7$(),r.Y8G("ngIf",!t.selfHosted)}}class Kt{constructor(t,i,n,e,o,s,r,a,c,l,u){this.apiService=t,this.platformUtilsService=i,this.i18nService=n,this.router=e,this.logService=o,this.fileDownloadService=s,this.dialogService=r,this.environmentService=a,this.billingAccountProfileStateService=c,this.toastService=l,this.accountService=u,this.loading=!1,this.firstLoaded=!1,this.selfHosted=!1,this.cancelSubscription=()=>Bt(this,void 0,void 0,(function*(){const t=(0,ft.GM)(this.dialogService,{data:{type:"User"}});this.cancelPromise=(0,bt.s)(t.closed);(yield this.cancelPromise)!==ft.vD.Closed&&(yield this.load())})),this.updateLicense=()=>Bt(this,void 0,void 0,(function*(){if(this.loading)return;const t=Tt.open(this.dialogService);(yield(0,bt.s)(t.closed))===gt.Y.Updated&&(yield this.load())})),this.adjustStorage=t=>Bt(this,void 0,void 0,(function*(){const i=mt.A.open(this.dialogService,{data:{price:4,cadence:"year",type:t?"Add":"Remove"}});(yield(0,bt.s)(i.closed))===mt.W.Submitted&&(yield this.load())})),this.selfHosted=this.platformUtilsService.isSelfHost()}ngOnInit(){return Bt(this,void 0,void 0,(function*(){this.cloudWebVaultUrl=yield(0,ht._)(this.environmentService.cloudWebVaultUrl$),yield this.load(),this.firstLoaded=!0}))}load(){return Bt(this,void 0,void 0,(function*(){if(this.loading)return;const t=yield(0,ht._)(this.accountService.activeAccount$);(yield(0,ht._)(this.billingAccountProfileStateService.hasPremiumPersonally$(t.id)))?(this.loading=!0,this.sub=yield this.apiService.getUserSubscription(),this.loading=!1):this.router.navigate(["/settings/subscription/premium"])}))}reinstate(){return Bt(this,void 0,void 0,(function*(){if(this.loading)return;if(yield this.dialogService.openSimpleDialog({title:{key:"reinstateSubscription"},content:{key:"reinstateConfirmation"},type:"warning"}))try{this.reinstatePromise=this.apiService.postReinstatePremium(),yield this.reinstatePromise,this.toastService.showToast({variant:"success",title:null,message:this.i18nService.t("reinstated")}),this.load()}catch(t){this.logService.error(t)}}))}downloadLicense(){if(this.loading)return;const t=JSON.stringify(this.sub.license,null,2);this.fileDownloadService.download({fileName:"bitwarden_premium_license.json",blobData:t})}get subscriptionMarkedForCancel(){return null!=this.subscription&&!this.subscription.cancelled&&this.subscription.cancelAtEndDate}get subscription(){return null!=this.sub?this.sub.subscription:null}get nextInvoice(){return null!=this.sub?this.sub.upcomingInvoice:null}get storagePercentage(){return null!=this.sub&&this.sub.maxStorageGb?+(this.sub.storageGb/this.sub.maxStorageGb*100).toFixed(2):0}get title(){return this.i18nService.t(this.selfHosted?"subscription":"premiumMembership")}get subscriptionStatus(){if(this.subscription){if("incomplete"===this.subscription.status){const t=new Date(this.subscription.periodStartDate).getTime();return(new Date).getTime()-t<=15e3?this.i18nService.t("active"):this.subscription.status}return this.subscription.status}return null}}Kt.ɵfac=function(t){return new(t||Kt)(r.rXU(M.G),r.rXU(a.y),r.rXU(X.W),r.rXU(c.Ix),r.rXU(wt.K),r.rXU(Ut.y),r.rXU(It.o3),r.rXU(U.v),r.rXU(x.Q),r.rXU(C.f),r.rXU(L.Di))},Kt.ɵcmp=r.VBU({type:Kt,selectors:[["ng-component"]],standalone:!1,decls:2,vars:2,consts:[["reinstateBtn",""],["cancelBtn",""],[4,"ngIf"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","tw-text-muted",3,"title"],[1,"tw-sr-only"],["type","warning",3,"title",4,"ngIf"],["class","tw-flex tw-w-full",4,"ngIf"],["type","warning",3,"title"],["bitTypography","body1"],["bitButton","","type","button","buttonType","secondary",3,"click","appApiAction","disabled"],[1,"tw-flex","tw-w-full"],[1,"tw-w-1/3"],[1,"tw-capitalize"],["bitBadge","","variant","warning",4,"ngIf"],["class","tw-w-2/3",4,"ngIf"],["bitBadge","","variant","warning"],[1,"tw-w-2/3"],[1,"!tw-block","tw-mb-1"],["body",""],[4,"ngFor","ngForOf"],["bitCell",""],["type","button","bitButton","","buttonType","secondary",3,"click"],["bitButton","","buttonType","secondary","target","_blank","rel","noreferrer",3,"href"],[1,"tw-flex","tw-justify-between"],["bitButton","","type","button","buttonType","secondary",3,"click",4,"ngIf"],["bitButton","","type","button","buttonType","danger","class","tw-ml-auto",3,"appApiAction","disabled","click",4,"ngIf"],["bitTypography","h3",1,"tw-mt-16"],["bgColor","success","size","default",3,"barWidth"],["bitButton","","type","button","buttonType","secondary",3,"click"],["bitButton","","type","button","buttonType","danger",1,"tw-ml-auto",3,"click","appApiAction","disabled"],[1,"tw-mt-3"],[1,"tw-flex","tw-gap-1"]],template:function(t,i){1&t&&r.DNE(0,Xt,6,6,"ng-container",2)(1,Qt,7,6,"ng-container",2),2&t&&(r.Y8G("ngIf",!i.firstLoaded&&i.loading),r.R7$(),r.Y8G("ngIf",i.sub))},dependencies:[u.Sq,u.bT,jt.k,Gt.n,p.Q,A.G,Et.X,Mt.Q,xt._,xt.O,d.r,u.oe,u.vh,h.$],encapsulation:2});const Zt=[{path:"",component:dt,data:{titleId:"subscription"},children:[{path:"",pathMatch:"full",redirectTo:"premium"},{path:"user-subscription",component:Kt,data:{titleId:"premiumMembership"}},{path:"premium",component:rt,data:{titleId:"goPremium"}},{path:"payment-method",component:o.NB,data:{titleId:"paymentMethod"}},{path:"billing-history",component:I,data:{titleId:"billingHistory"}}]}];class ti{}ti.ɵfac=function(t){return new(t||ti)},ti.ɵmod=r.$C({type:ti}),ti.ɵinj=r.G2t({imports:[s.iI.forChild(Zt),s.iI]});class ii{}ii.ɵfac=function(t){return new(t||ii)},ii.ɵmod=r.$C({type:ii}),ii.ɵinj=r.G2t({imports:[ti,o.rd,e.G]})}}]);
//# sourceMappingURL=8.57d0d27f052bacb06336.js.map