"use strict";(self.webpackChunk_bitwarden_web_vault=self.webpackChunk_bitwarden_web_vault||[]).push([[813],{28756:(t,i,e)=>{e.d(i,{w:()=>r});var n=e(74208),s=e(3204),o=e(1601);function r(t){return function(t,i,e,n,s){var o;const r=Object.assign(Object.assign({},n),{component:t}),a=null!=s?s:n;return[Object.assign(Object.assign({},a),{component:i,canMatch:[e,...null!==(o=a.canMatch)&&void 0!==o?o:[]]}),r]}(t.defaultComponent,t.flaggedComponent,()=>(0,n.WQX)(o.w).getFeatureFlag$(t.featureFlag).pipe((0,s.T)(t=>!0===t)),t.routeOptions)}},80813:(t,i,e)=>{e.d(i,{IndividualBillingModule:()=>Ni});var n=e(15674),s=e(63734),o=e(72932),r=e(40101),a=e(74208),c=e(6056),l=e(28756),u=e(82468),d=e(37115),p=e(16878),b=e(44500),h=e(27442),m=e(83892),g=e(36359),f=e(69194),v=e(25065),w=e(34571),y=e(31925),S=e(33812),I=e(35500),$=e(10672),F=e(77468),R=e(88016),T=function(t,i,e,n){return new(e||(e=Promise))(function(s,o){function r(t){try{c(n.next(t))}catch(i){o(i)}}function a(t){try{c(n.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(r,a)}c((n=n.apply(t,i||[])).next())})};function k(t,i){1&t&&(S.qex(0),S.nrm(1,"i",0),S.nI1(2,"i18n"),S.j41(3,"span",1),S.EFF(4),S.nI1(5,"i18n"),S.k0s(),S.bVm()),2&t&&(S.R7$(),S.Y8G("title",S.mNQ(S.bMT(2,3,"loading"))),S.R7$(3),S.JRh(S.bMT(5,5,"loading")))}function x(t,i){if(1&t){const t=S.RV6();S.qex(0),S.j41(1,"app-display-payment-method",2),S.bIt("updated",function(i){a.eBV(t);const e=S.XpG();return a.Njj(e.setPaymentMethod(i))}),S.k0s(),S.nrm(2,"app-display-account-credit",3),S.bVm()}if(2&t){S.XpG();const t=S.r8f(1);S.R7$(),S.Y8G("subscriber",t.account)("paymentMethod",t.paymentMethod),S.R7$(),S.Y8G("subscriber",t.account)("credit",t.credit)}}class M{constructor(t,i){this.accountService=t,this.subscriberBillingClient=i,this.viewState$=new p.t(null),this.load$=this.accountService.activeAccount$.pipe(y.$i,(0,b.n)(t=>T(this,void 0,void 0,function*(){const[i,e]=yield Promise.all([this.subscriberBillingClient.getPaymentMethod(t),this.subscriberBillingClient.getCredit(t)]);return{account:t,paymentMethod:i,credit:e}})),(0,h.t)({bufferSize:1,refCount:!1})),this.view$=(0,m.h)(this.load$.pipe((0,g.M)(t=>this.viewState$.next(t))),this.viewState$.pipe((0,f.p)(t=>null!==t))).pipe((0,h.t)({bufferSize:1,refCount:!0})),this.setPaymentMethod=t=>{this.viewState$.value&&this.viewState$.next(Object.assign(Object.assign({},this.viewState$.value),{paymentMethod:t}))}}}M.ɵfac=function(t){return new(t||M)(S.rXU(I.D),S.rXU(w.Hd))},M.ɵcmp=S.VBU({type:M,selectors:[["ng-component"]],features:[S.Jv_([w.Hd])],decls:5,vars:4,consts:[["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","tw-text-muted",3,"title"],[1,"tw-sr-only"],[3,"updated","subscriber","paymentMethod"],[3,"subscriber","credit"]],template:function(t,i){if(1&t&&(S.j41(0,"bit-container"),S.SS7(1),S.nI1(2,"async"),S.nVh(3,k,6,7,"ng-container")(4,x,3,4,"ng-container"),S.k0s()),2&t){S.R7$();const t=S.bH3(S.bMT(2,1,i.view$));S.R7$(2),S.vxM(t?4:3)}},dependencies:[s.I$,s.H8,o.G,v.G,$.H,F.Jj,R.$],encapsulation:2});var P=e(83731),j=e(3204),U=e(93695),G=e(88565),E=e(72245),X=e(29377),D=e(88832),C=e(639),A=e(75583),B=e(26477),V=e(36801),Y=e(81525),N=e(33438),J=e(13583),W=e(21274),Q=e(69855),O=e(12012),H=e(50700),L=e(11224),_=e(51757),z=e(58329),q=e(3892),Z=e(26657),K=e(45154),tt=e(56898),it=e(7730),et=e(68016),nt=function(t,i,e,n){return new(e||(e=Promise))(function(s,o){function r(t){try{c(n.next(t))}catch(i){o(i)}}function a(t){try{c(n.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(r,a)}c((n=n.apply(t,i||[])).next())})};function st(t,i){if(1&t&&(S.j41(0,"button",14),S.EFF(1),S.nI1(2,"i18n"),S.k0s()),2&t){const t=S.XpG();S.Y8G("bitAction",t.cancel),S.R7$(),S.SpI(" ",S.bMT(2,2,"cancel")," ")}}class ot extends J.m{constructor(t,i,e,n,s,o,r,a,c,l={}){var u;super(i,e,n,s,o,r),this.dialogRef=t,this.accountService=a,this.billingAccountProfileStateService=c,this.dialogData=l,this.submitLicenseDialog=()=>nt(this,void 0,void 0,function*(){yield this.submitLicense()}),this.cancel=()=>nt(this,void 0,void 0,function*(){this.onCanceled.emit(),this.dialogRef.close(N.Y.Cancelled)}),this.fromUserSubscriptionPage=null!==(u=null==l?void 0:l.fromUserSubscriptionPage)&&void 0!==u&&u}submitLicense(){return nt(this,void 0,void 0,function*(){if((yield this.submit())===N.Y.Updated){if(null==this.organizationId){const t=yield(0,E._)(this.accountService.activeAccount$);if(t){const i=yield(0,E._)(this.billingAccountProfileStateService.hasPremiumFromAnyOrganization$(t.id));yield this.billingAccountProfileStateService.setHasPremium(!0,i,t.id)}}this.dialogRef.close(N.Y.Updated)}})}static open(t,i){return t.open(ot,i)}}ot.ɵfac=function(t){return new(t||ot)(S.rXU(W.ce),S.rXU(O.G),S.rXU(H.W),S.rXU(d.y),S.rXU(L.X),S.rXU(_.ok),S.rXU(Q.f),S.rXU(I.D),S.rXU(z.Q),S.rXU(Y.Qs))},ot.ɵcmp=S.VBU({type:ot,selectors:[["ng-component"]],standalone:!1,features:[S.Vt3],decls:28,vars:26,consts:[["fileSelector",""],[3,"formGroup","bitSubmit"],["dialogSize","default",3,"title"],["bitDialogContent",""],[1,"tw-mb-4"],[1,"tw-block","tw-text-sm","tw-text-muted","tw-mb-2"],[1,"tw-mb-2"],["bitButton","","type","button","buttonType","unstyled",1,"tw-text-primary-600","tw-p-0","tw-border-0","tw-bg-transparent","hover:tw-underline","tw-cursor-pointer",3,"click"],[1,"tw-ml-2","tw-text-muted"],["type","file","formControlName","file","hidden","",1,"tw-hidden",3,"change"],[1,"tw-text-sm","tw-text-muted"],["bitDialogFooter",""],["type","submit","buttonType","primary","bitButton","","bitFormButton","",3,"disabled"],["bitButton","","bitFormButton","","buttonType","secondary","type","button","bitDialogClose","",3,"bitAction",4,"ngIf"],["bitButton","","bitFormButton","","buttonType","secondary","type","button","bitDialogClose","",3,"bitAction"]],template:function(t,i){if(1&t){const t=S.RV6();S.j41(0,"form",1)(1,"bit-dialog",2),S.nI1(2,"i18n"),S.qex(3,3),S.j41(4,"p",4),S.EFF(5),S.nI1(6,"i18n"),S.k0s(),S.j41(7,"div",4)(8,"label",5),S.EFF(9),S.nI1(10,"i18n"),S.k0s(),S.j41(11,"div",6)(12,"button",7),S.bIt("click",function(){a.eBV(t);const i=S.sdS(19);return a.Njj(i.click())}),S.EFF(13),S.nI1(14,"i18n"),S.k0s(),S.j41(15,"span",8),S.EFF(16),S.nI1(17,"i18n"),S.k0s()(),S.j41(18,"input",9,0),S.bIt("change",function(e){return a.eBV(t),a.Njj(i.setSelectedFile(e))}),S.k0s(),S.j41(20,"p",10),S.EFF(21),S.nI1(22,"i18n"),S.k0s()(),S.bVm(),S.qex(23,11),S.j41(24,"button",12),S.EFF(25),S.nI1(26,"i18n"),S.k0s(),S.DNE(27,st,3,4,"button",13),S.bVm(),S.k0s()()}2&t&&(S.Y8G("formGroup",i.updateLicenseForm)("bitSubmit",i.submitLicenseDialog),S.R7$(),S.Y8G("title",S.bMT(2,11,i.fromUserSubscriptionPage?"uploadLicense":"uploadLicenseFile")),S.R7$(4),S.JRh(S.i5U(6,13,"uploadLicenseFileDesc","bitwarden_license.json")),S.R7$(4),S.JRh(S.bMT(10,16,i.fromUserSubscriptionPage?"uploadYourPremiumLicenseFile":"uploadYourLicenseFile")),S.R7$(4),S.SpI(" ",S.bMT(14,18,"chooseFile")," "),S.R7$(3),S.JRh(i.licenseFile?i.licenseFile.name:S.bMT(17,20,"noFileChosen")),S.R7$(5),S.JRh(S.bMT(22,22,"maxFileSizeSansPunctuation")),S.R7$(3),S.Y8G("disabled",!i.licenseFile),S.R7$(),S.SpI(" ",S.bMT(26,24,"upload")," "),S.R7$(2),S.Y8G("ngIf",i.showCancel))},dependencies:[F.bT,_.qT,_.me,_.BC,_.cb,_.j4,_.JD,q.p,Z.$,K.L,tt.Q,it.I,et.m,R.$],encapsulation:2});var rt=e(23649),at=e(47696),ct=e(58806),lt=e(57178),ut=function(t,i,e,n){return new(e||(e=Promise))(function(s,o){function r(t){try{c(n.next(t))}catch(i){o(i)}}function a(t){try{c(n.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(r,a)}c((n=n.apply(t,i||[])).next())})};const dt=()=>({type:"bwi-external-link",position:"after"}),pt=(t,i)=>({type:"primary",text:t,icon:i}),bt=(t,i)=>({type:"secondary",text:t,icon:i});function ht(t,i){if(1&t){const t=S.RV6();S.j41(0,"bit-section")(1,"div",2)(2,"span",3),S.EFF(3),S.nI1(4,"i18n"),S.k0s()(),S.j41(5,"div",4)(6,"h1",5),S.EFF(7),S.nI1(8,"i18n"),S.k0s(),S.j41(9,"p",6),S.EFF(10),S.nI1(11,"i18n"),S.k0s()(),S.j41(12,"div",7)(13,"p",8),S.EFF(14),S.nI1(15,"i18n"),S.k0s(),S.j41(16,"p",9),S.EFF(17),S.nI1(18,"i18n"),S.k0s(),S.j41(19,"a",10),S.bIt("click",function(){a.eBV(t);const i=S.XpG();return a.Njj(i.openUploadLicenseDialog())}),S.EFF(20),S.nI1(21,"i18n"),S.nrm(22,"i",11),S.k0s()(),S.j41(23,"div",12)(24,"div")(25,"billing-pricing-card",13),S.nI1(26,"i18n"),S.nI1(27,"i18n"),S.bIt("buttonClick",function(){a.eBV(t);const i=S.XpG();return a.Njj(i.onPremiumUpgradeClick())}),S.j41(28,"h3",14),S.EFF(29),S.nI1(30,"i18n"),S.k0s()()(),S.j41(31,"div")(32,"billing-pricing-card",13),S.nI1(33,"i18n"),S.nI1(34,"i18n"),S.bIt("buttonClick",function(){a.eBV(t);const i=S.XpG();return a.Njj(i.onFamiliesUpgradeClick())}),S.j41(35,"h3",14),S.EFF(36),S.nI1(37,"i18n"),S.k0s()()()(),S.j41(38,"div",15)(39,"a",16),S.EFF(40),S.nI1(41,"i18n"),S.nrm(42,"i",17),S.k0s()()()}if(2&t){const t=S.XpG();S.R7$(2),S.Y8G("truncate",!1),S.R7$(),S.SpI(" ",S.bMT(4,16,"bitwardenFreeplanMessage")," "),S.R7$(4),S.SpI(" ",S.bMT(8,18,"upgradeCompleteSecurity")," "),S.R7$(3),S.SpI(" ",S.bMT(11,20,"individualUpgradeDescriptionMessage")," "),S.R7$(4),S.SpI(" ",S.bMT(15,22,"alreadyHaveSubscriptionQuestion")," "),S.R7$(3),S.SpI(" ",S.bMT(18,24,"alreadyHaveSubscriptionSelfHostedMessage")," "),S.R7$(3),S.SpI(" ",S.bMT(21,26,"uploadYourLicenseFile")," "),S.R7$(5),S.Y8G("tagline",S.bMT(26,28,"planDescPremium"))("button",S.l_i(43,pt,S.bMT(27,30,"upgradeToPremium"),S.lJ4(42,dt)))("features",t.premiumFeatures),S.R7$(4),S.JRh(S.bMT(30,32,"premium")),S.R7$(3),S.Y8G("tagline",S.bMT(33,34,"planDescFamiliesV2"))("button",S.l_i(47,bt,S.bMT(34,36,"upgradeToFamilies"),S.lJ4(46,dt)))("features",t.familiesFeatures),S.R7$(4),S.JRh(S.bMT(37,38,"families")),S.R7$(4),S.SpI(" ",S.bMT(41,40,"viewAllPlans")," ")}}class mt{constructor(t,i,e,n,s,o,r,c){this.accountService=t,this.activatedRoute=i,this.billingAccountProfileStateService=e,this.dialogService=n,this.environmentService=s,this.i18nService=o,this.router=r,this.toastService=c,this.cloudPremiumPageUrl$=this.environmentService.cloudWebVaultUrl$.pipe((0,j.T)(t=>`${t}/#/settings/subscription/premium`)),this.cloudFamiliesPageUrl$=this.environmentService.cloudWebVaultUrl$.pipe((0,j.T)(t=>`${t}/#/settings/subscription/premium`)),this.hasPremiumFromAnyOrganization$=this.accountService.activeAccount$.pipe((0,b.n)(t=>t?this.billingAccountProfileStateService.hasPremiumFromAnyOrganization$(t.id):(0,U.of)(!1))),this.hasPremiumPersonally$=this.accountService.activeAccount$.pipe((0,b.n)(t=>t?this.billingAccountProfileStateService.hasPremiumPersonally$(t.id):(0,U.of)(!1))),this.shouldShowUpgradeView$=this.hasPremiumPersonally$.pipe((0,j.T)(t=>!t)),this.premiumFeatures=[this.i18nService.t("builtInAuthenticator"),this.i18nService.t("secureFileStorage"),this.i18nService.t("emergencyAccess"),this.i18nService.t("breachMonitoring"),this.i18nService.t("andMoreFeatures")],this.familiesFeatures=[this.i18nService.t("premiumAccounts"),this.i18nService.t("familiesUnlimitedSharing"),this.i18nService.t("familiesUnlimitedCollections"),this.i18nService.t("familiesSharedStorage")],this.destroyRef=(0,a.WQX)(a.abz),this.openUploadLicenseDialog=()=>ut(this,void 0,void 0,function*(){const t=ot.open(this.dialogService);(yield(0,G.s)(t.closed))===N.Y.Updated&&(this.toastService.showToast({variant:"success",title:"",message:this.i18nService.t("premiumUpdated")}),yield this.navigateToSubscription())}),this.navigateToSubscription=()=>ut(this,void 0,void 0,function*(){return this.router.navigate(["../user-subscription"],{relativeTo:this.activatedRoute})}),this.onPremiumUpgradeClick=()=>ut(this,void 0,void 0,function*(){const t=yield(0,E._)(this.cloudPremiumPageUrl$);t?window.open(t,"_blank","noopener,noreferrer"):this.toastService.showToast({variant:"error",title:"",message:this.i18nService.t("cloudUrlNotConfigured")})}),this.onFamiliesUpgradeClick=()=>ut(this,void 0,void 0,function*(){const t=yield(0,E._)(this.cloudFamiliesPageUrl$);t?window.open(t,"_blank","noopener,noreferrer"):this.toastService.showToast({variant:"error",title:"",message:this.i18nService.t("cloudUrlNotConfigured")})}),this.hasPremiumPersonally$.pipe((0,P.pQ)(this.destroyRef),(0,b.n)(t=>t?this.navigateToSubscription():(0,U.of)(!0))).subscribe()}}mt.ɵfac=function(t){return new(t||mt)(S.rXU(I.D),S.rXU(rt.nX),S.rXU(z.Q),S.rXU(W.o3),S.rXU(X.v),S.rXU(H.W),S.rXU(rt.Ix),S.rXU(Q.f))},mt.ɵcmp=S.VBU({type:mt,selectors:[["ng-component"]],decls:3,vars:3,consts:[[1,"tw-max-w-3xl","tw-mx-auto"],[4,"ngIf"],[1,"tw-mt-10","tw-mb-4","tw-text-center"],["bitBadge","","variant","secondary",3,"truncate"],[1,"tw-text-center","tw-rounded"],[1,"tw-mt-2","tw-text-4xl"],[1,"tw-text-sm","tw-text-muted","tw-mb-6","tw-mt-4"],[1,"tw-bg-secondary-100","tw-p-4","tw-rounded-lg","tw-border","tw-border-secondary-300","tw-mb-6"],[1,"tw-font-semibold","tw-mb-0.5"],[1,"tw-text-sm","tw-text-muted","tw-mb-0.5"],["bitLink","","linkType","primary",1,"tw-cursor-pointer","tw-text-sm",3,"click"],["aria-hidden","true",1,"bwi","bwi-angle-right","tw-ml-1"],[1,"tw-grid","tw-grid-cols-1","md:tw-grid-cols-2","tw-gap-6","tw-mt-6","tw-justify-center"],[3,"buttonClick","tagline","button","features"],["slot","title","bitTypography","h3",1,"tw-m-0"],[1,"tw-text-center","tw-mt-6"],["bitLink","","linkType","primary","href","https://bitwarden.com/pricing/","target","_blank","rel","noopener noreferrer"],["aria-hidden","true",1,"bwi","bwi-external-link","tw-ml-1"]],template:function(t,i){1&t&&(S.j41(0,"div",0),S.DNE(1,ht,43,50,"bit-section",1),S.nI1(2,"async"),S.k0s()),2&t&&(S.R7$(),S.Y8G("ngIf",S.bMT(2,1,i.shouldShowUpgradeView$)))},dependencies:[F.MD,F.bT,D.n,C.E,at.n,A.E,ct.r,B.V,lt.g,n.Y2,F.Jj,V.$Z],encapsulation:2});var gt=e(33277),ft=e(58625),vt=e(3160),wt=e(58412),yt=e(1601),St=e(53127),It=e(2003),$t=e(37579),Ft=e(29029),Rt=e(81573),Tt=e(26411),kt=e(86226),xt=e(93199),Mt=e(97553),Pt=e(43759),jt=function(t,i,e,n){return new(e||(e=Promise))(function(s,o){function r(t){try{c(n.next(t))}catch(i){o(i)}}function a(t){try{c(n.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(r,a)}c((n=n.apply(t,i||[])).next())})};function Ut(t,i){if(1&t&&(S.j41(0,"bit-hint")(1,"strong"),S.EFF(2),S.nI1(3,"i18n"),S.k0s(),S.EFF(4),S.nI1(5,"currency"),S.nI1(6,"currency"),S.nI1(7,"i18n"),S.k0s()),2&t){const t=S.XpG();S.R7$(2),S.JRh(S.bMT(3,5,"total")),S.R7$(2),S.LHq(" ",t.formGroup.value.amount," GB × ",S.i5U(5,7,t.price(),"$")," = ",S.i5U(6,10,t.price()*t.formGroup.value.amount,"$")," / ",S.bMT(7,13,t.term())," ")}}class Gt{constructor(){this.accountBillingClient=(0,a.WQX)(w.cH),this.dialogParams=(0,a.WQX)(Y.Qs),this.dialogRef=(0,a.WQX)(W.ce),this.i18nService=(0,a.WQX)(H.W),this.toastService=(0,a.WQX)(Q.f),this.action=(0,gt.EW)(()=>this.dialogParams.type),this.price=(0,gt.EW)(()=>{if("add"===this.dialogParams.type)return this.dialogParams.price}),this.provided=(0,gt.EW)(()=>{if("add"===this.dialogParams.type)return this.dialogParams.provided}),this.term=(0,gt.EW)(()=>{if("add"===this.dialogParams.type)switch(this.dialogParams.cadence){case"annually":return this.i18nService.t("year");case"monthly":return this.i18nService.t("month")}}),this.existing=(0,gt.EW)(()=>this.dialogParams.existing),this.content=(0,gt.EW)(()=>{switch(this.action()){case"add":return{title:this.i18nService.t("addStorage"),body:this.i18nService.t("storageAddNote"),label:this.i18nService.t("gbStorageAdd")};case"remove":return{title:this.i18nService.t("removeStorage"),body:this.i18nService.t("whenYouRemoveStorage"),label:this.i18nService.t("gbStorageRemove")}}}),this.maxPurchasable=(0,gt.EW)(()=>{const t=this.provided();if(t)return It.J_-t}),this.maxValidatorValue=(0,gt.EW)(()=>{var t;const i=null!==(t=this.maxPurchasable())&&void 0!==t?t:It.J_,e=this.existing();switch(this.action()){case"add":return e?i-e:i;case"remove":return e||0}}),this.formGroup=new _.gE({amount:new _.MJ(1,{nonNullable:!0,validators:[_.k0.required,_.k0.min(1),_.k0.max(this.maxValidatorValue())]})}),this.submit=()=>jt(this,void 0,void 0,function*(){if(this.formGroup.markAllAsTouched(),!this.formGroup.valid||!this.formGroup.value.amount)return;const t=this.action(),i=this.existing(),e=this.formGroup.value.amount;switch(t){case"add":yield this.accountBillingClient.updateSubscriptionStorage(e+(null!=i?i:0));break;case"remove":yield this.accountBillingClient.updateSubscriptionStorage(i-e)}this.toastService.showToast({variant:"success",title:"",message:this.i18nService.t("adjustedStorage",e)}),this.dialogRef.close("submitted")})}}Gt.open=(t,i)=>t.open(Gt,i),Gt.ɵfac=function(t){return new(t||Gt)},Gt.ɵcmp=S.VBU({type:Gt,selectors:[["ng-component"]],features:[S.Jv_([w.cH])],decls:18,vars:15,consts:[[3,"formGroup","bitSubmit"],[3,"title"],["bitDialogContent",""],["bitTypography","body1"],[1,"tw-grid","tw-grid-cols-12"],[1,"tw-col-span-7"],["bitInput","","type","number",3,"formControl"],["bitDialogFooter",""],["type","submit","bitButton","","bitFormButton","","buttonType","primary",3,"disabled"],["type","button","bitButton","","bitFormButton","","buttonType","secondary",3,"bitDialogClose"]],template:function(t,i){if(1&t&&(S.j41(0,"form",0)(1,"bit-dialog",1),S.qex(2,2),S.j41(3,"p",3),S.EFF(4),S.k0s(),S.j41(5,"div",4)(6,"bit-form-field",5)(7,"bit-label"),S.EFF(8),S.k0s(),S.nrm(9,"input",6),S.nVh(10,Ut,8,15,"bit-hint"),S.k0s()(),S.bVm(),S.qex(11,7),S.j41(12,"button",8),S.EFF(13),S.nI1(14,"i18n"),S.k0s(),S.j41(15,"button",9),S.EFF(16),S.nI1(17,"i18n"),S.k0s(),S.bVm(),S.k0s()()),2&t){const t=i.content();S.Y8G("formGroup",i.formGroup)("bitSubmit",i.submit),S.R7$(),S.Y8G("title",t.title),S.R7$(3),S.JRh(t.body),S.R7$(4),S.JRh(t.label),S.R7$(),S.Y8G("formControl",i.formGroup.controls.amount),S.R7$(),S.vxM("add"===i.action()?10:-1),S.R7$(2),S.Y8G("disabled",i.formGroup.invalid),S.R7$(),S.SpI(" ",S.bMT(14,11,"submit")," "),S.R7$(2),S.Y8G("bitDialogClose","closed"),S.R7$(),S.SpI(" ",S.bMT(17,13,"cancel")," ")}},dependencies:[$t.C,Z.$,K.L,Ft.t,tt.Q,Rt.P,it.I,et.m,Tt.L,kt.j,xt.I,Mt.J,Pt.h,_.X1,_.qT,_.me,_.Q0,_.BC,_.cb,_.l_,_.j4,A.E,ct.r,F.oe,V.$Z],encapsulation:2,changeDetection:0});var Et=e(97062),Xt=function(t,i,e,n){return new(e||(e=Promise))(function(s,o){function r(t){try{c(n.next(t))}catch(i){o(i)}}function a(t){try{c(n.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(r,a)}c((n=n.apply(t,i||[])).next())})};function Dt(t,i){1&t&&(S.qex(0),S.nrm(1,"i",0),S.nI1(2,"i18n"),S.j41(3,"span",1),S.EFF(4),S.nI1(5,"i18n"),S.k0s(),S.bVm()),2&t&&(S.R7$(),S.Y8G("title",S.mNQ(S.bMT(2,3,"loading"))),S.R7$(3),S.JRh(S.bMT(5,5,"loading")))}function Ct(t,i){if(1&t){const t=S.RV6();S.j41(0,"billing-storage-card",9),S.bIt("callToActionClicked",function(i){a.eBV(t);const e=S.XpG(3);return a.Njj(e.onStorageCardAction(i))}),S.k0s()}if(2&t){const t=S.XpG(3);S.Y8G("storage",i)("addStorageDisabled",!t.canAddStorage())("removeStorageDisabled",!t.canRemoveStorage())}}function At(t,i){if(1&t){const t=S.RV6();S.j41(0,"div",2)(1,"h1",3),S.EFF(2),S.nI1(3,"i18n"),S.k0s(),S.j41(4,"p",4),S.EFF(5),S.nI1(6,"i18n"),S.k0s()(),S.j41(7,"div",5)(8,"billing-subscription-card",6),S.nI1(9,"i18n"),S.bIt("callToActionClicked",function(i){a.eBV(t);const e=S.XpG(2);return a.Njj(e.onSubscriptionCardAction(i))}),S.k0s(),S.nVh(10,Ct,1,3,"billing-storage-card",7),S.j41(11,"billing-additional-options-card",8),S.bIt("callToActionClicked",function(i){a.eBV(t);const e=S.XpG(2);return a.Njj(e.onAdditionalOptionsCardAction(i))}),S.k0s()()}if(2&t){let t;const e=i,n=S.XpG(2);S.R7$(2),S.JRh(S.bMT(3,8,"youHavePremium")),S.R7$(3),S.SpI(" ",S.bMT(6,10,"viewAndManagePremiumSubscription")," "),S.R7$(3),S.Y8G("title",S.bMT(9,12,"premiumMembership"))("subscription",e)("showUpgradeButton",n.premiumToOrganizationUpgradeEnabled()),S.R7$(2),S.vxM((t=e.storage)?10:-1,t),S.R7$(),S.Y8G("downloadLicenseDisabled",n.subscriptionTerminal())("cancelSubscriptionDisabled",!n.canCancelSubscription())}}function Bt(t,i){if(1&t&&S.nVh(0,At,12,14),2&t){let t;const i=S.XpG();S.vxM((t=i.subscription.value())?0:-1,t)}}class Vt{constructor(){this.accountService=(0,a.WQX)(I.D),this.activatedRoute=(0,a.WQX)(rt.nX),this.accountBillingClient=(0,a.WQX)(w.cH),this.billingAccountProfileStateService=(0,a.WQX)(z.Q),this.configService=(0,a.WQX)(yt.w),this.dialogService=(0,a.WQX)(W.o3),this.fileDownloadService=(0,a.WQX)(St.y),this.i18nService=(0,a.WQX)(H.W),this.router=(0,a.WQX)(rt.Ix),this.subscriptionPricingService=(0,a.WQX)(vt.z),this.toastService=(0,a.WQX)(Q.f),this.subscription=(0,gt.Zc)({loader:()=>Xt(this,void 0,void 0,function*(){const t=()=>Xt(this,void 0,void 0,function*(){return yield this.router.navigate(["/settings/subscription/premium"]),null}),i=yield(0,E._)(this.accountService.activeAccount$);if(!i)return yield t();return(yield(0,E._)(this.billingAccountProfileStateService.hasPremiumPersonally$(i.id)))?yield this.accountBillingClient.getSubscription():yield t()})}),this.subscriptionLoading=(0,gt.EW)(()=>this.subscription.isLoading()),this.subscriptionTerminal=(0,gt.EW)(()=>{const t=this.subscription.value();if(t)return t.status===It.gc.IncompleteExpired||t.status===It.gc.Canceled||t.status===It.gc.Unpaid}),this.subscriptionPendingCancellation=(0,gt.EW)(()=>{const t=this.subscription.value();if(t)return(t.status===It.gc.Trialing||t.status===It.gc.Active)&&!!t.cancelAt}),this.storage=(0,gt.EW)(()=>{const t=this.subscription.value();return null==t?void 0:t.storage}),this.purchasedStorage=(0,gt.EW)(()=>{var t;const i=this.subscription.value();return null===(t=null==i?void 0:i.cart.passwordManager.additionalStorage)||void 0===t?void 0:t.quantity}),this.premiumPlan=(0,P.ot)(this.subscriptionPricingService.getPersonalSubscriptionPricingTiers$().pipe((0,j.T)(t=>t.find(t=>t.id===wt.OU.Premium)))),this.premiumStoragePrice=(0,gt.EW)(()=>{const t=this.premiumPlan();return null==t?void 0:t.passwordManager.annualPricePerAdditionalStorageGB}),this.premiumProvidedStorage=(0,gt.EW)(()=>{const t=this.premiumPlan();return null==t?void 0:t.passwordManager.providedStorageGB}),this.canAddStorage=(0,gt.EW)(()=>{if(this.subscriptionTerminal())return!1;const t=this.storage(),i=this.premiumProvidedStorage();if(t&&i){const e=It.J_-i;return t.available<e}}),this.canRemoveStorage=(0,gt.EW)(()=>{if(this.subscriptionTerminal())return!1;const t=this.purchasedStorage();if(!t||0===t)return!1;const i=this.storage();return i?i.available>i.used:void 0}),this.canCancelSubscription=(0,gt.EW)(()=>!this.subscriptionTerminal()&&!this.subscriptionPendingCancellation()),this.premiumToOrganizationUpgradeEnabled=(0,P.ot)(this.configService.getFeatureFlag$(u.TO.PM29593_PremiumToOrganizationUpgrade),{initialValue:!1}),this.onSubscriptionCardAction=t=>Xt(this,void 0,void 0,function*(){switch(t){case It.xI.ContactSupport:window.open("https://bitwarden.com/contact/","_blank");break;case It.xI.ManageInvoices:yield this.router.navigate(["../billing-history"],{relativeTo:this.activatedRoute});break;case It.xI.ReinstateSubscription:if(!(yield this.dialogService.openSimpleDialog({title:{key:"reinstateSubscription"},content:{key:"reinstateConfirmation"},type:"warning"})))return;yield this.accountBillingClient.reinstateSubscription(),this.toastService.showToast({variant:"success",title:"",message:this.i18nService.t("reinstated")}),this.subscription.reload();break;case It.xI.UpdatePayment:yield this.router.navigate(["../payment-details"],{relativeTo:this.activatedRoute});case It.xI.UpgradePlan:}}),this.onStorageCardAction=t=>Xt(this,void 0,void 0,function*(){const i=this.getAdjustStorageDialogParams(t),e=Gt.open(this.dialogService,{data:i});"submitted"===(yield(0,G.s)(e.closed))&&this.subscription.reload()}),this.onAdditionalOptionsCardAction=t=>Xt(this,void 0,void 0,function*(){switch(t){case It.vo.DownloadLicense:{const t=yield this.accountBillingClient.getLicense(),i=JSON.stringify(t,null,2);this.fileDownloadService.download({fileName:"bitwarden_premium_license.json",blobData:i});break}case It.vo.CancelSubscription:{const t=(0,Et.GM)(this.dialogService,{data:{type:"User"}});if((yield(0,G.s)(t.closed))===Et.vD.Closed)return;this.subscription.reload()}}}),this.getAdjustStorageDialogParams=t=>{const i=this.purchasedStorage(),e=this.premiumStoragePrice(),n=this.premiumProvidedStorage();switch(t){case It.Xc.AddStorage:if(e&&n)return{type:"add",price:e,provided:n,cadence:"annually",existing:i};break;case It.Xc.RemoveStorage:if(i)return{type:"remove",existing:i}}}}}Vt.ɵfac=function(t){return new(t||Vt)},Vt.ɵcmp=S.VBU({type:Vt,selectors:[["ng-component"]],features:[S.Jv_([w.cH])],decls:2,vars:1,consts:[["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","tw-text-muted",3,"title"],[1,"tw-sr-only"],[1,"tw-flex","tw-flex-col","tw-gap-3","tw-items-center","tw-text-center","tw-pb-8","tw-pt-12","tw-px-14"],["bitTypography","h1",1,"tw-m-0"],["bitTypography","body1",1,"tw-m-0","tw-text-muted"],[1,"tw-flex","tw-flex-col","tw-gap-10","tw-mx-auto","tw-max-w-[800px]","tw-pb-8"],[3,"callToActionClicked","title","subscription","showUpgradeButton"],[3,"storage","addStorageDisabled","removeStorageDisabled"],[3,"callToActionClicked","downloadLicenseDisabled","cancelSubscriptionDisabled"],[3,"callToActionClicked","storage","addStorageDisabled","removeStorageDisabled"]],template:function(t,i){1&t&&S.nVh(0,Dt,6,7,"ng-container")(1,Bt,1,1),2&t&&S.vxM(i.subscriptionLoading()?0:1)},dependencies:[It.Vj,ft.p,It.db,It.ZS,A.E,ct.r,R.$],encapsulation:2,changeDetection:0});var Yt=e(2922),Nt=e(78650),Jt=function(t,i,e,n){return new(e||(e=Promise))(function(s,o){function r(t){try{c(n.next(t))}catch(i){o(i)}}function a(t){try{c(n.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(r,a)}c((n=n.apply(t,i||[])).next())})};function Wt(t,i){1&t&&(S.qex(0),S.nrm(1,"i",3),S.nI1(2,"i18n"),S.j41(3,"span",4),S.EFF(4),S.nI1(5,"i18n"),S.k0s(),S.bVm()),2&t&&(S.R7$(),S.Y8G("title",S.mNQ(S.bMT(2,3,"loading"))),S.R7$(3),S.JRh(S.bMT(5,5,"loading")))}function Qt(t,i){if(1&t){const t=S.RV6();S.j41(0,"button",7),S.bIt("click",function(){a.eBV(t);const i=S.XpG(2);return a.Njj(i.load())}),S.EFF(1),S.nI1(2,"i18n"),S.k0s()}2&t&&(S.R7$(),S.SpI(" ",S.bMT(2,1,"loadMore")," "))}function Ot(t,i){if(1&t&&(S.qex(0),S.nrm(1,"app-billing-history",5),S.DNE(2,Qt,3,3,"button",6),S.bVm()),2&t){const t=S.XpG();S.R7$(),S.Y8G("openInvoices",t.openInvoices)("paidInvoices",t.paidInvoices)("transactions",t.transactions),S.R7$(),S.Y8G("ngIf",t.hasAdditionalHistory)}}class Ht{constructor(t,i,e){this.platformUtilsService=t,this.router=i,this.accountBillingApiService=e,this.loading=!1,this.firstLoaded=!1,this.openInvoices=[],this.paidInvoices=[],this.transactions=[],this.hasAdditionalHistory=!1}ngOnInit(){return Jt(this,void 0,void 0,function*(){this.platformUtilsService.isSelfHost()?this.router.navigate(["/settings/subscription"]):(yield this.load(),this.firstLoaded=!0)})}load(){return Jt(this,void 0,void 0,function*(){if(this.loading)return;this.loading=!0;const t=this.accountBillingApiService.getBillingInvoices("open",this.openInvoices.length>0?this.openInvoices[this.openInvoices.length-1].id:null),i=this.accountBillingApiService.getBillingInvoices("paid",this.paidInvoices.length>0?this.paidInvoices[this.paidInvoices.length-1].id:null),e=this.accountBillingApiService.getBillingTransactions(this.transactions.length>0?this.transactions[this.transactions.length-1].createdDate:null),n=yield t,s=yield i,o=yield e;this.openInvoices=[...this.openInvoices,...n],this.paidInvoices=[...this.paidInvoices,...s],this.transactions=[...this.transactions,...o],this.hasAdditionalHistory=n.length>=5||s.length>=5||o.length>=5,this.loading=!1})}}Ht.ɵfac=function(t){return new(t||Ht)(S.rXU(d.y),S.rXU(rt.Ix),S.rXU(Yt.k))},Ht.ɵcmp=S.VBU({type:Ht,selectors:[["ng-component"]],standalone:!1,decls:6,vars:5,consts:[[1,"tw-flex","tw-justify-between","tw-mb-2","tw-pb-2","tw-mt-6"],["bitTypography","h2"],[4,"ngIf"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","tw-text-muted",3,"title"],[1,"tw-sr-only"],[3,"openInvoices","paidInvoices","transactions"],["type","button","bitButton","","buttonType","secondary",3,"click",4,"ngIf"],["type","button","bitButton","","buttonType","secondary",3,"click"]],template:function(t,i){1&t&&(S.j41(0,"div",0)(1,"h2",1),S.EFF(2),S.nI1(3,"i18n"),S.k0s()(),S.DNE(4,Wt,6,7,"ng-container",2)(5,Ot,3,4,"ng-container",2)),2&t&&(S.R7$(2),S.SpI(" ",S.bMT(3,3,"billingHistory")," "),S.R7$(2),S.Y8G("ngIf",!i.firstLoaded&&i.loading),S.R7$(),S.Y8G("ngIf",i.openInvoices||i.paidInvoices||i.transactions))},dependencies:[F.bT,tt.Q,ct.r,Nt.D,R.$],encapsulation:2});var Lt=e(33338),_t=e(84079),zt=e(58363),qt=e(49272),Zt=e(27485),Kt=function(t,i,e,n){return new(e||(e=Promise))(function(s,o){function r(t){try{c(n.next(t))}catch(i){o(i)}}function a(t){try{c(n.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(r,a)}c((n=n.apply(t,i||[])).next())})};const ti=t=>({amount:t,cadence:"monthly"}),ii=t=>({type:"primary",text:t}),ei=t=>({type:"secondary",text:t});function ni(t,i){if(1&t){const t=S.RV6();S.j41(0,"billing-pricing-card",13),S.nI1(1,"i18n"),S.nI1(2,"i18n"),S.bIt("buttonClick",function(){a.eBV(t);const i=S.XpG(2);return a.Njj(i.openUpgradeDialog("Premium"))}),S.j41(3,"h3",14),S.EFF(4),S.nI1(5,"i18n"),S.k0s()()}if(2&t){const t=i;S.Y8G("tagline",S.bMT(1,5,"advancedOnlineSecurity"))("price",S.eq3(11,ti,t.price))("button",S.eq3(13,ii,S.bMT(2,7,"upgradeToPremium")))("features",t.features),S.R7$(4),S.JRh(S.bMT(5,9,"premium"))}}function si(t,i){if(1&t){const t=S.RV6();S.j41(0,"billing-pricing-card",13),S.nI1(1,"i18n"),S.nI1(2,"i18n"),S.bIt("buttonClick",function(){a.eBV(t);const i=S.XpG(2);return a.Njj(i.openUpgradeDialog("Families"))}),S.j41(3,"h3",14),S.EFF(4),S.nI1(5,"i18n"),S.k0s()()}if(2&t){const t=i;S.Y8G("tagline",S.bMT(1,5,"planDescFamiliesV2"))("price",S.eq3(11,ti,t.price))("button",S.eq3(13,ei,S.bMT(2,7,"startFreeFamiliesTrial")))("features",t.features),S.R7$(4),S.JRh(S.bMT(5,9,"families"))}}function oi(t,i){if(1&t&&(S.j41(0,"bit-section")(1,"div",2)(2,"div",3)(3,"span",4),S.EFF(4),S.nI1(5,"i18n"),S.k0s()(),S.j41(6,"h2",5),S.EFF(7),S.nI1(8,"i18n"),S.k0s(),S.j41(9,"p",6),S.EFF(10),S.nI1(11,"i18n"),S.k0s()(),S.j41(12,"div",7)(13,"div"),S.nVh(14,ni,6,15,"billing-pricing-card",8),S.nI1(15,"async"),S.k0s(),S.j41(16,"div"),S.nVh(17,si,6,15,"billing-pricing-card",8),S.nI1(18,"async"),S.k0s()(),S.j41(19,"div",9)(20,"p",10),S.EFF(21),S.nI1(22,"i18n"),S.k0s(),S.j41(23,"a",11),S.EFF(24),S.nI1(25,"i18n"),S.nrm(26,"i",12),S.k0s()()()),2&t){let t,i;const e=S.XpG();S.R7$(3),S.Y8G("truncate",!1),S.R7$(),S.SpI(" ",S.bMT(5,8,"bitwardenFreeplanMessage")," "),S.R7$(3),S.SpI(" ",S.bMT(8,10,"upgradeCompleteSecurity")," "),S.R7$(3),S.SpI(" ",S.bMT(11,12,"individualUpgradeDescriptionMessage")," "),S.R7$(4),S.vxM((t=S.bMT(15,14,e.premiumCardData$))?14:-1,t),S.R7$(3),S.vxM((i=S.bMT(18,16,e.familiesCardData$))?17:-1,i),S.R7$(4),S.SpI(" ",S.bMT(22,18,"individualUpgradeTaxInformationMessage")," "),S.R7$(3),S.SpI(" ",S.bMT(25,20,"viewbusinessplans")," ")}}const ri="callToAction",ai="upgradeToPremium";class ci{constructor(t,i,e,n,s,o,r,c){this.accountService=t,this.apiService=i,this.dialogService=e,this.syncService=n,this.billingAccountProfileStateService=s,this.subscriptionPricingService=o,this.router=r,this.activatedRoute=c,this.destroyRef=(0,a.WQX)(a.abz),this.navigateToSubscriptionPage=()=>this.router.navigate(["../user-subscription"],{relativeTo:this.activatedRoute}),this.navigateToIndividualVault=()=>this.router.navigate(["/vault"]),this.finalizeUpgrade=()=>Kt(this,void 0,void 0,function*(){yield this.apiService.refreshIdentityToken(),yield this.syncService.fullSync(!0)}),this.hasPremiumFromAnyOrganization$=this.accountService.activeAccount$.pipe((0,b.n)(t=>t?this.billingAccountProfileStateService.hasPremiumFromAnyOrganization$(t.id):(0,U.of)(!1))),this.hasPremiumPersonally$=this.accountService.activeAccount$.pipe((0,b.n)(t=>t?this.billingAccountProfileStateService.hasPremiumPersonally$(t.id):(0,U.of)(!1))),this.accountService.activeAccount$.pipe(y.$i,(0,P.pQ)(this.destroyRef)).subscribe(t=>{this.subscriber=t}),this.shouldShowNewDesign$=(0,Lt.z)([this.hasPremiumFromAnyOrganization$,this.hasPremiumPersonally$]).pipe((0,j.T)(([t,i])=>!t&&!i)),(0,Lt.z)([this.hasPremiumFromAnyOrganization$,this.hasPremiumPersonally$]).pipe((0,P.pQ)(this.destroyRef),(0,b.n)(([t,i])=>i?(0,_t.H)(this.navigateToSubscriptionPage()):t?(0,_t.H)(this.navigateToIndividualVault()):(0,U.of)(!0))).subscribe(),this.shouldShowUpgradeDialogOnInit$=(0,Lt.z)([this.hasPremiumFromAnyOrganization$,this.hasPremiumPersonally$,this.activatedRoute.queryParams]).pipe((0,j.T)(([t,i,e])=>{const n=e[ri];return!t&&!i&&n===ai})),this.personalPricingTiers$=this.subscriptionPricingService.getPersonalSubscriptionPricingTiers$(),this.premiumCardData$=this.personalPricingTiers$.pipe((0,j.T)(t=>{const i=t.find(t=>t.id===wt.OU.Premium);return{tier:i,price:"standalone"===(null==i?void 0:i.passwordManager.type)&&i.passwordManager.annualPrice?Number((i.passwordManager.annualPrice/12).toFixed(2)):0,features:(null==i?void 0:i.passwordManager.features.map(t=>t.value))||[]}}),(0,h.t)({bufferSize:1,refCount:!0})),this.familiesCardData$=this.personalPricingTiers$.pipe((0,j.T)(t=>{const i=t.find(t=>t.id===wt.OU.Families);return{tier:i,price:"packaged"===(null==i?void 0:i.passwordManager.type)&&i.passwordManager.annualPrice?Number((i.passwordManager.annualPrice/12).toFixed(2)):0,features:(null==i?void 0:i.passwordManager.features.map(t=>t.value))||[]}}),(0,h.t)({bufferSize:1,refCount:!0})),this.shouldShowUpgradeDialogOnInit$.pipe((0,zt.s)(1),(0,b.n)(t=>t?(0,_t.H)(this.openUpgradeDialog("Premium")):(0,U.of)(void 0)),(0,P.pQ)(this.destroyRef)).subscribe()}openUpgradeDialog(t){return Kt(this,void 0,void 0,function*(){const i=yield(0,E._)(this.accountService.activeAccount$);if(!i)return;const e="Premium"===t?wt.OU.Premium:wt.OU.Families,n={account:i,initialStep:Zt.TT.Payment,selectedPlan:e,redirectOnCompletion:!0};Zt.gY.open(this.dialogService,{data:n}).closed.pipe((0,P.pQ)(this.destroyRef)).subscribe(t=>{(null==t?void 0:t.status)!==Zt.PD.UpgradedToPremium&&(null==t?void 0:t.status)!==Zt.PD.UpgradedToFamilies||this.finalizeUpgrade()})})}}ci.ɵfac=function(t){return new(t||ci)(S.rXU(I.D),S.rXU(O.G),S.rXU(W.o3),S.rXU(qt.H),S.rXU(z.Q),S.rXU(vt.z),S.rXU(rt.Ix),S.rXU(rt.nX))},ci.ɵcmp=S.VBU({type:ci,selectors:[["ng-component"]],decls:3,vars:3,consts:[[1,"tw-max-w-3xl","tw-mx-auto"],[4,"ngIf"],[1,"tw-text-center"],[1,"tw-mt-8","tw-mb-6"],["bitBadge","","variant","secondary",3,"truncate"],[1,"tw-mt-2","tw-text-4xl"],[1,"tw-text-muted","tw-mb-6","tw-mt-4"],[1,"tw-grid","tw-grid-cols-1","md:tw-grid-cols-2","tw-gap-6","tw-mt-6","tw-justify-center"],[3,"tagline","price","button","features"],[1,"tw-text-center","tw-mt-6"],[1,"tw-text-muted","tw-mb-2","tw-italic"],["bitLink","","linkType","primary","href","https://bitwarden.com/pricing/business/","target","_blank","rel","noopener noreferrer"],["aria-hidden","true",1,"bwi","bwi-external-link","tw-ml-1"],[3,"buttonClick","tagline","price","button","features"],["slot","title","bitTypography","h3",1,"tw-m-0"]],template:function(t,i){1&t&&(S.j41(0,"div",0),S.DNE(1,oi,27,22,"bit-section",1),S.nI1(2,"async"),S.k0s()),2&t&&(S.R7$(),S.Y8G("ngIf",S.bMT(2,1,i.shouldShowNewDesign$)))},dependencies:[F.MD,F.bT,D.n,C.E,at.n,A.E,ct.r,B.V,lt.g,n.Y2,F.Jj,V.$Z],encapsulation:2});var li=e(39805),ui=e(97560),di=e(93748);function pi(t,i){if(1&t&&(S.j41(0,"bit-tab-nav-bar",0)(1,"bit-tab-link",1),S.nI1(2,"async"),S.EFF(3),S.nI1(4,"i18n"),S.k0s(),S.j41(5,"bit-tab-link",2),S.EFF(6),S.nI1(7,"i18n"),S.k0s(),S.j41(8,"bit-tab-link",3),S.EFF(9),S.nI1(10,"i18n"),S.k0s()()),2&t){const t=S.XpG();S.R7$(),S.Y8G("route",S.bMT(2,4,t.hasPremium$)?"user-subscription":"premium"),S.R7$(2),S.JRh(S.bMT(4,6,"subscription")),S.R7$(3),S.JRh(S.bMT(7,8,"paymentDetails")),S.R7$(3),S.JRh(S.bMT(10,10,"billingHistory"))}}class bi{constructor(t,i,e){this.platformUtilsService=t,this.hasPremium$=e.activeAccount$.pipe((0,b.n)(t=>i.hasPremiumPersonally$(t.id)))}ngOnInit(){this.selfHosted=this.platformUtilsService.isSelfHost()}}bi.ɵfac=function(t){return new(t||bi)(S.rXU(d.y),S.rXU(z.Q),S.rXU(I.D))},bi.ɵcmp=S.VBU({type:bi,selectors:[["ng-component"]],standalone:!1,decls:3,vars:1,consts:[["slot","tabs"],[3,"route"],["route","payment-details"],["route","billing-history"]],template:function(t,i){1&t&&(S.j41(0,"app-header"),S.nVh(1,pi,11,12,"bit-tab-nav-bar",0),S.k0s(),S.nrm(2,"router-outlet")),2&t&&(S.R7$(),S.vxM(i.selfHosted?-1:1))},dependencies:[rt.n3,li.J,ui.T,di.f,F.Jj,R.$],encapsulation:2});var hi=e(56962),mi=e(33895),gi=e(5771),fi=e(44432),vi=e(38140),wi=e(47593),yi=e(67379),Si=function(t,i,e,n){return new(e||(e=Promise))(function(s,o){function r(t){try{c(n.next(t))}catch(i){o(i)}}function a(t){try{c(n.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(r,a)}c((n=n.apply(t,i||[])).next())})};function Ii(t,i){1&t&&(S.qex(0),S.nrm(1,"i",4),S.nI1(2,"i18n"),S.j41(3,"span",5),S.EFF(4),S.nI1(5,"i18n"),S.k0s(),S.bVm()),2&t&&(S.R7$(),S.Y8G("title",S.mNQ(S.bMT(2,3,"loading"))),S.R7$(3),S.JRh(S.bMT(5,5,"loading")))}function $i(t,i){1&t&&(S.j41(0,"bit-callout",9),S.nI1(1,"i18n"),S.EFF(2),S.nI1(3,"i18n"),S.k0s()),2&t&&(S.Y8G("title",S.mNQ(S.bMT(1,3,"canceled"))),S.R7$(2),S.SpI(" ",S.bMT(3,5,"subscriptionCanceled")))}function Fi(t,i){if(1&t){const t=S.RV6();S.j41(0,"bit-callout",9),S.nI1(1,"i18n"),S.j41(2,"p",10),S.EFF(3),S.nI1(4,"i18n"),S.k0s(),S.j41(5,"button",11,0),S.bIt("click",function(){a.eBV(t);const i=S.XpG(2);return a.Njj(i.reinstate())}),S.EFF(7),S.nI1(8,"i18n"),S.k0s()()}if(2&t){const t=S.sdS(6),i=S.XpG(2);S.Y8G("title",S.mNQ(S.bMT(1,6,"pendingCancellation"))),S.R7$(3),S.JRh(S.bMT(4,8,"subscriptionPendingCanceled")),S.R7$(2),S.Y8G("appApiAction",i.reinstatePromise)("disabled",t.loading()),S.R7$(2),S.SpI(" ",S.bMT(8,10,"reinstateSubscription")," ")}}function Ri(t,i){1&t&&(S.j41(0,"span",21),S.EFF(1),S.nI1(2,"i18n"),S.k0s()),2&t&&(S.R7$(),S.JRh(S.bMT(2,1,"pendingCancellation")))}function Ti(t,i){if(1&t&&(S.qex(0),S.j41(1,"div",23)(2,"span"),S.nI1(3,"i18n"),S.EFF(4),S.nI1(5,"date"),S.k0s(),S.nrm(6,"billing-discount-badge",24),S.k0s(),S.bVm()),2&t){const t=S.XpG(4);S.R7$(2),S.BMQ("aria-label",S.bMT(3,3,"nextChargeDate")),S.R7$(2),S.SpI(" ",S.i5U(5,5,t.sub.subscription.periodEndDate,"MMM d, y")," "),S.R7$(2),S.Y8G("discount",t.getDiscount(null==t.sub?null:t.sub.customerDiscount))}}function ki(t,i){if(1&t&&(S.j41(0,"div",23)(1,"span"),S.nI1(2,"i18n"),S.EFF(3),S.nI1(4,"date"),S.k0s()()),2&t){const t=S.XpG(4);S.R7$(),S.BMQ("aria-label",S.bMT(2,2,"nextChargeDate")),S.R7$(2),S.SpI(" ",S.i5U(4,4,t.sub.subscription.periodEndDate,"MMM d, y")," ")}}function xi(t,i){if(1&t&&(S.qex(0),S.DNE(1,Ti,7,8,"ng-container",22),S.nI1(2,"async"),S.DNE(3,ki,5,7,"ng-template",null,1,S.C5r),S.bVm()),2&t){const t=S.sdS(4),i=S.XpG(3);S.R7$(),S.Y8G("ngIf",S.bMT(2,2,i.enableDiscountDisplay$))("ngIfElse",t)}}function Mi(t,i){1&t&&(S.j41(0,"span",25),S.nI1(1,"i18n"),S.EFF(2,"-"),S.k0s()),2&t&&S.BMQ("aria-label",S.bMT(1,1,"noChargeScheduled"))}function Pi(t,i){if(1&t&&(S.j41(0,"div",12)(1,"div",13)(2,"div",14)(3,"div",15),S.EFF(4),S.nI1(5,"i18n"),S.k0s(),S.j41(6,"div"),S.EFF(7),S.nI1(8,"i18n"),S.k0s()(),S.j41(9,"div",14)(10,"div",15),S.EFF(11),S.nI1(12,"i18n"),S.k0s(),S.j41(13,"div",16)(14,"span",17),S.EFF(15),S.k0s(),S.DNE(16,Ri,3,3,"span",18),S.k0s()(),S.j41(17,"div",14)(18,"div",19),S.EFF(19),S.nI1(20,"i18n"),S.k0s(),S.j41(21,"div"),S.DNE(22,xi,5,4,"ng-container",3)(23,Mi,3,3,"span",20),S.k0s()()()()),2&t){const t=S.XpG(2);S.R7$(4),S.JRh(S.bMT(5,8,"plan")),S.R7$(3),S.JRh(S.bMT(8,10,"premiumMembership")),S.R7$(4),S.JRh(S.bMT(12,12,"status")),S.R7$(4),S.JRh(t.subscription&&t.subscriptionStatus||"-"),S.R7$(),S.Y8G("ngIf",t.subscriptionMarkedForCancel),S.R7$(3),S.JRh(S.bMT(20,14,"nextChargeHeader")),S.R7$(3),S.Y8G("ngIf",t.subscription),S.R7$(),S.Y8G("ngIf",!t.subscription)}}function ji(t,i){1&t&&(S.j41(0,"span",40),S.EFF(1),S.nI1(2,"i18n"),S.k0s()),2&t&&(S.R7$(),S.JRh(S.bMT(2,1,"active")))}function Ui(t,i){if(1&t&&(S.j41(0,"p",41),S.EFF(1),S.nI1(2,"i18n"),S.j41(3,"strong"),S.EFF(4),S.nI1(5,"date"),S.k0s(),S.EFF(6,". "),S.k0s()),2&t){const t=S.XpG(3);S.R7$(),S.SpI(" ",S.bMT(2,2,"youNeedToUpdateLicenseFile")," "),S.R7$(3),S.JRh(S.i5U(5,4,t.sub.expiration,"MMMM d, y"))}}function Gi(t,i){if(1&t){const t=S.RV6();S.qex(0),S.j41(1,"div",26)(2,"h1",27),S.EFF(3),S.nI1(4,"i18n"),S.k0s(),S.j41(5,"div",28),S.EFF(6),S.nI1(7,"i18n"),S.k0s()(),S.j41(8,"div",29)(9,"bit-base-card",30)(10,"div",31)(11,"div",32)(12,"div")(13,"h2",33),S.EFF(14),S.nI1(15,"i18n"),S.k0s()(),S.DNE(16,ji,3,3,"span",34),S.k0s(),S.DNE(17,Ui,7,7,"p",35),S.j41(18,"div",36)(19,"button",37),S.bIt("click",function(){a.eBV(t);const i=S.XpG(2);return a.Njj(i.updateLicense())}),S.EFF(20),S.nI1(21,"i18n"),S.k0s(),S.j41(22,"a",38),S.EFF(23),S.nI1(24,"i18n"),S.nrm(25,"i",39),S.k0s()()()()(),S.bVm()}if(2&t){const t=S.XpG(2);S.R7$(3),S.JRh(S.bMT(4,9,"youHaveBitwardenPremium")),S.R7$(3),S.SpI(" ",S.bMT(7,11,"viewAndManagePremiumSubscription")," "),S.R7$(8),S.SpI(" ",S.bMT(15,13,"premiumMembership")," "),S.R7$(2),S.Y8G("ngIf",t.isSubscriptionActive),S.R7$(),S.Y8G("ngIf",t.sub.expiration),S.R7$(3),S.SpI(" ",S.bMT(21,15,"updateLicense")," "),S.R7$(2),S.Y8G("href",S.VkB("",t.cloudWebVaultUrl,"/#/settings/subscription"),S.B4B),S.R7$(),S.SpI(" ",S.bMT(24,17,"launchCloudSubscriptionSentenceCase")," ")}}function Ei(t,i){if(1&t){const t=S.RV6();S.qex(0),S.j41(1,"div",50)(2,"div",36)(3,"button",51),S.bIt("click",function(){a.eBV(t);const i=S.XpG(3);return a.Njj(i.adjustStorage(!0))}),S.EFF(4),S.nI1(5,"i18n"),S.k0s(),S.j41(6,"button",51),S.bIt("click",function(){a.eBV(t);const i=S.XpG(3);return a.Njj(i.adjustStorage(!1))}),S.EFF(7),S.nI1(8,"i18n"),S.k0s()()(),S.bVm()}2&t&&(S.R7$(4),S.SpI(" ",S.bMT(5,2,"addStorage")," "),S.R7$(3),S.SpI(" ",S.bMT(8,4,"removeStorage")," "))}function Xi(t,i){if(1&t){const t=S.RV6();S.j41(0,"button",51),S.bIt("click",function(){a.eBV(t);const i=S.XpG(3);return a.Njj(i.downloadLicense())}),S.EFF(1),S.nI1(2,"i18n"),S.k0s()}2&t&&(S.R7$(),S.SpI(" ",S.bMT(2,1,"downloadLicense")," "))}function Di(t,i){if(1&t){const t=S.RV6();S.j41(0,"button",52,2),S.bIt("click",function(){a.eBV(t);const i=S.XpG(3);return a.Njj(i.cancelSubscription())}),S.EFF(2),S.nI1(3,"i18n"),S.k0s()}if(2&t){const t=S.sdS(1),i=S.XpG(3);S.Y8G("appApiAction",i.cancelPromise)("disabled",t.loading()),S.R7$(2),S.SpI(" ",S.bMT(3,3,"cancelSubscription")," ")}}function Ci(t,i){if(1&t&&(S.j41(0,"div",42)(1,"h3",43),S.EFF(2),S.nI1(3,"i18n"),S.k0s(),S.j41(4,"p",10),S.EFF(5),S.nI1(6,"i18n"),S.k0s(),S.nrm(7,"bit-progress",44),S.DNE(8,Ei,9,6,"ng-container",3),S.j41(9,"h3",45),S.EFF(10),S.nI1(11,"i18n"),S.k0s(),S.j41(12,"p",46),S.EFF(13),S.nI1(14,"i18n"),S.k0s(),S.j41(15,"div",47),S.DNE(16,Xi,3,3,"button",48)(17,Di,4,5,"button",49),S.k0s()()),2&t){const t=S.XpG(2);S.R7$(2),S.JRh(S.bMT(3,8,"storage")),S.R7$(3),S.SpI(" ",S.brH(6,10,"subscriptionStorage",t.sub.maxStorageGb||0,t.sub.storageName||"0 MB")," "),S.R7$(2),S.Y8G("barWidth",t.storagePercentage),S.R7$(),S.Y8G("ngIf",t.subscription&&!t.subscription.cancelled&&!t.subscriptionMarkedForCancel),S.R7$(2),S.JRh(S.bMT(11,14,"additionalOptions")),S.R7$(3),S.JRh(S.bMT(14,16,"additionalOptionsDesc")),S.R7$(3),S.Y8G("ngIf",!t.subscription||!t.subscription.cancelled),S.R7$(),S.Y8G("ngIf",t.subscription&&!t.subscription.cancelled&&!t.subscriptionMarkedForCancel)}}function Ai(t,i){if(1&t&&(S.qex(0),S.DNE(1,$i,4,7,"bit-callout",6)(2,Fi,9,12,"bit-callout",6)(3,Pi,24,16,"div",7)(4,Gi,26,19,"ng-container",3)(5,Ci,18,18,"div",8),S.bVm()),2&t){const t=S.XpG();S.R7$(),S.Y8G("ngIf",t.subscription&&t.subscription.cancelled),S.R7$(),S.Y8G("ngIf",t.subscriptionMarkedForCancel),S.R7$(),S.Y8G("ngIf",!t.selfHosted),S.R7$(),S.Y8G("ngIf",t.selfHosted),S.R7$(),S.Y8G("ngIf",!t.selfHosted)}}class Bi{constructor(t,i,e,n,s,o,r,a,c,l,d,p){this.apiService=t,this.platformUtilsService=i,this.i18nService=e,this.router=n,this.logService=s,this.fileDownloadService=o,this.dialogService=r,this.environmentService=a,this.billingAccountProfileStateService=c,this.toastService=l,this.accountService=d,this.configService=p,this.loading=!1,this.firstLoaded=!1,this.selfHosted=!1,this.enableDiscountDisplay$=this.configService.getFeatureFlag$(u.TO.PM23341_Milestone_2),this.cancelSubscription=()=>Si(this,void 0,void 0,function*(){const t=(0,Et.GM)(this.dialogService,{data:{type:"User"}});this.cancelPromise=(0,G.s)(t.closed);(yield this.cancelPromise)!==Et.vD.Closed&&(yield this.load())}),this.updateLicense=()=>Si(this,void 0,void 0,function*(){if(this.loading)return;const t=ot.open(this.dialogService,{data:{fromUserSubscriptionPage:!0}});(yield(0,G.s)(t.closed))===N.Y.Updated&&(yield this.load())}),this.adjustStorage=t=>Si(this,void 0,void 0,function*(){const i=mi.A.open(this.dialogService,{data:{price:4,cadence:"year",type:t?"Add":"Remove"}});(yield(0,G.s)(i.closed))===mi.W.Submitted&&(yield this.load())}),this.selfHosted=this.platformUtilsService.isSelfHost()}ngOnInit(){return Si(this,void 0,void 0,function*(){this.cloudWebVaultUrl=yield(0,E._)(this.environmentService.cloudWebVaultUrl$),yield this.load(),this.firstLoaded=!0})}load(){return Si(this,void 0,void 0,function*(){if(this.loading)return;const t=yield(0,E._)(this.accountService.activeAccount$);(yield(0,E._)(this.billingAccountProfileStateService.hasPremiumPersonally$(t.id)))?(this.loading=!0,this.sub=yield this.apiService.getUserSubscription(),this.loading=!1):this.router.navigate(["/settings/subscription/premium"])})}reinstate(){return Si(this,void 0,void 0,function*(){if(this.loading)return;if(yield this.dialogService.openSimpleDialog({title:{key:"reinstateSubscription"},content:{key:"reinstateConfirmation"},type:"warning"}))try{this.reinstatePromise=this.apiService.postReinstatePremium(),yield this.reinstatePromise,this.toastService.showToast({variant:"success",title:null,message:this.i18nService.t("reinstated")}),this.load()}catch(t){this.logService.error(t)}})}downloadLicense(){if(this.loading)return;const t=JSON.stringify(this.sub.license,null,2);this.fileDownloadService.download({fileName:"bitwarden_premium_license.json",blobData:t})}get subscriptionMarkedForCancel(){return null!=this.subscription&&!this.subscription.cancelled&&this.subscription.cancelAtEndDate}get subscription(){return null!=this.sub?this.sub.subscription:null}get nextInvoice(){return null!=this.sub?this.sub.upcomingInvoice:null}get subscriptionAmount(){var t;return(null===(t=this.subscription)||void 0===t?void 0:t.items)&&0!==this.subscription.items.length?this.subscription.items.reduce((t,i)=>t+(i.amount||0)*(i.quantity||0),0):0}get discountedSubscriptionAmount(){var t;return null!=(null===(t=this.nextInvoice)||void 0===t?void 0:t.amount)?this.nextInvoice.amount:this.subscriptionAmount}get storagePercentage(){return null!=this.sub&&this.sub.maxStorageGb?+(this.sub.storageGb/this.sub.maxStorageGb*100).toFixed(2):0}get title(){return this.i18nService.t(this.selfHosted?"subscription":"premiumMembership")}get subscriptionStatus(){if(this.subscription){if("incomplete"===this.subscription.status){const t=new Date(this.subscription.periodStartDate).getTime();return(new Date).getTime()-t<=15e3?this.i18nService.t("active"):this.subscription.status}return this.subscription.status}return null}getDiscount(t){return t?t.amountOff?{type:n.Tu.AmountOff,value:t.amountOff}:{type:n.Tu.PercentOff,value:t.percentOff}:null}get isSubscriptionActive(){if(!this.sub)return!1;if(this.selfHosted)return!0;const t=this.sub.expiration;if(!t||""===t.trim())return!0;const i=new Date(t);return!!isNaN(i.getTime())||i>new Date}}Bi.ɵfac=function(t){return new(t||Bi)(S.rXU(O.G),S.rXU(d.y),S.rXU(H.W),S.rXU(rt.Ix),S.rXU(hi.K),S.rXU(St.y),S.rXU(W.o3),S.rXU(X.v),S.rXU(z.Q),S.rXU(Q.f),S.rXU(I.D),S.rXU(yt.w))},Bi.ɵcmp=S.VBU({type:Bi,selectors:[["ng-component"]],standalone:!1,decls:2,vars:2,consts:[["reinstateBtn",""],["noDiscount",""],["cancelBtn",""],[4,"ngIf"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","tw-text-muted",3,"title"],[1,"tw-sr-only"],["type","warning",3,"title",4,"ngIf"],["class","tw-flex tw-max-w-[1340px] tw-pt-6",4,"ngIf"],["class","tw-max-w-[1340px]",4,"ngIf"],["type","warning",3,"title"],["bitTypography","body1"],["bitButton","","type","button","buttonType","secondary",3,"click","appApiAction","disabled"],[1,"tw-flex","tw-max-w-[1340px]","tw-pt-6"],[1,"tw-flex","tw-gap-16","tw-justify-between","tw-w-full"],[1,"tw-flex","tw-flex-col"],[1,"tw-font-semibold","tw-mb-2"],[1,"tw-flex","tw-items-center","tw-gap-2","tw-flex-wrap"],[1,"tw-capitalize"],["bitBadge","","variant","warning","class","tw-inline-flex",4,"ngIf"],[1,"tw-font-semibold","tw-mb-2","tw-text-right"],["class","tw-block tw-text-right",4,"ngIf"],["bitBadge","","variant","warning",1,"tw-inline-flex"],[4,"ngIf","ngIfElse"],[1,"tw-flex","tw-items-center","tw-gap-2","tw-flex-wrap","tw-justify-end"],[3,"discount"],[1,"tw-block","tw-text-right"],[1,"tw-mt-10","tw-text-center","tw-pb-4"],[1,"tw-text-4xl","tw-my-0"],[1,"tw-text-muted","tw-text-xs","tw-mb-4","tw-mt-2"],[1,"tw-flex","tw-justify-center"],[1,"tw-w-[800px]","tw-p-4","sm:tw-p-6"],[1,"tw-flex","tw-flex-col","tw-gap-5"],[1,"tw-flex","tw-items-center","tw-justify-between"],["bitTypography","h2",1,"tw-font-semibold","tw-mb-0"],["bitBadge","","variant","success",4,"ngIf"],["bitTypography","body1","class","tw-m-0",4,"ngIf"],[1,"tw-flex","tw-gap-4"],["type","button","bitButton","","buttonType","secondary",3,"click"],["bitButton","","buttonType","secondary","target","_blank","rel","noreferrer",3,"href"],["aria-hidden","true",1,"bwi","bwi-external-link","tw-ml-1"],["bitBadge","","variant","success"],["bitTypography","body1",1,"tw-m-0"],[1,"tw-max-w-[1340px]"],["bitTypography","h3",1,"tw-mt-8"],["bgColor","success","size","default",3,"barWidth"],["bitTypography","h3",1,"tw-mt-16"],["bitTypography","body1",1,"tw-mt-3"],[1,"tw-flex","tw-gap-4","tw-mt-3"],["bitButton","","type","button","buttonType","secondary",3,"click",4,"ngIf"],["bitButton","","type","button","buttonType","danger",3,"appApiAction","disabled","click",4,"ngIf"],[1,"tw-mt-3"],["bitButton","","type","button","buttonType","secondary",3,"click"],["bitButton","","type","button","buttonType","danger",3,"click","appApiAction","disabled"]],template:function(t,i){1&t&&S.DNE(0,Ii,6,7,"ng-container",3)(1,Ai,6,5,"ng-container",3),2&t&&(S.Y8G("ngIf",!i.firstLoaded&&i.loading),S.R7$(),S.Y8G("ngIf",i.sub))},dependencies:[F.bT,gi.k,at.n,tt.Q,fi.G,vi.X,ct.r,wi.U,yi.f,F.Jj,F.vh,R.$],encapsulation:2});const Vi=[{path:"",component:bi,data:{titleId:"subscription"},children:[{path:"",pathMatch:"full",redirectTo:"premium"},...(0,l.w)({defaultComponent:Bi,flaggedComponent:Vt,featureFlag:u.TO.PM29594_UpdateIndividualSubscriptionPage,routeOptions:{path:"user-subscription",data:{titleId:"premiumMembership"}}}),{path:"premium",component:mt,data:{titleId:"goPremium"},canMatch:[()=>(0,a.WQX)(d.y).isSelfHost()]},{path:"premium",component:ci,data:{titleId:"goPremium"}},{path:"payment-details",component:M,data:{titleId:"paymentDetails"}},{path:"billing-history",component:Ht,data:{titleId:"billingHistory"}}]}];class Yi{}Yi.ɵfac=function(t){return new(t||Yi)},Yi.ɵmod=S.$C({type:Yi}),Yi.ɵinj=a.G2t({imports:[c.iI.forChild(Vi),c.iI]});class Ni{}Ni.ɵfac=function(t){return new(t||Ni)},Ni.ɵmod=S.$C({type:Ni}),Ni.ɵinj=a.G2t({imports:[Yi,r.rd,o.G,s.Pu,s.vU,n.Y2]})}}]);
//# sourceMappingURL=813.89f2b50ec91ac173b62f.js.map