"use strict";(self.webpackChunk_bitwarden_web_vault=self.webpackChunk_bitwarden_web_vault||[]).push([[573],{86573:(t,i,e)=>{e.d(i,{i:()=>yt});var o,n=e(5253),r=e(3867),s=e(51757),a=e(44500),c=e(14803),l=e(66046),p=e(83892),d=e(12610),u=e(3204),h=e(33338),f=e(36359),m=e(44451),b=e(58625),g=e(49355),y=e(11994),v=e(67553),F=e(52759),w=e(3633),x=e(36502),E=e(78781),S=e(20377),I=e(45154),$=e(26411),P=e(37579),T=e(29029),z=e(22191),D=e(8433),V=e(80351),k=e(8297),R=e(30681),j=e(29776),C=e(9719);!function(t){t[t.AccountEncrypted=0]="AccountEncrypted",t[t.FileEncrypted=1]="FileEncrypted"}(o||(o={}));var G=e(72245),M=e(35500),O=e(88016),A=e(44432),B=function(t,i,e,o){return new(e||(e=Promise))((function(n,r){function s(t){try{c(o.next(t))}catch(i){r(i)}}function a(t){try{c(o.throw(t))}catch(i){r(i)}}function c(t){var i;t.done?n(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(s,a)}c((o=o.apply(t,i||[])).next())}))};function _(t,i){if(1&t&&(r.qex(0),r.j41(1,"bit-callout",1),r.nI1(2,"i18n"),r.EFF(3),r.nI1(4,"i18n"),r.k0s(),r.bVm()),2&t){const t=r.XpG();r.R7$(),r.FS9("title",r.bMT(2,2,t.scopeConfig.title)),r.R7$(2),r.SpI(" ",r.i5U(4,4,t.scopeConfig.description,t.scopeConfig.scopeIdentifier)," ")}}class U{constructor(t,i){this.organizationService=t,this.accountService=i,this.show=!1,this.organizationId=(0,r.hFB)(),this.exportFormat=(0,r.hFB)(),(0,r.QZP)((()=>B(this,void 0,void 0,(function*(){this.show=!1,yield this.getScopeMessage(this.organizationId(),this.exportFormat()),this.show=!0}))))}getScopeMessage(t,i){return B(this,void 0,void 0,(function*(){const e=yield(0,G._)((0,w.F6)(this.accountService.activeAccount$));this.scopeConfig=null!=t?{title:"exportingOrganizationVaultTitle",description:"exportingOrganizationVaultDesc",scopeIdentifier:(yield(0,G._)(this.organizationService.organizations$(e).pipe((0,v.Sw)(t)))).name}:{title:"exportingPersonalVaultTitle",description:"zip"==i?"exportingIndividualVaultWithAttachmentsDescription":"exportingIndividualVaultDescription",scopeIdentifier:yield(0,G._)(this.accountService.activeAccount$.pipe((0,u.T)((t=>null==t?void 0:t.email))))}}))}}U.ɵfac=function(t){return new(t||U)(r.rXU(v.PV),r.rXU(M.Di))},U.ɵcmp=r.VBU({type:U,selectors:[["tools-export-scope-callout"]],inputs:{organizationId:[1,"organizationId"],exportFormat:[1,"exportFormat"]},decls:1,vars:1,consts:[[4,"ngIf"],["type","info",3,"title"]],template:function(t,i){1&t&&r.DNE(0,_,5,7,"ng-container",0),2&t&&r.Y8G("ngIf",i.show)},dependencies:[n.MD,n.bT,b.p,O.$,V.j,A.G],encapsulation:2});var X=e(50700),N=e(69855),Y=e(21274),J=e(81582),q=e(18499),L=e(56962),Q=e(53127),W=e(93103),H=e(25024),K=e(86226),Z=e(99917),tt=e(97553),it=e(43759),et=e(76356),ot=e(69896),nt=e(36288),rt=e(33886),st=e(68923),at=e(24374),ct=e(17721),lt=function(t,i,e,o){return new(e||(e=Promise))((function(n,r){function s(t){try{c(o.next(t))}catch(i){r(i)}}function a(t){try{c(o.throw(t))}catch(i){r(i)}}function c(t){var i;t.done?n(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(s,a)}c((o=o.apply(t,i||[])).next())}))};function pt(t,i){1&t&&(r.j41(0,"bit-callout",6),r.nI1(1,"i18n"),r.EFF(2),r.nI1(3,"i18n"),r.k0s()),2&t&&(r.FS9("title",r.bMT(1,2,"vaultExportDisabled")),r.R7$(2),r.SpI(" ",r.bMT(3,4,"personalVaultExportPolicyInEffect"),"\n"))}function dt(t,i){1&t&&(r.nrm(0,"bit-option",10),r.nI1(1,"i18n")),2&t&&r.Y8G("label",r.bMT(1,1,"myVault"))}function ut(t,i){if(1&t&&r.nrm(0,"bit-option",11),2&t){const t=i.$implicit;r.Y8G("value",t.id)("label",t.name)}}function ht(t,i){if(1&t&&(r.j41(0,"bit-form-field")(1,"bit-label"),r.EFF(2),r.nI1(3,"i18n"),r.k0s(),r.j41(4,"bit-select",7),r.DNE(5,dt,2,3,"bit-option",8),r.nI1(6,"async"),r.DNE(7,ut,1,2,"bit-option",9),r.nI1(8,"async"),r.k0s()()),2&t){const t=r.XpG(2);r.R7$(2),r.JRh(r.bMT(3,3,"exportFrom")),r.R7$(3),r.Y8G("ngIf",!r.bMT(6,5,t.organizationDataOwnershipPolicy$)),r.R7$(2),r.Y8G("ngForOf",r.bMT(8,7,t.organizations$))}}function ft(t,i){if(1&t&&(r.qex(0),r.DNE(1,ht,9,9,"bit-form-field",3),r.bVm()),2&t){const t=i.ngIf;r.R7$(),r.Y8G("ngIf",t.length>0)}}function mt(t,i){if(1&t&&r.nrm(0,"bit-option",12),2&t){const t=i.$implicit;r.Y8G("value",t.value)("label",t.name)}}function bt(t,i){if(1&t){const t=r.RV6();r.qex(0),r.j41(1,"div",16)(2,"bit-form-field")(3,"bit-label"),r.EFF(4),r.nI1(5,"i18n"),r.k0s(),r.nrm(6,"input",17),r.j41(7,"button",18),r.mxI("toggledChange",(function(i){r.eBV(t);const e=r.XpG(2);return r.DH7(e.showFilePassword,i)||(e.showFilePassword=i),r.Njj(i)})),r.k0s(),r.j41(8,"button",19),r.bIt("click",(function(){r.eBV(t);const i=r.XpG(2);return r.Njj(i.generatePassword())})),r.k0s(),r.nrm(9,"button",20),r.nI1(10,"i18n"),r.j41(11,"bit-hint"),r.EFF(12),r.nI1(13,"i18n"),r.k0s()(),r.nrm(14,"tools-password-strength",21),r.k0s(),r.j41(15,"bit-form-field")(16,"bit-label"),r.EFF(17),r.nI1(18,"i18n"),r.k0s(),r.nrm(19,"input",22),r.j41(20,"button",18),r.mxI("toggledChange",(function(i){r.eBV(t);const e=r.XpG(2);return r.DH7(e.showFilePassword,i)||(e.showFilePassword=i),r.Njj(i)})),r.k0s()(),r.bVm()}if(2&t){const t=r.XpG(2);r.R7$(4),r.JRh(r.bMT(5,10,"filePassword")),r.R7$(3),r.R50("toggled",t.showFilePassword),r.R7$(2),r.Y8G("disabled",!t.filePassword)("appCopyClick",t.filePassword)("valueLabel",r.bMT(10,12,"password")),r.R7$(3),r.JRh(r.bMT(13,14,"exportPasswordDescription")),r.R7$(2),r.Y8G("password",t.filePassword)("showText",!0),r.R7$(3),r.JRh(r.bMT(18,16,"confirmFilePassword")),r.R7$(3),r.R50("toggled",t.showFilePassword)}}function gt(t,i){if(1&t&&(r.qex(0),r.j41(1,"bit-radio-group",13)(2,"bit-label"),r.EFF(3),r.nI1(4,"i18n"),r.k0s(),r.j41(5,"bit-radio-button",14)(6,"bit-label"),r.EFF(7),r.nI1(8,"i18n"),r.k0s(),r.j41(9,"bit-hint"),r.EFF(10),r.nI1(11,"i18n"),r.k0s()(),r.j41(12,"bit-radio-button",15)(13,"bit-label"),r.EFF(14),r.nI1(15,"i18n"),r.k0s(),r.j41(16,"bit-hint"),r.EFF(17),r.nI1(18,"i18n"),r.k0s()()(),r.DNE(19,bt,21,18,"ng-container",3),r.bVm()),2&t){const t=r.XpG();r.R7$(3),r.JRh(r.bMT(4,8,"exportTypeHeading")),r.R7$(2),r.Y8G("value",t.encryptedExportType.AccountEncrypted),r.R7$(2),r.JRh(r.bMT(8,10,"accountRestricted")),r.R7$(3),r.JRh(r.bMT(11,12,"accountRestrictedOptionDescription")),r.R7$(2),r.Y8G("value",t.encryptedExportType.FileEncrypted),r.R7$(2),r.JRh(r.bMT(15,14,"passwordProtected")),r.R7$(3),r.JRh(r.bMT(18,16,"passwordProtectedOptionDescription")),r.R7$(2),r.Y8G("ngIf",t.fileEncryptionType==t.encryptedExportType.FileEncrypted)}}class yt{get organizationId(){return this._organizationId}set organizationId(t){this._organizationId=t,(0,w.F6)(this.accountService.activeAccount$).pipe((0,a.n)((t=>this.organizationService.organizations$(t).pipe((0,v.Sw)(this._organizationId))))).pipe((0,c.Q)(this.destroy$)).subscribe((t=>{this._organizationId=null==t?void 0:t.id}))}get disabledByPolicy(){return this._disabledByPolicy}constructor(t,i,e,n,a,c,p,d,u,h,f,m,b){this.i18nService=t,this.toastService=i,this.exportService=e,this.eventCollectionService=n,this.generatorService=a,this.policyService=c,this.logService=p,this.formBuilder=d,this.fileDownloadService=u,this.dialogService=h,this.organizationService=f,this.accountService=m,this.collectionService=b,this.formLoading=new r.bkB,this.formDisabled=new r.bkB,this.onSuccessfulExport=new r.bkB,this.encryptedExportType=o,this._disabledByPolicy=!1,this.exportForm=this.formBuilder.group({vaultSelector:["myVault",{nonNullable:!0,validators:[s.k0.required]}],format:["json",s.k0.required],secret:[""],filePassword:["",s.k0.required],confirmFilePassword:["",s.k0.required],fileEncryptionType:[o.AccountEncrypted]}),this.formatOptions=[{name:".json",value:"json"},{name:".csv",value:"csv"},{name:".json (Encrypted)",value:"encrypted_json"}],this.destroy$=new l.B,this.onlyManagedCollections=!0,this.onGenerate$=new l.B,this.generatePassword=()=>lt(this,void 0,void 0,(function*(){this.onGenerate$.next({source:"export",type:j.ZU.password})})),this.submit=()=>lt(this,void 0,void 0,(function*(){if(this.isFileEncryptedExport&&this.filePassword!=this.confirmFilePassword)return void this.toastService.showToast({variant:"error",title:this.i18nService.t("errorOccurred"),message:this.i18nService.t("filePasswordAndConfirmFilePasswordDoNotMatch")});if(this.exportForm.markAllAsTouched(),this.exportForm.invalid)return;if(this.disabledByPolicy)return void this.toastService.showToast({variant:"error",title:null,message:this.i18nService.t("personalVaultExportPolicyInEffect")});(yield this.verifyUser())&&(yield this.doExport())}))}ngOnInit(){return lt(this,void 0,void 0,(function*(){this.exportForm.statusChanges.pipe((0,c.Q)(this.destroy$)).subscribe((t=>{this.formDisabled.emit("DISABLED"===t)})),this.disablePersonalVaultExportPolicy$=this.accountService.activeAccount$.pipe(w.F6,(0,a.n)((t=>this.policyService.policyAppliesToUser$(F.tt.DisablePersonalVaultExport,t)))),this.organizationDataOwnershipPolicy$=this.accountService.activeAccount$.pipe(w.F6,(0,a.n)((t=>this.policyService.policyAppliesToUser$(F.tt.OrganizationDataOwnership,t)))),this.exportForm.controls.vaultSelector.valueChanges.pipe((0,c.Q)(this.destroy$)).subscribe((t=>{this.organizationId="myVault"!==t?t:void 0,this.formatOptions=this.formatOptions.filter((t=>"zip"!==t.value)),this.exportForm.get("format").setValue("json"),"myVault"===t&&this.formatOptions.push({name:".zip (with attachments)",value:"zip"})})),(0,p.h)(this.exportForm.get("format").valueChanges,this.exportForm.get("fileEncryptionType").valueChanges).pipe((0,d.Z)(0),(0,c.Q)(this.destroy$)).subscribe((()=>this.adjustValidators()));const t=this.accountService.activeAccount$.pipe((0,S.y_)({name:()=>"active export account",distinct:(t,i)=>t.id===i.id}));if(this.generatorService.generate$({on$:this.onGenerate$,account$:t}).pipe((0,c.Q)(this.destroy$)).subscribe((t=>{this.exportForm.patchValue({filePassword:t.credential,confirmFilePassword:t.credential})})),this.organizationId)return this.organizations$=this.accountService.activeAccount$.pipe(w.F6,(0,a.n)((t=>this.organizationService.memberOrganizations$(t).pipe((0,u.T)((t=>t.filter((t=>t.id==this.organizationId)))))))),this.exportForm.controls.vaultSelector.patchValue(this.organizationId),this.exportForm.controls.vaultSelector.disable(),void(this.onlyManagedCollections=!1);this.organizations$=(0,h.z)({collections:this.collectionService.decryptedCollections$,memberOrganizations:this.accountService.activeAccount$.pipe(w.F6,(0,a.n)((t=>this.organizationService.memberOrganizations$(t))))}).pipe((0,u.T)((({collections:t,memberOrganizations:i})=>{const e=new Set(t.filter((t=>t.manage)).map((t=>t.organizationId)));return i.filter((t=>e.has(t.id))).sort(E.A.getSortFunction(this.i18nService,"name"))}))),(0,h.z)([this.disablePersonalVaultExportPolicy$,this.organizationDataOwnershipPolicy$,this.organizations$]).pipe((0,f.M)((([t,i,e])=>{this._disabledByPolicy=t,i&&e.length>0&&(this.exportForm.enable(),this.exportForm.controls.vaultSelector.setValue(e[0].id)),i&&0===e.length&&this.exportForm.disable(),t&&this.exportForm.disable(),t||i||this.exportForm.controls.vaultSelector.setValue("myVault")})),(0,c.Q)(this.destroy$)).subscribe()}))}ngAfterViewInit(){this.bitSubmit.loading$.pipe((0,c.Q)(this.destroy$)).subscribe((t=>{this.formLoading.emit(t)}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}get encryptedFormat(){return"encrypted_json"===this.format}get isFileEncryptedExport(){return"encrypted_json"===this.format&&this.fileEncryptionType===o.FileEncrypted}get isAccountEncryptedExport(){return"encrypted_json"===this.format&&this.fileEncryptionType===o.AccountEncrypted}doExport(){return lt(this,void 0,void 0,(function*(){try{const t=yield this.getExportData();this.downloadFile(t),this.toastService.showToast({variant:"success",title:null,message:this.i18nService.t("exportSuccess")}),this.onSuccessfulExport.emit(this.organizationId),yield this.collectEvent(),this.exportForm.get("secret").setValue(""),this.exportForm.clearValidators()}catch(t){this.logService.error(t)}}))}verifyUser(){return lt(this,void 0,void 0,(function*(){let t="exportWarningDesc";this.isFileEncryptedExport?t="fileEncryptedExportWarningDesc":this.isAccountEncryptedExport&&(t="encExportKeyWarningDesc");const i=yield y.GA.open(this.dialogService,{title:"confirmVaultExport",bodyText:t,confirmButtonOptions:{text:"exportVault",type:"primary"}});return"cancel"!==i.userAction&&(!!i.verificationSuccess||(i.noAvailableClientVerificationMethods,!1))}))}getExportData(){return lt(this,void 0,void 0,(function*(){return E.A.isNullOrWhitespace(this.organizationId)?this.exportService.getExport(this.format,this.filePassword):this.exportService.getOrganizationExport(this.organizationId,this.format,this.filePassword,this.onlyManagedCollections)}))}collectEvent(){return lt(this,void 0,void 0,(function*(){return this.organizationId?yield this.eventCollectionService.collect(x.Bx.Organization_ClientExportedVault,null,!1,this.organizationId):yield this.eventCollectionService.collect(x.Bx.User_ClientExportedVault)}))}get format(){return this.exportForm.get("format").value}get filePassword(){return this.exportForm.get("filePassword").value}get confirmFilePassword(){return this.exportForm.get("confirmFilePassword").value}get fileEncryptionType(){return this.exportForm.get("fileEncryptionType").value}adjustValidators(){this.exportForm.get("confirmFilePassword").reset(),this.exportForm.get("filePassword").reset(),this.encryptedFormat&&this.fileEncryptionType==o.FileEncrypted?(this.exportForm.controls.filePassword.enable(),this.exportForm.controls.confirmFilePassword.enable()):(this.exportForm.controls.filePassword.disable(),this.exportForm.controls.confirmFilePassword.disable())}downloadFile(t){this.fileDownloadService.download({fileName:t.fileName,blobData:t.data,blobOptions:{type:t.type}})}}yt.ɵfac=function(t){return new(t||yt)(r.rXU(X.W),r.rXU(N.f),r.rXU(C.Os),r.rXU(J.c),r.rXU(j.iE),r.rXU(q.m),r.rXU(L.K),r.rXU(s.ze),r.rXU(Q.y),r.rXU(Y.o3),r.rXU(v.PV),r.rXU(M.Di),r.rXU(m.YD))},yt.ɵcmp=r.VBU({type:yt,selectors:[["tools-export"]],viewQuery:function(t,i){if(1&t&&(r.GBs(I.L,5),r.GBs(g.k,5)),2&t){let t;r.mGM(t=r.lsd())&&(i.bitSubmit=t.first),r.mGM(t=r.lsd())&&(i.passwordStrengthComponent=t.first)}},inputs:{organizationId:"organizationId"},outputs:{formLoading:"formLoading",formDisabled:"formDisabled",onSuccessfulExport:"onSuccessfulExport"},decls:13,vars:15,consts:[["type","danger",3,"title",4,"ngIf"],[3,"organizationId","exportFormat"],["id","export_form_exportForm",3,"formGroup","bitSubmit"],[4,"ngIf"],["formControlName","format"],[3,"value","label",4,"ngFor","ngForOf"],["type","danger",3,"title"],["formControlName","vaultSelector"],["value","myVault","icon","bwi-user",3,"label",4,"ngIf"],["icon","bwi-business",3,"value","label",4,"ngFor","ngForOf"],["value","myVault","icon","bwi-user",3,"label"],["icon","bwi-business",3,"value","label"],[3,"value","label"],["formControlName","fileEncryptionType","aria-label","exportTypeHeading"],["id","AccountEncrypted","name","fileEncryptionType","checked","fileEncryptionType === encryptedExportType.AccountEncrypted",1,"tw-block",3,"value"],["id","FileEncrypted","name","fileEncryptionType","checked","fileEncryptionType === encryptedExportType.FileEncrypted",1,"tw-block",3,"value"],[1,"tw-mb-3"],["bitInput","","type","password","id","filePassword","formControlName","filePassword","name","password"],["type","button","bitSuffix","","bitIconButton","","bitPasswordInputToggle","",3,"toggledChange","toggled"],["type","button","bitIconButton","bwi-generate","appStopClick","","bitSuffix","",3,"click"],["type","button","bitIconButton","bwi-clone","appStopClick","","bitSuffix","","showToast","",3,"disabled","appCopyClick","valueLabel"],[3,"password","showText"],["bitInput","","type","password","id","confirmFilePassword","formControlName","confirmFilePassword","name","confirmFilePassword"]],template:function(t,i){1&t&&(r.DNE(0,pt,4,6,"bit-callout",0),r.nI1(1,"async"),r.nrm(2,"tools-export-scope-callout",1),r.j41(3,"form",2),r.DNE(4,ft,2,1,"ng-container",3),r.nI1(5,"async"),r.j41(6,"bit-form-field")(7,"bit-label"),r.EFF(8),r.nI1(9,"i18n"),r.k0s(),r.j41(10,"bit-select",4),r.DNE(11,mt,1,2,"bit-option",5),r.k0s()(),r.DNE(12,gt,20,18,"ng-container",3),r.k0s()),2&t&&(r.Y8G("ngIf",r.bMT(1,9,i.disablePersonalVaultExportPolicy$)),r.R7$(2),r.Y8G("organizationId",i.organizationId)("exportFormat",i.format),r.R7$(),r.Y8G("formGroup",i.exportForm)("bitSubmit",i.submit),r.R7$(),r.Y8G("ngIf",r.bMT(5,11,i.organizations$)),r.R7$(4),r.JRh(r.bMT(9,13,"fileFormat")),r.R7$(3),r.Y8G("ngForOf",i.formatOptions),r.R7$(),r.Y8G("ngIf","encrypted_json"===i.format))},dependencies:[n.MD,n.Sq,n.bT,n.Jj,s.X1,s.qT,s.me,s.BC,s.cb,s.j4,s.JD,b.p,W.Y,H.D,O.$,$.L,K.m,Z.s,tt.J,it.h,et.e,ot.a,P.C,I.L,T.t,z.Q,nt.s,D.p,rt.w,st.P,V.j,A.G,k.K,at.d,ct.Y,U,g.k,R._h],encapsulation:2})}}]);
//# sourceMappingURL=573.f33bb64c36e6073bf403.js.map