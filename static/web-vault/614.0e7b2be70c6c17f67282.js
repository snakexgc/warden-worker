"use strict";(self.webpackChunk_bitwarden_web_vault=self.webpackChunk_bitwarden_web_vault||[]).push([[614],{1614:(t,i,n)=>{n.d(i,{OrganizationBillingModule:()=>ue});var e=n(90097),s=n(50866),o=n(72932),a=n(40101),r=n(6056),c=n(67553),l=n(16878),u=n(44500),d=n(69194),p=n(72245),h=n(83892),b=n(36359),g=n(27442),m=n(66046),v=n(88565),f=n(33338),S=n(93695),y=n(58363),I=n(14803),w=n(8131),R=n(3633),$=n(82468),F=n(15639),T=n(5819),G=n(98221),M=n(1094),A=n(27760),k=n(63734),x=n(31925),j=n(25065),C=n(33812),E=n(74208),P=n(35500),B=n(23649),U=n(1601),D=n(21274),z=n(93748),X=n(10672),O=n(77468),Y=n(88016),N=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};function V(t,i){if(1&t){const t=C.RV6();C.j41(0,"app-organization-free-trial-warning",1),C.bIt("clicked",function(){E.eBV(t);const i=C.XpG();return E.Njj(i.changePaymentMethod())}),C.k0s()}if(2&t){C.XpG();const t=C.r8f(0);C.Y8G("organization",t)}}function L(t,i){1&t&&(C.qex(0),C.nrm(1,"i",2),C.nI1(2,"i18n"),C.j41(3,"span",3),C.EFF(4),C.nI1(5,"i18n"),C.k0s(),C.bVm()),2&t&&(C.R7$(),C.Y8G("title",C.mNQ(C.bMT(2,3,"loading"))),C.R7$(3),C.JRh(C.bMT(5,5,"loading")))}function q(t,i){if(1&t){const t=C.RV6();C.qex(0),C.j41(1,"app-display-payment-method",4),C.bIt("updated",function(i){E.eBV(t);const n=C.XpG();return E.Njj(n.setPaymentMethod(i))}),C.k0s(),C.j41(2,"app-display-billing-address",5),C.bIt("updated",function(i){E.eBV(t);const n=C.XpG();return E.Njj(n.setBillingAddress(i))}),C.k0s(),C.nrm(3,"app-display-account-credit",6),C.bVm()}if(2&t){const t=C.XpG(),i=C.r8f(5);C.R7$(),C.Y8G("subscriber",i.organization)("paymentMethod",i.paymentMethod),C.R7$(),C.Y8G("subscriber",i.organization)("billingAddress",i.billingAddress)("taxIdWarning",t.enableTaxIdWarning?i.taxIdWarning:null),C.R7$(),C.Y8G("subscriber",i.organization)("credit",i.credit)}}const J=new T.Lg("organizationBankAccountVerified");class _{constructor(t,i,n,e,s,o,a,r){this.accountService=t,this.activatedRoute=i,this.configService=n,this.dialogService=e,this.messageListener=s,this.organizationService=o,this.organizationWarningsService=a,this.subscriberBillingClient=r,this.viewState$=new l.t(null),this.organization$=this.accountService.activeAccount$.pipe(R.F6,(0,u.n)(t=>this.organizationService.organizations$(t).pipe((0,F.Hc)(this.activatedRoute.snapshot.params.organizationId))),(0,d.p)(t=>!!t)),this.load$=this.organization$.pipe(x.bL,(0,u.n)(t=>N(this,void 0,void 0,function*(){const i=(0,p._)(this.organizationWarningsService.getTaxIdWarning$(t.data)),[n,e,s,o]=yield Promise.all([this.subscriberBillingClient.getPaymentMethod(t),this.subscriberBillingClient.getBillingAddress(t),this.subscriberBillingClient.getCredit(t),i]);return{organization:t,paymentMethod:n,billingAddress:e,credit:s,taxIdWarning:o}}))),this.view$=(0,h.h)(this.load$.pipe((0,b.M)(t=>this.viewState$.next(t))),this.viewState$.pipe((0,d.p)(t=>null!==t))).pipe((0,g.t)({bufferSize:1,refCount:!0})),this.destroy$=new m.B,this.changePaymentMethod=()=>N(this,void 0,void 0,function*(){const t=yield(0,p._)(this.view$),i=k.tD.open(this.dialogService,{data:{subscriber:t.organization}}),n=yield(0,v.s)(i.closed);"success"===(null==n?void 0:n.type)&&(yield this.setPaymentMethod(n.paymentMethod))}),this.setBillingAddress=t=>{var i;this.viewState$.value&&(this.enableTaxIdWarning&&(null===(i=this.viewState$.value.billingAddress)||void 0===i?void 0:i.taxId)!==t.taxId&&this.organizationWarningsService.refreshTaxIdWarning(),this.viewState$.next(Object.assign(Object.assign({},this.viewState$.value),{billingAddress:t})))},this.setPaymentMethod=t=>N(this,void 0,void 0,function*(){var i;if(this.viewState$.value){this.viewState$.value.paymentMethod||this.organizationWarningsService.refreshFreeTrialWarning();const n=null!==(i=this.viewState$.value.billingAddress)&&void 0!==i?i:yield this.subscriberBillingClient.getBillingAddress(this.viewState$.value.organization);this.viewState$.next(Object.assign(Object.assign({},this.viewState$.value),{paymentMethod:t,billingAddress:n}))}})}ngOnInit(){return N(this,void 0,void 0,function*(){var t,i;null!==(i=null===(t=history.state)||void 0===t?void 0:t.launchPaymentModalAutomatically)&&void 0!==i&&i&&(history.replaceState(Object.assign(Object.assign({},history.state),{launchPaymentModalAutomatically:!1}),""),yield this.changePaymentMethod()),this.enableTaxIdWarning=yield this.configService.getFeatureFlag($.TO.PM22415_TaxIDWarnings),this.enableTaxIdWarning&&this.organizationWarningsService.taxIdWarningRefreshed$.pipe((0,u.n)(t=>(0,f.z)([(0,S.of)(t),this.organization$.pipe((0,y.s)(1)).pipe(x.bL,(0,u.n)(t=>this.subscriberBillingClient.getBillingAddress(t)))])),(0,I.Q)(this.destroy$)).subscribe(([t,i])=>{this.viewState$.value&&this.viewState$.next(Object.assign(Object.assign({},this.viewState$.value),{taxIdWarning:t,billingAddress:i}))}),this.messageListener.messages$(J).pipe((0,w.E)(this.view$),(0,d.p)(([t,i])=>t.organizationId===i.organization.data.id),(0,u.n)(t=>N(this,[t],void 0,function*([t,i]){return yield Promise.all([this.subscriberBillingClient.getPaymentMethod(i.organization),this.subscriberBillingClient.getBillingAddress(i.organization)])})),(0,b.M)(t=>N(this,[t],void 0,function*([t,i]){t&&(yield this.setPaymentMethod(t)),i&&this.setBillingAddress(i)})),(0,I.Q)(this.destroy$)).subscribe()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}_.ɵfac=function(t){return new(t||_)(C.rXU(P.Di),C.rXU(B.nX),C.rXU(U.w),C.rXU(D.o3),C.rXU(T.qk),C.rXU(c.PV),C.rXU(A.S),C.rXU(G.Hd))},_.ɵcmp=C.VBU({type:_,selectors:[["ng-component"]],decls:9,vars:8,consts:[[3,"organization"],[3,"clicked","organization"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","tw-text-muted",3,"title"],[1,"tw-sr-only"],[3,"updated","subscriber","paymentMethod"],[3,"updated","subscriber","billingAddress","taxIdWarning"],[3,"subscriber","credit"]],template:function(t,i){if(1&t&&(C.SS7(0),C.nI1(1,"async"),C.nVh(2,V,1,1,"app-organization-free-trial-warning",0),C.nrm(3,"app-header"),C.j41(4,"bit-container"),C.SS7(5),C.nI1(6,"async"),C.nVh(7,L,6,7,"ng-container")(8,q,4,7,"ng-container"),C.k0s()),2&t){const t=C.bH3(C.bMT(1,2,i.organization$));C.R7$(2),C.vxM(t?2:-1),C.R7$(3);const n=C.bH3(C.bMT(6,5,i.view$));C.R7$(2),C.vxM(n?8:7)}},dependencies:[k.I$,k.M0,k.H8,o.G,z.f,M.z,j.G,X.H,O.Jj,Y.$],encapsulation:2});var W=n(77259),Z=n(3204),H=n(13417),K=n(43978),Q=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};const tt=t=>Q(void 0,void 0,void 0,function*(){const i=(0,E.WQX)(c.PV),n=(0,E.WQX)(H.$),e=(0,E.WQX)(P.Di),s=yield(0,p._)(e.activeAccount$.pipe((0,Z.T)(t=>null==t?void 0:t.id)));if(!s)throw new Error("No user found.");const o=yield(0,p._)(i.organizations$(s).pipe((0,c.Sw)(t.params.organizationId)));if(!o)throw new Error("No organization found.");if(!o.hasProvider)return!0;const a=yield(0,p._)(n.get$(o.providerId,s));return!a||a.providerStatus!==K.kC.Billable});var it=n(83724),nt=n(73276),et=n(49247),st=n(56898),ot=n(78650),at=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};function rt(t,i){1&t&&(C.qex(0),C.nrm(1,"i",1),C.nI1(2,"i18n"),C.j41(3,"span",2),C.EFF(4),C.nI1(5,"i18n"),C.k0s(),C.bVm()),2&t&&(C.R7$(),C.Y8G("title",C.mNQ(C.bMT(2,3,"loading"))),C.R7$(3),C.JRh(C.bMT(5,5,"loading")))}function ct(t,i){if(1&t){const t=C.RV6();C.j41(0,"button",5),C.bIt("click",function(){E.eBV(t);const i=C.XpG(2);return E.Njj(i.load())}),C.EFF(1),C.nI1(2,"i18n"),C.k0s()}2&t&&(C.R7$(),C.SpI(" ",C.bMT(2,1,"loadMore")," "))}function lt(t,i){if(1&t&&(C.qex(0),C.nrm(1,"app-billing-history",3),C.DNE(2,ct,3,3,"button",4),C.bVm()),2&t){const t=C.XpG();C.R7$(),C.Y8G("openInvoices",t.openInvoices)("paidInvoices",t.paidInvoices)("transactions",t.transactions),C.R7$(),C.Y8G("ngIf",t.hasAdditionalHistory)}}class ut{constructor(t,i){this.organizationBillingApiService=t,this.route=i,this.loading=!1,this.firstLoaded=!1,this.openInvoices=[],this.paidInvoices=[],this.transactions=[],this.hasAdditionalHistory=!1,this.destroy$=new m.B}ngOnInit(){return at(this,void 0,void 0,function*(){this.route.params.pipe((0,nt.H)(t=>at(this,void 0,void 0,function*(){this.organizationId=t.organizationId,yield this.load(),this.firstLoaded=!0})),(0,I.Q)(this.destroy$)).subscribe()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}load(){return at(this,void 0,void 0,function*(){this.loading||(this.loading=!0,this.loading=!1)})}}ut.ɵfac=function(t){return new(t||ut)(C.rXU(et.C),C.rXU(B.nX))},ut.ɵcmp=C.VBU({type:ut,selectors:[["ng-component"]],standalone:!1,decls:4,vars:2,consts:[[4,"ngIf"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","tw-text-muted",3,"title"],[1,"tw-sr-only"],[3,"openInvoices","paidInvoices","transactions"],["type","button","bitButton","","buttonType","secondary",3,"click",4,"ngIf"],["type","button","bitButton","","buttonType","secondary",3,"click"]],template:function(t,i){1&t&&(C.nrm(0,"app-header"),C.j41(1,"bit-container"),C.DNE(2,rt,6,7,"ng-container",0)(3,lt,3,4,"ng-container",0),C.k0s()),2&t&&(C.R7$(2),C.Y8G("ngIf",!i.firstLoaded&&i.loading),C.R7$(),C.Y8G("ngIf",i.openInvoices||i.paidInvoices||i.transactions))},dependencies:[O.bT,st.Q,X.H,ot.D,z.f,Y.$],encapsulation:2});var dt=n(28202);const pt=n(13299).Sm`
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="4.8 6 110.4 107.52">
    <path class="tw-fill-illustration-bg-primary" d="M59.64 84.96c12.924 0 23.4-10.316 23.4-23.04 0-12.725-10.476-23.04-23.4-23.04-12.923 0-23.4 10.315-23.4 23.04 0 12.724 10.477 23.04 23.4 23.04Z"/>
    <path class="tw-fill-illustration-outline" fill-rule="evenodd" d="M59.64 40.08c-12.278 0-22.2 9.795-22.2 21.84 0 12.044 9.922 21.84 22.2 21.84 12.278 0 22.2-9.796 22.2-21.84 0-12.045-9.922-21.84-22.2-21.84Zm-24.6 21.84c0-13.405 11.031-24.24 24.6-24.24s24.6 10.835 24.6 24.24c0 13.405-11.031 24.24-24.6 24.24s-24.6-10.835-24.6-24.24Z" clip-rule="evenodd"/>
    <path class="tw-fill-illustration-bg-primary" d="M96 28.8a8.64 8.64 0 0 0 8.639-8.64 8.64 8.64 0 1 0-17.28 0A8.64 8.64 0 0 0 96 28.8Z"/>
    <path class="tw-fill-illustration-outline" fill-rule="evenodd" d="M96 12.72a7.44 7.44 0 1 0 0 14.88 7.44 7.44 0 0 0 0-14.88Zm-9.84 7.44c0-5.434 4.405-9.84 9.84-9.84 5.434 0 9.84 4.406 9.84 9.84 0 5.435-4.406 9.84-9.84 9.84-5.435 0-9.84-4.405-9.84-9.84Z" clip-rule="evenodd"/>
    <path class="tw-fill-illustration-bg-secondary" d="M105.359 72.72a8.64 8.64 0 0 0 8.64-8.64 8.64 8.64 0 1 0-17.28 0 8.64 8.64 0 0 0 8.64 8.64Z"/>
    <path class="tw-fill-illustration-outline" fill-rule="evenodd" d="M105.36 56.64a7.44 7.44 0 1 0 0 14.881 7.44 7.44 0 0 0 0-14.88Zm-9.84 7.44c0-5.434 4.405-9.84 9.84-9.84 5.434 0 9.84 4.406 9.84 9.84 0 5.435-4.406 9.84-9.84 9.84-5.435 0-9.84-4.405-9.84-9.84Z" clip-rule="evenodd"/>
    <path class="tw-fill-illustration-bg-tertiary" d="M97.44 112.32a8.64 8.64 0 1 0 0-17.28 8.64 8.64 0 0 0 0 17.28Z"/>
    <path class="tw-fill-illustration-outline" fill-rule="evenodd" d="M97.44 96.24a7.44 7.44 0 1 0 0 14.88 7.44 7.44 0 0 0 0-14.88Zm-9.84 7.44c0-5.435 4.405-9.84 9.84-9.84 5.434 0 9.84 4.405 9.84 9.84 0 5.434-4.406 9.84-9.84 9.84-5.435 0-9.84-4.406-9.84-9.84Z" clip-rule="evenodd"/>
    <path class="tw-fill-illustration-bg-primary" d="M39.119 111.599a8.64 8.64 0 1 0 0-17.28 8.64 8.64 0 0 0 0 17.28Z"/>
    <path class="tw-fill-illustration-outline" fill-rule="evenodd" d="M39.12 95.52a7.44 7.44 0 1 0 0 14.88 7.44 7.44 0 0 0 0-14.88Zm-9.84 7.44c0-5.434 4.405-9.84 9.84-9.84 5.434 0 9.84 4.406 9.84 9.84 0 5.435-4.406 9.84-9.84 9.84-5.435 0-9.84-4.405-9.84-9.84Z" clip-rule="evenodd"/>
    <path class="tw-fill-illustration-bg-secondary" d="M14.64 58.32a8.64 8.64 0 1 0 0-17.28 8.64 8.64 0 0 0 0 17.28Z"/>
    <path class="tw-fill-illustration-outline" fill-rule="evenodd" d="M14.64 42.24a7.44 7.44 0 1 0 0 14.88 7.44 7.44 0 0 0 0-14.88ZM4.8 49.68c0-5.435 4.405-9.84 9.84-9.84 5.434 0 9.84 4.405 9.84 9.84 0 5.434-4.406 9.84-9.84 9.84-5.435 0-9.84-4.406-9.84-9.84Z" clip-rule="evenodd"/>
    <path class="tw-fill-illustration-bg-tertiary" d="M39.84 24.48a8.64 8.64 0 1 0 0-17.28 8.64 8.64 0 0 0 0 17.28Z"/>
    <path class="tw-fill-illustration-outline" fill-rule="evenodd" d="M39.84 8.4a7.44 7.44 0 1 0 0 14.88 7.44 7.44 0 0 0 0-14.88ZM30 15.84C30 10.406 34.406 6 39.84 6s9.84 4.405 9.84 9.84c0 5.434-4.405 9.84-9.84 9.84-5.434 0-9.84-4.405-9.84-9.84Z" clip-rule="evenodd"/>
    <path class="tw-fill-illustration-outline" fill-rule="evenodd" d="M43.687 24.097a1.2 1.2 0 0 1 1.576.63l6.48 15.12a1.2 1.2 0 0 1-2.206.946l-6.48-15.12a1.2 1.2 0 0 1 .63-1.576ZM90.305 26.452a1.2 1.2 0 0 1 .123 1.692l-13.68 15.84a1.2 1.2 0 1 1-1.816-1.568l13.68-15.84a1.2 1.2 0 0 1 1.693-.124ZM22.844 52.239a1.2 1.2 0 0 1 1.477-.835l12.96 3.6a1.2 1.2 0 1 1-.642 2.312l-12.96-3.6a1.2 1.2 0 0 1-.835-1.477ZM51.228 82.475a1.2 1.2 0 0 1 .458 1.634l-6.48 11.52a1.2 1.2 0 1 1-2.092-1.177l6.48-11.52a1.2 1.2 0 0 1 1.634-.457ZM75.065 77.564a1.2 1.2 0 0 1 1.691.141l15.84 18.72a1.2 1.2 0 1 1-1.832 1.55l-15.84-18.72a1.2 1.2 0 0 1 .141-1.69ZM82.568 61.78a1.2 1.2 0 0 1 1.332-1.052l12.24 1.44a1.2 1.2 0 0 1-.28 2.384l-12.24-1.44a1.2 1.2 0 0 1-1.052-1.332Z" clip-rule="evenodd"/>
    <path class="tw-fill-illustration-tertiary" d="M72.633 60.217a1.2 1.2 0 0 0-.397.892v1.668c0 .354.156.69.427.918l2.501 2.107c.403.339.537.9.333 1.384l-.788 1.868a1.2 1.2 0 0 1-1.158.733l-3.424-.149a1.2 1.2 0 0 0-.898.349l-1.17 1.165a1.2 1.2 0 0 0-.349.956l.289 3.26a1.2 1.2 0 0 1-.732 1.212l-1.874.784a1.2 1.2 0 0 1-1.352-.302l-2.262-2.497a1.2 1.2 0 0 0-.89-.394h-1.685a1.2 1.2 0 0 0-.915.423l-2.122 2.498a1.2 1.2 0 0 1-1.378.33l-1.884-.788a1.2 1.2 0 0 1-.736-1.16l.148-3.397a1.2 1.2 0 0 0-.352-.902l-1.17-1.165a1.2 1.2 0 0 0-.952-.345l-3.287.288a1.2 1.2 0 0 1-1.21-.729l-.784-1.857a1.2 1.2 0 0 1 .304-1.36l2.501-2.245a1.2 1.2 0 0 0 .398-.893v-1.676a1.2 1.2 0 0 0-.416-.909l-2.526-2.176a1.2 1.2 0 0 1-.323-1.376l.792-1.877a1.2 1.2 0 0 1 1.158-.732l3.424.148a1.2 1.2 0 0 0 .898-.349l1.172-1.166c.251-.25.379-.6.348-.953L52 48.402a1.2 1.2 0 0 1 .732-1.21l1.869-.782a1.2 1.2 0 0 1 1.359.31l2.33 2.616a1.2 1.2 0 0 0 .897.402h1.68a1.2 1.2 0 0 0 .914-.423l2.123-2.497a1.2 1.2 0 0 1 1.377-.33l1.884.788a1.2 1.2 0 0 1 .736 1.159l-.148 3.397a1.2 1.2 0 0 0 .352.902l1.17 1.166c.251.25.6.376.952.345l3.287-.29a1.2 1.2 0 0 1 1.21.73l.784 1.858a1.2 1.2 0 0 1-.302 1.359l-2.573 2.315Zm-14.677-3.025c-2.704 1.105-3.952 4.141-2.843 6.764 1.11 2.692 4.16 3.934 6.794 2.83 2.634-1.104 3.951-4.141 2.842-6.764-1.04-2.692-4.09-3.934-6.793-2.83Z"/>
    <path class="tw-fill-illustration-outline" fill-rule="evenodd" d="M54.138 45.303a2.4 2.4 0 0 1 2.718.618l2.33 2.617h1.68l2.123-2.498a2.4 2.4 0 0 1 2.755-.66l1.884.788a2.4 2.4 0 0 1 1.472 2.32l-.148 3.396 1.17 1.165 3.287-.289a2.4 2.4 0 0 1 2.421 1.458l.784 1.859a2.4 2.4 0 0 1-.606 2.717l-2.572 2.315v1.668l2.501 2.107a2.4 2.4 0 0 1 .665 2.769l-.788 1.868a2.4 2.4 0 0 1-2.315 1.465l-3.424-.149-1.17 1.165.29 3.26a2.4 2.4 0 0 1-1.465 2.425l-1.874.784a2.4 2.4 0 0 1-2.705-.603L60.89 75.37h-1.685l-2.123 2.498a2.4 2.4 0 0 1-2.755.66l-1.884-.788a2.4 2.4 0 0 1-1.472-2.32l.148-3.396-1.17-1.165-3.287.289a2.4 2.4 0 0 1-2.421-1.458l-.784-1.858a2.4 2.4 0 0 1 .608-2.718l2.501-2.246v-1.676l-2.526-2.176a2.4 2.4 0 0 1-.645-2.751l.792-1.878a2.4 2.4 0 0 1 2.315-1.465l3.425.149 1.17-1.166-.292-3.401a2.4 2.4 0 0 1 1.465-2.42l1.869-.782Zm.926 2.214-1.869.782.293 3.4a2.4 2.4 0 0 1-.698 1.907l-1.171 1.166a2.4 2.4 0 0 1-1.797.697l-3.424-.148-.792 1.878 2.526 2.176a2.4 2.4 0 0 1 .833 1.818v1.676a2.4 2.4 0 0 1-.796 1.785L45.668 66.9l.783 1.858 3.287-.289a2.4 2.4 0 0 1 1.904.69l1.17 1.165a2.4 2.4 0 0 1 .704 1.806l-.148 3.397 1.884.787 2.123-2.497a2.4 2.4 0 0 1 1.829-.846h1.685a2.4 2.4 0 0 1 1.78.789l2.261 2.496 1.874-.783-.29-3.26a2.4 2.4 0 0 1 .698-1.912l1.17-1.165a2.4 2.4 0 0 1 1.797-.697l3.424.149.788-1.868-2.502-2.108a2.4 2.4 0 0 1-.853-1.835v-1.669a2.4 2.4 0 0 1 .794-1.783l2.573-2.315-.784-1.859-3.287.289a2.4 2.4 0 0 1-1.903-.69l-1.17-1.165a2.4 2.4 0 0 1-.705-1.806l.148-3.397-1.884-.788-2.123 2.498a2.4 2.4 0 0 1-1.828.846h-1.68a2.4 2.4 0 0 1-1.792-.804l-2.331-2.617Zm10.798 12.055c-1.301-3.338-5.073-4.834-8.36-3.49-3.313 1.352-4.865 5.091-3.496 8.336 1.364 3.302 5.117 4.836 8.365 3.474 3.21-1.345 4.858-5.06 3.49-8.32Zm-2.232.882c-.786-2.033-3.107-3.014-5.22-2.151-2.094.855-3.037 3.187-2.191 5.186l.004.01a3.98 3.98 0 0 0 5.22 2.18c2.052-.86 3.038-3.209 2.2-5.19a1.065 1.065 0 0 1-.013-.035Z" clip-rule="evenodd"/>
  </svg>
`;var ht=n(88083),bt=n(56962),gt=n(33895),mt=n(97062),vt=n(51757),ft=n(7248);class St extends ft.V{constructor(){super(...arguments),this.type=K.pC.Default}}var yt=n(81525),It=n(62166),wt=n(12012),Rt=n(37115),$t=n(50700),Ft=n(11224),Tt=n(69855),Gt=n(7855),Mt=n(25024),At=n(26657),kt=n(45154),xt=n(44432),jt=n(7730),Ct=n(68016),Et=n(86226),Pt=n(97553),Bt=n(43759),Ut=n(69896),Dt=n(36288),zt=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};function Xt(t,i){1&t&&C.nrm(0,"app-user-verification",9)}function Ot(t,i){1&t&&(C.qex(0),C.j41(1,"p"),C.EFF(2),C.nI1(3,"i18n"),C.k0s(),C.j41(4,"bit-callout",10),C.EFF(5),C.nI1(6,"i18n"),C.k0s(),C.bVm()),2&t&&(C.R7$(2),C.JRh(C.bMT(3,2,"rotateBillingSyncTokenTitle")),C.R7$(3),C.SpI(" ",C.bMT(6,4,"rotateBillingSyncTokenWarning")," "))}function Yt(t,i){if(1&t&&(C.j41(0,"div",15)(1,"b",16),C.EFF(2),C.nI1(3,"i18n"),C.k0s(),C.EFF(4),C.nI1(5,"date"),C.k0s()),2&t){const t=C.XpG(2);C.R7$(2),C.SpI("",C.bMT(3,2,"lastSync"),":"),C.R7$(2),C.SpI(" ",C.i5U(5,4,t.lastSyncDate,"medium")," ")}}function Nt(t,i){if(1&t&&(C.j41(0,"div",17),C.nrm(1,"i",18),C.EFF(2),C.nI1(3,"i18n"),C.k0s()),2&t){const t=C.XpG(2);C.R7$(2),C.SpI(" ",C.i5U(3,1,1===t.daysBetween?"awaitingSyncSingular":"awaitingSyncPlural",t.daysBetween)," ")}}function Vt(t,i){if(1&t&&(C.j41(0,"div")(1,"p"),C.EFF(2),C.nI1(3,"i18n"),C.k0s(),C.j41(4,"bit-form-field")(5,"bit-label"),C.EFF(6),C.nI1(7,"i18n"),C.k0s(),C.nrm(8,"input",11)(9,"button",12),C.nI1(10,"i18n"),C.nI1(11,"i18n"),C.k0s(),C.DNE(12,Yt,6,7,"div",13)(13,Nt,4,4,"div",14),C.k0s()),2&t){const t=C.XpG();C.R7$(2),C.JRh(C.bMT(3,8,"copyPasteBillingSync")),C.R7$(4),C.JRh(C.bMT(7,10,"billingSyncKey")),C.R7$(2),C.Y8G("value",t.clientSecret),C.R7$(),C.Y8G("valueLabel",C.bMT(10,12,"billingSyncKey"))("appCopyClick",t.clientSecret)("label",C.bMT(11,14,"copyValue")),C.R7$(3),C.Y8G("ngIf",t.showLastSyncText),C.R7$(),C.Y8G("ngIf",t.showAwaitingSyncText)}}function Lt(t,i){if(1&t&&(C.j41(0,"button",19),C.EFF(1),C.k0s()),2&t){const t=C.XpG();C.R7$(),C.SpI(" ",t.submitButtonText," ")}}function qt(t,i){1&t&&(C.j41(0,"button",20),C.EFF(1),C.nI1(2,"i18n"),C.k0s()),2&t&&(C.R7$(),C.SpI(" ",C.bMT(2,1,"close")," "))}function Jt(t,i){if(1&t){const t=C.RV6();C.j41(0,"button",21),C.bIt("click",function(){E.eBV(t);const i=C.XpG();return E.Njj(i.cancelRotate())}),C.EFF(1),C.nI1(2,"i18n"),C.k0s()}2&t&&(C.R7$(),C.SpI(" ",C.bMT(2,1,"cancel")," "))}function _t(t,i){if(1&t){const t=C.RV6();C.j41(0,"button",21),C.bIt("click",function(){E.eBV(t);const i=C.XpG();return E.Njj(i.rotateToken())}),C.EFF(1),C.nI1(2,"i18n"),C.k0s()}2&t&&(C.R7$(),C.SpI(" ",C.bMT(2,1,"rotateToken")," "))}class Wt{constructor(t,i,n,e,s,o,a,r){this.data=t,this.userVerificationService=i,this.apiService=n,this.platformUtilsService=e,this.i18nService=s,this.organizationApiService=o,this.logService=a,this.toastService=r,this.formGroup=new vt.gE({verification:new vt.MJ(null,vt.k0.required)}),this.submit=()=>zt(this,void 0,void 0,function*(){try{const t=this.userVerificationService.buildRequest(this.formGroup.value.verification,St).then(t=>(t.type=K.pC.BillingSync,t));if(this.showRotateScreen){const i=yield t.then(t=>this.organizationApiService.rotateApiKey(this.organizationId,t));yield this.load(i),this.showRotateScreen=!1,this.toastService.showToast({variant:"success",title:null,message:this.i18nService.t("billingSyncApiKeyRotated")})}else{const i=yield t.then(t=>this.organizationApiService.getOrCreateApiKey(this.organizationId,t));yield this.load(i)}}catch(t){throw this.logService.error(t),t}}),this.organizationId=t.organizationId,this.hasBillingToken=t.hasBillingToken}copy(){this.platformUtilsService.copyToClipboard(this.clientSecret)}load(t){return zt(this,void 0,void 0,function*(){this.clientSecret=t.apiKey,this.keyRevisionDate=t.revisionDate,this.hasBillingToken=!0;const i=yield this.apiService.getSponsorshipSyncStatus(this.organizationId);this.lastSyncDate=i.lastSyncDate})}cancelRotate(){this.showRotateScreen=!1}rotateToken(){this.showRotateScreen=!0}dayDiff(t,i){const n=Math.abs(i.getTime()-t.getTime());return Math.round(n/864e5)}get submitButtonText(){return this.showRotateScreen?this.i18nService.t("rotateToken"):this.i18nService.t(this.hasBillingToken?"continue":"generateToken")}get showLastSyncText(){return this.lastSyncDate&&this.lastSyncDate>this.keyRevisionDate}get showAwaitingSyncText(){return this.lastSyncDate&&this.lastSyncDate<=this.keyRevisionDate}get daysBetween(){return this.dayDiff(this.keyRevisionDate,new Date)}static open(t,i){return t.open(Wt,{data:i})}}Wt.ɵfac=function(t){return new(t||Wt)(C.rXU(yt.Qs),C.rXU(It.i),C.rXU(wt.G),C.rXU(Rt.y),C.rXU($t.W),C.rXU(Ft.X),C.rXU(bt.K),C.rXU(Tt.f))},Wt.ɵcmp=C.VBU({type:Wt,selectors:[["ng-component"]],standalone:!1,decls:14,vars:12,consts:[[3,"formGroup","bitSubmit"],["bitDialogTitle",""],["bitDialogContent",""],["formControlName","verification",4,"ngIf"],[4,"ngIf"],["bitDialogFooter",""],["type","submit","bitButton","","bitFormButton","","buttonType","primary",4,"ngIf"],["bitButton","","bitDialogClose","","type","button",4,"ngIf"],["bitButton","","type","button",3,"click",4,"ngIf"],["formControlName","verification"],["type","warning"],["bitInput","","id","clientSecret","type","text","disabled","",1,"tw-font-mono",3,"value"],["bitIconButton","bwi-clone","bitSuffix","","type","button","showToast","",3,"valueLabel","appCopyClick","label"],["class","tw-mt-2 tw-text-sm tw-text-muted",4,"ngIf"],["class","tw-mt-2 tw-text-sm tw-text-danger",4,"ngIf"],[1,"tw-mt-2","tw-text-sm","tw-text-muted"],[1,"tw-font-medium"],[1,"tw-mt-2","tw-text-sm","tw-text-danger"],[1,"bwi","bwi-error"],["type","submit","bitButton","","bitFormButton","","buttonType","primary"],["bitButton","","bitDialogClose","","type","button"],["bitButton","","type","button",3,"click"]],template:function(t,i){1&t&&(C.j41(0,"form",0)(1,"bit-dialog")(2,"span",1),C.EFF(3),C.nI1(4,"i18n"),C.k0s(),C.j41(5,"div",2),C.DNE(6,Xt,1,0,"app-user-verification",3)(7,Ot,7,6,"ng-container",4)(8,Vt,14,16,"div",4),C.k0s(),C.qex(9,5),C.DNE(10,Lt,2,1,"button",6)(11,qt,3,3,"button",7)(12,Jt,3,3,"button",8)(13,_t,3,3,"button",8),C.bVm(),C.k0s()()),2&t&&(C.Y8G("formGroup",i.formGroup)("bitSubmit",i.submit),C.R7$(3),C.SpI(" ",C.bMT(4,10,i.hasBillingToken?"viewBillingToken":"generateBillingToken")," "),C.R7$(3),C.Y8G("ngIf",!i.clientSecret),C.R7$(),C.Y8G("ngIf",i.clientSecret&&i.showRotateScreen),C.R7$(),C.Y8G("ngIf",i.clientSecret&&!i.showRotateScreen),C.R7$(2),C.Y8G("ngIf",!i.clientSecret||i.showRotateScreen),C.R7$(),C.Y8G("ngIf",!i.showRotateScreen),C.R7$(),C.Y8G("ngIf",i.showRotateScreen),C.R7$(),C.Y8G("ngIf",i.clientSecret&&!i.showRotateScreen))},dependencies:[Gt.q,O.bT,vt.qT,vt.BC,vt.cb,vt.j4,vt.JD,Mt.D,At.$,kt.L,st.Q,xt.G,jt.I,Ct.m,Et.j,Pt.J,Bt.h,Ut.a,Dt.s,O.vh,Y.$],encapsulation:2});var Zt,Ht=n(16452),Kt=n(53127),Qt=n(54471),ti=n(3892),ii=n(59032),ni=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};!function(t){t.Cancelled="cancelled",t.Downloaded="downloaded"}(Zt||(Zt={}));class ei{constructor(t,i,n,e,s){this.data=t,this.dialogRef=i,this.fileDownloadService=n,this.organizationApiService=e,this.formBuilder=s,this.licenseForm=this.formBuilder.group({installationId:["",[vt.k0.required]]}),this.submit=()=>ni(this,void 0,void 0,function*(){this.licenseForm.markAllAsTouched();const t=this.licenseForm.get("installationId").value;if(null==t||""===t)return;const i=yield this.organizationApiService.getLicense(this.data.organizationId,t),n=JSON.stringify(i,null,2);this.fileDownloadService.download({fileName:"bitwarden_organization_license.json",blobData:n}),this.dialogRef.close(Zt.Downloaded)}),this.cancel=()=>{this.dialogRef.close(Zt.Cancelled)}}static open(t,i){return t.open(ei,i)}}ei.ɵfac=function(t){return new(t||ei)(C.rXU(yt.Qs),C.rXU(D.ce),C.rXU(Kt.y),C.rXU(Ft.X),C.rXU(vt.ok))},ei.ɵcmp=C.VBU({type:ei,selectors:[["ng-component"]],standalone:!1,decls:23,vars:19,consts:[[3,"formGroup","bitSubmit"],["bitDialogTitle",""],["bitDialogContent",""],[1,"tw-grid","tw-grid-cols-12","tw-gap-4"],[1,"tw-col-span-8"],["bitLink","","target","_blank","rel","noreferrer","href","https://bitwarden.com/help/licensing-on-premise/#organization-account-sharing","slot","end",1,"tw-ml-auto",3,"appA11yTitle"],["aria-hidden","true",1,"bwi","bwi-question-circle"],["type","text","bitInput","","formControlName","installationId"],["bitDialogFooter",""],["bitButton","","bitFormButton","","buttonType","primary","type","submit"],["bitButton","","bitFormButton","","buttonType","secondary","type","button",3,"bitAction"]],template:function(t,i){1&t&&(C.j41(0,"form",0)(1,"bit-dialog")(2,"span",1),C.EFF(3),C.nI1(4,"i18n"),C.k0s(),C.qex(5,2),C.j41(6,"div",3)(7,"div",4)(8,"bit-form-field")(9,"bit-label"),C.EFF(10),C.nI1(11,"i18n"),C.j41(12,"a",5),C.nI1(13,"i18n"),C.nrm(14,"i",6),C.k0s()(),C.nrm(15,"input",7),C.k0s()()(),C.bVm(),C.qex(16,8),C.j41(17,"button",9),C.EFF(18),C.nI1(19,"i18n"),C.k0s(),C.j41(20,"button",10),C.EFF(21),C.nI1(22,"i18n"),C.k0s(),C.bVm(),C.k0s()()),2&t&&(C.Y8G("formGroup",i.licenseForm)("bitSubmit",i.submit),C.R7$(3),C.JRh(C.bMT(4,9,"downloadLicense")),C.R7$(7),C.SpI("",C.bMT(11,11,"enterInstallationId")," "),C.R7$(2),C.Y8G("appA11yTitle",C.mNQ(C.bMT(13,13,"learnMore"))),C.R7$(6),C.SpI(" ",C.bMT(19,15,"submit")," "),C.R7$(2),C.Y8G("bitAction",i.cancel),C.R7$(),C.SpI(" ",C.bMT(22,17,"cancel")," "))},dependencies:[vt.qT,vt.me,vt.BC,vt.cb,vt.j4,vt.JD,Qt.C,ti.p,At.$,kt.L,st.Q,Ct.m,Et.j,Pt.J,Bt.h,ii.L,Y.$],encapsulation:2});var si=n(48180),oi=n(47696),ai=n(58384),ri=n(38140),ci=n(38410),li=n(22466),ui=n(36572),di=n(58806),pi=n(52136);class hi{constructor(t,i){this.seatAdjustment=t,this.maxAutoscaleSeats=i}}var bi=n(50352),gi=n(90246),mi=n(93199),vi=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};class fi{constructor(t,i,n,e,s,o){this.i18nService=t,this.organizationApiService=i,this.formBuilder=n,this.toastService=e,this.internalOrganizationService=s,this.accountService=o,this.seatPrice=0,this.interval="year",this.onAdjusted=new C.bkB,this.destroy$=new m.B,this.adjustSubscriptionForm=this.formBuilder.group({newSeatCount:[0,[vt.k0.min(0)]],limitSubscription:[!1],newMaxSeats:[0,[vt.k0.min(0)]]}),this.submit=()=>vi(this,void 0,void 0,function*(){if(this.adjustSubscriptionForm.markAllAsTouched(),this.adjustSubscriptionForm.invalid)return;const t=new hi(this.additionalSeatCount,this.adjustSubscriptionForm.value.newMaxSeats),i=yield this.organizationApiService.updatePasswordManagerSeats(this.organizationId,t),n=yield(0,p._)((0,R.F6)(this.accountService.activeAccount$)),e=yield(0,p._)(this.internalOrganizationService.organizations$(n).pipe((0,c.Sw)(this.organizationId))),s=new pi.o(i,{isMember:e.isMember,isProviderUser:e.isProviderUser});yield this.internalOrganizationService.upsert(s,n),this.toastService.showToast({variant:"success",title:null,message:this.i18nService.t("subscriptionUpdated")}),this.onAdjusted.emit()})}ngOnInit(){this.adjustSubscriptionForm.valueChanges.pipe((0,I.Q)(this.destroy$)).subscribe(t=>{const i=this.adjustSubscriptionForm.controls.newMaxSeats;t.limitSubscription?(i.setValidators([vt.k0.min(t.newSeatCount)]),i.enable({emitEvent:!1})):i.disable({emitEvent:!1})}),this.adjustSubscriptionForm.patchValue({newSeatCount:this.currentSeatCount,newMaxSeats:this.maxAutoscaleSeats,limitSubscription:null!=this.maxAutoscaleSeats})}limitSubscriptionChanged(){this.adjustSubscriptionForm.value.limitSubscription||(this.adjustSubscriptionForm.value.newMaxSeats=null)}get additionalSeatCount(){return this.adjustSubscriptionForm.value.newSeatCount?this.adjustSubscriptionForm.value.newSeatCount-this.currentSeatCount:0}get maxSeatTotal(){var t;return Math.abs((null!==(t=this.adjustSubscriptionForm.value.newMaxSeats)&&void 0!==t?t:0)*this.seatPrice)}get seatTotalCost(){return Math.abs(this.adjustSubscriptionForm.value.newSeatCount*this.seatPrice)}get limitSubscription(){return this.adjustSubscriptionForm.value.limitSubscription}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}fi.ɵfac=function(t){return new(t||fi)(C.rXU($t.W),C.rXU(Ft.X),C.rXU(vt.ok),C.rXU(Tt.f),C.rXU(c.k4),C.rXU(P.Di))},fi.ɵcmp=C.VBU({type:fi,selectors:[["app-adjust-subscription"]],inputs:{organizationId:"organizationId",maxAutoscaleSeats:"maxAutoscaleSeats",currentSeatCount:"currentSeatCount",seatPrice:"seatPrice",interval:"interval"},outputs:{onAdjusted:"onAdjusted"},standalone:!1,decls:43,vars:49,consts:[[3,"formGroup","bitSubmit"],[1,"tw-grid","tw-grid-cols-12","tw-gap-4"],[1,"tw-col-span-8"],["bitInput","","formControlName","newSeatCount","type","number","min","0","step","1"],["bitCheckbox","","formControlName","limitSubscription","type","checkbox",3,"change"],[1,"tw-grid","tw-grid-cols-12","tw-gap-4","tw-mb-4",3,"hidden"],["bitInput","","formControlName","newMaxSeats","type","number","step","1",3,"min"],["bitButton","","buttonType","primary","bitFormButton","","type","submit"]],template:function(t,i){1&t&&(C.j41(0,"form",0)(1,"div",1)(2,"div",2)(3,"bit-form-field")(4,"bit-label"),C.EFF(5),C.nI1(6,"i18n"),C.k0s(),C.nrm(7,"input",3),C.j41(8,"bit-hint")(9,"strong"),C.EFF(10),C.nI1(11,"i18n"),C.k0s(),C.EFF(12),C.nI1(13,"currency"),C.nI1(14,"currency"),C.nI1(15,"i18n"),C.k0s()()()(),C.j41(16,"div")(17,"bit-form-control")(18,"input",4),C.bIt("change",function(){return i.limitSubscriptionChanged()}),C.k0s(),C.j41(19,"bit-label"),C.EFF(20),C.nI1(21,"i18n"),C.k0s(),C.j41(22,"bit-hint"),C.EFF(23),C.nI1(24,"i18n"),C.k0s()()(),C.j41(25,"div",5)(26,"div",2)(27,"bit-form-field")(28,"bit-label"),C.EFF(29),C.nI1(30,"i18n"),C.k0s(),C.nrm(31,"input",6),C.j41(32,"bit-hint")(33,"strong"),C.EFF(34),C.nI1(35,"i18n"),C.k0s(),C.EFF(36),C.nI1(37,"currency"),C.nI1(38,"currency"),C.nI1(39,"i18n"),C.k0s()()()(),C.j41(40,"button",7),C.EFF(41),C.nI1(42,"i18n"),C.k0s()()),2&t&&(C.Y8G("formGroup",i.adjustSubscriptionForm)("bitSubmit",i.submit),C.R7$(5),C.JRh(C.bMT(6,19,"subscriptionSeats")),C.R7$(5),C.SpI("",C.bMT(11,21,"total"),":"),C.R7$(2),C.LHq(" ",i.adjustSubscriptionForm.value.newSeatCount||0," × ",C.i5U(13,23,i.seatPrice,"$")," = ",C.i5U(14,26,i.seatTotalCost,"$")," / ",C.bMT(15,29,i.interval)),C.R7$(8),C.JRh(C.bMT(21,31,"limitSubscription")),C.R7$(3),C.SpI(" ",C.bMT(24,33,"limitSubscriptionDesc")),C.R7$(2),C.Y8G("hidden",!i.adjustSubscriptionForm.value.limitSubscription),C.R7$(4),C.JRh(C.bMT(30,35,"maxSeatLimit")),C.R7$(2),C.Y8G("min",null==i.adjustSubscriptionForm.value.newSeatCount?1:i.adjustSubscriptionForm.value.newSeatCount),C.R7$(3),C.SpI("",C.bMT(35,37,"maxSeatCost"),":"),C.R7$(2),C.LHq(" ",i.adjustSubscriptionForm.value.newMaxSeats||0," × ",C.i5U(37,39,i.seatPrice,"$")," = ",C.i5U(38,42,i.maxSeatTotal,"$")," / ",C.bMT(39,45,i.interval)),C.R7$(5),C.SpI(" ",C.bMT(42,47,"save")," "))},dependencies:[vt.qT,vt.me,vt.Q0,vt.Zm,vt.BC,vt.cb,vt.VZ,vt.j4,vt.JD,At.$,kt.L,st.Q,bi.P,gi.f,Et.j,mi.I,Pt.J,Bt.h,O.oe,Y.$],encapsulation:2});n(69580);var Si=n(53072),yi=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};class Ii{constructor(t){this.logService=t,this.onChanged=new C.bkB,this.onCanceled=new C.bkB}submit(){return yi(this,void 0,void 0,function*(){try{this.onChanged.emit()}catch(t){this.logService.error(t)}})}cancel(){this.onCanceled.emit()}}Ii.ɵfac=function(t){return new(t||Ii)(C.rXU(bt.K))},Ii.ɵcmp=C.VBU({type:Ii,selectors:[["app-change-plan"]],inputs:{organizationId:"organizationId",currentPlan:"currentPlan",preSelectedProductTier:"preSelectedProductTier"},outputs:{onChanged:"onChanged",onCanceled:"onCanceled"},standalone:!1,decls:11,vars:15,consts:[[1,"tw-relative","tw-flex","tw-flex-col","tw-min-w-0","tw-rounded","tw-border","tw-border-solid","tw-border-secondary-300"],[1,"tw-flex-auto","tw-p-5"],["bitIconButton","bwi-close","buttonType","main","type","button","size","small",1,"tw-float-right",3,"click","label"],["bitTypography","h2"],["bitTypography","body1",1,"tw-mb-0"],[3,"onCanceled","showFree","showCancel","organizationId","currentPlan","preSelectedProductTier"]],template:function(t,i){1&t&&(C.j41(0,"div",0)(1,"div",1)(2,"button",2),C.nI1(3,"i18n"),C.bIt("click",function(){return i.cancel()}),C.k0s(),C.j41(4,"h2",3),C.EFF(5),C.nI1(6,"i18n"),C.k0s(),C.j41(7,"p",4),C.EFF(8),C.nI1(9,"i18n"),C.k0s(),C.j41(10,"app-organization-plans",5),C.bIt("onCanceled",function(){return i.cancel()}),C.k0s()()()),2&t&&(C.R7$(2),C.Y8G("label",C.mNQ(C.bMT(3,9,"cancel"))),C.R7$(3),C.JRh(C.bMT(6,11,"changeBillingPlan")),C.R7$(3),C.JRh(C.bMT(9,13,"changeBillingPlanUpgrade")),C.R7$(2),C.Y8G("showFree",!1)("showCancel",!0)("organizationId",i.organizationId)("currentPlan",i.currentPlan)("preSelectedProductTier",i.preSelectedProductTier))},dependencies:[Dt.s,di.r,Si.v,Y.$],encapsulation:2});class wi{}var Ri=n(68466),$i=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};function Fi(t,i){if(1&t&&(C.j41(0,"bit-form-field",1)(1,"bit-label"),C.EFF(2),C.nI1(3,"i18n"),C.k0s(),C.nrm(4,"input",9),C.j41(5,"bit-hint")(6,"strong"),C.EFF(7),C.nI1(8,"i18n"),C.k0s(),C.EFF(9),C.nI1(10,"currency"),C.nI1(11,"currency"),C.nI1(12,"i18n"),C.k0s()()),2&t){const t=C.XpG();C.R7$(2),C.JRh(C.bMT(3,7,"maxSeatLimit")),C.R7$(2),C.Y8G("min",t.formGroup.value.seatCount),C.R7$(3),C.SpI("",C.bMT(8,9,"maxSeatCost"),":"),C.R7$(2),C.LHq(" ",t.formGroup.value.maxAutoscaleSeats||0," × ",C.i5U(10,11,t.options.seatPrice,"$")," = ",C.i5U(11,14,t.maxSeatTotalCost,"$")," / ",C.bMT(12,17,t.options.interval)," ")}}function Ti(t,i){if(1&t&&(C.j41(0,"bit-form-field",1)(1,"bit-label"),C.EFF(2),C.nI1(3,"i18n"),C.k0s(),C.nrm(4,"input",10),C.j41(5,"bit-hint")(6,"div"),C.EFF(7),C.nI1(8,"i18n"),C.k0s(),C.j41(9,"strong"),C.EFF(10),C.nI1(11,"i18n"),C.k0s(),C.EFF(12),C.nI1(13,"currency"),C.nI1(14,"currency"),C.nI1(15,"i18n"),C.k0s()()),2&t){const t=C.XpG();C.R7$(2),C.JRh(C.bMT(3,8,"machineAccountLimit")),C.R7$(2),C.Y8G("min",t.formGroup.value.additionalServiceAccounts),C.R7$(3),C.SpI(" ",C.i5U(8,10,"includedMachineAccounts",t.options.baseServiceAccountCount)," "),C.R7$(3),C.SpI("",C.bMT(11,13,"maxMachineAccountCost"),":"),C.R7$(2),C.LHq(" ",t.maxAdditionalServiceAccounts," × ",C.i5U(13,15,t.options.additionalServiceAccountPrice,"$")," = ",C.i5U(14,18,t.maxServiceAccountTotalCost,"$")," / ",C.bMT(15,21,t.options.interval)," ")}}class Gi{get monthlyServiceAccountPrice(){return"month"==this.options.interval?this.options.additionalServiceAccountPrice:this.options.additionalServiceAccountPrice/12}get serviceAccountTotalCost(){return Math.abs(this.formGroup.value.additionalServiceAccounts*this.options.additionalServiceAccountPrice)}get seatTotalCost(){return Math.abs(this.formGroup.value.seatCount*this.options.seatPrice)}get maxAdditionalServiceAccounts(){var t;const i=null!==(t=this.formGroup.value.maxAutoscaleServiceAccounts)&&void 0!==t?t:0;return Math.max(0,i-this.options.baseServiceAccountCount)}get maxServiceAccountTotalCost(){return this.maxAdditionalServiceAccounts*this.options.additionalServiceAccountPrice}get maxSeatTotalCost(){var t;return Math.abs((null!==(t=this.formGroup.value.maxAutoscaleSeats)&&void 0!==t?t:0)*this.options.seatPrice)}constructor(t,i,n,e,s,o,a){this.formBuilder=t,this.organizationApiService=i,this.i18nService=n,this.platformUtilsService=e,this.toastService=s,this.internalOrganizationService=o,this.accountService=a,this.onAdjusted=new C.bkB,this.destroy$=new m.B,this.formGroup=this.formBuilder.group({seatCount:[0,[vt.k0.required,vt.k0.min(1)]],limitSeats:[!1],maxAutoscaleSeats:[null],additionalServiceAccounts:[0,[vt.k0.required,vt.k0.min(0)]],limitServiceAccounts:[!1],maxAutoscaleServiceAccounts:[null]}),this.submit=()=>$i(this,void 0,void 0,function*(){if(this.formGroup.markAllAsTouched(),this.formGroup.invalid)return;const t=new wi;t.seatAdjustment=this.formGroup.value.seatCount-this.options.seatCount,t.serviceAccountAdjustment=this.formGroup.value.additionalServiceAccounts-this.options.additionalServiceAccounts,t.maxAutoscaleSeats=this.formGroup.value.limitSeats?this.formGroup.value.maxAutoscaleSeats:null,t.maxAutoscaleServiceAccounts=this.formGroup.value.limitServiceAccounts?this.formGroup.value.maxAutoscaleServiceAccounts:null;const i=yield this.organizationApiService.updateSecretsManagerSubscription(this.organizationId,t),n=yield(0,p._)((0,R.F6)(this.accountService.activeAccount$)),e=yield(0,p._)(this.internalOrganizationService.organizations$(n).pipe((0,c.Sw)(this.organizationId))),s=new pi.o(i,{isMember:e.isMember,isProviderUser:e.isProviderUser});yield this.internalOrganizationService.upsert(s,n),this.toastService.showToast({variant:"success",title:null,message:this.i18nService.t("subscriptionUpdated")}),this.onAdjusted.emit()})}ngOnInit(){this.formGroup.valueChanges.pipe((0,I.Q)(this.destroy$)).subscribe(t=>{const i=this.formGroup.controls.maxAutoscaleSeats,n=this.formGroup.controls.maxAutoscaleServiceAccounts;t.limitSeats?(i.setValidators([vt.k0.min(t.seatCount)]),i.enable({emitEvent:!1})):i.disable({emitEvent:!1}),t.limitServiceAccounts?(n.setValidators([vt.k0.min(t.additionalServiceAccounts+this.options.baseServiceAccountCount)]),n.enable({emitEvent:!1})):n.disable({emitEvent:!1})}),this.formGroup.patchValue({seatCount:this.options.seatCount,maxAutoscaleSeats:this.options.maxAutoscaleSeats,additionalServiceAccounts:this.options.additionalServiceAccounts,maxAutoscaleServiceAccounts:this.options.maxAutoscaleServiceAccounts,limitSeats:null!=this.options.maxAutoscaleSeats,limitServiceAccounts:null!=this.options.maxAutoscaleServiceAccounts})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}Gi.ɵfac=function(t){return new(t||Gi)(C.rXU(vt.ok),C.rXU(Ft.X),C.rXU($t.W),C.rXU(Rt.y),C.rXU(Tt.f),C.rXU(c.k4),C.rXU(P.Di))},Gi.ɵcmp=C.VBU({type:Gi,selectors:[["app-sm-adjust-subscription"]],inputs:{organizationId:"organizationId",options:"options"},outputs:{onAdjusted:"onAdjusted"},standalone:!1,decls:55,vars:67,consts:[[3,"formGroup","bitSubmit"],[1,"tw-w-2/3"],["bitInput","","id","smSeatCount","formControlName","seatCount","type","number","step","1","min","1"],["type","checkbox","bitCheckbox","","id","limitSmSeats","formControlName","limitSeats"],["class","tw-w-2/3",4,"ngIf"],["bitInput","","id","additionalServiceAccountCount","formControlName","additionalServiceAccounts","type","number","step","1","min","0"],["type","checkbox","bitCheckbox","","id","limitServiceAccounts","formControlName","limitServiceAccounts"],["type","submit","bitButton","","buttonType","primary","bitFormButton",""],[1,"tw-mt-2",3,"formGroup"],["bitInput","","id","smSeatLimit","formControlName","maxAutoscaleSeats","type","number","step","1",3,"min"],["bitInput","","id","additionalServiceAccountLimit","formControlName","maxAutoscaleServiceAccounts","type","number","step","1",3,"min"]],template:function(t,i){1&t&&(C.j41(0,"form",0)(1,"bit-form-field",1)(2,"bit-label"),C.EFF(3),C.nI1(4,"i18n"),C.k0s(),C.nrm(5,"input",2),C.j41(6,"bit-hint")(7,"strong"),C.EFF(8),C.nI1(9,"i18n"),C.k0s(),C.EFF(10),C.nI1(11,"currency"),C.nI1(12,"currency"),C.nI1(13,"i18n"),C.k0s()(),C.j41(14,"bit-form-control")(15,"bit-label"),C.EFF(16),C.nI1(17,"i18n"),C.k0s(),C.nrm(18,"input",3),C.j41(19,"bit-hint"),C.EFF(20),C.nI1(21,"i18n"),C.k0s()(),C.DNE(22,Fi,13,19,"bit-form-field",4),C.j41(23,"bit-form-field",1)(24,"bit-label"),C.EFF(25),C.nI1(26,"i18n"),C.k0s(),C.nrm(27,"input",5),C.j41(28,"bit-hint")(29,"div"),C.EFF(30),C.nI1(31,"i18n"),C.nI1(32,"currency"),C.nI1(33,"i18n"),C.k0s(),C.j41(34,"div")(35,"strong"),C.EFF(36),C.nI1(37,"i18n"),C.k0s(),C.EFF(38),C.nI1(39,"currency"),C.nI1(40,"currency"),C.nI1(41,"i18n"),C.k0s()()(),C.j41(42,"bit-form-control")(43,"bit-label"),C.EFF(44),C.nI1(45,"i18n"),C.k0s(),C.nrm(46,"input",6),C.j41(47,"bit-hint"),C.EFF(48),C.nI1(49,"i18n"),C.k0s()(),C.DNE(50,Ti,16,23,"bit-form-field",4),C.j41(51,"button",7),C.EFF(52),C.nI1(53,"i18n"),C.k0s(),C.nrm(54,"bit-error-summary",8),C.k0s()),2&t&&(C.Y8G("formGroup",i.formGroup)("bitSubmit",i.submit),C.R7$(3),C.JRh(C.bMT(4,24,"subscriptionSeats")),C.R7$(5),C.SpI("",C.bMT(9,26,"total"),":"),C.R7$(2),C.LHq(" ",i.formGroup.value.seatCount||0," × ",C.i5U(11,28,i.options.seatPrice,"$")," = ",C.i5U(12,31,i.seatTotalCost,"$")," / ",C.bMT(13,34,i.options.interval)," "),C.R7$(6),C.JRh(C.bMT(17,36,"limitSubscription")),C.R7$(4),C.SpI(" ",C.bMT(21,38,"limitSmSubscriptionDesc")," "),C.R7$(2),C.Y8G("ngIf",i.formGroup.value.limitSeats),C.R7$(3),C.JRh(C.bMT(26,40,"additionalMachineAccounts")),C.R7$(5),C.Lme(" ",C.i5U(31,42,"includedMachineAccounts",i.options.baseServiceAccountCount)," ",C.i5U(33,48,"addAdditionalMachineAccounts",C.i5U(32,45,i.monthlyServiceAccountPrice,"$"))," "),C.R7$(6),C.SpI("",C.bMT(37,51,"total"),":"),C.R7$(2),C.LHq(" ",i.formGroup.value.additionalServiceAccounts||0," × ",C.i5U(39,53,i.options.additionalServiceAccountPrice,"$")," = ",C.i5U(40,56,i.serviceAccountTotalCost,"$")," / ",C.bMT(41,59,i.options.interval)," "),C.R7$(6),C.JRh(C.bMT(45,61,"limitMachineAccounts")),C.R7$(4),C.SpI(" ",C.bMT(49,63,"limitMachineAccountsDesc")," "),C.R7$(2),C.Y8G("ngIf",i.formGroup.value.limitServiceAccounts),C.R7$(2),C.SpI(" ",C.bMT(53,65,"save")," "),C.R7$(2),C.Y8G("formGroup",i.formGroup))},dependencies:[O.bT,vt.qT,vt.me,vt.Q0,vt.Zm,vt.BC,vt.cb,vt.VZ,vt.j4,vt.JD,At.$,kt.L,st.Q,bi.P,gi.f,Et.j,mi.I,Pt.J,Ri.L,Bt.h,O.oe,Y.$],encapsulation:2});n(84488);class Mi{}n(69138);var Ai=n(91517),ki=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};function xi(t,i){if(1&t&&(C.j41(0,"form",1),C.nrm(1,"sm-subscribe",2),C.k0s()),2&t){const t=C.XpG();C.Y8G("formGroup",t.formGroup)("bitSubmit",t.submit),C.R7$(),C.Y8G("formGroup",t.formGroup)("selectedPlan",t.plan)("upgradeOrganization",!1)("showSubmitButton",!0)("customerDiscount",t.customerDiscount)}}class ji{constructor(t,i,n,e,s,o,r,c){this.apiService=t,this.formBuilder=i,this.platformUtilsService=n,this.i18nService=e,this.organizationApiService=s,this.organizationService=o,this.toastService=r,this.accountService=c,this.onSubscribe=new C.bkB,this.formGroup=(0,a.Fk)(this.formBuilder),this.submit=()=>ki(this,void 0,void 0,function*(){const t=new Mi;t.additionalSmSeats=this.plan.SecretsManager.hasAdditionalSeatsOption?this.formGroup.value.userSeats:0,t.additionalServiceAccounts=this.plan.SecretsManager.hasAdditionalServiceAccountOption?this.formGroup.value.additionalServiceAccounts:0;const i=yield this.organizationApiService.subscribeToSecretsManager(this.organization.id,t),n=new pi.o(i,{isMember:this.organization.isMember,isProviderUser:this.organization.isProviderUser}),e=yield(0,p._)((0,R.F6)(this.accountService.activeAccount$));yield this.organizationService.upsert(n,e),yield this.apiService.refreshIdentityToken(),this.toastService.showToast({variant:"success",title:null,message:this.i18nService.t("subscribedToSecretsManager")}),this.onSubscribe.emit()})}}function Ci(t,i){if(1&t&&(C.j41(0,"button",5),C.EFF(1),C.nI1(2,"i18n"),C.k0s()),2&t){const t=C.XpG(2);C.Y8G("bitAction",t.requestReinstatement),C.R7$(),C.SpI(" ",C.bMT(2,2,"reinstateSubscription")," ")}}function Ei(t,i){if(1&t&&(C.j41(0,"bit-callout",3)(1,"p"),C.EFF(2),C.k0s(),C.DNE(3,Ci,3,4,"button",4),C.k0s()),2&t){const t=C.XpG();C.Y8G("type",t.data.callout.severity)("title",t.data.callout.header),C.R7$(2),C.JRh(t.data.callout.body),C.R7$(),C.Y8G("ngIf",t.data.callout.showReinstatementButton)}}function Pi(t,i){if(1&t&&(C.qex(0),C.j41(1,"dt"),C.EFF(2),C.k0s(),C.j41(3,"dd")(4,"span",6),C.EFF(5),C.k0s()(),C.j41(6,"dt"),C.EFF(7),C.nI1(8,"titlecase"),C.k0s(),C.j41(9,"dd"),C.EFF(10),C.nI1(11,"date"),C.k0s(),C.bVm()),2&t){const t=C.XpG();C.R7$(2),C.JRh(t.data.status.label),C.R7$(3),C.SpI(" ",t.displayedStatus," "),C.R7$(2),C.SpI(" ",C.bMT(8,4,t.data.date.label)," "),C.R7$(3),C.SpI(" ",C.i5U(11,6,t.data.date.value,"mediumDate")," ")}}ji.ɵfac=function(t){return new(t||ji)(C.rXU(wt.G),C.rXU(vt.ok),C.rXU(Rt.y),C.rXU($t.W),C.rXU(Ft.X),C.rXU(c.k4),C.rXU(Tt.f),C.rXU(P.Di))},ji.ɵcmp=C.VBU({type:ji,selectors:[["sm-subscribe-standalone"]],inputs:{plan:"plan",organization:"organization",customerDiscount:"customerDiscount"},outputs:{onSubscribe:"onSubscribe"},standalone:!1,decls:1,vars:1,consts:[[3,"formGroup","bitSubmit",4,"ngIf"],[3,"formGroup","bitSubmit"],[3,"formGroup","selectedPlan","upgradeOrganization","showSubmitButton","customerDiscount"]],template:function(t,i){1&t&&C.DNE(0,xi,2,7,"form",0),2&t&&C.Y8G("ngIf",i.plan)},dependencies:[O.bT,vt.qT,vt.cb,vt.j4,kt.L,Ai.m],encapsulation:2});class Bi{constructor(t,i){this.datePipe=t,this.i18nService=i,this.reinstatementRequested=new C.bkB,this.requestReinstatement=()=>this.reinstatementRequested.emit()}get displayedStatus(){return this.subscription.items.some(t=>t.sponsoredSubscriptionItem)?this.i18nService.t("sponsored"):this.data.status.value}get planName(){return this.organizationSubscriptionResponse.plan.name}get status(){return this.subscription?"canceled"!=this.subscription.status&&this.subscription.cancelAtEndDate?"pending_cancellation":this.subscription.status:"free"}get subscription(){var t;return null===(t=this.organizationSubscriptionResponse)||void 0===t?void 0:t.subscription}get data(){const t=this.i18nService.t("status"),i=this.i18nService.t("nextCharge"),n=this.i18nService.t("subscriptionExpired"),e=this.i18nService.t("cancellationDate");switch(this.status){case"free":return{};case"trialing":return{status:{label:t,value:this.i18nService.t("trial")},date:{label:i,value:this.subscription.periodEndDate}};case"active":return{status:{label:t,value:this.i18nService.t("active")},date:{label:i,value:this.subscription.periodEndDate}};case"past_due":{const i=this.i18nService.t("pastDue"),e=this.datePipe.transform(this.subscription.suspensionDate,"mediumDate"),s="charge_automatically"===this.subscription.collectionMethod?this.i18nService.t("pastDueWarningForChargeAutomatically",this.subscription.gracePeriod,e):this.i18nService.t("pastDueWarningForSendInvoice",this.subscription.gracePeriod,e);return{status:{label:t,value:i},date:{label:n,value:this.subscription.unpaidPeriodEndDate},callout:{severity:"warning",header:i,body:s,showReinstatementButton:!1}}}case"unpaid":return{status:{label:t,value:this.i18nService.t("unpaid")},date:{label:n,value:this.subscription.unpaidPeriodEndDate},callout:{severity:"danger",header:this.i18nService.t("unpaidInvoice"),body:this.i18nService.t("toReactivateYourSubscription"),showReinstatementButton:!1}};case"pending_cancellation":{const i=this.i18nService.t("pendingCancellation");return{status:{label:t,value:i},date:{label:e,value:this.subscription.periodEndDate},callout:{severity:"warning",header:i,body:this.i18nService.t("subscriptionPendingCanceled"),showReinstatementButton:!0}}}case"incomplete_expired":case"canceled":{const i=this.i18nService.t("canceled");return{status:{label:t,value:i},date:{label:e,value:this.subscription.periodEndDate},callout:{severity:"danger",header:i,body:this.i18nService.t("subscriptionCanceled"),showReinstatementButton:!1}}}}}}Bi.ɵfac=function(t){return new(t||Bi)(C.rXU(O.vh),C.rXU($t.W))},Bi.ɵcmp=C.VBU({type:Bi,selectors:[["app-subscription-status"]],inputs:{organizationSubscriptionResponse:"organizationSubscriptionResponse"},outputs:{reinstatementRequested:"reinstatementRequested"},standalone:!1,decls:9,vars:6,consts:[[3,"type","title",4,"ngIf"],[1,"tw-grid","tw-grid-flow-col","tw-grid-rows-2"],[4,"ngIf"],[3,"type","title"],["bitButton","","buttonType","secondary","type","button",3,"bitAction",4,"ngIf"],["bitButton","","buttonType","secondary","type","button",3,"bitAction"],[1,"tw-capitalize"]],template:function(t,i){1&t&&(C.qex(0),C.DNE(1,Ei,4,4,"bit-callout",0),C.j41(2,"dl",1)(3,"dt"),C.EFF(4),C.nI1(5,"i18n"),C.k0s(),C.j41(6,"dd"),C.EFF(7),C.k0s(),C.DNE(8,Pi,12,9,"ng-container",2),C.k0s(),C.bVm()),2&t&&(C.R7$(),C.Y8G("ngIf",i.data.callout),C.R7$(3),C.JRh(C.bMT(5,4,"billingPlan")),C.R7$(3),C.JRh(i.planName),C.R7$(),C.Y8G("ngIf",i.data.status&&i.data.date))},dependencies:[O.bT,ti.p,st.Q,xt.G,O.PV,O.vh,Y.$],encapsulation:2});var Ui=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};const Di=t=>({"tw-pl-20":t}),zi=t=>["/providers",t,"billing","subscription"];function Xi(t,i){1&t&&(C.qex(0),C.nrm(1,"i",7),C.nI1(2,"i18n"),C.j41(3,"span",8),C.EFF(4),C.nI1(5,"i18n"),C.k0s(),C.bVm()),2&t&&(C.R7$(),C.Y8G("title",C.mNQ(C.bMT(2,3,"loading"))),C.R7$(3),C.JRh(C.bMT(5,5,"loading")))}function Oi(t,i){if(1&t){const t=C.RV6();C.j41(0,"app-subscription-status",11),C.bIt("reinstatementRequested",function(){E.eBV(t);const i=C.XpG(3);return E.Njj(i.reinstate())}),C.k0s()}if(2&t){const t=C.XpG(3);C.Y8G("organizationSubscriptionResponse",t.sub)}}function Yi(t,i){if(1&t&&(C.j41(0,"span",16),C.EFF(1),C.nI1(2,"i18n"),C.k0s()),2&t){const t=C.XpG(4);C.R7$(),C.JRh(C.i5U(2,1,"providerDiscount",null==t.customerDiscount?null:t.customerDiscount.percentOff))}}function Ni(t,i){if(1&t&&(C.j41(0,"span"),C.EFF(1),C.nI1(2,"i18n"),C.k0s()),2&t){const t=C.XpG().$implicit;C.R7$(),C.SpI("",C.bMT(2,1,t.productName)," -")}}function Vi(t,i){1&t&&(C.qex(0),C.EFF(1),C.nI1(2,"i18n"),C.bVm()),2&t&&(C.R7$(),C.SpI(" ",C.bMT(2,1,"freeForOneYear")," "))}function Li(t,i){if(1&t&&(C.j41(0,"span",23),C.EFF(1),C.nI1(2,"currency"),C.nI1(3,"i18n"),C.k0s()),2&t){const t=C.XpG(2).$implicit,i=C.XpG(6);C.R7$(),C.Lme("",C.i5U(2,2,i.calculateTotalAppliedDiscount(t.quantity*t.amount),"$")," / ",C.bMT(3,5,"year"))}}function qi(t,i){if(1&t&&(C.j41(0,"div",21)(1,"span"),C.EFF(2),C.nI1(3,"currency"),C.nI1(4,"i18n"),C.k0s(),C.DNE(5,Li,4,7,"span",22),C.k0s()),2&t){const t=C.XpG().$implicit,i=C.XpG(6);C.R7$(2),C.Lme(" ",C.i5U(3,3,t.quantity*t.amount,"$")," /",C.bMT(4,6,t.interval)," "),C.R7$(3),C.Y8G("ngIf",null==i.customerDiscount?null:i.customerDiscount.percentOff)}}function Ji(t,i){if(1&t&&(C.j41(0,"tr",18)(1,"td",19),C.DNE(2,Ni,3,3,"span",5),C.EFF(3),C.nI1(4,"currency"),C.k0s(),C.j41(5,"td",20),C.DNE(6,Vi,3,3,"ng-container",6)(7,qi,6,8,"ng-template",null,2,C.C5r),C.k0s()()),2&t){const t=i.$implicit,n=C.sdS(8),e=C.XpG(6);C.R7$(),C.Y8G("ngClass",C.eq3(10,Di,t.addonSubscriptionItem)),C.R7$(),C.Y8G("ngIf",!t.addonSubscriptionItem),C.R7$(),C.E5c(" ",t.name," ",t.quantity>1?"×"+t.quantity:""," @ ",C.i5U(4,7,t.amount,"$")," "),C.R7$(3),C.Y8G("ngIf",e.isSecretsManagerTrial())("ngIfElse",n)}}function _i(t,i){if(1&t&&(C.qex(0),C.DNE(1,Ji,9,12,"tr",17),C.bVm()),2&t){const t=C.XpG(5);C.R7$(),C.Y8G("ngForOf",t.subscriptionLineItems)}}function Wi(t,i){1&t&&(C.j41(0,"tr",18)(1,"td",25),C.EFF(2),C.nI1(3,"i18n"),C.nI1(4,"i18n"),C.k0s(),C.j41(5,"td",20),C.EFF(6),C.nI1(7,"i18n"),C.k0s()()),2&t&&(C.R7$(2),C.Lme("",C.bMT(3,3,"passwordManager")," - ",C.bMT(4,5,"freeOrganization")),C.R7$(4),C.JRh(C.bMT(7,7,"free")))}function Zi(t,i){1&t&&(C.j41(0,"tr",18)(1,"td",25),C.EFF(2),C.nI1(3,"i18n"),C.nI1(4,"i18n"),C.k0s(),C.j41(5,"td",20),C.EFF(6),C.nI1(7,"i18n"),C.k0s()()),2&t&&(C.R7$(2),C.Lme("",C.bMT(3,3,"secretsManager")," - ",C.bMT(4,5,"freeOrganization")),C.R7$(4),C.JRh(C.bMT(7,7,"free")))}function Hi(t,i){if(1&t&&(C.qex(0),C.DNE(1,Wi,8,9,"tr",24)(2,Zi,8,9,"tr",24),C.bVm()),2&t){const t=C.XpG(5);C.R7$(),C.Y8G("ngIf",t.userOrg.usePasswordManager),C.R7$(),C.Y8G("ngIf",t.userOrg.useSecretsManager)}}function Ki(t,i){if(1&t&&C.DNE(0,_i,2,1,"ng-container",5)(1,Hi,3,2,"ng-container",5),2&t){const t=C.XpG(4);C.Y8G("ngIf",t.subscription&&!t.userOrg.isFreeOrg),C.R7$(),C.Y8G("ngIf",t.userOrg.isFreeOrg)}}function Qi(t,i){if(1&t&&(C.qex(0),C.j41(1,"div",12)(2,"strong",13),C.EFF(3),C.nI1(4,"i18n"),C.DNE(5,Yi,3,4,"span",14),C.k0s(),C.j41(6,"bit-table"),C.DNE(7,Ki,2,2,"ng-template",15),C.k0s()(),C.bVm()),2&t){const t=C.XpG(3);C.R7$(3),C.JRh(C.bMT(4,2,"details")),C.R7$(2),C.Y8G("ngIf",(null==t.customerDiscount?null:t.customerDiscount.percentOff)>0&&!t.isSecretsManagerTrial())}}function tn(t,i){if(1&t){const t=C.RV6();C.j41(0,"button",29),C.bIt("click",function(){E.eBV(t);const i=C.XpG(4);return E.Njj(i.changePlan())}),C.EFF(1),C.nI1(2,"i18n"),C.k0s()}2&t&&(C.R7$(),C.SpI(" ",C.bMT(2,1,"changeBillingPlan")," "))}function nn(t,i){if(1&t){const t=C.RV6();C.j41(0,"app-change-plan",30),C.bIt("onChanged",function(){E.eBV(t);const i=C.XpG(4);return E.Njj(i.closeChangePlan())})("onCanceled",function(){E.eBV(t);const i=C.XpG(4);return E.Njj(i.closeChangePlan())}),C.k0s()}if(2&t){const t=C.XpG(4);C.Y8G("organizationId",t.organizationId)("currentPlan",t.sub.plan)("preSelectedProductTier",t.preSelectedProductTier)}}function en(t,i){if(1&t&&(C.qex(0),C.j41(1,"div",26),C.DNE(2,tn,3,3,"button",27)(3,nn,1,3,"app-change-plan",28),C.k0s(),C.bVm()),2&t){const t=C.XpG(3);C.R7$(2),C.Y8G("ngIf",t.showChangePlanButton),C.R7$(),C.Y8G("ngIf",t.showChangePlan)}}function sn(t,i){if(1&t){const t=C.RV6();C.qex(0),C.j41(1,"div",31)(2,"sm-subscribe-standalone",32),C.bIt("onSubscribe",function(){E.eBV(t);const i=C.XpG(3);return E.Njj(i.subscriptionAdjusted())}),C.k0s()(),C.bVm()}if(2&t){const t=C.XpG(3);C.R7$(2),C.Y8G("plan",t.sub.plan)("organization",t.userOrg)("customerDiscount",t.customerDiscount)}}function on(t,i){1&t&&(C.j41(0,"p",35),C.EFF(1),C.nI1(2,"i18n"),C.nI1(3,"i18n"),C.nI1(4,"i18n"),C.j41(5,"a",37),C.EFF(6),C.nI1(7,"i18n"),C.k0s()()),2&t&&(C.R7$(),C.E5c(" ",C.bMT(2,4,"smStandaloneTrialSeatCountUpdateMessageFragment1")," ",C.bMT(3,6,"passwordManager")," ",C.bMT(4,8,"smStandaloneTrialSeatCountUpdateMessageFragment2")," "),C.R7$(5),C.SpI("",C.bMT(7,10,"contactSupportShort"),". "))}function an(t,i){if(1&t){const t=C.RV6();C.qex(0),C.j41(1,"h3",38),C.EFF(2),C.nI1(3,"i18n"),C.k0s(),C.j41(4,"app-adjust-subscription",39),C.bIt("onAdjusted",function(){E.eBV(t);const i=C.XpG(4);return E.Njj(i.subscriptionAdjusted())}),C.k0s(),C.bVm()}if(2&t){const t=C.XpG(4);C.R7$(2),C.JRh(C.bMT(3,6,"passwordManager")),C.R7$(2),C.Y8G("seatPrice",t.seatPrice)("organizationId",t.organizationId)("interval",t.billingInterval)("currentSeatCount",t.seats)("maxAutoscaleSeats",t.maxAutoscaleSeats)}}function rn(t,i){if(1&t&&(C.j41(0,"button",40),C.EFF(1),C.nI1(2,"i18n"),C.k0s()),2&t){const t=C.XpG(4);C.Y8G("bitAction",t.removeSponsorship),C.R7$(),C.SpI(" ",C.bMT(2,2,"removeSponsorship")," ")}}function cn(t,i){if(1&t&&(C.qex(0),C.j41(1,"div",43)(2,"div",44)(3,"button",45),C.EFF(4),C.nI1(5,"i18n"),C.k0s(),C.j41(6,"button",45),C.EFF(7),C.nI1(8,"i18n"),C.k0s()()(),C.bVm()),2&t){const t=C.XpG(5);C.R7$(3),C.Y8G("bitAction",t.adjustStorage(!0)),C.R7$(),C.SpI(" ",C.bMT(5,4,"addStorage")," "),C.R7$(2),C.Y8G("bitAction",t.adjustStorage(!1)),C.R7$(),C.SpI(" ",C.bMT(8,6,"removeStorage")," ")}}function ln(t,i){if(1&t&&(C.qex(0),C.j41(1,"h4",41),C.EFF(2),C.nI1(3,"i18n"),C.k0s(),C.j41(4,"p",35),C.EFF(5),C.nI1(6,"i18n"),C.k0s(),C.nrm(7,"bit-progress",42),C.DNE(8,cn,9,8,"ng-container",5),C.bVm()),2&t){const t=C.XpG(4);C.R7$(2),C.JRh(C.bMT(3,4,"storage")),C.R7$(3),C.SpI(" ",C.brH(6,6,"subscriptionStorage",t.sub.maxStorageGb||0,t.sub.storageName||"0 MB")," "),C.R7$(2),C.Y8G("barWidth",t.storagePercentage),C.R7$(),C.Y8G("ngIf",t.subscription&&!t.subscription.cancelled&&!t.subscriptionMarkedForCancel)}}function un(t,i){if(1&t){const t=C.RV6();C.qex(0),C.j41(1,"h3",46),C.EFF(2),C.nI1(3,"i18n"),C.k0s(),C.j41(4,"app-sm-adjust-subscription",47),C.bIt("onAdjusted",function(){E.eBV(t);const i=C.XpG(4);return E.Njj(i.subscriptionAdjusted())}),C.k0s(),C.bVm()}if(2&t){const t=C.XpG(4);C.R7$(2),C.JRh(C.bMT(3,3,"secretsManager")),C.R7$(2),C.Y8G("organizationId",t.organizationId)("options",t.smOptions)}}function dn(t,i){if(1&t&&(C.qex(0),C.j41(1,"h2",33),C.EFF(2),C.nI1(3,"i18n"),C.k0s(),C.DNE(4,on,8,12,"p",34),C.j41(5,"p",35),C.EFF(6),C.k0s(),C.DNE(7,an,5,8,"ng-container",5)(8,rn,3,4,"button",36)(9,ln,9,10,"ng-container",5)(10,un,5,5,"ng-container",5),C.bVm()),2&t){const t=C.XpG(3);C.R7$(2),C.JRh(C.bMT(3,7,"manageSubscription")),C.R7$(2),C.Y8G("ngIf","sm-standalone"===(null==t.customerDiscount?null:t.customerDiscount.id)),C.R7$(2),C.JRh(t.subscriptionDesc),C.R7$(),C.Y8G("ngIf",t.subscription&&t.canAdjustSeats&&!t.subscription.cancelled&&!t.subscriptionMarkedForCancel&&(!t.customerDiscount||"sm-standalone"!=t.customerDiscount.id)),C.R7$(),C.Y8G("ngIf",t.isSponsoredSubscription),C.R7$(),C.Y8G("ngIf",!t.customerDiscount||"sm-standalone"!=t.customerDiscount.id),C.R7$(),C.Y8G("ngIf",t.showAdjustSecretsManager)}}function pn(t,i){1&t&&C.eu8(0)}function hn(t,i){if(1&t){const t=C.RV6();C.j41(0,"button",49),C.bIt("click",function(){E.eBV(t);const i=C.XpG(4);return E.Njj(i.cancelSubscription())}),C.EFF(1),C.nI1(2,"i18n"),C.k0s()}2&t&&(C.R7$(),C.SpI(" ",C.bMT(2,1,"cancelSubscription")," "))}function bn(t,i){if(1&t&&(C.qex(0),C.j41(1,"h2",33),C.EFF(2),C.nI1(3,"i18n"),C.k0s(),C.j41(4,"p",35),C.EFF(5),C.nI1(6,"i18n"),C.k0s(),C.j41(7,"div",44),C.DNE(8,hn,3,3,"button",48),C.k0s(),C.bVm()),2&t){const t=C.XpG(3);C.R7$(2),C.JRh(C.bMT(3,3,"additionalOptions")),C.R7$(3),C.SpI(" ",C.bMT(6,5,"additionalOptionsDesc")," "),C.R7$(3),C.Y8G("ngIf",t.subscription&&!t.subscription.cancelled&&!t.subscriptionMarkedForCancel)}}function gn(t,i){if(1&t&&(C.qex(0),C.DNE(1,Oi,1,1,"app-subscription-status",9)(2,Qi,8,4,"ng-container",5)(3,en,4,2,"ng-container",5)(4,sn,3,3,"ng-container",5)(5,dn,11,9,"ng-container",5)(6,pn,1,0,"ng-container",10)(7,bn,9,7,"ng-container",5),C.bVm()),2&t){const t=C.XpG(2),i=C.sdS(6);C.R7$(),C.Y8G("ngIf",!t.userOrg.isFreeOrg),C.R7$(),C.Y8G("ngIf",t.userOrg.canEditSubscription),C.R7$(),C.Y8G("ngIf",t.userOrg.canEditSubscription),C.R7$(),C.Y8G("ngIf",t.showSecretsManagerSubscribe),C.R7$(),C.Y8G("ngIf",t.userOrg.canEditSubscription),C.R7$(),C.Y8G("ngTemplateOutlet",i),C.R7$(),C.Y8G("ngIf",t.userOrg.canEditSubscription)}}function mn(t,i){if(1&t&&(C.j41(0,"bit-container"),C.DNE(1,gn,8,7,"ng-container",5),C.k0s()),2&t){const t=C.XpG();C.R7$(),C.Y8G("ngIf",t.sub&&!t.loading)}}function vn(t,i){if(1&t&&(C.j41(0,"p",35),C.EFF(1),C.nI1(2,"i18n"),C.j41(3,"a",52),C.EFF(4),C.nI1(5,"i18n"),C.k0s(),C.EFF(6,". "),C.k0s()),2&t){const t=C.XpG(4);C.R7$(),C.SpI(" ",C.bMT(2,3,"manageSubscriptionFromThe")," "),C.R7$(2),C.Y8G("routerLink",C.eq3(7,zi,t.userOrg.providerId)),C.R7$(),C.JRh(C.bMT(5,5,"providerPortal"))}}function fn(t,i){if(1&t&&(C.j41(0,"p"),C.EFF(1),C.nI1(2,"i18n"),C.nI1(3,"i18n"),C.k0s()),2&t){const t=C.XpG(4);C.R7$(),C.Lme(" ",C.i5U(2,2,"billingManagedByProvider",t.userOrg.providerName),". ",C.bMT(3,5,"billingContactProviderForAssistance"),". ")}}function Sn(t,i){1&t&&C.eu8(0)}function yn(t,i){if(1&t&&(C.qex(0),C.j41(1,"h2",50),C.EFF(2),C.nI1(3,"i18n"),C.k0s(),C.DNE(4,vn,7,9,"p",51)(5,fn,4,7,"ng-template",null,4,C.C5r)(7,Sn,1,0,"ng-container",10),C.bVm()),2&t){const t=C.sdS(6),i=C.XpG(3),n=C.sdS(6);C.R7$(2),C.JRh(C.bMT(3,4,"manageSubscription")),C.R7$(2),C.Y8G("ngIf",i.userOrg.isProviderUser)("ngIfElse",t),C.R7$(3),C.Y8G("ngTemplateOutlet",n)}}function In(t,i){if(1&t&&(C.j41(0,"div",53)(1,"div",54),C.nrm(2,"bit-icon",55),C.k0s(),C.j41(3,"p",56),C.EFF(4),C.nI1(5,"i18n"),C.k0s(),C.j41(6,"p"),C.EFF(7),C.nI1(8,"i18n"),C.k0s()()),2&t){const t=C.XpG(3);C.R7$(2),C.Y8G("icon",t.gearIcon),C.R7$(2),C.JRh(C.i5U(5,3,"billingManagedByProvider",t.userOrg.providerName)),C.R7$(3),C.JRh(C.bMT(8,6,"billingContactProviderForAssistance"))}}function wn(t,i){if(1&t&&(C.j41(0,"bit-container"),C.DNE(1,yn,8,6,"ng-container",6)(2,In,9,8,"ng-template",null,3,C.C5r),C.k0s()),2&t){const t=C.sdS(3),i=C.XpG(2);C.R7$(),C.Y8G("ngIf",i.organizationIsManagedByConsolidatedBillingMSP)("ngIfElse",t)}}function Rn(t,i){if(1&t&&C.DNE(0,wn,4,2,"bit-container",5),2&t){const t=C.XpG();C.Y8G("ngIf",!t.loading)}}function $n(t,i){if(1&t&&(C.qex(0),C.j41(1,"h2",33),C.EFF(2),C.nI1(3,"i18n"),C.k0s(),C.j41(4,"p",35),C.EFF(5),C.k0s(),C.bVm()),2&t){const t=C.XpG(2);C.R7$(2),C.JRh(C.bMT(3,2,"manageSubscription")),C.R7$(3),C.JRh(t.resellerSeatsRemainingMessage)}}function Fn(t,i){if(1&t){const t=C.RV6();C.j41(0,"button",29),C.bIt("click",function(){E.eBV(t);const i=C.XpG(3);return E.Njj(i.manageBillingSync())}),C.EFF(1),C.nI1(2,"i18n"),C.k0s()}if(2&t){const t=C.XpG(3);C.R7$(),C.SpI(" ",C.bMT(2,1,t.hasBillingSyncToken?"viewBillingToken":"setUpBillingSync")," ")}}function Tn(t,i){if(1&t){const t=C.RV6();C.qex(0),C.j41(1,"h2",33),C.EFF(2),C.nI1(3,"i18n"),C.k0s(),C.j41(4,"p",35),C.EFF(5),C.nI1(6,"i18n"),C.k0s(),C.j41(7,"div",44)(8,"button",29),C.bIt("click",function(){E.eBV(t);const i=C.XpG(2);return E.Njj(i.downloadLicense())}),C.EFF(9),C.nI1(10,"i18n"),C.k0s(),C.DNE(11,Fn,3,3,"button",27),C.k0s(),C.bVm()}if(2&t){const t=C.XpG(2);C.R7$(2),C.SpI(" ",C.bMT(3,4,"selfHostingTitleProper")," "),C.R7$(3),C.SpI(" ",C.bMT(6,6,"toHostBitwardenOnYourOwnServer")," "),C.R7$(4),C.SpI(" ",C.bMT(10,8,"downloadLicense")," "),C.R7$(2),C.Y8G("ngIf",t.canUseBillingSync)}}function Gn(t,i){if(1&t&&C.DNE(0,$n,6,4,"ng-container",5)(1,Tn,12,10,"ng-container",5),2&t){const t=C.XpG();C.Y8G("ngIf",t.userOrg.hasReseller&&t.resellerSeatsRemainingMessage),C.R7$(),C.Y8G("ngIf",t.showSelfHost)}}class Mn{constructor(t,i,n,e,s,o,a,r,c,l,u,d){this.apiService=t,this.i18nService=i,this.logService=n,this.organizationService=e,this.accountService=s,this.organizationApiService=o,this.route=a,this.dialogService=r,this.configService=c,this.toastService=l,this.billingApiService=u,this.organizationUserApiService=d,this.lineItems=[],this.showChangePlan=!1,this.showAdjustSecretsManager=!1,this.showSecretsManagerSubscribe=!1,this.loading=!0,this.preSelectedProductTier=ht.K_.Free,this.showSubscription=!0,this.showSelfHost=!1,this.organizationIsManagedByConsolidatedBillingMSP=!1,this.gearIcon=pt,this.teamsStarter=ht.K_.TeamsStarter,this.destroy$=new m.B,this.cancelSubscription=()=>Ui(this,void 0,void 0,function*(){const t=(0,mt.GM)(this.dialogService,{data:{type:"Organization",id:this.organizationId,plan:this.sub.plan.type}});(yield(0,v.s)(t.closed))!==mt.vD.Closed&&(yield this.load())}),this.reinstate=()=>Ui(this,void 0,void 0,function*(){if(this.loading)return;if(yield this.dialogService.openSimpleDialog({title:{key:"reinstateSubscription"},content:{key:"reinstateConfirmation"},type:"warning"}))try{yield this.organizationApiService.reinstate(this.organizationId),this.toastService.showToast({variant:"success",title:null,message:this.i18nService.t("reinstated")}),yield this.load()}catch(t){this.logService.error(t)}}),this.adjustStorage=t=>()=>Ui(this,void 0,void 0,function*(){const i=gt.A.open(this.dialogService,{data:{price:this.storageGbPrice,cadence:this.billingInterval,type:t?"Add":"Remove",organizationId:this.organizationId}});(yield(0,v.s)(i.closed))===gt.W.Submitted&&(yield this.load())}),this.removeSponsorship=()=>Ui(this,void 0,void 0,function*(){if(yield this.dialogService.openSimpleDialog({title:{key:"removeSponsorship"},content:{key:"removeSponsorshipConfirmation"},acceptButtonText:{key:"remove"},type:"warning"}))try{yield this.apiService.deleteRemoveSponsorship(this.organizationId),this.toastService.showToast({variant:"success",title:null,message:this.i18nService.t("removeSponsorshipSuccess")}),yield this.load()}catch(t){this.logService.error(t)}}),this.discountPrice=(t,i=null)=>{var n;return t-(!(null===(n=this.customerDiscount)||void 0===n?void 0:n.active)||i&&this.customerDiscount.appliesTo.length&&!this.customerDiscount.appliesTo.includes(i)?0:t*(this.customerDiscount.percentOff/100))}}ngOnInit(){return Ui(this,void 0,void 0,function*(){if(this.organizationId=this.route.snapshot.params[Mn.ROUTE_PARAM_ORGANIZATION_ID],yield this.load(),this.route.snapshot.queryParams[Mn.QUERY_PARAM_UPGRADE]){yield this.changePlan();const t=this.route.snapshot.queryParamMap.get("productTierType");if(null!=t){const i=Number(t);Object.values(ht.K_).includes(i)&&(this.preSelectedProductTier=i)}}if(this.userOrg.hasReseller){const t=(yield this.organizationUserApiService.getAllUsers(this.userOrg.id)).data.filter(t=>[K.Zx.Invited,K.Zx.Accepted,K.Zx.Confirmed].includes(t.status)).length,i=this.userOrg.seats-t,n=this.i18nService.t("seatsRemaining",i.toString(),this.userOrg.seats.toString());this.resellerSeatsRemainingMessage=n}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}load(){return Ui(this,void 0,void 0,function*(){var t,i,n,e,s,o,a,r,l;this.loading=!0,this.locale=yield(0,p._)(this.i18nService.locale$);const u=yield(0,p._)((0,R.F6)(this.accountService.activeAccount$));this.userOrg=yield(0,p._)(this.organizationService.organizations$(u).pipe((0,c.Sw)(this.organizationId)));const d=!this.userOrg.hasProvider&&this.userOrg.isOwner,h=this.userOrg.hasReseller&&this.userOrg.isOwner,b=this.userOrg.hasProvider&&this.userOrg.isProviderUser;this.organizationIsManagedByConsolidatedBillingMSP=this.userOrg.hasProvider&&this.userOrg.hasBillableProvider,this.showSubscription=d||h||b&&!this.organizationIsManagedByConsolidatedBillingMSP,this.showSelfHost=this.userOrg.productTierType===ht.K_.Families||this.userOrg.productTierType===ht.K_.Enterprise,this.showSubscription&&(this.sub=yield this.organizationApiService.getSubscription(this.organizationId),this.lineItems=null===(i=null===(t=this.sub)||void 0===t?void 0:t.subscription)||void 0===i?void 0:i.items,this.lineItems&&this.lineItems.length&&(this.lineItems=this.lineItems.map(t=>{var i,n;const e=t.amount*t.quantity,s=(null===(n=null===(i=this.sub.plan)||void 0===i?void 0:i.SecretsManager)||void 0===n?void 0:n.seatPrice)*t.quantity;return t.productName=e===s||t.name.includes("Service Accounts")?"secretsManager":"passwordManager",t}).sort(An)),100==(null===(e=null===(n=this.sub)||void 0===n?void 0:n.customerDiscount)||void 0===e?void 0:e.percentOff)&&this.lineItems.reverse());const g=yield this.organizationApiService.getApiKeyInformation(this.organizationId);this.hasBillingSyncToken=g.data.some(t=>t.keyType===K.pC.BillingSync),this.showSecretsManagerSubscribe=this.userOrg.canEditSubscription&&!this.userOrg.hasProvider&&(null===(o=null===(s=this.sub)||void 0===s?void 0:s.plan)||void 0===o?void 0:o.SecretsManager)&&!this.userOrg.useSecretsManager&&!(null===(a=this.subscription)||void 0===a?void 0:a.cancelled)&&!this.subscriptionMarkedForCancel,this.showAdjustSecretsManager=this.userOrg.canEditSubscription&&this.userOrg.useSecretsManager&&null!=this.subscription&&(null===(l=null===(r=this.sub.plan)||void 0===r?void 0:r.SecretsManager)||void 0===l?void 0:l.hasAdditionalSeatsOption)&&!this.subscription.cancelled&&!this.subscriptionMarkedForCancel,this.loading=!1})}get subscription(){return null!=this.sub?this.sub.subscription:null}get subscriptionLineItems(){return this.lineItems.map(t=>({name:t.name,amount:this.discountPrice(t.amount,t.productId),quantity:t.quantity,interval:t.interval,sponsoredSubscriptionItem:t.sponsoredSubscriptionItem,addonSubscriptionItem:t.addonSubscriptionItem,productName:t.productName,productId:t.productId}))}get nextInvoice(){return null!=this.sub?this.sub.upcomingInvoice:null}get customerDiscount(){return null!=this.sub?this.sub.customerDiscount:null}get isExpired(){const t=this.nextInvoice;return null!=t&&new Date(t.date).getTime()<Date.now()}get storagePercentage(){return null!=this.sub&&this.sub.maxStorageGb?+(this.sub.storageGb/this.sub.maxStorageGb*100).toFixed(2):0}get billingInterval(){return!this.sub.plan.isAnnual?"month":"year"}get storageGbPrice(){return this.sub.plan.PasswordManager.additionalStoragePricePerGb}get seatPrice(){return this.discountPrice(this.sub.plan.PasswordManager.seatPrice)}get seats(){return this.sub.seats}get smOptions(){return{seatCount:this.sub.smSeats,maxAutoscaleSeats:this.sub.maxAutoscaleSmSeats,seatPrice:this.sub.plan.SecretsManager.seatPrice,maxAutoscaleServiceAccounts:this.sub.maxAutoscaleSmServiceAccounts,additionalServiceAccounts:this.sub.smServiceAccounts-this.sub.plan.SecretsManager.baseServiceAccount,interval:this.sub.plan.isAnnual?"year":"month",additionalServiceAccountPrice:this.sub.plan.SecretsManager.additionalPricePerServiceAccount,baseServiceAccountCount:this.sub.plan.SecretsManager.baseServiceAccount}}get maxAutoscaleSeats(){return this.sub.maxAutoscaleSeats}get canAdjustSeats(){return this.sub.plan.PasswordManager.hasAdditionalSeatsOption}get isSponsoredSubscription(){var t;return null===(t=this.sub.subscription)||void 0===t?void 0:t.items.some(t=>t.sponsoredSubscriptionItem)}get subscriptionDesc(){if(this.sub.planType===ht.OL.Free)return this.i18nService.t("subscriptionFreePlan",this.sub.seats.toString());if(this.sub.planType===ht.OL.FamiliesAnnually||this.sub.planType===ht.OL.FamiliesAnnually2025||this.sub.planType===ht.OL.FamiliesAnnually2019||this.sub.planType===ht.OL.TeamsStarter2023||this.sub.planType===ht.OL.TeamsStarter)return this.isSponsoredSubscription?this.i18nService.t("subscriptionSponsoredFamiliesPlan",this.sub.seats.toString()):this.i18nService.t("subscriptionUpgrade",this.sub.seats.toString());if(this.sub.maxAutoscaleSeats===this.sub.seats&&null!=this.sub.seats){const t=this.sub.plan.isAnnual?"annualSubscriptionUserSeatsMessage":"monthlySubscriptionUserSeatsMessage";return this.i18nService.t(t+"subscriptionSeatMaxReached",this.sub.seats.toString())}if(this.userOrg.productTierType===ht.K_.TeamsStarter)return this.i18nService.t("subscriptionUserSeatsWithoutAdditionalSeatsOption",10);if(null==this.sub.maxAutoscaleSeats){const t=this.sub.plan.isAnnual?"annualSubscriptionUserSeatsMessage":"monthlySubscriptionUserSeatsMessage";return this.i18nService.t(t)}{const t=this.sub.plan.isAnnual?"annualSubscriptionUserSeatsMessage":"monthlySubscriptionUserSeatsMessage";return this.i18nService.t(t,this.sub.maxAutoscaleSeats.toString())}}get subscriptionMarkedForCancel(){return null!=this.subscription&&!this.subscription.cancelled&&this.subscription.cancelAtEndDate}changePlan(){return Ui(this,void 0,void 0,function*(){const t=(0,Ht.IO)(this.dialogService,{data:{organizationId:this.organizationId,subscription:this.sub,productTierType:this.userOrg.productTierType}});(yield(0,v.s)(t.closed))!==Ht.d1.Closed&&(yield this.load())})}isSecretsManagerTrial(){var t,i,n,e,s,o;const a="sm-standalone"===(null===(i=null===(t=this.sub)||void 0===t?void 0:t.customerDiscount)||void 0===i?void 0:i.id),r=null!==(o=null===(s=null===(e=null===(n=this.sub)||void 0===n?void 0:n.subscription)||void 0===e?void 0:e.items)||void 0===s?void 0:s.some(t=>{var i,n,e;return null===(e=null===(n=null===(i=this.sub)||void 0===i?void 0:i.customerDiscount)||void 0===n?void 0:n.appliesTo)||void 0===e?void 0:e.includes(t.productId)}))&&void 0!==o&&o;return a&&r}closeChangePlan(){this.showChangePlan=!1}downloadLicense(){return Ui(this,void 0,void 0,function*(){ei.open(this.dialogService,{data:{organizationId:this.organizationId}})})}manageBillingSync(){return Ui(this,void 0,void 0,function*(){const t=Wt.open(this.dialogService,{organizationId:this.organizationId,hasBillingToken:this.hasBillingSyncToken});yield(0,p._)(t.closed),yield this.load()})}subscriptionAdjusted(){return Ui(this,void 0,void 0,function*(){yield this.load()})}calculateTotalAppliedDiscount(t){var i;return t/(1-(null===(i=this.customerDiscount)||void 0===i?void 0:i.percentOff)/100)}get showChangePlanButton(){var t,i;return!this.showChangePlan&&this.sub.plan.productTier!==ht.K_.Enterprise&&!(null===(t=this.sub.subscription)||void 0===t?void 0:t.cancelled)||(null===(i=this.sub.subscription)||void 0===i?void 0:i.cancelled)&&this.sub.plan.productTier===ht.K_.Free}get canUseBillingSync(){return this.userOrg.productTierType===ht.K_.Enterprise}}function An(t,i){return t.productName==i.productName?t.addonSubscriptionItem==i.addonSubscriptionItem?0:t.addonSubscriptionItem?1:-1:t.productName.localeCompare(i.productName)}Mn.QUERY_PARAM_UPGRADE="upgrade",Mn.ROUTE_PARAM_ORGANIZATION_ID="organizationId",Mn.ɵfac=function(t){return new(t||Mn)(C.rXU(wt.G),C.rXU($t.W),C.rXU(bt.K),C.rXU(c.PV),C.rXU(P.Di),C.rXU(Ft.X),C.rXU(B.nX),C.rXU(D.o3),C.rXU(U.w),C.rXU(Tt.f),C.rXU(si.P),C.rXU(dt.uB))},Mn.ɵcmp=C.VBU({type:Mn,selectors:[["ng-component"]],standalone:!1,decls:7,vars:3,consts:[["hideSubscription",""],["setupSelfHost",""],["calculateElse",""],["organizationIsNotManagedByConsolidatedBillingMSP",""],["isOrganizationOwner",""],[4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"bwi","bwi-spinner","bwi-spin","tw-text-muted",3,"title"],[1,"tw-sr-only"],[3,"organizationSubscriptionResponse","reinstatementRequested",4,"ngIf"],[4,"ngTemplateOutlet"],[3,"reinstatementRequested","organizationSubscriptionResponse"],[1,"tw-flex-col"],[1,"tw-block","tw-border-0","tw-border-b","tw-border-solid","tw-border-secondary-300"],["class","tw-ml-3","bitBadge","","variant","success",4,"ngIf"],["body",""],["bitBadge","","variant","success",1,"tw-ml-3"],["bitRow","",4,"ngFor","ngForOf"],["bitRow",""],["bitCell","",1,"tw-align-middle",3,"ngClass"],["bitCell","",1,"tw-text-right"],[1,"tw-flex","tw-flex-col"],["class","tw-line-through !tw-text-muted",4,"ngIf"],[1,"tw-line-through","!tw-text-muted"],["bitRow","",4,"ngIf"],["bitCell",""],[1,"tw-mt-5"],["bitButton","","buttonType","secondary","type","button",3,"click",4,"ngIf"],[3,"organizationId","currentPlan","preSelectedProductTier","onChanged","onCanceled",4,"ngIf"],["bitButton","","buttonType","secondary","type","button",3,"click"],[3,"onChanged","onCanceled","organizationId","currentPlan","preSelectedProductTier"],[1,"tw-mt-7"],[3,"onSubscribe","plan","organization","customerDiscount"],["bitTypography","h2",1,"tw-mt-7"],["bitTypography","body1",4,"ngIf"],["bitTypography","body1"],["bitButton","","buttonType","danger","type","button",3,"bitAction",4,"ngIf"],["href","https://bitwarden.com/contact/","target","_blank","rel","noreferrer"],["bitTypography","h3",1,"tw-mt-7"],[3,"onAdjusted","seatPrice","organizationId","interval","currentSeatCount","maxAutoscaleSeats"],["bitButton","","buttonType","danger","type","button",3,"bitAction"],["bitTypography","h4",1,"tw-mt-9"],["bgColor","success",3,"barWidth"],[1,"tw-mt-3"],[1,"tw-flex","tw-space-x-2"],["bitButton","","buttonType","secondary","type","button",3,"bitAction"],["bitTypography","h3",1,"tw-mt-9"],[3,"onAdjusted","organizationId","options"],["bitButton","","buttonType","danger","type","button",3,"click",4,"ngIf"],["bitButton","","buttonType","danger","type","button",3,"click"],["bitTypography","h2"],["bitTypography","body1",4,"ngIf","ngIfElse"],[3,"routerLink"],[1,"tw-flex","tw-flex-col","tw-items-center","tw-text-info"],[1,"tw-size-56","tw-content-center"],["aria-hidden","true",3,"icon"],[1,"tw-font-medium"]],template:function(t,i){if(1&t&&(C.nrm(0,"app-header"),C.DNE(1,Xi,6,7,"ng-container",5)(2,mn,2,1,"bit-container",6)(3,Rn,1,1,"ng-template",null,0,C.C5r)(5,Gn,2,2,"ng-template",null,1,C.C5r)),2&t){const t=C.sdS(4);C.R7$(),C.Y8G("ngIf",i.loading),C.R7$(),C.Y8G("ngIf",i.showSubscription)("ngIfElse",t)}},dependencies:[r.Wk,O.YU,O.Sq,O.bT,O.T3,ti.p,oi.n,st.Q,X.H,ai.i,ri.X,ci.Q,li.Y,ui._,ui.O,di.r,z.f,fi,Ii,Gi,ji,Bi,O.oe,Y.$],encapsulation:2});var kn=n(20702);class xn extends kn.r{constructor(t){if(super(t),null==t)return;this.billingSyncKey=this.getResponseProperty("BillingSyncKey");const i=this.getResponseProperty("LastLicenseSync");i&&(this.lastLicenseSync=new Date(i))}}class jn{constructor(t){null!=t&&(this.planName=t.plan.name,this.expirationWithGracePeriod=null!=t.expiration?new Date(t.expiration):null,this.expirationWithoutGracePeriod=null!=t.expirationWithoutGracePeriod?new Date(t.expirationWithoutGracePeriod):null)}get hasSeparateGracePeriod(){return null!=this.expirationWithGracePeriod&&null!=this.expirationWithoutGracePeriod}get hasExpiration(){return null!=this.expirationWithGracePeriod}get isExpiredWithoutGracePeriod(){return this.hasSeparateGracePeriod&&this.expirationWithoutGracePeriod<new Date}get isExpiredAndOutsideGracePeriod(){return this.hasExpiration&&this.expirationWithGracePeriod<new Date}get isInTrial(){return this.expirationWithGracePeriod&&this.expirationWithoutGracePeriod&&this.expirationWithGracePeriod.getTime()===this.expirationWithoutGracePeriod.getTime()}}var Cn=n(29377),En=n(83516);class Pn{constructor(t,i,n,e){this.organizationId=t,this.type=i,this.enabled=n,this.config=e}}class Bn{constructor(t){this.billingSyncKey=t}}var Un=n(49519),Dn=n(57083),zn=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};class Xn{constructor(t,i,n,e){this.dialogRef=t,this.data=i,this.apiService=n,this.logService=e,this.submit=()=>zn(this,void 0,void 0,function*(){var t;try{const i=new Pn(this.entityId,K.eH.CloudBillingSync,!0,new Bn(this.formGroup.value.billingSyncKey)),n=null==this.existingConnectionId?yield this.apiService.createOrganizationConnection(i,xn):yield this.apiService.updateOrganizationConnection(i,xn,this.existingConnectionId);this.existingConnectionId=null==n?void 0:n.id,this.billingSyncKey=null===(t=null==n?void 0:n.config)||void 0===t?void 0:t.billingSyncKey,this.setParentConnection(n),this.dialogRef.close()}catch(i){this.logService.error(i)}}),this.deleteConnection=()=>zn(this,void 0,void 0,function*(){yield this.apiService.deleteOrganizationConnection(this.existingConnectionId),this.setParentConnection(null),this.dialogRef.close()}),this.entityId=i.entityId,this.existingConnectionId=i.existingConnectionId,this.billingSyncKey=i.billingSyncKey,this.setParentConnection=i.setParentConnection,this.formGroup=new vt.gE({billingSyncKey:new vt.MJ(this.billingSyncKey,vt.k0.required)})}static open(t,i){return t.open(Xn,{data:i})}}Xn.ɵfac=function(t){return new(t||Xn)(C.rXU(D.ce),C.rXU(yt.Qs),C.rXU(wt.G),C.rXU(bt.K))},Xn.ɵcmp=C.VBU({type:Xn,selectors:[["ng-component"]],standalone:!1,decls:23,vars:22,consts:[[3,"formGroup","bitSubmit"],["bitDialogTitle",""],["bitDialogContent",""],["bitInput","","id","billingSyncKey","type","text","formControlName","billingSyncKey","appAutofocus","","appInputVerbatim",""],["bitDialogFooter",""],["type","submit","bitButton","","bitFormButton","","buttonType","primary"],["bitButton","","bitDialogClose","","type","button"],["type","button","buttonType","danger","bitIconButton","bwi-trash","bitFormButton","",1,"tw-ml-auto",3,"bitAction","label"]],template:function(t,i){1&t&&(C.j41(0,"form",0)(1,"bit-dialog")(2,"span",1),C.EFF(3),C.nI1(4,"i18n"),C.k0s(),C.j41(5,"div",2)(6,"p"),C.EFF(7),C.nI1(8,"i18n"),C.k0s(),C.j41(9,"bit-form-field")(10,"bit-label"),C.EFF(11),C.nI1(12,"i18n"),C.k0s(),C.nrm(13,"input",3),C.k0s()(),C.qex(14,4),C.j41(15,"button",5),C.EFF(16),C.nI1(17,"i18n"),C.k0s(),C.j41(18,"button",6),C.EFF(19),C.nI1(20,"i18n"),C.k0s(),C.nrm(21,"button",7),C.nI1(22,"i18n"),C.bVm(),C.k0s()()),2&t&&(C.Y8G("formGroup",i.formGroup)("bitSubmit",i.submit),C.R7$(3),C.SpI(" ",C.bMT(4,10,"manageBillingTokenSync")," "),C.R7$(4),C.JRh(C.bMT(8,12,"billingSyncKeyDesc")),C.R7$(4),C.SpI(" ",C.bMT(12,14,"billingSyncKey")," "),C.R7$(5),C.SpI(" ",C.bMT(17,16,"save")," "),C.R7$(3),C.SpI(" ",C.bMT(20,18,"cancel")," "),C.R7$(2),C.Y8G("label",C.mNQ(C.bMT(22,20,"delete")))("bitAction",i.deleteConnection))},dependencies:[vt.qT,vt.me,vt.BC,vt.cb,vt.j4,vt.JD,Un.B,Dn.q,ti.p,At.$,kt.L,st.Q,jt.I,Ct.m,Et.j,Pt.J,Bt.h,Dt.s,Y.$],encapsulation:2});var On=n(24374),Yn=n(17721),Nn=n(13583);class Vn{constructor(){this.gearIcon=pt}}Vn.ɵfac=function(t){return new(t||Vn)},Vn.ɵcmp=C.VBU({type:Vn,selectors:[["app-org-subscription-hidden"]],inputs:{providerName:"providerName"},standalone:!1,decls:9,vars:8,consts:[[1,"tw-flex","tw-flex-col","tw-items-center","tw-text-info"],[1,"tw-size-56","tw-content-center"],["aria-hidden","true",3,"icon"],[1,"tw-font-medium"]],template:function(t,i){1&t&&(C.j41(0,"div",0)(1,"div",1),C.nrm(2,"bit-icon",2),C.k0s(),C.j41(3,"p",3),C.EFF(4),C.nI1(5,"i18n"),C.k0s(),C.j41(6,"p"),C.EFF(7),C.nI1(8,"i18n"),C.k0s()()),2&t&&(C.R7$(2),C.Y8G("icon",i.gearIcon),C.R7$(2),C.JRh(C.i5U(5,3,"billingManagedByProvider",i.providerName)),C.R7$(3),C.JRh(C.bMT(8,6,"billingContactProviderForAssistance")))},dependencies:[ai.i,Y.$],encapsulation:2});var Ln=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};const qn=t=>({"tw-text-danger":t});function Jn(t,i){1&t&&(C.qex(0),C.nrm(1,"i",2),C.nI1(2,"i18n"),C.j41(3,"span",3),C.EFF(4),C.nI1(5,"i18n"),C.k0s(),C.bVm()),2&t&&(C.R7$(),C.Y8G("title",C.mNQ(C.bMT(2,3,"loading"))),C.R7$(3),C.JRh(C.bMT(5,5,"loading")))}function _n(t,i){if(1&t&&C.nrm(0,"app-org-subscription-hidden",4),2&t){const t=C.XpG();C.Y8G("providerName",t.userOrg.providerName)}}function Wn(t,i){if(1&t&&(C.qex(0),C.j41(1,"dt"),C.EFF(2),C.nI1(3,"i18n"),C.k0s(),C.j41(4,"dd"),C.EFF(5),C.nI1(6,"date"),C.nI1(7,"i18n"),C.k0s(),C.bVm()),2&t){const t=C.XpG(2);C.R7$(2),C.JRh(C.bMT(3,2,"lastLicenseSync")),C.R7$(3),C.SpI(" ",null!=t.lastLicenseSync?C.i5U(6,4,t.lastLicenseSync,"medium"):C.bMT(7,7,"never")," ")}}function Zn(t,i){if(1&t&&(C.j41(0,"div",17),C.EFF(1),C.nI1(2,"date"),C.nI1(3,"i18n"),C.k0s()),2&t){const t=C.XpG(3);C.R7$(),C.SpI(" ",C.i5U(3,4,"selfHostGracePeriodHelp",C.i5U(2,1,t.subscription.expirationWithGracePeriod,"mediumDate"))," ")}}function Hn(t,i){if(1&t&&(C.j41(0,"dd",6),C.EFF(1),C.nI1(2,"date"),C.DNE(3,Zn,4,7,"div",16),C.k0s()),2&t){const t=C.XpG(2);C.Y8G("ngClass",C.eq3(6,qn,t.showAsExpired)),C.R7$(),C.SpI(" ",C.i5U(2,3,t.subscription.hasSeparateGracePeriod?t.subscription.expirationWithoutGracePeriod:t.subscription.expirationWithGracePeriod,"mediumDate")," "),C.R7$(2),C.Y8G("ngIf",t.subscription.hasSeparateGracePeriod&&!t.subscription.isInTrial)}}function Kn(t,i){1&t&&(C.j41(0,"dd"),C.EFF(1),C.nI1(2,"i18n"),C.k0s()),2&t&&(C.R7$(),C.JRh(C.bMT(2,1,"neverExpires")))}function Qn(t,i){if(1&t&&(C.j41(0,"bit-radio-button",18)(1,"bit-label"),C.EFF(2),C.nI1(3,"i18n"),C.j41(4,"a",19),C.nrm(5,"i",8),C.j41(6,"span",3),C.EFF(7),C.nI1(8,"i18n"),C.k0s()()(),C.j41(9,"bit-hint"),C.EFF(10),C.nI1(11,"i18n"),C.k0s()()),2&t){const t=C.XpG(2);C.Y8G("value",t.licenseOptions.SYNC)("disabled",t.disableLicenseSyncControl),C.R7$(2),C.SpI("",C.bMT(3,5,"automaticSync")," "),C.R7$(5),C.JRh(C.bMT(8,7,"billingSyncHelp")),C.R7$(3),C.SpI(" ",C.bMT(11,9,"automaticBillingSyncDesc")," ")}}function te(t,i){if(1&t){const t=C.RV6();C.qex(0),C.j41(1,"div",20)(2,"button",21),C.bIt("click",function(){E.eBV(t);const i=C.XpG(2);return E.Njj(i.manageBillingSyncSelfHosted())}),C.EFF(3),C.nI1(4,"i18n"),C.k0s(),C.j41(5,"button",22),C.EFF(6),C.nI1(7,"i18n"),C.k0s()(),C.bVm()}if(2&t){const t=C.XpG(2);C.R7$(3),C.SpI(" ",C.bMT(4,4,"manageBillingTokenSync")," "),C.R7$(2),C.Y8G("bitAction",t.syncLicense)("disabled",!t.billingSyncEnabled),C.R7$(),C.SpI(" ",C.bMT(7,6,"syncLicense")," ")}}function ie(t,i){if(1&t&&(C.j41(0,"bit-radio-button",23)(1,"bit-label"),C.EFF(2),C.nI1(3,"i18n"),C.k0s(),C.j41(4,"bit-hint"),C.EFF(5),C.nI1(6,"i18n"),C.k0s()()),2&t){const t=C.XpG(2);C.Y8G("value",t.licenseOptions.UPLOAD),C.R7$(2),C.JRh(C.bMT(3,3,"manualUpload")),C.R7$(3),C.SpI(" ",C.bMT(6,5,"manualBillingTokenUploadDesc")," ")}}function ne(t,i){1&t&&(C.j41(0,"bit-label",27),C.EFF(1),C.nI1(2,"i18n"),C.k0s()),2&t&&(C.R7$(),C.SpI(" ",C.bMT(2,1,"licenseAndBillingManagementDesc")," "))}function ee(t,i){1&t&&(C.j41(0,"h3",28),C.EFF(1),C.nI1(2,"i18n"),C.k0s()),2&t&&(C.R7$(),C.SpI(" ",C.bMT(2,1,"uploadLicense")," "))}function se(t,i){if(1&t){const t=C.RV6();C.qex(0),C.DNE(1,ne,3,3,"bit-label",24)(2,ee,3,3,"h3",25),C.j41(3,"app-update-license",26),C.bIt("onUpdated",function(){E.eBV(t);const i=C.XpG(2);return E.Njj(i.licenseUploaded())}),C.k0s(),C.bVm()}if(2&t){const t=C.XpG(2);C.R7$(),C.Y8G("ngIf",!t.showAutomaticSyncAndManualUpload),C.R7$(),C.Y8G("ngIf",t.showAutomaticSyncAndManualUpload),C.R7$(),C.Y8G("showAutomaticSyncAndManualUpload",t.showAutomaticSyncAndManualUpload)("organizationId",t.organizationId)("showCancel",!1)}}function oe(t,i){if(1&t&&(C.qex(0),C.j41(1,"dl",5)(2,"dt"),C.EFF(3),C.nI1(4,"i18n"),C.k0s(),C.j41(5,"dd"),C.EFF(6),C.k0s(),C.DNE(7,Wn,8,9,"ng-container",0),C.j41(8,"dt")(9,"span",6),C.EFF(10),C.nI1(11,"i18n"),C.k0s(),C.j41(12,"a",7),C.nI1(13,"i18n"),C.nrm(14,"i",8),C.j41(15,"span",3),C.EFF(16),C.nI1(17,"i18n"),C.k0s()()(),C.DNE(18,Hn,4,8,"dd",9)(19,Kn,3,3,"dd",0),C.k0s(),C.j41(20,"a",10),C.EFF(21),C.nI1(22,"i18n"),C.k0s(),C.j41(23,"form",11)(24,"bit-radio-group",12)(25,"h2",13),C.EFF(26),C.nI1(27,"i18n"),C.k0s(),C.DNE(28,Qn,12,11,"bit-radio-button",14)(29,te,8,8,"ng-container",0)(30,ie,7,7,"bit-radio-button",15)(31,se,4,5,"ng-container",0),C.k0s()(),C.bVm()),2&t){const t=C.XpG();C.R7$(3),C.JRh(C.bMT(4,19,"billingPlan")),C.R7$(3),C.JRh(t.subscription.planName),C.R7$(),C.Y8G("ngIf",t.billingSyncSetUp),C.R7$(2),C.Y8G("ngClass",C.eq3(31,qn,t.showAsExpired)),C.R7$(),C.JRh(C.bMT(11,21,"subscriptionExpiration")),C.R7$(2),C.Y8G("appA11yTitle",C.bMT(13,23,"licensePaidFeaturesHelp")),C.R7$(4),C.JRh(C.bMT(17,25,"licensePaidFeaturesHelp")),C.R7$(2),C.Y8G("ngIf",t.subscription.hasExpiration),C.R7$(),C.Y8G("ngIf",!t.subscription.hasExpiration),C.R7$(),C.Y8G("href",C.mNQ(t.cloudWebVaultUrl),C.B4B),C.R7$(),C.SpI(" ",C.bMT(22,27,"launchCloudSubscription")," "),C.R7$(2),C.Y8G("formGroup",t.form),C.R7$(),C.Y8G("block",!0),C.R7$(2),C.SpI(" ",C.bMT(27,29,"licenseAndBillingManagement")," "),C.R7$(2),C.Y8G("ngIf",t.showAutomaticSyncAndManualUpload),C.R7$(),C.Y8G("ngIf",t.updateMethod===t.licenseOptions.SYNC),C.R7$(),C.Y8G("ngIf",t.showAutomaticSyncAndManualUpload),C.R7$(),C.Y8G("ngIf",t.updateMethod===t.licenseOptions.UPLOAD)}}var ae;!function(t){t[t.SYNC=0]="SYNC",t[t.UPLOAD=1]="UPLOAD"}(ae||(ae={}));class re{set existingBillingSyncConnection(t){this._existingBillingSyncConnection=t,this.form.get("updateMethod").setValue(this.billingSyncEnabled?ae.SYNC:ae.UPLOAD)}get existingBillingSyncConnection(){return this._existingBillingSyncConnection}get billingSyncEnabled(){var t;return null===(t=this.existingBillingSyncConnection)||void 0===t?void 0:t.enabled}get showAsExpired(){return this.subscription.hasSeparateGracePeriod?this.subscription.isExpiredWithoutGracePeriod:this.subscription.isExpiredAndOutsideGracePeriod}constructor(t,i,n,e,s,o,a,r,c,l,u){this.messagingService=t,this.apiService=i,this.organizationService=n,this.accountService=e,this.route=s,this.organizationApiService=o,this.platformUtilsService=a,this.i18nService=r,this.environmentService=c,this.dialogService=l,this.toastService=u,this.licenseOptions=ae,this.form=new vt.gE({updateMethod:new vt.MJ(ae.UPLOAD)}),this.disableLicenseSyncControl=!1,this.firstLoaded=!1,this.loading=!1,this.destroy$=new m.B,this.syncLicense=()=>Ln(this,void 0,void 0,function*(){this.form.get("updateMethod").setValue(ae.SYNC),yield this.organizationApiService.selfHostedSyncLicense(this.organizationId),this.load(),yield this.loadOrganizationConnection(),this.messagingService.send("updatedOrgLicense"),this.toastService.showToast({variant:"success",title:null,message:this.i18nService.t("licenseSyncSuccess")})})}ngOnInit(){return Ln(this,void 0,void 0,function*(){this.cloudWebVaultUrl=yield(0,p._)(this.environmentService.cloudWebVaultUrl$),this.route.params.pipe((0,nt.H)(t=>Ln(this,void 0,void 0,function*(){this.organizationId=t.organizationId,yield this.load(),yield this.loadOrganizationConnection(),this.firstLoaded=!0})),(0,I.Q)(this.destroy$)).subscribe()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}load(){return Ln(this,void 0,void 0,function*(){if(this.loading)return;this.loading=!0;const t=yield(0,p._)((0,R.F6)(this.accountService.activeAccount$));if(this.userOrg=yield(0,p._)(this.organizationService.organizations$(t).pipe((0,c.Sw)(this.organizationId))),this.showAutomaticSyncAndManualUpload=this.userOrg.productTierType!=ht.K_.Families,this.userOrg.canViewSubscription){const t=yield this.organizationApiService.getSubscription(this.organizationId);this.subscription=new jn(t)}this.loading=!1})}loadOrganizationConnection(){return Ln(this,void 0,void 0,function*(){if(!this.firstLoaded){const t=yield this.apiService.getCloudCommunicationsEnabled();this.disableLicenseSyncControl=!t}this.disableLicenseSyncControl||(this.existingBillingSyncConnection=yield this.apiService.getOrganizationConnection(this.organizationId,K.eH.CloudBillingSync,xn))})}licenseUploaded(){this.load(),this.messagingService.send("updatedOrgLicense")}manageBillingSyncSelfHosted(){var t,i,n;Xn.open(this.dialogService,{entityId:this.organizationId,existingConnectionId:null===(t=this.existingBillingSyncConnection)||void 0===t?void 0:t.id,billingSyncKey:null===(n=null===(i=this.existingBillingSyncConnection)||void 0===i?void 0:i.config)||void 0===n?void 0:n.billingSyncKey,setParentConnection:t=>{this.existingBillingSyncConnection=t}})}get billingSyncSetUp(){var t;return null!=(null===(t=this.existingBillingSyncConnection)||void 0===t?void 0:t.id)}get updateMethod(){return this.form.get("updateMethod").value}get lastLicenseSync(){var t,i;return null===(i=null===(t=this.existingBillingSyncConnection)||void 0===t?void 0:t.config)||void 0===i?void 0:i.lastLicenseSync}}re.ɵfac=function(t){return new(t||re)(C.rXU(En.U),C.rXU(wt.G),C.rXU(c.PV),C.rXU(P.Di),C.rXU(B.nX),C.rXU(Ft.X),C.rXU(Rt.y),C.rXU($t.W),C.rXU(Cn.v),C.rXU(D.o3),C.rXU(Tt.f))},re.ɵcmp=C.VBU({type:re,selectors:[["ng-component"]],standalone:!1,decls:5,vars:3,consts:[[4,"ngIf"],[3,"providerName",4,"ngIf"],[1,"bwi","bwi-spinner","bwi-spin","tw-text-muted",3,"title"],[1,"tw-sr-only"],[3,"providerName"],[1,"tw-mb-2"],[3,"ngClass"],["href","https://bitwarden.com/help/licensing-on-premise/#update-organization-license","target","_blank","rel","noreferrer",3,"appA11yTitle"],["aria-hidden","true",1,"bwi","bwi-question-circle"],[3,"ngClass",4,"ngIf"],["bitButton","","buttonType","secondary","target","_blank","rel","noreferrer",1,"tw-mb-4",3,"href"],[3,"formGroup"],["formControlName","updateMethod",3,"block"],[1,"tw-mt-5"],["id","automatic-sync",3,"value","disabled",4,"ngIf"],["id","manual-upload","class","tw-mt-6",3,"value",4,"ngIf"],["class","tw-text-muted tw-break-words tw-whitespace-normal tw-max-w-fit tw-inline-block",4,"ngIf"],[1,"tw-text-muted","tw-break-words","tw-whitespace-normal","tw-max-w-fit","tw-inline-block"],["id","automatic-sync",3,"value","disabled"],["href","https://bitwarden.com/help/families-for-enterprise-self-hosted/","target","_blank","rel","noreferrer","slot","end","bitLink",""],[1,"tw-mt-6","tw-flex","tw-gap-2"],["bitButton","","buttonType","secondary","type","button",3,"click"],["bitButton","","buttonType","primary","type","button",3,"bitAction","disabled"],["id","manual-upload",1,"tw-mt-6",3,"value"],["class","tw-mb-6 tw-block",4,"ngIf"],["class","tw-font-medium tw-mt-6",4,"ngIf"],[3,"onUpdated","showAutomaticSyncAndManualUpload","organizationId","showCancel"],[1,"tw-mb-6","tw-block"],[1,"tw-font-medium","tw-mt-6"]],template:function(t,i){1&t&&(C.nrm(0,"app-header"),C.j41(1,"bit-container"),C.DNE(2,Jn,6,7,"ng-container",0)(3,_n,1,1,"app-org-subscription-hidden",1)(4,oe,32,33,"ng-container",0),C.k0s()),2&t&&(C.R7$(2),C.Y8G("ngIf",!i.firstLoaded&&i.loading),C.R7$(),C.Y8G("ngIf",i.firstLoaded&&!i.userOrg.canViewSubscription),C.R7$(),C.Y8G("ngIf",i.subscription&&i.firstLoaded))},dependencies:[O.YU,O.bT,vt.qT,vt.BC,vt.cb,vt.j4,vt.JD,Qt.C,ti.p,st.Q,X.H,Et.j,mi.I,ii.L,On.d,Yn.Y,Nn.m,z.f,Vn,O.vh,Y.$],encapsulation:2});const ce=[{path:"",canActivate:[(0,W.V)(c.Vc)],children:[{path:"",pathMatch:"full",redirectTo:"subscription"},{path:"subscription",component:it._.isSelfHost()?re:Mn,data:{titleId:"subscription"}},{path:"payment-details",component:_,canActivate:[(0,W.V)(t=>t.canEditPaymentMethods),tt],data:{titleId:"paymentDetails"}},{path:"history",component:ut,canActivate:[(0,W.V)(t=>t.canViewBillingHistory),tt],data:{titleId:"billingHistory"}}]}];class le{}le.ɵfac=function(t){return new(t||le)},le.ɵmod=C.$C({type:le}),le.ɵinj=E.G2t({imports:[r.iI.forChild(ce),r.iI]});class ue{}ue.ɵfac=function(t){return new(t||ue)},ue.ɵmod=C.$C({type:ue}),ue.ɵinj=E.G2t({imports:[le,s.R6,a.rd,Si.v,o.G,e.H]})}}]);
//# sourceMappingURL=614.0e7b2be70c6c17f67282.js.map