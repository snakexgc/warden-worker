"use strict";(self.webpackChunk_bitwarden_web_vault=self.webpackChunk_bitwarden_web_vault||[]).push([[453],{37453:(i,t,e)=>{e.d(t,{IndividualBillingModule:()=>Ct});var n=e(65731),s=e(63734),o=e(72932),r=e(40101),a=e(74208),c=e(6056),u=e(3204),l=e(82468),p=e(1601),d=e(37115),b=e(16878),h=e(44500),m=e(27442),f=e(83892),g=e(36359),v=e(69194),y=e(25065),I=e(98221),S=e(31925),$=e(33812),w=e(35500),F=e(10672),T=e(77468),R=e(88016),M=function(i,t,e,n){return new(e||(e=Promise))(function(s,o){function r(i){try{c(n.next(i))}catch(t){o(t)}}function a(i){try{c(n.throw(i))}catch(t){o(t)}}function c(i){var t;i.done?s(i.value):(t=i.value,t instanceof e?t:new e(function(i){i(t)})).then(r,a)}c((n=n.apply(i,t||[])).next())})};function k(i,t){1&i&&($.qex(0),$.nrm(1,"i",0),$.nI1(2,"i18n"),$.j41(3,"span",1),$.EFF(4),$.nI1(5,"i18n"),$.k0s(),$.bVm()),2&i&&($.R7$(),$.Y8G("title",$.mNQ($.bMT(2,3,"loading"))),$.R7$(3),$.JRh($.bMT(5,5,"loading")))}function U(i,t){if(1&i){const i=$.RV6();$.qex(0),$.j41(1,"app-display-payment-method",2),$.bIt("updated",function(t){a.eBV(i);const e=$.XpG();return a.Njj(e.setPaymentMethod(t))}),$.k0s(),$.nrm(2,"app-display-account-credit",3),$.bVm()}if(2&i){$.XpG();const i=$.r8f(1);$.R7$(),$.Y8G("subscriber",i.account)("paymentMethod",i.paymentMethod),$.R7$(),$.Y8G("subscriber",i.account)("credit",i.credit)}}class P{constructor(i,t){this.accountService=i,this.subscriberBillingClient=t,this.viewState$=new b.t(null),this.load$=this.accountService.activeAccount$.pipe(S.$i,(0,h.n)(i=>M(this,void 0,void 0,function*(){const[t,e]=yield Promise.all([this.subscriberBillingClient.getPaymentMethod(i),this.subscriberBillingClient.getCredit(i)]);return{account:i,paymentMethod:t,credit:e}})),(0,m.t)({bufferSize:1,refCount:!1})),this.view$=(0,f.h)(this.load$.pipe((0,g.M)(i=>this.viewState$.next(i))),this.viewState$.pipe((0,v.p)(i=>null!==i))).pipe((0,m.t)({bufferSize:1,refCount:!0})),this.setPaymentMethod=i=>{this.viewState$.value&&this.viewState$.next(Object.assign(Object.assign({},this.viewState$.value),{paymentMethod:i}))}}}P.ɵfac=function(i){return new(i||P)($.rXU(w.Di),$.rXU(I.Hd))},P.ɵcmp=$.VBU({type:P,selectors:[["ng-component"]],features:[$.Jv_([I.Hd])],decls:5,vars:4,consts:[["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","tw-text-muted",3,"title"],[1,"tw-sr-only"],[3,"updated","subscriber","paymentMethod"],[3,"subscriber","credit"]],template:function(i,t){if(1&i&&($.j41(0,"bit-container"),$.SS7(1),$.nI1(2,"async"),$.nVh(3,k,6,7,"ng-container")(4,U,3,4,"ng-container"),$.k0s()),2&i){$.R7$();const i=$.bH3($.bMT(2,1,t.view$));$.R7$(2),$.vxM(i?4:3)}},dependencies:[s.I$,s.H8,o.G,y.G,F.H,T.Jj,R.$],encapsulation:2});var j=e(83731),G=e(93695),E=e(33338),x=e(29377),X=e(23649),B=e(58329),A=e(50700),D=e(69855),C=e(56898),V=e(44432),Y=e(88832),J=e(49272),N=e(10010),L=e(12012),H=e(51757),O=e(83078),z=e(26657),Q=e(45154),q=e(86226),_=e(93199),W=e(97553),Z=e(43759),K=e(58806),ii=function(i,t,e,n){return new(e||(e=Promise))(function(s,o){function r(i){try{c(n.next(i))}catch(t){o(t)}}function a(i){try{c(n.throw(i))}catch(t){o(t)}}function c(i){var t;i.done?s(i.value):(t=i.value,t instanceof e?t:new e(function(i){i(t)})).then(r,a)}c((n=n.apply(i,t||[])).next())})};class ti extends N.X{constructor(i,t,e,n,s,o,r){super(t,e,n,o,r),this.apiService=i,this.formBuilder=t,this.i18nService=e,this.platformUtilsService=n,this.syncService=s,this.toastService=o,this.tokenService=r,this.onLicenseFileUploaded=new $.bkB}submit(){const i=Object.create(null,{submit:{get:()=>super.submit}});return ii(this,void 0,void 0,function*(){yield i.submit.call(this);const t=new FormData;t.append("license",this.formValue.file),yield this.apiService.postAccountLicense(t),yield this.apiService.refreshIdentityToken(),yield this.syncService.fullSync(!0),this.onLicenseFileUploaded.emit()})}get description(){return"uploadLicenseFilePremium"}get hintFileName(){return"bitwarden_premium_license.json"}}ti.ɵfac=function(i){return new(i||ti)($.rXU(L.G),$.rXU(H.ok),$.rXU(A.W),$.rXU(d.y),$.rXU(J.H),$.rXU(D.f),$.rXU(O.B))},ti.ɵcmp=$.VBU({type:ti,selectors:[["individual-self-hosting-license-uploader"]],outputs:{onLicenseFileUploaded:"onLicenseFileUploaded"},standalone:!1,features:[$.Vt3],decls:22,vars:21,consts:[["fileSelector",""],["bitTypography","body1",1,"tw-break-words","tw-whitespace-normal","tw-mb-8"],[3,"formGroup","bitSubmit"],[1,"tw-my-1"],["bitButton","","type","button","buttonType","secondary",3,"click"],["bitInput","","type","file","formControlName","file","accept","application/JSON","hidden","",1,"tw-hidden",3,"change"],["type","submit","bitButton","","bitFormButton","","buttonType","primary"]],template:function(i,t){if(1&i){const i=$.RV6();$.j41(0,"p",1),$.EFF(1),$.nI1(2,"i18n"),$.k0s(),$.j41(3,"form",2)(4,"bit-form-field")(5,"bit-label"),$.EFF(6),$.nI1(7,"i18n"),$.k0s(),$.j41(8,"div",3)(9,"button",4),$.bIt("click",function(){a.eBV(i);const t=$.sdS(15);return a.Njj(t.click())}),$.EFF(10),$.nI1(11,"i18n"),$.k0s(),$.EFF(12),$.nI1(13,"i18n"),$.k0s(),$.j41(14,"input",5,0),$.bIt("change",function(e){return a.eBV(i),a.Njj(t.onLicenseFileSelectedChanged(e))}),$.k0s(),$.j41(16,"bit-hint"),$.EFF(17),$.nI1(18,"i18n"),$.k0s()(),$.j41(19,"button",6),$.EFF(20),$.nI1(21,"i18n"),$.k0s()()}2&i&&($.R7$(),$.SpI(" ",$.bMT(2,8,"uploadLicenseFileOrg"),"\n"),$.R7$(2),$.Y8G("formGroup",t.form)("bitSubmit",t.submit),$.R7$(3),$.JRh($.bMT(7,10,t.description)),$.R7$(4),$.SpI(" ",$.bMT(11,12,"chooseFile")," "),$.R7$(2),$.SpI(" ",t.form.value.file?t.form.value.file.name:$.bMT(13,14,"noFileChosen")," "),$.R7$(5),$.JRh($.i5U(18,16,"licenseFileDesc",t.hintFileName)),$.R7$(3),$.SpI(" ",$.bMT(21,19,"submit")," "))},dependencies:[H.qT,H.me,H.BC,H.cb,H.j4,H.JD,z.$,Q.L,C.Q,q.j,_.I,W.J,Z.h,K.r,R.$],encapsulation:2});var ei=function(i,t,e,n){return new(e||(e=Promise))(function(s,o){function r(i){try{c(n.next(i))}catch(t){o(t)}}function a(i){try{c(n.throw(i))}catch(t){o(t)}}function c(i){var t;i.done?s(i.value):(t=i.value,t instanceof e?t:new e(function(i){i(t)})).then(r,a)}c((n=n.apply(i,t||[])).next())})};class ni{constructor(i,t,e,n,s,o,r){this.accountService=i,this.activatedRoute=t,this.billingAccountProfileStateService=e,this.environmentService=n,this.i18nService=s,this.router=o,this.toastService=r,this.cloudPremiumPageUrl$=this.environmentService.cloudWebVaultUrl$.pipe((0,u.T)(i=>`${i}/#/settings/subscription/premium`)),this.hasPremiumFromAnyOrganization$=this.accountService.activeAccount$.pipe((0,h.n)(i=>i?this.billingAccountProfileStateService.hasPremiumFromAnyOrganization$(i.id):(0,G.of)(!1))),this.hasPremiumPersonally$=this.accountService.activeAccount$.pipe((0,h.n)(i=>i?this.billingAccountProfileStateService.hasPremiumPersonally$(i.id):(0,G.of)(!1))),this.onLicenseFileUploaded=()=>ei(this,void 0,void 0,function*(){this.toastService.showToast({variant:"success",title:"",message:this.i18nService.t("premiumUpdated")}),yield this.navigateToSubscription()}),this.navigateToSubscription=()=>this.router.navigate(["../user-subscription"],{relativeTo:this.activatedRoute}),this.navigateToVault=()=>this.router.navigate(["/vault"]),(0,E.z)([this.hasPremiumFromAnyOrganization$,this.hasPremiumPersonally$]).pipe((0,j.pQ)(),(0,h.n)(([i,t])=>i?this.navigateToVault():t?this.navigateToSubscription():(0,G.of)(!0))).subscribe()}}ni.ɵfac=function(i){return new(i||ni)($.rXU(w.Di),$.rXU(X.nX),$.rXU(B.Q),$.rXU(x.v),$.rXU(A.W),$.rXU(X.Ix),$.rXU(D.f))},ni.ɵcmp=$.VBU({type:ni,selectors:[["ng-component"]],decls:41,vars:31,consts:[["type","success"],[1,"bwi-ul"],["aria-hidden","true",1,"bwi","bwi-check","tw-text-success","bwi-li"],["bitButton","","target","_blank","rel","noreferrer","buttonType","secondary",3,"href"],[3,"onLicenseFileUploaded"]],template:function(i,t){1&i&&($.j41(0,"bit-container")(1,"bit-section")(2,"bit-callout",0)(3,"p"),$.EFF(4),$.nI1(5,"i18n"),$.k0s(),$.j41(6,"ul",1)(7,"li"),$.nrm(8,"i",2),$.EFF(9),$.nI1(10,"i18n"),$.k0s(),$.j41(11,"li"),$.nrm(12,"i",2),$.EFF(13),$.nI1(14,"i18n"),$.k0s(),$.j41(15,"li"),$.nrm(16,"i",2),$.EFF(17),$.nI1(18,"i18n"),$.k0s(),$.j41(19,"li"),$.nrm(20,"i",2),$.EFF(21),$.nI1(22,"i18n"),$.k0s(),$.j41(23,"li"),$.nrm(24,"i",2),$.EFF(25),$.nI1(26,"i18n"),$.k0s(),$.j41(27,"li"),$.nrm(28,"i",2),$.EFF(29),$.nI1(30,"i18n"),$.k0s(),$.j41(31,"li"),$.nrm(32,"i",2),$.EFF(33),$.nI1(34,"i18n"),$.k0s()(),$.j41(35,"a",3),$.nI1(36,"async"),$.EFF(37),$.nI1(38,"i18n"),$.k0s()()(),$.j41(39,"bit-section")(40,"individual-self-hosting-license-uploader",4),$.bIt("onLicenseFileUploaded",function(){return t.onLicenseFileUploaded()}),$.k0s()()()),2&i&&($.R7$(4),$.JRh($.bMT(5,11,"premiumUpgradeUnlockFeatures")),$.R7$(5),$.SpI(" ",$.bMT(10,13,"premiumSignUpStorage")," "),$.R7$(4),$.SpI(" ",$.bMT(14,15,"premiumSignUpTwoStepOptions")," "),$.R7$(4),$.SpI(" ",$.bMT(18,17,"premiumSignUpEmergency")," "),$.R7$(4),$.SpI(" ",$.bMT(22,19,"premiumSignUpReports")," "),$.R7$(4),$.SpI(" ",$.bMT(26,21,"premiumSignUpTotp")," "),$.R7$(4),$.SpI(" ",$.bMT(30,23,"premiumSignUpSupport")," "),$.R7$(4),$.SpI(" ",$.bMT(34,25,"premiumSignUpFuture")," "),$.R7$(2),$.Y8G("href",$.mNQ($.bMT(36,27,t.cloudPremiumPageUrl$)),$.B4B),$.R7$(2),$.SpI(" ",$.bMT(38,29,"purchasePremium")," "))},dependencies:[y.G,C.Q,V.G,F.H,Y.n,r.rd,ti,T.Jj,R.$],encapsulation:2});var si=e(2922),oi=e(78650),ri=function(i,t,e,n){return new(e||(e=Promise))(function(s,o){function r(i){try{c(n.next(i))}catch(t){o(t)}}function a(i){try{c(n.throw(i))}catch(t){o(t)}}function c(i){var t;i.done?s(i.value):(t=i.value,t instanceof e?t:new e(function(i){i(t)})).then(r,a)}c((n=n.apply(i,t||[])).next())})};function ai(i,t){1&i&&($.qex(0),$.nrm(1,"i",3),$.nI1(2,"i18n"),$.j41(3,"span",4),$.EFF(4),$.nI1(5,"i18n"),$.k0s(),$.bVm()),2&i&&($.R7$(),$.Y8G("title",$.mNQ($.bMT(2,3,"loading"))),$.R7$(3),$.JRh($.bMT(5,5,"loading")))}function ci(i,t){if(1&i){const i=$.RV6();$.j41(0,"button",7),$.bIt("click",function(){a.eBV(i);const t=$.XpG(2);return a.Njj(t.load())}),$.EFF(1),$.nI1(2,"i18n"),$.k0s()}2&i&&($.R7$(),$.SpI(" ",$.bMT(2,1,"loadMore")," "))}function ui(i,t){if(1&i&&($.qex(0),$.nrm(1,"app-billing-history",5),$.DNE(2,ci,3,3,"button",6),$.bVm()),2&i){const i=$.XpG();$.R7$(),$.Y8G("openInvoices",i.openInvoices)("paidInvoices",i.paidInvoices)("transactions",i.transactions),$.R7$(),$.Y8G("ngIf",i.hasAdditionalHistory)}}class li{constructor(i,t,e){this.platformUtilsService=i,this.router=t,this.accountBillingApiService=e,this.loading=!1,this.firstLoaded=!1,this.openInvoices=[],this.paidInvoices=[],this.transactions=[],this.hasAdditionalHistory=!1}ngOnInit(){return ri(this,void 0,void 0,function*(){this.platformUtilsService.isSelfHost()?this.router.navigate(["/settings/subscription"]):(yield this.load(),this.firstLoaded=!0)})}load(){return ri(this,void 0,void 0,function*(){if(this.loading)return;this.loading=!0;const i=this.accountBillingApiService.getBillingInvoices("open",this.openInvoices.length>0?this.openInvoices[this.openInvoices.length-1].id:null),t=this.accountBillingApiService.getBillingInvoices("paid",this.paidInvoices.length>0?this.paidInvoices[this.paidInvoices.length-1].id:null),e=this.accountBillingApiService.getBillingTransactions(this.transactions.length>0?this.transactions[this.transactions.length-1].createdDate:null),n=yield i,s=yield t,o=yield e;this.openInvoices=[...this.openInvoices,...n],this.paidInvoices=[...this.paidInvoices,...s],this.transactions=[...this.transactions,...o],this.hasAdditionalHistory=n.length>=5||s.length>=5||o.length>=5,this.loading=!1})}}li.ɵfac=function(i){return new(i||li)($.rXU(d.y),$.rXU(X.Ix),$.rXU(si.k))},li.ɵcmp=$.VBU({type:li,selectors:[["ng-component"]],standalone:!1,decls:6,vars:5,consts:[[1,"tw-flex","tw-justify-between","tw-mb-2","tw-pb-2","tw-mt-6"],["bitTypography","h2"],[4,"ngIf"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","tw-text-muted",3,"title"],[1,"tw-sr-only"],[3,"openInvoices","paidInvoices","transactions"],["type","button","bitButton","","buttonType","secondary",3,"click",4,"ngIf"],["type","button","bitButton","","buttonType","secondary",3,"click"]],template:function(i,t){1&i&&($.j41(0,"div",0)(1,"h2",1),$.EFF(2),$.nI1(3,"i18n"),$.k0s()(),$.DNE(4,ai,6,7,"ng-container",2)(5,ui,3,4,"ng-container",2)),2&i&&($.R7$(2),$.SpI(" ",$.bMT(3,3,"billingHistory")," "),$.R7$(2),$.Y8G("ngIf",!t.firstLoaded&&t.loading),$.R7$(),$.Y8G("ngIf",t.openInvoices||t.paidInvoices||t.transactions))},dependencies:[T.bT,C.Q,K.r,oi.D,R.$],encapsulation:2});var pi=e(84079),di=e(58363),bi=e(72245),hi=e(58412),mi=e(639),fi=e(75583),gi=e(26477),vi=e(36801),yi=e(27485),Ii=e(21274),Si=e(3160),$i=e(47696),wi=e(59032),Fi=function(i,t,e,n){return new(e||(e=Promise))(function(s,o){function r(i){try{c(n.next(i))}catch(t){o(t)}}function a(i){try{c(n.throw(i))}catch(t){o(t)}}function c(i){var t;i.done?s(i.value):(t=i.value,t instanceof e?t:new e(function(i){i(t)})).then(r,a)}c((n=n.apply(i,t||[])).next())})};const Ti=i=>({amount:i,cadence:"monthly"}),Ri=i=>({type:"primary",text:i}),Mi=i=>({type:"secondary",text:i});function ki(i,t){if(1&i){const i=$.RV6();$.j41(0,"billing-pricing-card",13),$.nI1(1,"i18n"),$.nI1(2,"i18n"),$.bIt("buttonClick",function(){a.eBV(i);const t=$.XpG(2);return a.Njj(t.openUpgradeDialog("Premium"))}),$.j41(3,"h3",14),$.EFF(4),$.nI1(5,"i18n"),$.k0s()()}if(2&i){const i=t;$.Y8G("tagline",$.bMT(1,5,"advancedOnlineSecurity"))("price",$.eq3(11,Ti,i.price))("button",$.eq3(13,Ri,$.bMT(2,7,"upgradeToPremium")))("features",i.features),$.R7$(4),$.JRh($.bMT(5,9,"premium"))}}function Ui(i,t){if(1&i){const i=$.RV6();$.j41(0,"billing-pricing-card",13),$.nI1(1,"i18n"),$.nI1(2,"i18n"),$.bIt("buttonClick",function(){a.eBV(i);const t=$.XpG(2);return a.Njj(t.openUpgradeDialog("Families"))}),$.j41(3,"h3",14),$.EFF(4),$.nI1(5,"i18n"),$.k0s()()}if(2&i){const i=t;$.Y8G("tagline",$.bMT(1,5,"planDescFamiliesV2"))("price",$.eq3(11,Ti,i.price))("button",$.eq3(13,Mi,$.bMT(2,7,"startFreeFamiliesTrial")))("features",i.features),$.R7$(4),$.JRh($.bMT(5,9,"families"))}}function Pi(i,t){if(1&i&&($.j41(0,"bit-section")(1,"div",2)(2,"div",3)(3,"span",4),$.EFF(4),$.nI1(5,"i18n"),$.k0s()(),$.j41(6,"h2",5),$.EFF(7),$.nI1(8,"i18n"),$.k0s(),$.j41(9,"p",6),$.EFF(10),$.nI1(11,"i18n"),$.k0s()(),$.j41(12,"div",7)(13,"div"),$.nVh(14,ki,6,15,"billing-pricing-card",8),$.nI1(15,"async"),$.k0s(),$.j41(16,"div"),$.nVh(17,Ui,6,15,"billing-pricing-card",8),$.nI1(18,"async"),$.k0s()(),$.j41(19,"div",9)(20,"p",10),$.EFF(21),$.nI1(22,"i18n"),$.k0s(),$.j41(23,"a",11),$.EFF(24),$.nI1(25,"i18n"),$.nrm(26,"i",12),$.k0s()()()),2&i){let i,t;const e=$.XpG();$.R7$(3),$.Y8G("truncate",!1),$.R7$(),$.SpI(" ",$.bMT(5,8,"bitwardenFreeplanMessage")," "),$.R7$(3),$.SpI(" ",$.bMT(8,10,"upgradeCompleteSecurity")," "),$.R7$(3),$.SpI(" ",$.bMT(11,12,"individualUpgradeDescriptionMessage")," "),$.R7$(4),$.vxM((i=$.bMT(15,14,e.premiumCardData$))?14:-1,i),$.R7$(3),$.vxM((t=$.bMT(18,16,e.familiesCardData$))?17:-1,t),$.R7$(4),$.SpI(" ",$.bMT(22,18,"individualUpgradeTaxInformationMessage")," "),$.R7$(3),$.SpI(" ",$.bMT(25,20,"viewbusinessplans")," ")}}const ji="callToAction",Gi="upgradeToPremium";class Ei{constructor(i,t,e,n,s,o,r,c){this.accountService=i,this.apiService=t,this.dialogService=e,this.syncService=n,this.billingAccountProfileStateService=s,this.subscriptionPricingService=o,this.router=r,this.activatedRoute=c,this.destroyRef=(0,a.WQX)(a.abz),this.navigateToSubscriptionPage=()=>this.router.navigate(["../user-subscription"],{relativeTo:this.activatedRoute}),this.navigateToIndividualVault=()=>this.router.navigate(["/vault"]),this.finalizeUpgrade=()=>Fi(this,void 0,void 0,function*(){yield this.apiService.refreshIdentityToken(),yield this.syncService.fullSync(!0)}),this.hasPremiumFromAnyOrganization$=this.accountService.activeAccount$.pipe((0,h.n)(i=>i?this.billingAccountProfileStateService.hasPremiumFromAnyOrganization$(i.id):(0,G.of)(!1))),this.hasPremiumPersonally$=this.accountService.activeAccount$.pipe((0,h.n)(i=>i?this.billingAccountProfileStateService.hasPremiumPersonally$(i.id):(0,G.of)(!1))),this.accountService.activeAccount$.pipe(S.$i,(0,j.pQ)(this.destroyRef)).subscribe(i=>{this.subscriber=i}),this.shouldShowNewDesign$=(0,E.z)([this.hasPremiumFromAnyOrganization$,this.hasPremiumPersonally$]).pipe((0,u.T)(([i,t])=>!i&&!t)),(0,E.z)([this.hasPremiumFromAnyOrganization$,this.hasPremiumPersonally$]).pipe((0,j.pQ)(this.destroyRef),(0,h.n)(([i,t])=>t?(0,pi.H)(this.navigateToSubscriptionPage()):i?(0,pi.H)(this.navigateToIndividualVault()):(0,G.of)(!0))).subscribe(),this.shouldShowUpgradeDialogOnInit$=(0,E.z)([this.hasPremiumFromAnyOrganization$,this.hasPremiumPersonally$,this.activatedRoute.queryParams]).pipe((0,u.T)(([i,t,e])=>{const n=e[ji];return!i&&!t&&n===Gi})),this.personalPricingTiers$=this.subscriptionPricingService.getPersonalSubscriptionPricingTiers$(),this.premiumCardData$=this.personalPricingTiers$.pipe((0,u.T)(i=>{const t=i.find(i=>i.id===hi.OU.Premium);return{tier:t,price:"standalone"===(null==t?void 0:t.passwordManager.type)&&t.passwordManager.annualPrice?Number((t.passwordManager.annualPrice/12).toFixed(2)):0,features:(null==t?void 0:t.passwordManager.features.map(i=>i.value))||[]}}),(0,m.t)({bufferSize:1,refCount:!0})),this.familiesCardData$=this.personalPricingTiers$.pipe((0,u.T)(i=>{const t=i.find(i=>i.id===hi.OU.Families);return{tier:t,price:"packaged"===(null==t?void 0:t.passwordManager.type)&&t.passwordManager.annualPrice?Number((t.passwordManager.annualPrice/12).toFixed(2)):0,features:(null==t?void 0:t.passwordManager.features.map(i=>i.value))||[]}}),(0,m.t)({bufferSize:1,refCount:!0})),this.shouldShowUpgradeDialogOnInit$.pipe((0,di.s)(1),(0,h.n)(i=>i?(0,pi.H)(this.openUpgradeDialog("Premium")):(0,G.of)(void 0)),(0,j.pQ)(this.destroyRef)).subscribe()}openUpgradeDialog(i){return Fi(this,void 0,void 0,function*(){const t=yield(0,bi._)(this.accountService.activeAccount$);if(!t)return;const e="Premium"===i?hi.OU.Premium:hi.OU.Families,n={account:t,initialStep:yi.TT.Payment,selectedPlan:e,redirectOnCompletion:!0};yi.gY.open(this.dialogService,{data:n}).closed.pipe((0,j.pQ)(this.destroyRef)).subscribe(i=>{(null==i?void 0:i.status)!==yi.PD.UpgradedToPremium&&(null==i?void 0:i.status)!==yi.PD.UpgradedToFamilies||this.finalizeUpgrade()})})}}Ei.ɵfac=function(i){return new(i||Ei)($.rXU(w.Di),$.rXU(L.G),$.rXU(Ii.o3),$.rXU(J.H),$.rXU(B.Q),$.rXU(Si.z),$.rXU(X.Ix),$.rXU(X.nX))},Ei.ɵcmp=$.VBU({type:Ei,selectors:[["ng-component"]],decls:3,vars:3,consts:[[1,"tw-max-w-3xl","tw-mx-auto"],[4,"ngIf"],[1,"tw-text-center"],[1,"tw-mt-8","tw-mb-6"],["bitBadge","","variant","secondary",3,"truncate"],[1,"tw-mt-2","tw-text-4xl"],[1,"tw-text-muted","tw-mb-6","tw-mt-4"],[1,"tw-grid","tw-grid-cols-1","md:tw-grid-cols-2","tw-gap-6","tw-mt-6","tw-justify-center"],[3,"tagline","price","button","features"],[1,"tw-text-center","tw-mt-6"],[1,"tw-text-muted","tw-mb-2","tw-italic"],["bitLink","","linkType","primary","href","https://bitwarden.com/pricing/business/","target","_blank","rel","noopener noreferrer"],["aria-hidden","true",1,"bwi","bwi-external-link","tw-ml-1"],[3,"buttonClick","tagline","price","button","features"],["slot","title","bitTypography","h3",1,"tw-m-0"]],template:function(i,t){1&i&&($.j41(0,"div",0),$.DNE(1,Pi,27,22,"bit-section",1),$.nI1(2,"async"),$.k0s()),2&i&&($.R7$(),$.Y8G("ngIf",$.bMT(2,1,t.shouldShowNewDesign$)))},dependencies:[T.MD,T.bT,Y.n,mi.E,$i.n,fi.E,K.r,gi.V,wi.L,n.Y2,T.Jj,vi.$Z],encapsulation:2});var xi=e(12610),Xi=e(75811),Bi=e(73276),Ai=e(36006),Di=e(88083),Ci=e(14055),Vi=e(21587),Yi=e(34923),Ji=function(i,t,e,n){return new(e||(e=Promise))(function(s,o){function r(i){try{c(n.next(i))}catch(t){o(t)}}function a(i){try{c(n.throw(i))}catch(t){o(t)}}function c(i){var t;i.done?s(i.value):(t=i.value,t instanceof e?t:new e(function(i){i(t)})).then(r,a)}c((n=n.apply(i,t||[])).next())})};const Ni=()=>({plan:"families"}),Li=()=>({type:"checkout",supportsTaxId:!1});function Hi(i,t){1&i&&($.qex(0),$.nrm(1,"i",0),$.nI1(2,"i18n"),$.j41(3,"span",1),$.EFF(4),$.nI1(5,"i18n"),$.k0s(),$.bVm()),2&i&&($.R7$(),$.Y8G("title",$.mNQ($.bMT(2,3,"loading"))),$.R7$(3),$.JRh($.bMT(5,5,"loading")))}function Oi(i,t){1&i&&($.j41(0,"bit-callout",21),$.nI1(1,"i18n"),$.EFF(2),$.nI1(3,"i18n"),$.k0s()),2&i&&($.Y8G("title",$.mNQ($.bMT(1,3,"youHavePremiumAccess"))),$.R7$(2),$.SpI(" ",$.bMT(3,5,"alreadyPremiumFromOrg")," "))}function zi(i,t){if(1&i&&($.j41(0,"bit-container")(1,"bit-section")(2,"h2",2),$.EFF(3),$.nI1(4,"i18n"),$.k0s(),$.DNE(5,Oi,4,7,"bit-callout",3),$.nI1(6,"async"),$.j41(7,"bit-callout",4)(8,"p"),$.EFF(9),$.nI1(10,"i18n"),$.k0s(),$.j41(11,"ul",5)(12,"li"),$.nrm(13,"i",6),$.EFF(14),$.nI1(15,"async"),$.nI1(16,"i18n"),$.k0s(),$.j41(17,"li"),$.nrm(18,"i",6),$.EFF(19),$.nI1(20,"i18n"),$.k0s(),$.j41(21,"li"),$.nrm(22,"i",6),$.EFF(23),$.nI1(24,"i18n"),$.k0s(),$.j41(25,"li"),$.nrm(26,"i",6),$.EFF(27),$.nI1(28,"i18n"),$.k0s(),$.j41(29,"li"),$.nrm(30,"i",6),$.EFF(31),$.nI1(32,"i18n"),$.k0s(),$.j41(33,"li"),$.nrm(34,"i",6),$.EFF(35),$.nI1(36,"i18n"),$.k0s(),$.j41(37,"li"),$.nrm(38,"i",6),$.EFF(39),$.nI1(40,"i18n"),$.k0s()(),$.j41(41,"p",7),$.EFF(42),$.nI1(43,"async"),$.nI1(44,"currency"),$.nI1(45,"i18n"),$.j41(46,"a",8),$.EFF(47),$.nI1(48,"i18n"),$.k0s()()()(),$.j41(49,"form",9)(50,"bit-section")(51,"h2",2),$.EFF(52),$.nI1(53,"i18n"),$.k0s(),$.j41(54,"div",10)(55,"bit-form-field",11)(56,"bit-label"),$.EFF(57),$.nI1(58,"i18n"),$.k0s(),$.nrm(59,"input",12),$.nI1(60,"i18n"),$.j41(61,"bit-hint"),$.EFF(62),$.nI1(63,"async"),$.nI1(64,"async"),$.nI1(65,"currency"),$.nI1(66,"i18n"),$.nI1(67,"i18n"),$.k0s()()()(),$.j41(68,"bit-section")(69,"h2",2),$.EFF(70),$.nI1(71,"i18n"),$.k0s(),$.EFF(72),$.nI1(73,"i18n"),$.nI1(74,"async"),$.nI1(75,"currency"),$.nrm(76,"br"),$.EFF(77),$.nI1(78,"i18n"),$.nI1(79,"async"),$.nI1(80,"currency"),$.nI1(81,"async"),$.nI1(82,"currency"),$.nrm(83,"hr",13),$.k0s(),$.j41(84,"bit-section")(85,"h3",2),$.EFF(86),$.nI1(87,"i18n"),$.k0s(),$.j41(88,"div",14),$.nrm(89,"app-enter-payment-method",15),$.nI1(90,"async"),$.nrm(91,"app-enter-billing-address",16),$.k0s(),$.j41(92,"div",14)(93,"div",17)(94,"span"),$.EFF(95),$.nI1(96,"i18n"),$.nI1(97,"async"),$.nI1(98,"currency"),$.k0s(),$.j41(99,"span"),$.EFF(100),$.nI1(101,"i18n"),$.nI1(102,"async"),$.nI1(103,"currency"),$.k0s()()(),$.nrm(104,"hr",18),$.j41(105,"p",19)(106,"strong"),$.EFF(107),$.nI1(108,"i18n"),$.k0s(),$.EFF(109),$.nI1(110,"async"),$.nI1(111,"currency"),$.nI1(112,"i18n"),$.k0s(),$.j41(113,"button",20),$.nI1(114,"async"),$.EFF(115),$.nI1(116,"i18n"),$.k0s()()()()),2&i){const i=$.XpG();$.R7$(3),$.JRh($.bMT(4,43,"goPremium")),$.R7$(2),$.Y8G("ngIf",$.bMT(6,45,i.hasPremiumFromAnyOrganization$)),$.R7$(4),$.JRh($.bMT(10,47,"premiumUpgradeUnlockFeatures")),$.R7$(5),$.SpI(" ",$.i5U(16,51,"premiumSignUpStorageV2",`${$.bMT(15,49,i.providedStorageGb$)} GB`)," "),$.R7$(5),$.SpI(" ",$.bMT(20,54,"premiumSignUpTwoStepOptions")," "),$.R7$(4),$.SpI(" ",$.bMT(24,56,"premiumSignUpEmergency")," "),$.R7$(4),$.SpI(" ",$.bMT(28,58,"premiumSignUpReports")," "),$.R7$(4),$.SpI(" ",$.bMT(32,60,"premiumSignUpTotp")," "),$.R7$(4),$.SpI(" ",$.bMT(36,62,"premiumSignUpSupport")," "),$.R7$(4),$.SpI(" ",$.bMT(40,64,"premiumSignUpFuture")," "),$.R7$(3),$.SpI(" ",$.brH(45,71,"premiumPriceWithFamilyPlan",$.i5U(44,68,$.bMT(43,66,i.premiumPrice$),"$"),i.familyPlanMaxUserCount)," "),$.R7$(4),$.Y8G("queryParams",$.lJ4(149,Ni)),$.R7$(),$.SpI(" ",$.bMT(48,75,"bitwardenFamiliesPlan")," "),$.R7$(2),$.Y8G("formGroup",i.formGroup)("bitSubmit",i.submitPayment),$.R7$(3),$.JRh($.bMT(53,77,"addons")),$.R7$(5),$.JRh($.bMT(58,79,"additionalStorageGb")),$.R7$(2),$.Y8G("placeholder",$.mNQ($.bMT(60,81,"additionalStorageGbDesc"))),$.R7$(3),$.JRh($.ii3(67,92,"additionalStorageIntervalDesc",`${$.bMT(63,83,i.providedStorageGb$)} GB`,$.i5U(65,87,$.bMT(64,85,i.storagePrice$),"$"),$.bMT(66,90,"year"))),$.R7$(8),$.JRh($.bMT(71,97,"summary")),$.R7$(2),$.Lme(" ",$.bMT(73,99,"premiumMembership"),": ",$.i5U(75,103,$.bMT(74,101,i.premiumPrice$),"$")," "),$.R7$(5),$.LHq(" ",$.bMT(78,106,"additionalStorageGb"),": ",i.formGroup.value.additionalStorage||0," GB × ",$.i5U(80,110,$.bMT(79,108,i.storagePrice$),"$")," = ",$.i5U(82,115,$.bMT(81,113,i.storageCost$),"$")," "),$.R7$(9),$.JRh($.bMT(87,118,"paymentInformation")),$.R7$(3),$.Y8G("group",i.formGroup.controls.paymentMethod)("showBankAccount",!1)("showAccountCredit",!0)("hasEnoughAccountCredit",$.bMT(90,120,i.hasEnoughAccountCredit$)),$.R7$(2),$.Y8G("group",i.formGroup.controls.billingAddress)("scenario",$.lJ4(150,Li)),$.R7$(4),$.Lme("",$.bMT(96,122,"planPrice"),": ",$.i5U(98,126,$.bMT(97,124,i.subtotal$),"USD $")),$.R7$(5),$.Lme("",$.bMT(101,129,"estimatedTax"),": ",$.i5U(103,133,$.bMT(102,131,i.tax$),"USD $")),$.R7$(7),$.SpI("",$.bMT(108,136,"total"),":"),$.R7$(2),$.Lme(" ",$.i5U(111,140,$.bMT(110,138,i.total$),"USD $"),"/",$.bMT(112,143,"year")," "),$.R7$(4),$.Y8G("disabled",!$.bMT(114,145,i.hasEnoughAccountCredit$)),$.R7$(2),$.SpI(" ",$.bMT(116,147,"submit")," ")}}class Qi{constructor(i,t,e,n,o,r,a,c,l,p,d,b){this.activatedRoute=i,this.apiService=t,this.billingAccountProfileStateService=e,this.environmentService=n,this.i18nService=o,this.router=r,this.syncService=a,this.toastService=c,this.accountService=l,this.subscriberBillingClient=p,this.taxClient=d,this.subscriptionPricingService=b,this.formGroup=new H.gE({additionalStorage:new H.MJ(0,[H.k0.min(0),H.k0.max(99)]),paymentMethod:s.Pu.getFormGroup(),billingAddress:s.vU.getFormGroup()}),this.premiumPrices$=this.subscriptionPricingService.getPersonalSubscriptionPricingTiers$().pipe((0,u.T)(i=>{const t=i.find(i=>i.id===hi.OU.Premium);if(!t)throw new Error("Could not find Premium plan");return{seat:t.passwordManager.annualPrice,storage:t.passwordManager.annualPricePerAdditionalStorageGB,providedStorageGb:t.passwordManager.providedStorageGB}}),(0,m.t)({bufferSize:1,refCount:!0})),this.premiumPrice$=this.premiumPrices$.pipe((0,u.T)(i=>i.seat)),this.storagePrice$=this.premiumPrices$.pipe((0,u.T)(i=>i.storage)),this.providedStorageGb$=this.premiumPrices$.pipe((0,u.T)(i=>i.providedStorageGb)),this.isLoadingPrices$=this.premiumPrices$.pipe((0,u.T)(()=>!1),(0,xi.Z)(!0),(0,Xi.W)(()=>(0,G.of)(!1))),this.storageCost$=(0,E.z)([this.storagePrice$,this.formGroup.controls.additionalStorage.valueChanges.pipe((0,xi.Z)(this.formGroup.value.additionalStorage))]).pipe((0,u.T)(([i,t])=>i*t)),this.subtotal$=(0,E.z)([this.premiumPrice$,this.storageCost$]).pipe((0,u.T)(([i,t])=>i+t)),this.tax$=this.formGroup.valueChanges.pipe((0,v.p)(()=>this.formGroup.valid),(0,Ai.B)(1e3),(0,h.n)(()=>Ji(this,void 0,void 0,function*(){const i=(0,s.c3)(this.formGroup.controls.billingAddress);return(yield this.taxClient.previewTaxForPremiumSubscriptionPurchase(this.formGroup.value.additionalStorage,i)).tax})),(0,xi.Z)(0)),this.total$=(0,E.z)([this.subtotal$,this.tax$]).pipe((0,u.T)(([i,t])=>i+t)),this.familyPlanMaxUserCount=6,this.finalizeUpgrade=()=>Ji(this,void 0,void 0,function*(){yield this.apiService.refreshIdentityToken(),yield this.syncService.fullSync(!0)}),this.postFinalizeUpgrade=()=>Ji(this,void 0,void 0,function*(){this.toastService.showToast({variant:"success",title:null,message:this.i18nService.t("premiumUpdated")}),yield this.navigateToSubscriptionPage()}),this.navigateToSubscriptionPage=()=>this.router.navigate(["../user-subscription"],{relativeTo:this.activatedRoute}),this.submitPayment=()=>Ji(this,void 0,void 0,function*(){var i;if(this.formGroup.invalid)return;let t,e;if(this.formGroup.value.paymentMethod.type===Ci.mv.accountCredit)t=Di.eq.Credit,e="";else{const i=yield this.enterPaymentMethodComponent.tokenize();t=(0,Ci.x$)(i.type),e=i.token}const n=new FormData;n.append("paymentMethodType",t.toString()),n.append("paymentToken",e),n.append("additionalStorageGb",(null!==(i=this.formGroup.value.additionalStorage)&&void 0!==i?i:0).toString()),n.append("country",this.formGroup.value.billingAddress.country),n.append("postalCode",this.formGroup.value.billingAddress.postalCode),yield this.apiService.postPremium(n),yield this.finalizeUpgrade(),yield this.postFinalizeUpgrade()}),this.hasPremiumFromAnyOrganization$=this.accountService.activeAccount$.pipe((0,h.n)(i=>this.billingAccountProfileStateService.hasPremiumFromAnyOrganization$(i.id)));const f=this.accountService.activeAccount$.pipe(S.$i,(0,h.n)(i=>this.subscriberBillingClient.getCredit(i)));this.hasEnoughAccountCredit$=(0,E.z)([f,this.total$,this.formGroup.controls.paymentMethod.controls.type.valueChanges.pipe((0,xi.Z)(this.formGroup.value.paymentMethod.type))]).pipe((0,u.T)(([i,t,e])=>e!==Ci.mv.accountCredit||i>=t)),(0,E.z)([this.accountService.activeAccount$.pipe((0,h.n)(i=>this.billingAccountProfileStateService.hasPremiumPersonally$(i.id))),this.environmentService.cloudWebVaultUrl$]).pipe((0,j.pQ)(),(0,Bi.H)(([i,t])=>i?(0,pi.H)(this.navigateToSubscriptionPage()):(this.cloudWebVaultURL=t,(0,G.of)(!0)))).subscribe()}}Qi.ɵfac=function(i){return new(i||Qi)($.rXU(X.nX),$.rXU(L.G),$.rXU(B.Q),$.rXU(x.v),$.rXU(A.W),$.rXU(X.Ix),$.rXU(J.H),$.rXU(D.f),$.rXU(w.Di),$.rXU(I.Hd),$.rXU(I.jZ),$.rXU(Si.z))},Qi.ɵcmp=$.VBU({type:Qi,selectors:[["ng-component"]],viewQuery:function(i,t){if(1&i&&$.GBs(s.Pu,5),2&i){let i;$.mGM(i=$.lsd())&&(t.enterPaymentMethodComponent=i.first)}},standalone:!1,features:[$.Jv_([I.Hd,I.jZ])],decls:3,vars:3,consts:[["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","tw-text-muted",3,"title"],[1,"tw-sr-only"],["bitTypography","h2"],["type","info","icon","bwi bwi-star-f",3,"title",4,"ngIf"],["type","success"],[1,"bwi-ul"],["aria-hidden","true",1,"bwi","bwi-check","tw-text-success","bwi-li"],["bitTypography","body1",1,"tw-mb-0"],["bitLink","","linkType","primary","routerLink","/create-organization",3,"queryParams"],[3,"formGroup","bitSubmit"],[1,"tw-grid","tw-grid-cols-12","tw-gap-4"],[1,"tw-col-span-6"],["bitInput","","formControlName","additionalStorage","type","number","step","1",3,"placeholder"],[1,"tw-my-3"],[1,"tw-mb-4"],[3,"group","showBankAccount","showAccountCredit","hasEnoughAccountCredit"],[3,"group","scenario"],[1,"tw-text-muted","tw-text-sm","tw-flex","tw-flex-col"],[1,"tw-my-1","tw-w-1/4","tw-ml-0"],["bitTypography","body1"],["type","submit","buttonType","primary","bitButton","","bitFormButton","",3,"disabled"],["type","info","icon","bwi bwi-star-f",3,"title"]],template:function(i,t){1&i&&($.nVh(0,Hi,6,7,"ng-container"),$.nI1(1,"async"),$.vZN(2,zi,117,151,"bit-container")),2&i&&$.vxM($.bMT(1,1,t.isLoadingPrices$)?0:2)},dependencies:[c.Wk,T.bT,H.qT,H.me,H.Q0,H.BC,H.cb,H.j4,H.JD,z.$,Q.L,C.Q,V.G,F.H,q.j,_.I,W.J,Z.h,wi.L,Y.n,K.r,Vi.P,Yi.vU,T.Jj,T.oe,R.$],encapsulation:2});var qi=e(39805),_i=e(97560),Wi=e(93748);function Zi(i,t){if(1&i&&($.j41(0,"bit-tab-nav-bar",1)(1,"bit-tab-link",2),$.nI1(2,"async"),$.EFF(3),$.nI1(4,"i18n"),$.k0s(),$.j41(5,"bit-tab-link",3),$.EFF(6),$.nI1(7,"i18n"),$.k0s(),$.j41(8,"bit-tab-link",4),$.EFF(9),$.nI1(10,"i18n"),$.k0s()()),2&i){const i=$.XpG();$.R7$(),$.Y8G("route",$.bMT(2,4,i.hasPremium$)?"user-subscription":"premium"),$.R7$(2),$.JRh($.bMT(4,6,"subscription")),$.R7$(3),$.JRh($.bMT(7,8,"paymentDetails")),$.R7$(3),$.JRh($.bMT(10,10,"billingHistory"))}}class Ki{constructor(i,t,e){this.platformUtilsService=i,this.hasPremium$=e.activeAccount$.pipe((0,h.n)(i=>t.hasPremiumPersonally$(i.id)))}ngOnInit(){this.selfHosted=this.platformUtilsService.isSelfHost()}}Ki.ɵfac=function(i){return new(i||Ki)($.rXU(d.y),$.rXU(B.Q),$.rXU(w.Di))},Ki.ɵcmp=$.VBU({type:Ki,selectors:[["ng-component"]],standalone:!1,decls:3,vars:1,consts:[["slot","tabs",4,"ngIf"],["slot","tabs"],[3,"route"],["route","payment-details"],["route","billing-history"]],template:function(i,t){1&i&&($.j41(0,"app-header"),$.DNE(1,Zi,11,12,"bit-tab-nav-bar",0),$.k0s(),$.nrm(2,"router-outlet")),2&i&&($.R7$(),$.Y8G("ngIf",!t.selfHosted))},dependencies:[X.n3,T.bT,qi.J,_i.T,Wi.f,T.Jj,R.$],encapsulation:2});var it=e(88565),tt=e(56962),et=e(33895),nt=e(97062),st=e(33438),ot=e(13583),rt=e(11224),at=e(3892),ct=e(7730),ut=e(68016),lt=function(i,t,e,n){return new(e||(e=Promise))(function(s,o){function r(i){try{c(n.next(i))}catch(t){o(t)}}function a(i){try{c(n.throw(i))}catch(t){o(t)}}function c(i){var t;i.done?s(i.value):(t=i.value,t instanceof e?t:new e(function(i){i(t)})).then(r,a)}c((n=n.apply(i,t||[])).next())})};function pt(i,t){if(1&i&&($.j41(0,"button",9),$.EFF(1),$.nI1(2,"i18n"),$.k0s()),2&i){const i=$.XpG();$.Y8G("bitAction",i.cancel),$.R7$(),$.SpI(" ",$.bMT(2,2,"cancel")," ")}}class dt extends ot.m{constructor(i,t,e,n,s,o,r){super(t,e,n,s,o,r),this.dialogRef=i,this.submitLicenseDialog=()=>lt(this,void 0,void 0,function*(){yield this.submitLicense()}),this.cancel=()=>lt(this,void 0,void 0,function*(){yield this.cancel(),this.dialogRef.close(st.Y.Cancelled)})}submitLicense(){return lt(this,void 0,void 0,function*(){(yield this.submit())===st.Y.Updated&&this.dialogRef.close(st.Y.Updated)})}static open(i){return i.open(dt)}}dt.ɵfac=function(i){return new(i||dt)($.rXU(Ii.ce),$.rXU(L.G),$.rXU(A.W),$.rXU(d.y),$.rXU(rt.X),$.rXU(H.ok),$.rXU(D.f))},dt.ɵcmp=$.VBU({type:dt,selectors:[["ng-component"]],standalone:!1,features:[$.Vt3],decls:24,vars:22,consts:[["fileSelector",""],[3,"formGroup","bitSubmit"],["dialogSize","default",3,"title"],["bitDialogContent",""],["bitButton","","type","button","buttonType","secondary",3,"click"],["bitInput","","type","file","formControlName","file","hidden","",1,"tw-hidden",3,"change"],["bitDialogFooter",""],["type","submit","buttonType","primary","bitButton","","bitFormButton",""],["bitButton","","bitFormButton","","buttonType","secondary","type","button","bitDialogClose","",3,"bitAction",4,"ngIf"],["bitButton","","bitFormButton","","buttonType","secondary","type","button","bitDialogClose","",3,"bitAction"]],template:function(i,t){if(1&i){const i=$.RV6();$.j41(0,"form",1)(1,"bit-dialog",2),$.nI1(2,"i18n"),$.qex(3,3),$.j41(4,"bit-form-field")(5,"bit-label"),$.EFF(6),$.nI1(7,"i18n"),$.k0s(),$.j41(8,"div")(9,"button",4),$.bIt("click",function(){a.eBV(i);const t=$.sdS(15);return a.Njj(t.click())}),$.EFF(10),$.nI1(11,"i18n"),$.k0s(),$.EFF(12),$.nI1(13,"i18n"),$.k0s(),$.j41(14,"input",5,0),$.bIt("change",function(e){return a.eBV(i),a.Njj(t.setSelectedFile(e))}),$.k0s(),$.j41(16,"bit-hint"),$.EFF(17),$.nI1(18,"i18n"),$.k0s()(),$.bVm(),$.qex(19,6),$.j41(20,"button",7),$.EFF(21),$.nI1(22,"i18n"),$.k0s(),$.DNE(23,pt,3,4,"button",8),$.bVm(),$.k0s()()}2&i&&($.Y8G("formGroup",t.updateLicenseForm)("bitSubmit",t.submitLicenseDialog),$.R7$(),$.Y8G("title",$.bMT(2,9,"updateLicense")),$.R7$(5),$.JRh($.bMT(7,11,"licenseFile")),$.R7$(4),$.SpI(" ",$.bMT(11,13,"chooseFile")," "),$.R7$(2),$.SpI(" ",t.licenseFile?t.licenseFile.name:$.bMT(13,15,"noFileChosen")," "),$.R7$(5),$.JRh($.i5U(18,17,"licenseFileDesc","bitwarden_premium_license.json")),$.R7$(4),$.SpI(" ",$.bMT(22,20,"submit")," "),$.R7$(2),$.Y8G("ngIf",t.showCancel))},dependencies:[T.bT,H.qT,H.me,H.BC,H.cb,H.j4,H.JD,at.p,z.$,Q.L,C.Q,ct.I,ut.m,q.j,_.I,W.J,Z.h,R.$],encapsulation:2});var bt=e(53127),ht=e(5771),mt=e(38140),ft=e(47593),gt=function(i,t,e,n){return new(e||(e=Promise))(function(s,o){function r(i){try{c(n.next(i))}catch(t){o(t)}}function a(i){try{c(n.throw(i))}catch(t){o(t)}}function c(i){var t;i.done?s(i.value):(t=i.value,t instanceof e?t:new e(function(i){i(t)})).then(r,a)}c((n=n.apply(i,t||[])).next())})};function vt(i,t){1&i&&($.qex(0),$.nrm(1,"i",4),$.nI1(2,"i18n"),$.j41(3,"span",5),$.EFF(4),$.nI1(5,"i18n"),$.k0s(),$.bVm()),2&i&&($.R7$(),$.Y8G("title",$.mNQ($.bMT(2,3,"loading"))),$.R7$(3),$.JRh($.bMT(5,5,"loading")))}function yt(i,t){1&i&&($.j41(0,"bit-callout",9),$.nI1(1,"i18n"),$.EFF(2),$.nI1(3,"i18n"),$.k0s()),2&i&&($.Y8G("title",$.mNQ($.bMT(1,3,"canceled"))),$.R7$(2),$.SpI(" ",$.bMT(3,5,"subscriptionCanceled")))}function It(i,t){if(1&i){const i=$.RV6();$.j41(0,"bit-callout",9),$.nI1(1,"i18n"),$.j41(2,"p",10),$.EFF(3),$.nI1(4,"i18n"),$.k0s(),$.j41(5,"button",11,0),$.bIt("click",function(){a.eBV(i);const t=$.XpG(2);return a.Njj(t.reinstate())}),$.EFF(7),$.nI1(8,"i18n"),$.k0s()()}if(2&i){const i=$.sdS(6),t=$.XpG(2);$.Y8G("title",$.mNQ($.bMT(1,6,"pendingCancellation"))),$.R7$(3),$.JRh($.bMT(4,8,"subscriptionPendingCanceled")),$.R7$(2),$.Y8G("appApiAction",t.reinstatePromise)("disabled",i.loading()),$.R7$(2),$.SpI(" ",$.bMT(8,10,"reinstateSubscription")," ")}}function St(i,t){if(1&i&&($.j41(0,"dd"),$.EFF(1),$.nI1(2,"date"),$.k0s()),2&i){const i=$.XpG(3);$.R7$(),$.JRh($.i5U(2,1,i.sub.expiration,"mediumDate"))}}function $t(i,t){1&i&&($.j41(0,"dd"),$.EFF(1),$.nI1(2,"i18n"),$.k0s()),2&i&&($.R7$(),$.JRh($.bMT(2,1,"neverExpires")))}function wt(i,t){if(1&i&&($.j41(0,"dl")(1,"dt"),$.EFF(2),$.nI1(3,"i18n"),$.k0s(),$.DNE(4,St,3,4,"dd",3)(5,$t,3,3,"dd",3),$.k0s()),2&i){const i=$.XpG(2);$.R7$(2),$.JRh($.bMT(3,3,"expiration")),$.R7$(2),$.Y8G("ngIf",i.sub.expiration),$.R7$(),$.Y8G("ngIf",!i.sub.expiration)}}function Ft(i,t){1&i&&($.j41(0,"span",20),$.EFF(1),$.nI1(2,"i18n"),$.k0s()),2&i&&($.R7$(),$.JRh($.bMT(2,1,"pendingCancellation")))}function Tt(i,t){if(1&i&&($.qex(0),$.j41(1,"div",22)(2,"span"),$.nI1(3,"i18n"),$.EFF(4),$.nI1(5,"date"),$.nI1(6,"currency"),$.k0s(),$.nrm(7,"billing-discount-badge",23),$.k0s(),$.bVm()),2&i){const i=$.XpG(4);$.R7$(2),$.BMQ("aria-label",$.bMT(3,3,"nextChargeDateAndAmount")),$.R7$(2),$.SpI(" ",$.i5U(5,5,i.sub.subscription.periodEndDate,"MMM d, y")+", "+$.i5U(6,8,i.discountedSubscriptionAmount,"$")," "),$.R7$(3),$.Y8G("discount",i.getDiscountInfo(null==i.sub?null:i.sub.customerDiscount))}}function Rt(i,t){if(1&i&&($.j41(0,"div",22)(1,"span"),$.nI1(2,"i18n"),$.EFF(3),$.nI1(4,"date"),$.nI1(5,"currency"),$.k0s()()),2&i){const i=$.XpG(4);$.R7$(),$.BMQ("aria-label",$.bMT(2,2,"nextChargeDateAndAmount")),$.R7$(2),$.SpI(" ",$.i5U(4,4,i.sub.subscription.periodEndDate,"MMM d, y")+", "+$.i5U(5,7,i.subscriptionAmount,"$")," ")}}function Mt(i,t){if(1&i&&($.qex(0),$.DNE(1,Tt,8,11,"ng-container",21),$.nI1(2,"async"),$.DNE(3,Rt,6,10,"ng-template",null,1,$.C5r),$.bVm()),2&i){const i=$.sdS(4),t=$.XpG(3);$.R7$(),$.Y8G("ngIf",$.bMT(2,2,t.enableDiscountDisplay$))("ngIfElse",i)}}function kt(i,t){1&i&&($.j41(0,"span",24),$.nI1(1,"i18n"),$.EFF(2,"-"),$.k0s()),2&i&&$.BMQ("aria-label",$.bMT(1,1,"noChargeScheduled"))}function Ut(i,t){if(1&i&&($.j41(0,"div",12)(1,"div",13)(2,"div",14)(3,"div",15),$.EFF(4),$.nI1(5,"i18n"),$.k0s(),$.j41(6,"div"),$.EFF(7),$.nI1(8,"i18n"),$.k0s()(),$.j41(9,"div",14)(10,"div",15),$.EFF(11),$.nI1(12,"i18n"),$.k0s(),$.j41(13,"div")(14,"span",16),$.EFF(15),$.k0s(),$.DNE(16,Ft,3,3,"span",17),$.k0s()(),$.j41(17,"div",14)(18,"div",18),$.EFF(19),$.nI1(20,"i18n"),$.k0s(),$.j41(21,"div"),$.DNE(22,Mt,5,4,"ng-container",3)(23,kt,3,3,"span",19),$.k0s()()()()),2&i){const i=$.XpG(2);$.R7$(4),$.JRh($.bMT(5,8,"plan")),$.R7$(3),$.JRh($.bMT(8,10,"premiumMembership")),$.R7$(4),$.JRh($.bMT(12,12,"status")),$.R7$(4),$.JRh(i.subscription&&i.subscriptionStatus||"-"),$.R7$(),$.Y8G("ngIf",i.subscriptionMarkedForCancel),$.R7$(3),$.JRh($.bMT(20,14,"nextChargeHeader")),$.R7$(3),$.Y8G("ngIf",i.subscription),$.R7$(),$.Y8G("ngIf",!i.subscription)}}function Pt(i,t){if(1&i){const i=$.RV6();$.qex(0),$.j41(1,"div")(2,"button",25),$.bIt("click",function(){a.eBV(i);const t=$.XpG(2);return a.Njj(t.updateLicense())}),$.EFF(3),$.nI1(4,"i18n"),$.k0s(),$.j41(5,"a",26),$.EFF(6),$.nI1(7,"i18n"),$.k0s()(),$.bVm()}if(2&i){const i=$.XpG(2);$.R7$(3),$.SpI(" ",$.bMT(4,4,"updateLicense")," "),$.R7$(2),$.Y8G("href",$.VkB("",i.cloudWebVaultUrl,"/#/settings/subscription"),$.B4B),$.R7$(),$.SpI(" ",$.bMT(7,6,"launchCloudSubscription")," ")}}function jt(i,t){if(1&i){const i=$.RV6();$.qex(0),$.j41(1,"div",35)(2,"div",36)(3,"button",37),$.bIt("click",function(){a.eBV(i);const t=$.XpG(3);return a.Njj(t.adjustStorage(!0))}),$.EFF(4),$.nI1(5,"i18n"),$.k0s(),$.j41(6,"button",37),$.bIt("click",function(){a.eBV(i);const t=$.XpG(3);return a.Njj(t.adjustStorage(!1))}),$.EFF(7),$.nI1(8,"i18n"),$.k0s()()(),$.bVm()}2&i&&($.R7$(4),$.SpI(" ",$.bMT(5,2,"addStorage")," "),$.R7$(3),$.SpI(" ",$.bMT(8,4,"removeStorage")," "))}function Gt(i,t){if(1&i){const i=$.RV6();$.j41(0,"button",37),$.bIt("click",function(){a.eBV(i);const t=$.XpG(3);return a.Njj(t.downloadLicense())}),$.EFF(1),$.nI1(2,"i18n"),$.k0s()}2&i&&($.R7$(),$.SpI(" ",$.bMT(2,1,"downloadLicense")," "))}function Et(i,t){if(1&i){const i=$.RV6();$.j41(0,"button",38,2),$.bIt("click",function(){a.eBV(i);const t=$.XpG(3);return a.Njj(t.cancelSubscription())}),$.EFF(2),$.nI1(3,"i18n"),$.k0s()}if(2&i){const i=$.sdS(1),t=$.XpG(3);$.Y8G("appApiAction",t.cancelPromise)("disabled",i.loading()),$.R7$(2),$.SpI(" ",$.bMT(3,3,"cancelSubscription")," ")}}function xt(i,t){if(1&i&&($.j41(0,"div",27)(1,"h3",28),$.EFF(2),$.nI1(3,"i18n"),$.k0s(),$.j41(4,"p",10),$.EFF(5),$.nI1(6,"i18n"),$.k0s(),$.nrm(7,"bit-progress",29),$.DNE(8,jt,9,6,"ng-container",3),$.j41(9,"h3",30),$.EFF(10),$.nI1(11,"i18n"),$.k0s(),$.j41(12,"p",31),$.EFF(13),$.nI1(14,"i18n"),$.k0s(),$.j41(15,"div",32),$.DNE(16,Gt,3,3,"button",33)(17,Et,4,5,"button",34),$.k0s()()),2&i){const i=$.XpG(2);$.R7$(2),$.JRh($.bMT(3,8,"storage")),$.R7$(3),$.SpI(" ",$.brH(6,10,"subscriptionStorage",i.sub.maxStorageGb||0,i.sub.storageName||"0 MB")," "),$.R7$(2),$.Y8G("barWidth",i.storagePercentage),$.R7$(),$.Y8G("ngIf",i.subscription&&!i.subscription.cancelled&&!i.subscriptionMarkedForCancel),$.R7$(2),$.JRh($.bMT(11,14,"additionalOptions")),$.R7$(3),$.JRh($.bMT(14,16,"additionalOptionsDesc")),$.R7$(3),$.Y8G("ngIf",!i.subscription||!i.subscription.cancelled),$.R7$(),$.Y8G("ngIf",i.subscription&&!i.subscription.cancelled&&!i.subscriptionMarkedForCancel)}}function Xt(i,t){if(1&i&&($.qex(0),$.DNE(1,yt,4,7,"bit-callout",6)(2,It,9,12,"bit-callout",6)(3,wt,6,5,"dl",3)(4,Ut,24,16,"div",7)(5,Pt,8,8,"ng-container",3)(6,xt,18,18,"div",8),$.bVm()),2&i){const i=$.XpG();$.R7$(),$.Y8G("ngIf",i.subscription&&i.subscription.cancelled),$.R7$(),$.Y8G("ngIf",i.subscriptionMarkedForCancel),$.R7$(),$.Y8G("ngIf",i.selfHosted),$.R7$(),$.Y8G("ngIf",!i.selfHosted),$.R7$(),$.Y8G("ngIf",i.selfHosted),$.R7$(),$.Y8G("ngIf",!i.selfHosted)}}class Bt{constructor(i,t,e,n,s,o,r,a,c,u,p,d){this.apiService=i,this.platformUtilsService=t,this.i18nService=e,this.router=n,this.logService=s,this.fileDownloadService=o,this.dialogService=r,this.environmentService=a,this.billingAccountProfileStateService=c,this.toastService=u,this.accountService=p,this.configService=d,this.loading=!1,this.firstLoaded=!1,this.selfHosted=!1,this.enableDiscountDisplay$=this.configService.getFeatureFlag$(l.TO.PM23341_Milestone_2),this.cancelSubscription=()=>gt(this,void 0,void 0,function*(){const i=(0,nt.GM)(this.dialogService,{data:{type:"User"}});this.cancelPromise=(0,it.s)(i.closed);(yield this.cancelPromise)!==nt.vD.Closed&&(yield this.load())}),this.updateLicense=()=>gt(this,void 0,void 0,function*(){if(this.loading)return;const i=dt.open(this.dialogService);(yield(0,it.s)(i.closed))===st.Y.Updated&&(yield this.load())}),this.adjustStorage=i=>gt(this,void 0,void 0,function*(){const t=et.A.open(this.dialogService,{data:{price:4,cadence:"year",type:i?"Add":"Remove"}});(yield(0,it.s)(t.closed))===et.W.Submitted&&(yield this.load())}),this.selfHosted=this.platformUtilsService.isSelfHost()}ngOnInit(){return gt(this,void 0,void 0,function*(){this.cloudWebVaultUrl=yield(0,bi._)(this.environmentService.cloudWebVaultUrl$),yield this.load(),this.firstLoaded=!0})}load(){return gt(this,void 0,void 0,function*(){if(this.loading)return;const i=yield(0,bi._)(this.accountService.activeAccount$);(yield(0,bi._)(this.billingAccountProfileStateService.hasPremiumPersonally$(i.id)))?(this.loading=!0,this.sub=yield this.apiService.getUserSubscription(),this.loading=!1):this.router.navigate(["/settings/subscription/premium"])})}reinstate(){return gt(this,void 0,void 0,function*(){if(this.loading)return;if(yield this.dialogService.openSimpleDialog({title:{key:"reinstateSubscription"},content:{key:"reinstateConfirmation"},type:"warning"}))try{this.reinstatePromise=this.apiService.postReinstatePremium(),yield this.reinstatePromise,this.toastService.showToast({variant:"success",title:null,message:this.i18nService.t("reinstated")}),this.load()}catch(i){this.logService.error(i)}})}downloadLicense(){if(this.loading)return;const i=JSON.stringify(this.sub.license,null,2);this.fileDownloadService.download({fileName:"bitwarden_premium_license.json",blobData:i})}get subscriptionMarkedForCancel(){return null!=this.subscription&&!this.subscription.cancelled&&this.subscription.cancelAtEndDate}get subscription(){return null!=this.sub?this.sub.subscription:null}get nextInvoice(){return null!=this.sub?this.sub.upcomingInvoice:null}get subscriptionAmount(){var i;return(null===(i=this.subscription)||void 0===i?void 0:i.items)&&0!==this.subscription.items.length?this.subscription.items.reduce((i,t)=>i+(t.amount||0)*(t.quantity||0),0):0}get discountedSubscriptionAmount(){var i;return null!=(null===(i=this.nextInvoice)||void 0===i?void 0:i.amount)?this.nextInvoice.amount:this.subscriptionAmount}get storagePercentage(){return null!=this.sub&&this.sub.maxStorageGb?+(this.sub.storageGb/this.sub.maxStorageGb*100).toFixed(2):0}get title(){return this.i18nService.t(this.selfHosted?"subscription":"premiumMembership")}get subscriptionStatus(){if(this.subscription){if("incomplete"===this.subscription.status){const i=new Date(this.subscription.periodStartDate).getTime();return(new Date).getTime()-i<=15e3?this.i18nService.t("active"):this.subscription.status}return this.subscription.status}return null}getDiscountInfo(i){return i?{active:i.active,percentOff:i.percentOff,amountOff:i.amountOff}:null}}Bt.ɵfac=function(i){return new(i||Bt)($.rXU(L.G),$.rXU(d.y),$.rXU(A.W),$.rXU(X.Ix),$.rXU(tt.K),$.rXU(bt.y),$.rXU(Ii.o3),$.rXU(x.v),$.rXU(B.Q),$.rXU(D.f),$.rXU(w.Di),$.rXU(p.w))},Bt.ɵcmp=$.VBU({type:Bt,selectors:[["ng-component"]],standalone:!1,decls:2,vars:2,consts:[["reinstateBtn",""],["noDiscount",""],["cancelBtn",""],[4,"ngIf"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","tw-text-muted",3,"title"],[1,"tw-sr-only"],["type","warning",3,"title",4,"ngIf"],["class","tw-flex tw-max-w-[1340px] tw-pt-6",4,"ngIf"],["class","tw-max-w-[1340px]",4,"ngIf"],["type","warning",3,"title"],["bitTypography","body1"],["bitButton","","type","button","buttonType","secondary",3,"click","appApiAction","disabled"],[1,"tw-flex","tw-max-w-[1340px]","tw-pt-6"],[1,"tw-flex","tw-gap-16","tw-justify-between","tw-w-full"],[1,"tw-flex","tw-flex-col"],[1,"tw-font-semibold","tw-mb-2"],[1,"tw-capitalize"],["bitBadge","","variant","warning","class","tw-mt-2 tw-block",4,"ngIf"],[1,"tw-font-semibold","tw-mb-2","tw-text-right"],["class","tw-block tw-text-right",4,"ngIf"],["bitBadge","","variant","warning",1,"tw-mt-2","tw-block"],[4,"ngIf","ngIfElse"],[1,"tw-flex","tw-items-center","tw-gap-2","tw-flex-wrap","tw-justify-end"],[3,"discount"],[1,"tw-block","tw-text-right"],["type","button","bitButton","","buttonType","secondary",3,"click"],["bitButton","","buttonType","secondary","target","_blank","rel","noreferrer",3,"href"],[1,"tw-max-w-[1340px]"],["bitTypography","h3",1,"tw-mt-8"],["bgColor","success","size","default",3,"barWidth"],["bitTypography","h3",1,"tw-mt-16"],["bitTypography","body1",1,"tw-mt-3"],[1,"tw-flex","tw-gap-4","tw-mt-3"],["bitButton","","type","button","buttonType","secondary",3,"click",4,"ngIf"],["bitButton","","type","button","buttonType","danger",3,"appApiAction","disabled","click",4,"ngIf"],[1,"tw-mt-3"],[1,"tw-flex","tw-gap-4"],["bitButton","","type","button","buttonType","secondary",3,"click"],["bitButton","","type","button","buttonType","danger",3,"click","appApiAction","disabled"]],template:function(i,t){1&i&&$.DNE(0,vt,6,7,"ng-container",3)(1,Xt,7,6,"ng-container",3),2&i&&($.Y8G("ngIf",!t.firstLoaded&&t.loading),$.R7$(),$.Y8G("ngIf",t.sub))},dependencies:[T.bT,ht.k,$i.n,C.Q,V.G,mt.X,K.r,ft.U,T.Jj,T.oe,T.vh,R.$],encapsulation:2});const At=[{path:"",component:Ki,data:{titleId:"subscription"},children:[{path:"",pathMatch:"full",redirectTo:"premium"},{path:"user-subscription",component:Bt,data:{titleId:"premiumMembership"}},{path:"premium",component:ni,data:{titleId:"goPremium"},canMatch:[()=>(0,a.WQX)(d.y).isSelfHost()]},{path:"premium",component:Ei,data:{titleId:"goPremium"},canMatch:[()=>(0,a.WQX)(p.w).getFeatureFlag$(l.TO.PM24033PremiumUpgradeNewDesign).pipe((0,u.T)(i=>!0===i))]},{path:"premium",component:Qi,data:{titleId:"goPremium"}},{path:"payment-details",component:P,data:{titleId:"paymentDetails"}},{path:"billing-history",component:li,data:{titleId:"billingHistory"}}]}];class Dt{}Dt.ɵfac=function(i){return new(i||Dt)},Dt.ɵmod=$.$C({type:Dt}),Dt.ɵinj=a.G2t({imports:[c.iI.forChild(At),c.iI]});class Ct{}Ct.ɵfac=function(i){return new(i||Ct)},Ct.ɵmod=$.$C({type:Ct}),Ct.ɵinj=a.G2t({imports:[Dt,r.rd,o.G,s.Pu,s.vU,n.Y2]})}}]);
//# sourceMappingURL=453.fbb85954401903bbb832.js.map