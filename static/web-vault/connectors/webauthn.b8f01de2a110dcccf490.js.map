{"version":3,"file":"connectors/webauthn.b8f01de2a110dcccf490.js","mappings":"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","sources":["webpack://@bitwarden/web-vault/webpack/bootstrap","webpack://@bitwarden/web-vault/./src/connectors/common.ts","webpack://@bitwarden/web-vault/./src/connectors/common-webauthn.ts","webpack://@bitwarden/web-vault/webpack/runtime/make namespace object","webpack://@bitwarden/web-vault/./src/connectors/webauthn.ts"],"sourcesContent":["// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","export function getQsParam(name: string) {\n  const url = window.location.href;\n  // eslint-disable-next-line\n  name = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n  const regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\");\n  const results = regex.exec(url);\n\n  if (!results) {\n    return null;\n  }\n  if (!results[2]) {\n    return \"\";\n  }\n\n  return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n}\n\nexport function b64Decode(str: string, spaceAsPlus = false) {\n  if (spaceAsPlus) {\n    str = str.replace(/ /g, \"+\");\n  }\n\n  return decodeURIComponent(\n    Array.prototype.map\n      .call(atob(str), (c: string) => {\n        return \"%\" + (\"00\" + c.charCodeAt(0).toString(16)).slice(-2);\n      })\n      .join(\"\"),\n  );\n}\n","export function buildDataString(assertedCredential: PublicKeyCredential) {\n  const response = assertedCredential.response as AuthenticatorAssertionResponse;\n\n  const authData = new Uint8Array(response.authenticatorData);\n  const clientDataJSON = new Uint8Array(response.clientDataJSON);\n  const rawId = new Uint8Array(assertedCredential.rawId);\n  const sig = new Uint8Array(response.signature);\n\n  const data = {\n    id: assertedCredential.id,\n    rawId: coerceToBase64Url(rawId),\n    type: assertedCredential.type,\n    extensions: assertedCredential.getClientExtensionResults(),\n    response: {\n      authenticatorData: coerceToBase64Url(authData),\n      clientDataJson: coerceToBase64Url(clientDataJSON),\n      signature: coerceToBase64Url(sig),\n    },\n  };\n\n  return JSON.stringify(data);\n}\n\nexport function parseWebauthnJson(jsonString: string) {\n  const json = JSON.parse(jsonString);\n\n  const challenge = json.challenge.replace(/-/g, \"+\").replace(/_/g, \"/\");\n  json.challenge = Uint8Array.from(atob(challenge), (c) => c.charCodeAt(0));\n\n  json.allowCredentials.forEach((listItem: any) => {\n    // eslint-disable-next-line\n    const fixedId = listItem.id.replace(/\\_/g, \"/\").replace(/\\-/g, \"+\");\n    listItem.id = Uint8Array.from(atob(fixedId), (c) => c.charCodeAt(0));\n  });\n\n  return json;\n}\n\n// From https://github.com/abergs/fido2-net-lib/blob/b487a1d47373ea18cd752b4988f7262035b7b54e/Demo/wwwroot/js/helpers.js#L34\n// License: https://github.com/abergs/fido2-net-lib/blob/master/LICENSE.txt\nfunction coerceToBase64Url(thing: any) {\n  // Array or ArrayBuffer to Uint8Array\n  if (Array.isArray(thing)) {\n    thing = Uint8Array.from(thing);\n  }\n\n  if (thing instanceof ArrayBuffer) {\n    thing = new Uint8Array(thing);\n  }\n\n  // Uint8Array to base64\n  if (thing instanceof Uint8Array) {\n    let str = \"\";\n    const len = thing.byteLength;\n\n    for (let i = 0; i < len; i++) {\n      str += String.fromCharCode(thing[i]);\n    }\n    thing = window.btoa(str);\n  }\n\n  if (typeof thing !== \"string\") {\n    throw new Error(\"could not coerce to string\");\n  }\n\n  // base64 to base64url\n  // NOTE: \"=\" at the end of challenge is optional, strip it off here\n  thing = thing.replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=*$/g, \"\");\n\n  return thing;\n}\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// FIXME: Update this file to be type safe and remove this and next line\n// @ts-strict-ignore\nimport { b64Decode, getQsParam } from \"./common\";\nimport { buildDataString, parseWebauthnJson } from \"./common-webauthn\";\n\n// FIXME: Remove when updating file. Eslint update\n// eslint-disable-next-line @typescript-eslint/no-require-imports\nrequire(\"./webauthn.scss\");\n\nconst mobileCallbackUri = \"bitwarden://webauthn-callback\";\n\nlet parsed = false;\nlet webauthnJson: any;\nlet headerText: string = null;\nlet btnText: string = null;\nlet btnAwaitingInteractionText: string = null;\nlet btnReturnText: string = null;\nlet parentUrl: string = null;\nlet parentOrigin: string = null;\nlet mobileResponse = false;\nlet stopWebAuthn = false;\nlet sentSuccess = false;\nlet obj: any = null;\n\n// For accessibility, we do not actually disable the button as it would\n// become unfocusable by a screenreader. We just make it look disabled.\nconst disabledBtnClasses = [\n  \"tw-bg-secondary-300\",\n  \"tw-border-secondary-300\",\n  \"!tw-text-muted\",\n  \"!tw-cursor-not-allowed\",\n  \"hover:tw-bg-secondary-300\",\n  \"hover:tw-border-secondary-300\",\n  \"hover:!tw-text-muted\",\n  \"hover:tw-no-underline\",\n];\n\nconst enabledBtnClasses = [\n  \"tw-bg-primary-600\",\n  \"tw-border-primary-600\",\n  \"!tw-text-contrast\",\n  \"hover:tw-bg-primary-700\",\n  \"hover:tw-border-primary-700\",\n  \"hover:!tw-text-contrast\",\n  \"hover:tw-no-underline\",\n];\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  init();\n});\n\nfunction setDefaultWebAuthnButtonState() {\n  if (!btnText) {\n    return;\n  }\n\n  const button = document.getElementById(\"webauthn-button\");\n  button.onclick = executeWebAuthn;\n\n  button.innerText = decodeURI(btnText);\n\n  // reset back to default button state\n  button.classList.remove(...disabledBtnClasses);\n  button.classList.add(...enabledBtnClasses);\n}\n\nfunction setAwaitingInteractionWebAuthnButtonState() {\n  if (!btnAwaitingInteractionText) {\n    return;\n  }\n  const button = document.getElementById(\"webauthn-button\");\n  button.innerText = decodeURI(btnAwaitingInteractionText);\n  button.onclick = null;\n\n  button.classList.remove(...enabledBtnClasses);\n  button.classList.add(...disabledBtnClasses);\n}\n\nfunction init() {\n  start();\n  onMessage();\n  info(\"ready\");\n}\n\nfunction parseParameters() {\n  if (parsed) {\n    return;\n  }\n\n  parentUrl = getQsParam(\"parent\");\n  if (!parentUrl) {\n    error(\"No parent.\");\n    return;\n  } else {\n    parentUrl = decodeURIComponent(parentUrl);\n    parentOrigin = new URL(parentUrl).origin;\n  }\n\n  const version = getQsParam(\"v\");\n\n  if (version === \"1\") {\n    parseParametersV1();\n  } else {\n    parseParametersV2();\n  }\n  parsed = true;\n}\n\nfunction parseParametersV1() {\n  const data = getQsParam(\"data\");\n  if (!data) {\n    error(\"No data.\");\n    return;\n  }\n\n  webauthnJson = b64Decode(data);\n  headerText = getQsParam(\"headerText\");\n  btnText = getQsParam(\"btnText\");\n  btnAwaitingInteractionText = getQsParam(\"btnAwaitingInteractionText\");\n  btnReturnText = getQsParam(\"btnReturnText\");\n}\n\nfunction parseParametersV2() {\n  let dataObj: {\n    data: any;\n    headerText: string;\n    btnText: string;\n    btnReturnText: string;\n    callbackUri?: string;\n    mobile?: boolean;\n  } = null;\n  try {\n    dataObj = JSON.parse(b64Decode(getQsParam(\"data\")));\n    // FIXME: Remove when updating file. Eslint update\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  } catch (e) {\n    error(\"Cannot parse data.\");\n    return;\n  }\n\n  mobileResponse = dataObj.callbackUri != null || dataObj.mobile === true;\n  webauthnJson = dataObj.data;\n  headerText = dataObj.headerText;\n  btnText = dataObj.btnText;\n  btnReturnText = dataObj.btnReturnText;\n}\n\nfunction start() {\n  sentSuccess = false;\n\n  if (!(\"credentials\" in navigator)) {\n    error(\"WebAuthn is not supported in this browser.\");\n    return;\n  }\n\n  parseParameters();\n\n  if (headerText) {\n    const header = document.getElementById(\"webauthn-header\");\n    header.innerText = decodeURI(headerText);\n  }\n\n  setDefaultWebAuthnButtonState();\n\n  if (!webauthnJson) {\n    error(\"No data.\");\n    return;\n  }\n\n  try {\n    obj = parseWebauthnJson(webauthnJson);\n    // FIXME: Remove when updating file. Eslint update\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  } catch (e) {\n    error(\"Cannot parse webauthn data.\");\n    return;\n  }\n\n  stopWebAuthn = false;\n\n  if (\n    mobileResponse ||\n    (navigator.userAgent.indexOf(\" Safari/\") !== -1 && navigator.userAgent.indexOf(\"Chrome\") === -1)\n  ) {\n    // Safari and mobile chrome blocks non-user initiated WebAuthn requests.\n  } else {\n    executeWebAuthn();\n  }\n}\n\nfunction executeWebAuthn() {\n  if (stopWebAuthn) {\n    // reset back to default button state\n    setDefaultWebAuthnButtonState();\n    return;\n  }\n\n  setAwaitingInteractionWebAuthnButtonState();\n  navigator.credentials.get({ publicKey: obj }).then(success).catch(error);\n}\n\nfunction onMessage() {\n  window.addEventListener(\n    \"message\",\n    (event) => {\n      if (!event.origin || event.origin === \"\" || event.origin !== parentOrigin) {\n        return;\n      }\n\n      if (event.data === \"stop\") {\n        setDefaultWebAuthnButtonState();\n        stopWebAuthn = true;\n      } else if (event.data === \"start\" && stopWebAuthn) {\n        start();\n      }\n    },\n    false,\n  );\n}\n\nfunction error(message: string) {\n  if (mobileResponse) {\n    document.location.replace(mobileCallbackUri + \"?error=\" + encodeURIComponent(message));\n    returnButton(mobileCallbackUri + \"?error=\" + encodeURIComponent(message));\n  } else {\n    parent.postMessage(\"error|\" + message, parentUrl);\n    setDefaultWebAuthnButtonState();\n  }\n}\n\nfunction success(assertedCredential: PublicKeyCredential) {\n  if (sentSuccess) {\n    return;\n  }\n\n  const dataString = buildDataString(assertedCredential);\n\n  if (mobileResponse) {\n    document.location.replace(mobileCallbackUri + \"?data=\" + encodeURIComponent(dataString));\n    returnButton(mobileCallbackUri + \"?data=\" + encodeURIComponent(dataString));\n  } else {\n    parent.postMessage(\"success|\" + dataString, parentUrl);\n    sentSuccess = true;\n  }\n}\n\nfunction info(message: string) {\n  if (mobileResponse) {\n    return;\n  }\n\n  parent.postMessage(\"info|\" + message, parentUrl);\n}\n\nfunction returnButton(uri: string) {\n  // provides 'return' button in case scripted navigation is blocked\n  const button = document.getElementById(\"webauthn-button\");\n  button.innerText = decodeURI(btnReturnText);\n  button.onclick = () => {\n    document.location.replace(uri);\n  };\n}\n"],"names":["__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","getQsParam","name","url","window","location","href","replace","results","RegExp","exec","decodeURIComponent","b64Decode","str","spaceAsPlus","Array","prototype","map","call","atob","c","charCodeAt","toString","slice","join","coerceToBase64Url","thing","isArray","Uint8Array","from","ArrayBuffer","len","byteLength","i","String","fromCharCode","btoa","Error","r","Symbol","toStringTag","Object","defineProperty","value","mobileCallbackUri","webauthnJson","parsed","headerText","btnText","btnAwaitingInteractionText","btnReturnText","parentUrl","parentOrigin","mobileResponse","stopWebAuthn","sentSuccess","obj","disabledBtnClasses","enabledBtnClasses","setDefaultWebAuthnButtonState","button","document","getElementById","onclick","executeWebAuthn","innerText","decodeURI","classList","remove","add","parseParameters","error","URL","origin","data","parseParametersV1","dataObj","JSON","parse","e","callbackUri","mobile","parseParametersV2","start","navigator","jsonString","json","challenge","allowCredentials","forEach","listItem","fixedId","id","parseWebauthnJson","userAgent","indexOf","setAwaitingInteractionWebAuthnButtonState","credentials","get","publicKey","then","success","catch","message","encodeURIComponent","returnButton","parent","postMessage","assertedCredential","dataString","response","authData","authenticatorData","clientDataJSON","rawId","sig","signature","type","extensions","getClientExtensionResults","clientDataJson","stringify","buildDataString","uri","addEventListener","event"],"sourceRoot":""}