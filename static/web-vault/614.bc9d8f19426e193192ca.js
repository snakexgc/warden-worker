"use strict";(self.webpackChunk_bitwarden_web_vault=self.webpackChunk_bitwarden_web_vault||[]).push([[614],{1614:(t,i,n)=>{n.d(i,{OrganizationBillingModule:()=>re});var e=n(90097),s=n(50866),o=n(72932),a=n(40101),r=n(6056),c=n(67553),l=n(16878),u=n(44500),d=n(69194),p=n(72245),h=n(83892),b=n(36359),g=n(27442),m=n(66046),v=n(88565),f=n(33338),S=n(93695),y=n(58363),I=n(14803),w=n(8131),R=n(3633),$=n(15639),F=n(5819),T=n(34571),G=n(1094),M=n(27760),A=n(63734),k=n(31925),x=n(25065),j=n(33812),C=n(74208),E=n(35500),P=n(23649),B=n(21274),U=n(93748),z=n(10672),D=n(77468),X=n(88016),O=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};function Y(t,i){if(1&t){const t=j.RV6();j.j41(0,"app-organization-free-trial-warning",1),j.bIt("clicked",function(){C.eBV(t);const i=j.XpG();return C.Njj(i.changePaymentMethod())}),j.k0s()}if(2&t){j.XpG();const t=j.r8f(0);j.Y8G("organization",t)}}function N(t,i){1&t&&(j.qex(0),j.nrm(1,"i",2),j.nI1(2,"i18n"),j.j41(3,"span",3),j.EFF(4),j.nI1(5,"i18n"),j.k0s(),j.bVm()),2&t&&(j.R7$(),j.Y8G("title",j.mNQ(j.bMT(2,3,"loading"))),j.R7$(3),j.JRh(j.bMT(5,5,"loading")))}function V(t,i){if(1&t){const t=j.RV6();j.qex(0),j.j41(1,"app-display-payment-method",4),j.bIt("updated",function(i){C.eBV(t);const n=j.XpG();return C.Njj(n.setPaymentMethod(i))}),j.k0s(),j.j41(2,"app-display-billing-address",5),j.bIt("updated",function(i){C.eBV(t);const n=j.XpG();return C.Njj(n.setBillingAddress(i))}),j.k0s(),j.nrm(3,"app-display-account-credit",6),j.bVm()}if(2&t){j.XpG();const t=j.r8f(5);j.R7$(),j.Y8G("subscriber",t.organization)("paymentMethod",t.paymentMethod),j.R7$(),j.Y8G("subscriber",t.organization)("billingAddress",t.billingAddress)("taxIdWarning",t.taxIdWarning),j.R7$(),j.Y8G("subscriber",t.organization)("credit",t.credit)}}const L=new F.Lg("organizationBankAccountVerified");class q{constructor(t,i,n,e,s,o,a){this.accountService=t,this.activatedRoute=i,this.dialogService=n,this.messageListener=e,this.organizationService=s,this.organizationWarningsService=o,this.subscriberBillingClient=a,this.viewState$=new l.t(null),this.organization$=this.accountService.activeAccount$.pipe(R.F6,(0,u.n)(t=>this.organizationService.organizations$(t).pipe((0,$.Hc)(this.activatedRoute.snapshot.params.organizationId))),(0,d.p)(t=>!!t)),this.load$=this.organization$.pipe(k.bL,(0,u.n)(t=>O(this,void 0,void 0,function*(){const i=(0,p._)(this.organizationWarningsService.getTaxIdWarning$(t.data)),[n,e,s,o]=yield Promise.all([this.subscriberBillingClient.getPaymentMethod(t),this.subscriberBillingClient.getBillingAddress(t),this.subscriberBillingClient.getCredit(t),i]);return{organization:t,paymentMethod:n,billingAddress:e,credit:s,taxIdWarning:o}}))),this.view$=(0,h.h)(this.load$.pipe((0,b.M)(t=>this.viewState$.next(t))),this.viewState$.pipe((0,d.p)(t=>null!==t))).pipe((0,g.t)({bufferSize:1,refCount:!0})),this.destroy$=new m.B,this.changePaymentMethod=()=>O(this,void 0,void 0,function*(){const t=yield(0,p._)(this.view$),i=A.tD.open(this.dialogService,{data:{subscriber:t.organization}}),n=yield(0,v.s)(i.closed);"success"===(null==n?void 0:n.type)&&(yield this.setPaymentMethod(n.paymentMethod))}),this.setBillingAddress=t=>{var i;this.viewState$.value&&((null===(i=this.viewState$.value.billingAddress)||void 0===i?void 0:i.taxId)!==t.taxId&&this.organizationWarningsService.refreshTaxIdWarning(),this.viewState$.next(Object.assign(Object.assign({},this.viewState$.value),{billingAddress:t})))},this.setPaymentMethod=t=>O(this,void 0,void 0,function*(){var i;if(this.viewState$.value){this.viewState$.value.paymentMethod||this.organizationWarningsService.refreshFreeTrialWarning();const n=null!==(i=this.viewState$.value.billingAddress)&&void 0!==i?i:yield this.subscriberBillingClient.getBillingAddress(this.viewState$.value.organization);this.viewState$.next(Object.assign(Object.assign({},this.viewState$.value),{paymentMethod:t,billingAddress:n}))}})}ngOnInit(){return O(this,void 0,void 0,function*(){var t,i;null!==(i=null===(t=history.state)||void 0===t?void 0:t.launchPaymentModalAutomatically)&&void 0!==i&&i&&(history.replaceState(Object.assign(Object.assign({},history.state),{launchPaymentModalAutomatically:!1}),""),yield this.changePaymentMethod()),this.organizationWarningsService.taxIdWarningRefreshed$.pipe((0,u.n)(t=>(0,f.z)([(0,S.of)(t),this.organization$.pipe((0,y.s)(1)).pipe(k.bL,(0,u.n)(t=>this.subscriberBillingClient.getBillingAddress(t)))])),(0,I.Q)(this.destroy$)).subscribe(([t,i])=>{this.viewState$.value&&this.viewState$.next(Object.assign(Object.assign({},this.viewState$.value),{taxIdWarning:t,billingAddress:i}))}),this.messageListener.messages$(L).pipe((0,w.E)(this.view$),(0,d.p)(([t,i])=>t.organizationId===i.organization.data.id),(0,u.n)(t=>O(this,[t],void 0,function*([t,i]){return yield Promise.all([this.subscriberBillingClient.getPaymentMethod(i.organization),this.subscriberBillingClient.getBillingAddress(i.organization)])})),(0,b.M)(t=>O(this,[t],void 0,function*([t,i]){t&&(yield this.setPaymentMethod(t)),i&&this.setBillingAddress(i)})),(0,I.Q)(this.destroy$)).subscribe()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}q.ɵfac=function(t){return new(t||q)(j.rXU(E.D),j.rXU(P.nX),j.rXU(B.o3),j.rXU(F.qk),j.rXU(c.PV),j.rXU(M.S),j.rXU(T.Hd))},q.ɵcmp=j.VBU({type:q,selectors:[["ng-component"]],decls:9,vars:8,consts:[[3,"organization"],[3,"clicked","organization"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","tw-text-muted",3,"title"],[1,"tw-sr-only"],[3,"updated","subscriber","paymentMethod"],[3,"updated","subscriber","billingAddress","taxIdWarning"],[3,"subscriber","credit"]],template:function(t,i){if(1&t&&(j.SS7(0),j.nI1(1,"async"),j.nVh(2,Y,1,1,"app-organization-free-trial-warning",0),j.nrm(3,"app-header"),j.j41(4,"bit-container"),j.SS7(5),j.nI1(6,"async"),j.nVh(7,N,6,7,"ng-container")(8,V,4,7,"ng-container"),j.k0s()),2&t){const t=j.bH3(j.bMT(1,2,i.organization$));j.R7$(2),j.vxM(t?2:-1),j.R7$(3);const n=j.bH3(j.bMT(6,5,i.view$));j.R7$(2),j.vxM(n?8:7)}},dependencies:[A.I$,A.M0,A.H8,o.G,U.f,G.z,x.G,z.H,D.Jj,X.$],encapsulation:2});var J=n(77259),_=n(3204),W=n(13417),Z=n(43978),H=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};const K=t=>H(void 0,void 0,void 0,function*(){const i=(0,C.WQX)(c.PV),n=(0,C.WQX)(W.$),e=(0,C.WQX)(E.D),s=yield(0,p._)(e.activeAccount$.pipe((0,_.T)(t=>null==t?void 0:t.id)));if(!s)throw new Error("No user found.");const o=yield(0,p._)(i.organizations$(s).pipe((0,c.Sw)(t.params.organizationId)));if(!o)throw new Error("No organization found.");if(!o.hasProvider)return!0;const a=yield(0,p._)(n.get$(o.providerId,s));return!a||a.providerStatus!==Z.kC.Billable});var Q=n(83724),tt=n(73276),it=n(49247),nt=n(56898),et=n(78650),st=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};function ot(t,i){1&t&&(j.qex(0),j.nrm(1,"i",1),j.nI1(2,"i18n"),j.j41(3,"span",2),j.EFF(4),j.nI1(5,"i18n"),j.k0s(),j.bVm()),2&t&&(j.R7$(),j.Y8G("title",j.mNQ(j.bMT(2,3,"loading"))),j.R7$(3),j.JRh(j.bMT(5,5,"loading")))}function at(t,i){if(1&t){const t=j.RV6();j.j41(0,"button",5),j.bIt("click",function(){C.eBV(t);const i=j.XpG(2);return C.Njj(i.load())}),j.EFF(1),j.nI1(2,"i18n"),j.k0s()}2&t&&(j.R7$(),j.SpI(" ",j.bMT(2,1,"loadMore")," "))}function rt(t,i){if(1&t&&(j.qex(0),j.nrm(1,"app-billing-history",3),j.DNE(2,at,3,3,"button",4),j.bVm()),2&t){const t=j.XpG();j.R7$(),j.Y8G("openInvoices",t.openInvoices)("paidInvoices",t.paidInvoices)("transactions",t.transactions),j.R7$(),j.Y8G("ngIf",t.hasAdditionalHistory)}}class ct{constructor(t,i){this.organizationBillingApiService=t,this.route=i,this.loading=!1,this.firstLoaded=!1,this.openInvoices=[],this.paidInvoices=[],this.transactions=[],this.hasAdditionalHistory=!1,this.destroy$=new m.B}ngOnInit(){return st(this,void 0,void 0,function*(){this.route.params.pipe((0,tt.H)(t=>st(this,void 0,void 0,function*(){this.organizationId=t.organizationId,yield this.load(),this.firstLoaded=!0})),(0,I.Q)(this.destroy$)).subscribe()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}load(){return st(this,void 0,void 0,function*(){this.loading||(this.loading=!0,this.loading=!1)})}}ct.ɵfac=function(t){return new(t||ct)(j.rXU(it.C),j.rXU(P.nX))},ct.ɵcmp=j.VBU({type:ct,selectors:[["ng-component"]],standalone:!1,decls:4,vars:2,consts:[[4,"ngIf"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","tw-text-muted",3,"title"],[1,"tw-sr-only"],[3,"openInvoices","paidInvoices","transactions"],["type","button","bitButton","","buttonType","secondary",3,"click",4,"ngIf"],["type","button","bitButton","","buttonType","secondary",3,"click"]],template:function(t,i){1&t&&(j.nrm(0,"app-header"),j.j41(1,"bit-container"),j.DNE(2,ot,6,7,"ng-container",0)(3,rt,3,4,"ng-container",0),j.k0s()),2&t&&(j.R7$(2),j.Y8G("ngIf",!i.firstLoaded&&i.loading),j.R7$(),j.Y8G("ngIf",i.openInvoices||i.paidInvoices||i.transactions))},dependencies:[D.bT,nt.Q,z.H,et.D,U.f,X.$],encapsulation:2});var lt=n(23965);const ut=n(82392).JW`
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="4.8 6 110.4 107.52">
    <path class="tw-fill-illustration-bg-primary" d="M59.64 84.96c12.924 0 23.4-10.316 23.4-23.04 0-12.725-10.476-23.04-23.4-23.04-12.923 0-23.4 10.315-23.4 23.04 0 12.724 10.477 23.04 23.4 23.04Z"/>
    <path class="tw-fill-illustration-outline" fill-rule="evenodd" d="M59.64 40.08c-12.278 0-22.2 9.795-22.2 21.84 0 12.044 9.922 21.84 22.2 21.84 12.278 0 22.2-9.796 22.2-21.84 0-12.045-9.922-21.84-22.2-21.84Zm-24.6 21.84c0-13.405 11.031-24.24 24.6-24.24s24.6 10.835 24.6 24.24c0 13.405-11.031 24.24-24.6 24.24s-24.6-10.835-24.6-24.24Z" clip-rule="evenodd"/>
    <path class="tw-fill-illustration-bg-primary" d="M96 28.8a8.64 8.64 0 0 0 8.639-8.64 8.64 8.64 0 1 0-17.28 0A8.64 8.64 0 0 0 96 28.8Z"/>
    <path class="tw-fill-illustration-outline" fill-rule="evenodd" d="M96 12.72a7.44 7.44 0 1 0 0 14.88 7.44 7.44 0 0 0 0-14.88Zm-9.84 7.44c0-5.434 4.405-9.84 9.84-9.84 5.434 0 9.84 4.406 9.84 9.84 0 5.435-4.406 9.84-9.84 9.84-5.435 0-9.84-4.405-9.84-9.84Z" clip-rule="evenodd"/>
    <path class="tw-fill-illustration-bg-secondary" d="M105.359 72.72a8.64 8.64 0 0 0 8.64-8.64 8.64 8.64 0 1 0-17.28 0 8.64 8.64 0 0 0 8.64 8.64Z"/>
    <path class="tw-fill-illustration-outline" fill-rule="evenodd" d="M105.36 56.64a7.44 7.44 0 1 0 0 14.881 7.44 7.44 0 0 0 0-14.88Zm-9.84 7.44c0-5.434 4.405-9.84 9.84-9.84 5.434 0 9.84 4.406 9.84 9.84 0 5.435-4.406 9.84-9.84 9.84-5.435 0-9.84-4.405-9.84-9.84Z" clip-rule="evenodd"/>
    <path class="tw-fill-illustration-bg-tertiary" d="M97.44 112.32a8.64 8.64 0 1 0 0-17.28 8.64 8.64 0 0 0 0 17.28Z"/>
    <path class="tw-fill-illustration-outline" fill-rule="evenodd" d="M97.44 96.24a7.44 7.44 0 1 0 0 14.88 7.44 7.44 0 0 0 0-14.88Zm-9.84 7.44c0-5.435 4.405-9.84 9.84-9.84 5.434 0 9.84 4.405 9.84 9.84 0 5.434-4.406 9.84-9.84 9.84-5.435 0-9.84-4.406-9.84-9.84Z" clip-rule="evenodd"/>
    <path class="tw-fill-illustration-bg-primary" d="M39.119 111.599a8.64 8.64 0 1 0 0-17.28 8.64 8.64 0 0 0 0 17.28Z"/>
    <path class="tw-fill-illustration-outline" fill-rule="evenodd" d="M39.12 95.52a7.44 7.44 0 1 0 0 14.88 7.44 7.44 0 0 0 0-14.88Zm-9.84 7.44c0-5.434 4.405-9.84 9.84-9.84 5.434 0 9.84 4.406 9.84 9.84 0 5.435-4.406 9.84-9.84 9.84-5.435 0-9.84-4.405-9.84-9.84Z" clip-rule="evenodd"/>
    <path class="tw-fill-illustration-bg-secondary" d="M14.64 58.32a8.64 8.64 0 1 0 0-17.28 8.64 8.64 0 0 0 0 17.28Z"/>
    <path class="tw-fill-illustration-outline" fill-rule="evenodd" d="M14.64 42.24a7.44 7.44 0 1 0 0 14.88 7.44 7.44 0 0 0 0-14.88ZM4.8 49.68c0-5.435 4.405-9.84 9.84-9.84 5.434 0 9.84 4.405 9.84 9.84 0 5.434-4.406 9.84-9.84 9.84-5.435 0-9.84-4.406-9.84-9.84Z" clip-rule="evenodd"/>
    <path class="tw-fill-illustration-bg-tertiary" d="M39.84 24.48a8.64 8.64 0 1 0 0-17.28 8.64 8.64 0 0 0 0 17.28Z"/>
    <path class="tw-fill-illustration-outline" fill-rule="evenodd" d="M39.84 8.4a7.44 7.44 0 1 0 0 14.88 7.44 7.44 0 0 0 0-14.88ZM30 15.84C30 10.406 34.406 6 39.84 6s9.84 4.405 9.84 9.84c0 5.434-4.405 9.84-9.84 9.84-5.434 0-9.84-4.405-9.84-9.84Z" clip-rule="evenodd"/>
    <path class="tw-fill-illustration-outline" fill-rule="evenodd" d="M43.687 24.097a1.2 1.2 0 0 1 1.576.63l6.48 15.12a1.2 1.2 0 0 1-2.206.946l-6.48-15.12a1.2 1.2 0 0 1 .63-1.576ZM90.305 26.452a1.2 1.2 0 0 1 .123 1.692l-13.68 15.84a1.2 1.2 0 1 1-1.816-1.568l13.68-15.84a1.2 1.2 0 0 1 1.693-.124ZM22.844 52.239a1.2 1.2 0 0 1 1.477-.835l12.96 3.6a1.2 1.2 0 1 1-.642 2.312l-12.96-3.6a1.2 1.2 0 0 1-.835-1.477ZM51.228 82.475a1.2 1.2 0 0 1 .458 1.634l-6.48 11.52a1.2 1.2 0 1 1-2.092-1.177l6.48-11.52a1.2 1.2 0 0 1 1.634-.457ZM75.065 77.564a1.2 1.2 0 0 1 1.691.141l15.84 18.72a1.2 1.2 0 1 1-1.832 1.55l-15.84-18.72a1.2 1.2 0 0 1 .141-1.69ZM82.568 61.78a1.2 1.2 0 0 1 1.332-1.052l12.24 1.44a1.2 1.2 0 0 1-.28 2.384l-12.24-1.44a1.2 1.2 0 0 1-1.052-1.332Z" clip-rule="evenodd"/>
    <path class="tw-fill-illustration-tertiary" d="M72.633 60.217a1.2 1.2 0 0 0-.397.892v1.668c0 .354.156.69.427.918l2.501 2.107c.403.339.537.9.333 1.384l-.788 1.868a1.2 1.2 0 0 1-1.158.733l-3.424-.149a1.2 1.2 0 0 0-.898.349l-1.17 1.165a1.2 1.2 0 0 0-.349.956l.289 3.26a1.2 1.2 0 0 1-.732 1.212l-1.874.784a1.2 1.2 0 0 1-1.352-.302l-2.262-2.497a1.2 1.2 0 0 0-.89-.394h-1.685a1.2 1.2 0 0 0-.915.423l-2.122 2.498a1.2 1.2 0 0 1-1.378.33l-1.884-.788a1.2 1.2 0 0 1-.736-1.16l.148-3.397a1.2 1.2 0 0 0-.352-.902l-1.17-1.165a1.2 1.2 0 0 0-.952-.345l-3.287.288a1.2 1.2 0 0 1-1.21-.729l-.784-1.857a1.2 1.2 0 0 1 .304-1.36l2.501-2.245a1.2 1.2 0 0 0 .398-.893v-1.676a1.2 1.2 0 0 0-.416-.909l-2.526-2.176a1.2 1.2 0 0 1-.323-1.376l.792-1.877a1.2 1.2 0 0 1 1.158-.732l3.424.148a1.2 1.2 0 0 0 .898-.349l1.172-1.166c.251-.25.379-.6.348-.953L52 48.402a1.2 1.2 0 0 1 .732-1.21l1.869-.782a1.2 1.2 0 0 1 1.359.31l2.33 2.616a1.2 1.2 0 0 0 .897.402h1.68a1.2 1.2 0 0 0 .914-.423l2.123-2.497a1.2 1.2 0 0 1 1.377-.33l1.884.788a1.2 1.2 0 0 1 .736 1.159l-.148 3.397a1.2 1.2 0 0 0 .352.902l1.17 1.166c.251.25.6.376.952.345l3.287-.29a1.2 1.2 0 0 1 1.21.73l.784 1.858a1.2 1.2 0 0 1-.302 1.359l-2.573 2.315Zm-14.677-3.025c-2.704 1.105-3.952 4.141-2.843 6.764 1.11 2.692 4.16 3.934 6.794 2.83 2.634-1.104 3.951-4.141 2.842-6.764-1.04-2.692-4.09-3.934-6.793-2.83Z"/>
    <path class="tw-fill-illustration-outline" fill-rule="evenodd" d="M54.138 45.303a2.4 2.4 0 0 1 2.718.618l2.33 2.617h1.68l2.123-2.498a2.4 2.4 0 0 1 2.755-.66l1.884.788a2.4 2.4 0 0 1 1.472 2.32l-.148 3.396 1.17 1.165 3.287-.289a2.4 2.4 0 0 1 2.421 1.458l.784 1.859a2.4 2.4 0 0 1-.606 2.717l-2.572 2.315v1.668l2.501 2.107a2.4 2.4 0 0 1 .665 2.769l-.788 1.868a2.4 2.4 0 0 1-2.315 1.465l-3.424-.149-1.17 1.165.29 3.26a2.4 2.4 0 0 1-1.465 2.425l-1.874.784a2.4 2.4 0 0 1-2.705-.603L60.89 75.37h-1.685l-2.123 2.498a2.4 2.4 0 0 1-2.755.66l-1.884-.788a2.4 2.4 0 0 1-1.472-2.32l.148-3.396-1.17-1.165-3.287.289a2.4 2.4 0 0 1-2.421-1.458l-.784-1.858a2.4 2.4 0 0 1 .608-2.718l2.501-2.246v-1.676l-2.526-2.176a2.4 2.4 0 0 1-.645-2.751l.792-1.878a2.4 2.4 0 0 1 2.315-1.465l3.425.149 1.17-1.166-.292-3.401a2.4 2.4 0 0 1 1.465-2.42l1.869-.782Zm.926 2.214-1.869.782.293 3.4a2.4 2.4 0 0 1-.698 1.907l-1.171 1.166a2.4 2.4 0 0 1-1.797.697l-3.424-.148-.792 1.878 2.526 2.176a2.4 2.4 0 0 1 .833 1.818v1.676a2.4 2.4 0 0 1-.796 1.785L45.668 66.9l.783 1.858 3.287-.289a2.4 2.4 0 0 1 1.904.69l1.17 1.165a2.4 2.4 0 0 1 .704 1.806l-.148 3.397 1.884.787 2.123-2.497a2.4 2.4 0 0 1 1.829-.846h1.685a2.4 2.4 0 0 1 1.78.789l2.261 2.496 1.874-.783-.29-3.26a2.4 2.4 0 0 1 .698-1.912l1.17-1.165a2.4 2.4 0 0 1 1.797-.697l3.424.149.788-1.868-2.502-2.108a2.4 2.4 0 0 1-.853-1.835v-1.669a2.4 2.4 0 0 1 .794-1.783l2.573-2.315-.784-1.859-3.287.289a2.4 2.4 0 0 1-1.903-.69l-1.17-1.165a2.4 2.4 0 0 1-.705-1.806l.148-3.397-1.884-.788-2.123 2.498a2.4 2.4 0 0 1-1.828.846h-1.68a2.4 2.4 0 0 1-1.792-.804l-2.331-2.617Zm10.798 12.055c-1.301-3.338-5.073-4.834-8.36-3.49-3.313 1.352-4.865 5.091-3.496 8.336 1.364 3.302 5.117 4.836 8.365 3.474 3.21-1.345 4.858-5.06 3.49-8.32Zm-2.232.882c-.786-2.033-3.107-3.014-5.22-2.151-2.094.855-3.037 3.187-2.191 5.186l.004.01a3.98 3.98 0 0 0 5.22 2.18c2.052-.86 3.038-3.209 2.2-5.19a1.065 1.065 0 0 1-.013-.035Z" clip-rule="evenodd"/>
  </svg>
`;var dt=n(88083),pt=n(56962),ht=n(33895),bt=n(97062),gt=n(51757),mt=n(7248);class vt extends mt.V{constructor(){super(...arguments),this.type=Z.pC.Default}}var ft=n(81525),St=n(62166),yt=n(12012),It=n(37115),wt=n(50700),Rt=n(11224),$t=n(69855),Ft=n(7855),Tt=n(25024),Gt=n(26657),Mt=n(45154),At=n(44432),kt=n(7730),xt=n(68016),jt=n(86226),Ct=n(97553),Et=n(43759),Pt=n(69896),Bt=n(36288),Ut=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};function zt(t,i){1&t&&j.nrm(0,"app-user-verification",9)}function Dt(t,i){1&t&&(j.qex(0),j.j41(1,"p"),j.EFF(2),j.nI1(3,"i18n"),j.k0s(),j.j41(4,"bit-callout",10),j.EFF(5),j.nI1(6,"i18n"),j.k0s(),j.bVm()),2&t&&(j.R7$(2),j.JRh(j.bMT(3,2,"rotateBillingSyncTokenTitle")),j.R7$(3),j.SpI(" ",j.bMT(6,4,"rotateBillingSyncTokenWarning")," "))}function Xt(t,i){if(1&t&&(j.j41(0,"div",15)(1,"b",16),j.EFF(2),j.nI1(3,"i18n"),j.k0s(),j.EFF(4),j.nI1(5,"date"),j.k0s()),2&t){const t=j.XpG(2);j.R7$(2),j.SpI("",j.bMT(3,2,"lastSync"),":"),j.R7$(2),j.SpI(" ",j.i5U(5,4,t.lastSyncDate,"medium")," ")}}function Ot(t,i){if(1&t&&(j.j41(0,"div",17),j.nrm(1,"i",18),j.EFF(2),j.nI1(3,"i18n"),j.k0s()),2&t){const t=j.XpG(2);j.R7$(2),j.SpI(" ",j.i5U(3,1,1===t.daysBetween?"awaitingSyncSingular":"awaitingSyncPlural",t.daysBetween)," ")}}function Yt(t,i){if(1&t&&(j.j41(0,"div")(1,"p"),j.EFF(2),j.nI1(3,"i18n"),j.k0s(),j.j41(4,"bit-form-field")(5,"bit-label"),j.EFF(6),j.nI1(7,"i18n"),j.k0s(),j.nrm(8,"input",11)(9,"button",12),j.nI1(10,"i18n"),j.nI1(11,"i18n"),j.k0s(),j.DNE(12,Xt,6,7,"div",13)(13,Ot,4,4,"div",14),j.k0s()),2&t){const t=j.XpG();j.R7$(2),j.JRh(j.bMT(3,8,"copyPasteBillingSync")),j.R7$(4),j.JRh(j.bMT(7,10,"billingSyncKey")),j.R7$(2),j.Y8G("value",t.clientSecret),j.R7$(),j.Y8G("valueLabel",j.bMT(10,12,"billingSyncKey"))("appCopyClick",t.clientSecret)("label",j.bMT(11,14,"copyValue")),j.R7$(3),j.Y8G("ngIf",t.showLastSyncText),j.R7$(),j.Y8G("ngIf",t.showAwaitingSyncText)}}function Nt(t,i){if(1&t&&(j.j41(0,"button",19),j.EFF(1),j.k0s()),2&t){const t=j.XpG();j.R7$(),j.SpI(" ",t.submitButtonText," ")}}function Vt(t,i){1&t&&(j.j41(0,"button",20),j.EFF(1),j.nI1(2,"i18n"),j.k0s()),2&t&&(j.R7$(),j.SpI(" ",j.bMT(2,1,"close")," "))}function Lt(t,i){if(1&t){const t=j.RV6();j.j41(0,"button",21),j.bIt("click",function(){C.eBV(t);const i=j.XpG();return C.Njj(i.cancelRotate())}),j.EFF(1),j.nI1(2,"i18n"),j.k0s()}2&t&&(j.R7$(),j.SpI(" ",j.bMT(2,1,"cancel")," "))}function qt(t,i){if(1&t){const t=j.RV6();j.j41(0,"button",21),j.bIt("click",function(){C.eBV(t);const i=j.XpG();return C.Njj(i.rotateToken())}),j.EFF(1),j.nI1(2,"i18n"),j.k0s()}2&t&&(j.R7$(),j.SpI(" ",j.bMT(2,1,"rotateToken")," "))}class Jt{constructor(t,i,n,e,s,o,a,r){this.data=t,this.userVerificationService=i,this.apiService=n,this.platformUtilsService=e,this.i18nService=s,this.organizationApiService=o,this.logService=a,this.toastService=r,this.formGroup=new gt.gE({verification:new gt.MJ(null,gt.k0.required)}),this.submit=()=>Ut(this,void 0,void 0,function*(){try{const t=this.userVerificationService.buildRequest(this.formGroup.value.verification,vt).then(t=>(t.type=Z.pC.BillingSync,t));if(this.showRotateScreen){const i=yield t.then(t=>this.organizationApiService.rotateApiKey(this.organizationId,t));yield this.load(i),this.showRotateScreen=!1,this.toastService.showToast({variant:"success",title:null,message:this.i18nService.t("billingSyncApiKeyRotated")})}else{const i=yield t.then(t=>this.organizationApiService.getOrCreateApiKey(this.organizationId,t));yield this.load(i)}}catch(t){throw this.logService.error(t),t}}),this.organizationId=t.organizationId,this.hasBillingToken=t.hasBillingToken}copy(){this.platformUtilsService.copyToClipboard(this.clientSecret)}load(t){return Ut(this,void 0,void 0,function*(){this.clientSecret=t.apiKey,this.keyRevisionDate=t.revisionDate,this.hasBillingToken=!0;const i=yield this.apiService.getSponsorshipSyncStatus(this.organizationId);this.lastSyncDate=i.lastSyncDate})}cancelRotate(){this.showRotateScreen=!1}rotateToken(){this.showRotateScreen=!0}dayDiff(t,i){const n=Math.abs(i.getTime()-t.getTime());return Math.round(n/864e5)}get submitButtonText(){return this.showRotateScreen?this.i18nService.t("rotateToken"):this.i18nService.t(this.hasBillingToken?"continue":"generateToken")}get showLastSyncText(){return this.lastSyncDate&&this.lastSyncDate>this.keyRevisionDate}get showAwaitingSyncText(){return this.lastSyncDate&&this.lastSyncDate<=this.keyRevisionDate}get daysBetween(){return this.dayDiff(this.keyRevisionDate,new Date)}static open(t,i){return t.open(Jt,{data:i})}}Jt.ɵfac=function(t){return new(t||Jt)(j.rXU(ft.Qs),j.rXU(St.i),j.rXU(yt.G),j.rXU(It.y),j.rXU(wt.W),j.rXU(Rt.X),j.rXU(pt.K),j.rXU($t.f))},Jt.ɵcmp=j.VBU({type:Jt,selectors:[["ng-component"]],standalone:!1,decls:14,vars:12,consts:[[3,"formGroup","bitSubmit"],["bitDialogTitle",""],["bitDialogContent",""],["formControlName","verification",4,"ngIf"],[4,"ngIf"],["bitDialogFooter",""],["type","submit","bitButton","","bitFormButton","","buttonType","primary",4,"ngIf"],["bitButton","","bitDialogClose","","type","button",4,"ngIf"],["bitButton","","type","button",3,"click",4,"ngIf"],["formControlName","verification"],["type","warning"],["bitInput","","id","clientSecret","type","text","disabled","",1,"tw-font-mono",3,"value"],["bitIconButton","bwi-clone","bitSuffix","","type","button","showToast","",3,"valueLabel","appCopyClick","label"],["class","tw-mt-2 tw-text-sm tw-text-muted",4,"ngIf"],["class","tw-mt-2 tw-text-sm tw-text-danger",4,"ngIf"],[1,"tw-mt-2","tw-text-sm","tw-text-muted"],[1,"tw-font-medium"],[1,"tw-mt-2","tw-text-sm","tw-text-danger"],[1,"bwi","bwi-error"],["type","submit","bitButton","","bitFormButton","","buttonType","primary"],["bitButton","","bitDialogClose","","type","button"],["bitButton","","type","button",3,"click"]],template:function(t,i){1&t&&(j.j41(0,"form",0)(1,"bit-dialog")(2,"span",1),j.EFF(3),j.nI1(4,"i18n"),j.k0s(),j.j41(5,"div",2),j.DNE(6,zt,1,0,"app-user-verification",3)(7,Dt,7,6,"ng-container",4)(8,Yt,14,16,"div",4),j.k0s(),j.qex(9,5),j.DNE(10,Nt,2,1,"button",6)(11,Vt,3,3,"button",7)(12,Lt,3,3,"button",8)(13,qt,3,3,"button",8),j.bVm(),j.k0s()()),2&t&&(j.Y8G("formGroup",i.formGroup)("bitSubmit",i.submit),j.R7$(3),j.SpI(" ",j.bMT(4,10,i.hasBillingToken?"viewBillingToken":"generateBillingToken")," "),j.R7$(3),j.Y8G("ngIf",!i.clientSecret),j.R7$(),j.Y8G("ngIf",i.clientSecret&&i.showRotateScreen),j.R7$(),j.Y8G("ngIf",i.clientSecret&&!i.showRotateScreen),j.R7$(2),j.Y8G("ngIf",!i.clientSecret||i.showRotateScreen),j.R7$(),j.Y8G("ngIf",!i.showRotateScreen),j.R7$(),j.Y8G("ngIf",i.showRotateScreen),j.R7$(),j.Y8G("ngIf",i.clientSecret&&!i.showRotateScreen))},dependencies:[Ft.q,D.bT,gt.qT,gt.BC,gt.cb,gt.j4,gt.JD,Tt.D,Gt.$,Mt.L,nt.Q,At.G,kt.I,xt.m,jt.j,Ct.J,Et.h,Pt.a,Bt.s,D.vh,X.$],encapsulation:2});var _t,Wt=n(16452),Zt=n(53127),Ht=n(54471),Kt=n(3892),Qt=n(57178),ti=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};!function(t){t.Cancelled="cancelled",t.Downloaded="downloaded"}(_t||(_t={}));class ii{constructor(t,i,n,e,s){this.data=t,this.dialogRef=i,this.fileDownloadService=n,this.organizationApiService=e,this.formBuilder=s,this.licenseForm=this.formBuilder.group({installationId:["",[gt.k0.required]]}),this.submit=()=>ti(this,void 0,void 0,function*(){this.licenseForm.markAllAsTouched();const t=this.licenseForm.get("installationId").value;if(null==t||""===t)return;const i=yield this.organizationApiService.getLicense(this.data.organizationId,t),n=JSON.stringify(i,null,2);this.fileDownloadService.download({fileName:"bitwarden_organization_license.json",blobData:n}),this.dialogRef.close(_t.Downloaded)}),this.cancel=()=>{this.dialogRef.close(_t.Cancelled)}}static open(t,i){return t.open(ii,i)}}ii.ɵfac=function(t){return new(t||ii)(j.rXU(ft.Qs),j.rXU(B.ce),j.rXU(Zt.y),j.rXU(Rt.X),j.rXU(gt.ok))},ii.ɵcmp=j.VBU({type:ii,selectors:[["ng-component"]],standalone:!1,decls:23,vars:19,consts:[[3,"formGroup","bitSubmit"],["bitDialogTitle",""],["bitDialogContent",""],[1,"tw-grid","tw-grid-cols-12","tw-gap-4"],[1,"tw-col-span-8"],["bitLink","","target","_blank","rel","noreferrer","href","https://bitwarden.com/help/licensing-on-premise/#organization-account-sharing","slot","end",1,"tw-ml-auto",3,"appA11yTitle"],["aria-hidden","true",1,"bwi","bwi-question-circle"],["type","text","bitInput","","formControlName","installationId"],["bitDialogFooter",""],["bitButton","","bitFormButton","","buttonType","primary","type","submit"],["bitButton","","bitFormButton","","buttonType","secondary","type","button",3,"bitAction"]],template:function(t,i){1&t&&(j.j41(0,"form",0)(1,"bit-dialog")(2,"span",1),j.EFF(3),j.nI1(4,"i18n"),j.k0s(),j.qex(5,2),j.j41(6,"div",3)(7,"div",4)(8,"bit-form-field")(9,"bit-label"),j.EFF(10),j.nI1(11,"i18n"),j.j41(12,"a",5),j.nI1(13,"i18n"),j.nrm(14,"i",6),j.k0s()(),j.nrm(15,"input",7),j.k0s()()(),j.bVm(),j.qex(16,8),j.j41(17,"button",9),j.EFF(18),j.nI1(19,"i18n"),j.k0s(),j.j41(20,"button",10),j.EFF(21),j.nI1(22,"i18n"),j.k0s(),j.bVm(),j.k0s()()),2&t&&(j.Y8G("formGroup",i.licenseForm)("bitSubmit",i.submit),j.R7$(3),j.JRh(j.bMT(4,9,"downloadLicense")),j.R7$(7),j.SpI("",j.bMT(11,11,"enterInstallationId")," "),j.R7$(2),j.Y8G("appA11yTitle",j.mNQ(j.bMT(13,13,"learnMore"))),j.R7$(6),j.SpI(" ",j.bMT(19,15,"submit")," "),j.R7$(2),j.Y8G("bitAction",i.cancel),j.R7$(),j.SpI(" ",j.bMT(22,17,"cancel")," "))},dependencies:[gt.qT,gt.me,gt.BC,gt.cb,gt.j4,gt.JD,Ht.C,Kt.p,Gt.$,Mt.L,nt.Q,xt.m,jt.j,Ct.J,Et.h,Qt.g,X.$],encapsulation:2});var ni=n(47696),ei=n(8168),si=n(38140),oi=n(38410),ai=n(22466),ri=n(36572),ci=n(58806),li=n(52136);class ui{constructor(t,i){this.seatAdjustment=t,this.maxAutoscaleSeats=i}}var di=n(50352),pi=n(90246),hi=n(93199),bi=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};class gi{constructor(t,i,n,e,s,o){this.i18nService=t,this.organizationApiService=i,this.formBuilder=n,this.toastService=e,this.internalOrganizationService=s,this.accountService=o,this.seatPrice=0,this.interval="year",this.onAdjusted=new j.bkB,this.destroy$=new m.B,this.adjustSubscriptionForm=this.formBuilder.group({newSeatCount:[0,[gt.k0.min(0)]],limitSubscription:[!1],newMaxSeats:[0,[gt.k0.min(0)]]}),this.submit=()=>bi(this,void 0,void 0,function*(){if(this.adjustSubscriptionForm.markAllAsTouched(),this.adjustSubscriptionForm.invalid)return;const t=new ui(this.additionalSeatCount,this.adjustSubscriptionForm.value.newMaxSeats),i=yield this.organizationApiService.updatePasswordManagerSeats(this.organizationId,t),n=yield(0,p._)((0,R.F6)(this.accountService.activeAccount$)),e=yield(0,p._)(this.internalOrganizationService.organizations$(n).pipe((0,c.Sw)(this.organizationId))),s=new li.o(i,{isMember:e.isMember,isProviderUser:e.isProviderUser});yield this.internalOrganizationService.upsert(s,n),this.toastService.showToast({variant:"success",title:null,message:this.i18nService.t("subscriptionUpdated")}),this.onAdjusted.emit()})}ngOnInit(){this.adjustSubscriptionForm.valueChanges.pipe((0,I.Q)(this.destroy$)).subscribe(t=>{const i=this.adjustSubscriptionForm.controls.newMaxSeats;t.limitSubscription?(i.setValidators([gt.k0.min(t.newSeatCount)]),i.enable({emitEvent:!1})):i.disable({emitEvent:!1})}),this.adjustSubscriptionForm.patchValue({newSeatCount:this.currentSeatCount,newMaxSeats:this.maxAutoscaleSeats,limitSubscription:null!=this.maxAutoscaleSeats})}limitSubscriptionChanged(){this.adjustSubscriptionForm.value.limitSubscription||(this.adjustSubscriptionForm.value.newMaxSeats=null)}get additionalSeatCount(){return this.adjustSubscriptionForm.value.newSeatCount?this.adjustSubscriptionForm.value.newSeatCount-this.currentSeatCount:0}get maxSeatTotal(){var t;return Math.abs((null!==(t=this.adjustSubscriptionForm.value.newMaxSeats)&&void 0!==t?t:0)*this.seatPrice)}get seatTotalCost(){return Math.abs(this.adjustSubscriptionForm.value.newSeatCount*this.seatPrice)}get limitSubscription(){return this.adjustSubscriptionForm.value.limitSubscription}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}gi.ɵfac=function(t){return new(t||gi)(j.rXU(wt.W),j.rXU(Rt.X),j.rXU(gt.ok),j.rXU($t.f),j.rXU(c.k4),j.rXU(E.D))},gi.ɵcmp=j.VBU({type:gi,selectors:[["app-adjust-subscription"]],inputs:{organizationId:"organizationId",maxAutoscaleSeats:"maxAutoscaleSeats",currentSeatCount:"currentSeatCount",seatPrice:"seatPrice",interval:"interval"},outputs:{onAdjusted:"onAdjusted"},standalone:!1,decls:43,vars:49,consts:[[3,"formGroup","bitSubmit"],[1,"tw-grid","tw-grid-cols-12","tw-gap-4"],[1,"tw-col-span-8"],["bitInput","","formControlName","newSeatCount","type","number","min","0","step","1"],["bitCheckbox","","formControlName","limitSubscription","type","checkbox",3,"change"],[1,"tw-grid","tw-grid-cols-12","tw-gap-4","tw-mb-4",3,"hidden"],["bitInput","","formControlName","newMaxSeats","type","number","step","1",3,"min"],["bitButton","","buttonType","primary","bitFormButton","","type","submit"]],template:function(t,i){1&t&&(j.j41(0,"form",0)(1,"div",1)(2,"div",2)(3,"bit-form-field")(4,"bit-label"),j.EFF(5),j.nI1(6,"i18n"),j.k0s(),j.nrm(7,"input",3),j.j41(8,"bit-hint")(9,"strong"),j.EFF(10),j.nI1(11,"i18n"),j.k0s(),j.EFF(12),j.nI1(13,"currency"),j.nI1(14,"currency"),j.nI1(15,"i18n"),j.k0s()()()(),j.j41(16,"div")(17,"bit-form-control")(18,"input",4),j.bIt("change",function(){return i.limitSubscriptionChanged()}),j.k0s(),j.j41(19,"bit-label"),j.EFF(20),j.nI1(21,"i18n"),j.k0s(),j.j41(22,"bit-hint"),j.EFF(23),j.nI1(24,"i18n"),j.k0s()()(),j.j41(25,"div",5)(26,"div",2)(27,"bit-form-field")(28,"bit-label"),j.EFF(29),j.nI1(30,"i18n"),j.k0s(),j.nrm(31,"input",6),j.j41(32,"bit-hint")(33,"strong"),j.EFF(34),j.nI1(35,"i18n"),j.k0s(),j.EFF(36),j.nI1(37,"currency"),j.nI1(38,"currency"),j.nI1(39,"i18n"),j.k0s()()()(),j.j41(40,"button",7),j.EFF(41),j.nI1(42,"i18n"),j.k0s()()),2&t&&(j.Y8G("formGroup",i.adjustSubscriptionForm)("bitSubmit",i.submit),j.R7$(5),j.JRh(j.bMT(6,19,"subscriptionSeats")),j.R7$(5),j.SpI("",j.bMT(11,21,"total"),":"),j.R7$(2),j.LHq(" ",i.adjustSubscriptionForm.value.newSeatCount||0," × ",j.i5U(13,23,i.seatPrice,"$")," = ",j.i5U(14,26,i.seatTotalCost,"$")," / ",j.bMT(15,29,i.interval)),j.R7$(8),j.JRh(j.bMT(21,31,"limitSubscription")),j.R7$(3),j.SpI(" ",j.bMT(24,33,"limitSubscriptionDesc")),j.R7$(2),j.Y8G("hidden",!i.adjustSubscriptionForm.value.limitSubscription),j.R7$(4),j.JRh(j.bMT(30,35,"maxSeatLimit")),j.R7$(2),j.Y8G("min",null==i.adjustSubscriptionForm.value.newSeatCount?1:i.adjustSubscriptionForm.value.newSeatCount),j.R7$(3),j.SpI("",j.bMT(35,37,"maxSeatCost"),":"),j.R7$(2),j.LHq(" ",i.adjustSubscriptionForm.value.newMaxSeats||0," × ",j.i5U(37,39,i.seatPrice,"$")," = ",j.i5U(38,42,i.maxSeatTotal,"$")," / ",j.bMT(39,45,i.interval)),j.R7$(5),j.SpI(" ",j.bMT(42,47,"save")," "))},dependencies:[gt.qT,gt.me,gt.Q0,gt.Zm,gt.BC,gt.cb,gt.VZ,gt.j4,gt.JD,Gt.$,Mt.L,nt.Q,di.P,pi.f,jt.j,hi.I,Ct.J,Et.h,D.oe,X.$],encapsulation:2});n(69580);var mi=n(67372),vi=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};class fi{constructor(t){this.logService=t,this.onChanged=new j.bkB,this.onCanceled=new j.bkB}submit(){return vi(this,void 0,void 0,function*(){try{this.onChanged.emit()}catch(t){this.logService.error(t)}})}cancel(){this.onCanceled.emit()}}fi.ɵfac=function(t){return new(t||fi)(j.rXU(pt.K))},fi.ɵcmp=j.VBU({type:fi,selectors:[["app-change-plan"]],inputs:{organizationId:"organizationId",currentPlan:"currentPlan",preSelectedProductTier:"preSelectedProductTier"},outputs:{onChanged:"onChanged",onCanceled:"onCanceled"},standalone:!1,decls:11,vars:15,consts:[[1,"tw-relative","tw-flex","tw-flex-col","tw-min-w-0","tw-rounded","tw-border","tw-border-solid","tw-border-secondary-300"],[1,"tw-flex-auto","tw-p-5"],["bitIconButton","bwi-close","buttonType","main","type","button","size","small",1,"tw-float-right",3,"click","label"],["bitTypography","h2"],["bitTypography","body1",1,"tw-mb-0"],[3,"onCanceled","showFree","showCancel","organizationId","currentPlan","preSelectedProductTier"]],template:function(t,i){1&t&&(j.j41(0,"div",0)(1,"div",1)(2,"button",2),j.nI1(3,"i18n"),j.bIt("click",function(){return i.cancel()}),j.k0s(),j.j41(4,"h2",3),j.EFF(5),j.nI1(6,"i18n"),j.k0s(),j.j41(7,"p",4),j.EFF(8),j.nI1(9,"i18n"),j.k0s(),j.j41(10,"app-organization-plans",5),j.bIt("onCanceled",function(){return i.cancel()}),j.k0s()()()),2&t&&(j.R7$(2),j.Y8G("label",j.mNQ(j.bMT(3,9,"cancel"))),j.R7$(3),j.JRh(j.bMT(6,11,"changeBillingPlan")),j.R7$(3),j.JRh(j.bMT(9,13,"changeBillingPlanUpgrade")),j.R7$(2),j.Y8G("showFree",!1)("showCancel",!0)("organizationId",i.organizationId)("currentPlan",i.currentPlan)("preSelectedProductTier",i.preSelectedProductTier))},dependencies:[Bt.s,ci.r,mi.v,X.$],encapsulation:2});class Si{}var yi=n(68466),Ii=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};function wi(t,i){if(1&t&&(j.j41(0,"bit-form-field",1)(1,"bit-label"),j.EFF(2),j.nI1(3,"i18n"),j.k0s(),j.nrm(4,"input",9),j.j41(5,"bit-hint")(6,"strong"),j.EFF(7),j.nI1(8,"i18n"),j.k0s(),j.EFF(9),j.nI1(10,"currency"),j.nI1(11,"currency"),j.nI1(12,"i18n"),j.k0s()()),2&t){const t=j.XpG();j.R7$(2),j.JRh(j.bMT(3,7,"maxSeatLimit")),j.R7$(2),j.Y8G("min",t.formGroup.value.seatCount),j.R7$(3),j.SpI("",j.bMT(8,9,"maxSeatCost"),":"),j.R7$(2),j.LHq(" ",t.formGroup.value.maxAutoscaleSeats||0," × ",j.i5U(10,11,t.options.seatPrice,"$")," = ",j.i5U(11,14,t.maxSeatTotalCost,"$")," / ",j.bMT(12,17,t.options.interval)," ")}}function Ri(t,i){if(1&t&&(j.j41(0,"bit-form-field",1)(1,"bit-label"),j.EFF(2),j.nI1(3,"i18n"),j.k0s(),j.nrm(4,"input",10),j.j41(5,"bit-hint")(6,"div"),j.EFF(7),j.nI1(8,"i18n"),j.k0s(),j.j41(9,"strong"),j.EFF(10),j.nI1(11,"i18n"),j.k0s(),j.EFF(12),j.nI1(13,"currency"),j.nI1(14,"currency"),j.nI1(15,"i18n"),j.k0s()()),2&t){const t=j.XpG();j.R7$(2),j.JRh(j.bMT(3,8,"machineAccountLimit")),j.R7$(2),j.Y8G("min",t.formGroup.value.additionalServiceAccounts),j.R7$(3),j.SpI(" ",j.i5U(8,10,"includedMachineAccounts",t.options.baseServiceAccountCount)," "),j.R7$(3),j.SpI("",j.bMT(11,13,"maxMachineAccountCost"),":"),j.R7$(2),j.LHq(" ",t.maxAdditionalServiceAccounts," × ",j.i5U(13,15,t.options.additionalServiceAccountPrice,"$")," = ",j.i5U(14,18,t.maxServiceAccountTotalCost,"$")," / ",j.bMT(15,21,t.options.interval)," ")}}class $i{get monthlyServiceAccountPrice(){return"month"==this.options.interval?this.options.additionalServiceAccountPrice:this.options.additionalServiceAccountPrice/12}get serviceAccountTotalCost(){return Math.abs(this.formGroup.value.additionalServiceAccounts*this.options.additionalServiceAccountPrice)}get seatTotalCost(){return Math.abs(this.formGroup.value.seatCount*this.options.seatPrice)}get maxAdditionalServiceAccounts(){var t;const i=null!==(t=this.formGroup.value.maxAutoscaleServiceAccounts)&&void 0!==t?t:0;return Math.max(0,i-this.options.baseServiceAccountCount)}get maxServiceAccountTotalCost(){return this.maxAdditionalServiceAccounts*this.options.additionalServiceAccountPrice}get maxSeatTotalCost(){var t;return Math.abs((null!==(t=this.formGroup.value.maxAutoscaleSeats)&&void 0!==t?t:0)*this.options.seatPrice)}constructor(t,i,n,e,s,o,a){this.formBuilder=t,this.organizationApiService=i,this.i18nService=n,this.platformUtilsService=e,this.toastService=s,this.internalOrganizationService=o,this.accountService=a,this.onAdjusted=new j.bkB,this.destroy$=new m.B,this.formGroup=this.formBuilder.group({seatCount:[0,[gt.k0.required,gt.k0.min(1)]],limitSeats:[!1],maxAutoscaleSeats:[null],additionalServiceAccounts:[0,[gt.k0.required,gt.k0.min(0)]],limitServiceAccounts:[!1],maxAutoscaleServiceAccounts:[null]}),this.submit=()=>Ii(this,void 0,void 0,function*(){if(this.formGroup.markAllAsTouched(),this.formGroup.invalid)return;const t=new Si;t.seatAdjustment=this.formGroup.value.seatCount-this.options.seatCount,t.serviceAccountAdjustment=this.formGroup.value.additionalServiceAccounts-this.options.additionalServiceAccounts,t.maxAutoscaleSeats=this.formGroup.value.limitSeats?this.formGroup.value.maxAutoscaleSeats:null,t.maxAutoscaleServiceAccounts=this.formGroup.value.limitServiceAccounts?this.formGroup.value.maxAutoscaleServiceAccounts:null;const i=yield this.organizationApiService.updateSecretsManagerSubscription(this.organizationId,t),n=yield(0,p._)((0,R.F6)(this.accountService.activeAccount$)),e=yield(0,p._)(this.internalOrganizationService.organizations$(n).pipe((0,c.Sw)(this.organizationId))),s=new li.o(i,{isMember:e.isMember,isProviderUser:e.isProviderUser});yield this.internalOrganizationService.upsert(s,n),this.toastService.showToast({variant:"success",title:null,message:this.i18nService.t("subscriptionUpdated")}),this.onAdjusted.emit()})}ngOnInit(){this.formGroup.valueChanges.pipe((0,I.Q)(this.destroy$)).subscribe(t=>{const i=this.formGroup.controls.maxAutoscaleSeats,n=this.formGroup.controls.maxAutoscaleServiceAccounts;t.limitSeats?(i.setValidators([gt.k0.min(t.seatCount)]),i.enable({emitEvent:!1})):i.disable({emitEvent:!1}),t.limitServiceAccounts?(n.setValidators([gt.k0.min(t.additionalServiceAccounts+this.options.baseServiceAccountCount)]),n.enable({emitEvent:!1})):n.disable({emitEvent:!1})}),this.formGroup.patchValue({seatCount:this.options.seatCount,maxAutoscaleSeats:this.options.maxAutoscaleSeats,additionalServiceAccounts:this.options.additionalServiceAccounts,maxAutoscaleServiceAccounts:this.options.maxAutoscaleServiceAccounts,limitSeats:null!=this.options.maxAutoscaleSeats,limitServiceAccounts:null!=this.options.maxAutoscaleServiceAccounts})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}$i.ɵfac=function(t){return new(t||$i)(j.rXU(gt.ok),j.rXU(Rt.X),j.rXU(wt.W),j.rXU(It.y),j.rXU($t.f),j.rXU(c.k4),j.rXU(E.D))},$i.ɵcmp=j.VBU({type:$i,selectors:[["app-sm-adjust-subscription"]],inputs:{organizationId:"organizationId",options:"options"},outputs:{onAdjusted:"onAdjusted"},standalone:!1,decls:55,vars:67,consts:[[3,"formGroup","bitSubmit"],[1,"tw-w-2/3"],["bitInput","","id","smSeatCount","formControlName","seatCount","type","number","step","1","min","1"],["type","checkbox","bitCheckbox","","id","limitSmSeats","formControlName","limitSeats"],["class","tw-w-2/3",4,"ngIf"],["bitInput","","id","additionalServiceAccountCount","formControlName","additionalServiceAccounts","type","number","step","1","min","0"],["type","checkbox","bitCheckbox","","id","limitServiceAccounts","formControlName","limitServiceAccounts"],["type","submit","bitButton","","buttonType","primary","bitFormButton",""],[1,"tw-mt-2",3,"formGroup"],["bitInput","","id","smSeatLimit","formControlName","maxAutoscaleSeats","type","number","step","1",3,"min"],["bitInput","","id","additionalServiceAccountLimit","formControlName","maxAutoscaleServiceAccounts","type","number","step","1",3,"min"]],template:function(t,i){1&t&&(j.j41(0,"form",0)(1,"bit-form-field",1)(2,"bit-label"),j.EFF(3),j.nI1(4,"i18n"),j.k0s(),j.nrm(5,"input",2),j.j41(6,"bit-hint")(7,"strong"),j.EFF(8),j.nI1(9,"i18n"),j.k0s(),j.EFF(10),j.nI1(11,"currency"),j.nI1(12,"currency"),j.nI1(13,"i18n"),j.k0s()(),j.j41(14,"bit-form-control")(15,"bit-label"),j.EFF(16),j.nI1(17,"i18n"),j.k0s(),j.nrm(18,"input",3),j.j41(19,"bit-hint"),j.EFF(20),j.nI1(21,"i18n"),j.k0s()(),j.DNE(22,wi,13,19,"bit-form-field",4),j.j41(23,"bit-form-field",1)(24,"bit-label"),j.EFF(25),j.nI1(26,"i18n"),j.k0s(),j.nrm(27,"input",5),j.j41(28,"bit-hint")(29,"div"),j.EFF(30),j.nI1(31,"i18n"),j.nI1(32,"currency"),j.nI1(33,"i18n"),j.k0s(),j.j41(34,"div")(35,"strong"),j.EFF(36),j.nI1(37,"i18n"),j.k0s(),j.EFF(38),j.nI1(39,"currency"),j.nI1(40,"currency"),j.nI1(41,"i18n"),j.k0s()()(),j.j41(42,"bit-form-control")(43,"bit-label"),j.EFF(44),j.nI1(45,"i18n"),j.k0s(),j.nrm(46,"input",6),j.j41(47,"bit-hint"),j.EFF(48),j.nI1(49,"i18n"),j.k0s()(),j.DNE(50,Ri,16,23,"bit-form-field",4),j.j41(51,"button",7),j.EFF(52),j.nI1(53,"i18n"),j.k0s(),j.nrm(54,"bit-error-summary",8),j.k0s()),2&t&&(j.Y8G("formGroup",i.formGroup)("bitSubmit",i.submit),j.R7$(3),j.JRh(j.bMT(4,24,"subscriptionSeats")),j.R7$(5),j.SpI("",j.bMT(9,26,"total"),":"),j.R7$(2),j.LHq(" ",i.formGroup.value.seatCount||0," × ",j.i5U(11,28,i.options.seatPrice,"$")," = ",j.i5U(12,31,i.seatTotalCost,"$")," / ",j.bMT(13,34,i.options.interval)," "),j.R7$(6),j.JRh(j.bMT(17,36,"limitSubscription")),j.R7$(4),j.SpI(" ",j.bMT(21,38,"limitSmSubscriptionDesc")," "),j.R7$(2),j.Y8G("ngIf",i.formGroup.value.limitSeats),j.R7$(3),j.JRh(j.bMT(26,40,"additionalMachineAccounts")),j.R7$(5),j.Lme(" ",j.i5U(31,42,"includedMachineAccounts",i.options.baseServiceAccountCount)," ",j.i5U(33,48,"addAdditionalMachineAccounts",j.i5U(32,45,i.monthlyServiceAccountPrice,"$"))," "),j.R7$(6),j.SpI("",j.bMT(37,51,"total"),":"),j.R7$(2),j.LHq(" ",i.formGroup.value.additionalServiceAccounts||0," × ",j.i5U(39,53,i.options.additionalServiceAccountPrice,"$")," = ",j.i5U(40,56,i.serviceAccountTotalCost,"$")," / ",j.bMT(41,59,i.options.interval)," "),j.R7$(6),j.JRh(j.bMT(45,61,"limitMachineAccounts")),j.R7$(4),j.SpI(" ",j.bMT(49,63,"limitMachineAccountsDesc")," "),j.R7$(2),j.Y8G("ngIf",i.formGroup.value.limitServiceAccounts),j.R7$(2),j.SpI(" ",j.bMT(53,65,"save")," "),j.R7$(2),j.Y8G("formGroup",i.formGroup))},dependencies:[D.bT,gt.qT,gt.me,gt.Q0,gt.Zm,gt.BC,gt.cb,gt.VZ,gt.j4,gt.JD,Gt.$,Mt.L,nt.Q,di.P,pi.f,jt.j,hi.I,Ct.J,yi.L,Et.h,D.oe,X.$],encapsulation:2});n(84488);class Fi{}n(69138);var Ti=n(91517),Gi=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};function Mi(t,i){if(1&t&&(j.j41(0,"form",1),j.nrm(1,"sm-subscribe",2),j.k0s()),2&t){const t=j.XpG();j.Y8G("formGroup",t.formGroup)("bitSubmit",t.submit),j.R7$(),j.Y8G("formGroup",t.formGroup)("selectedPlan",t.plan)("upgradeOrganization",!1)("showSubmitButton",!0)("customerDiscount",t.customerDiscount)}}class Ai{constructor(t,i,n,e,s,o,r,c){this.apiService=t,this.formBuilder=i,this.platformUtilsService=n,this.i18nService=e,this.organizationApiService=s,this.organizationService=o,this.toastService=r,this.accountService=c,this.onSubscribe=new j.bkB,this.formGroup=(0,a.Fk)(this.formBuilder),this.submit=()=>Gi(this,void 0,void 0,function*(){const t=new Fi;t.additionalSmSeats=this.plan.SecretsManager.hasAdditionalSeatsOption?this.formGroup.value.userSeats:0,t.additionalServiceAccounts=this.plan.SecretsManager.hasAdditionalServiceAccountOption?this.formGroup.value.additionalServiceAccounts:0;const i=yield this.organizationApiService.subscribeToSecretsManager(this.organization.id,t),n=new li.o(i,{isMember:this.organization.isMember,isProviderUser:this.organization.isProviderUser}),e=yield(0,p._)((0,R.F6)(this.accountService.activeAccount$));yield this.organizationService.upsert(n,e),yield this.apiService.refreshIdentityToken(),this.toastService.showToast({variant:"success",title:null,message:this.i18nService.t("subscribedToSecretsManager")}),this.onSubscribe.emit()})}}function ki(t,i){if(1&t&&(j.j41(0,"button",5),j.EFF(1),j.nI1(2,"i18n"),j.k0s()),2&t){const t=j.XpG(2);j.Y8G("bitAction",t.requestReinstatement),j.R7$(),j.SpI(" ",j.bMT(2,2,"reinstateSubscription")," ")}}function xi(t,i){if(1&t&&(j.j41(0,"bit-callout",3)(1,"p"),j.EFF(2),j.k0s(),j.DNE(3,ki,3,4,"button",4),j.k0s()),2&t){const t=j.XpG();j.Y8G("type",t.data.callout.severity)("title",t.data.callout.header),j.R7$(2),j.JRh(t.data.callout.body),j.R7$(),j.Y8G("ngIf",t.data.callout.showReinstatementButton)}}function ji(t,i){if(1&t&&(j.qex(0),j.j41(1,"dt"),j.EFF(2),j.k0s(),j.j41(3,"dd")(4,"span",6),j.EFF(5),j.k0s()(),j.j41(6,"dt"),j.EFF(7),j.nI1(8,"titlecase"),j.k0s(),j.j41(9,"dd"),j.EFF(10),j.nI1(11,"date"),j.k0s(),j.bVm()),2&t){const t=j.XpG();j.R7$(2),j.JRh(t.data.status.label),j.R7$(3),j.SpI(" ",t.displayedStatus," "),j.R7$(2),j.SpI(" ",j.bMT(8,4,t.data.date.label)," "),j.R7$(3),j.SpI(" ",j.i5U(11,6,t.data.date.value,"mediumDate")," ")}}Ai.ɵfac=function(t){return new(t||Ai)(j.rXU(yt.G),j.rXU(gt.ok),j.rXU(It.y),j.rXU(wt.W),j.rXU(Rt.X),j.rXU(c.k4),j.rXU($t.f),j.rXU(E.D))},Ai.ɵcmp=j.VBU({type:Ai,selectors:[["sm-subscribe-standalone"]],inputs:{plan:"plan",organization:"organization",customerDiscount:"customerDiscount"},outputs:{onSubscribe:"onSubscribe"},standalone:!1,decls:1,vars:1,consts:[[3,"formGroup","bitSubmit",4,"ngIf"],[3,"formGroup","bitSubmit"],[3,"formGroup","selectedPlan","upgradeOrganization","showSubmitButton","customerDiscount"]],template:function(t,i){1&t&&j.DNE(0,Mi,2,7,"form",0),2&t&&j.Y8G("ngIf",i.plan)},dependencies:[D.bT,gt.qT,gt.cb,gt.j4,Mt.L,Ti.m],encapsulation:2});class Ci{constructor(t,i){this.datePipe=t,this.i18nService=i,this.reinstatementRequested=new j.bkB,this.requestReinstatement=()=>this.reinstatementRequested.emit()}get displayedStatus(){return this.subscription.items.some(t=>t.sponsoredSubscriptionItem)?this.i18nService.t("sponsored"):this.data.status.value}get planName(){return this.organizationSubscriptionResponse.plan.name}get status(){return this.subscription?"canceled"!=this.subscription.status&&this.subscription.cancelAtEndDate?"pending_cancellation":this.subscription.status:"free"}get subscription(){var t;return null===(t=this.organizationSubscriptionResponse)||void 0===t?void 0:t.subscription}get data(){const t=this.i18nService.t("status"),i=this.i18nService.t("nextCharge"),n=this.i18nService.t("subscriptionExpired"),e=this.i18nService.t("cancellationDate");switch(this.status){case"free":return{};case"trialing":return{status:{label:t,value:this.i18nService.t("trial")},date:{label:i,value:this.subscription.periodEndDate}};case"active":return{status:{label:t,value:this.i18nService.t("active")},date:{label:i,value:this.subscription.periodEndDate}};case"past_due":{const i=this.i18nService.t("pastDue"),e=this.datePipe.transform(this.subscription.suspensionDate,"mediumDate"),s="charge_automatically"===this.subscription.collectionMethod?this.i18nService.t("pastDueWarningForChargeAutomatically",this.subscription.gracePeriod,e):this.i18nService.t("pastDueWarningForSendInvoice",this.subscription.gracePeriod,e);return{status:{label:t,value:i},date:{label:n,value:this.subscription.unpaidPeriodEndDate},callout:{severity:"warning",header:i,body:s,showReinstatementButton:!1}}}case"unpaid":return{status:{label:t,value:this.i18nService.t("unpaid")},date:{label:n,value:this.subscription.unpaidPeriodEndDate},callout:{severity:"danger",header:this.i18nService.t("unpaidInvoice"),body:this.i18nService.t("toReactivateYourSubscription"),showReinstatementButton:!1}};case"pending_cancellation":{const i=this.i18nService.t("pendingCancellation");return{status:{label:t,value:i},date:{label:e,value:this.subscription.periodEndDate},callout:{severity:"warning",header:i,body:this.i18nService.t("subscriptionPendingCanceled"),showReinstatementButton:!0}}}case"incomplete_expired":case"canceled":{const i=this.i18nService.t("canceled");return{status:{label:t,value:i},date:{label:e,value:this.subscription.periodEndDate},callout:{severity:"danger",header:i,body:this.i18nService.t("subscriptionCanceled"),showReinstatementButton:!1}}}}}}Ci.ɵfac=function(t){return new(t||Ci)(j.rXU(D.vh),j.rXU(wt.W))},Ci.ɵcmp=j.VBU({type:Ci,selectors:[["app-subscription-status"]],inputs:{organizationSubscriptionResponse:"organizationSubscriptionResponse"},outputs:{reinstatementRequested:"reinstatementRequested"},standalone:!1,decls:9,vars:6,consts:[[3,"type","title",4,"ngIf"],[1,"tw-grid","tw-grid-flow-col","tw-grid-rows-2"],[4,"ngIf"],[3,"type","title"],["bitButton","","buttonType","secondary","type","button",3,"bitAction",4,"ngIf"],["bitButton","","buttonType","secondary","type","button",3,"bitAction"],[1,"tw-capitalize"]],template:function(t,i){1&t&&(j.qex(0),j.DNE(1,xi,4,4,"bit-callout",0),j.j41(2,"dl",1)(3,"dt"),j.EFF(4),j.nI1(5,"i18n"),j.k0s(),j.j41(6,"dd"),j.EFF(7),j.k0s(),j.DNE(8,ji,12,9,"ng-container",2),j.k0s(),j.bVm()),2&t&&(j.R7$(),j.Y8G("ngIf",i.data.callout),j.R7$(3),j.JRh(j.bMT(5,4,"billingPlan")),j.R7$(3),j.JRh(i.planName),j.R7$(),j.Y8G("ngIf",i.data.status&&i.data.date))},dependencies:[D.bT,Kt.p,nt.Q,At.G,D.PV,D.vh,X.$],encapsulation:2});var Ei=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};const Pi=t=>({"tw-pl-20":t}),Bi=t=>["/providers",t,"billing","subscription"];function Ui(t,i){1&t&&(j.qex(0),j.nrm(1,"i",7),j.nI1(2,"i18n"),j.j41(3,"span",8),j.EFF(4),j.nI1(5,"i18n"),j.k0s(),j.bVm()),2&t&&(j.R7$(),j.Y8G("title",j.mNQ(j.bMT(2,3,"loading"))),j.R7$(3),j.JRh(j.bMT(5,5,"loading")))}function zi(t,i){if(1&t){const t=j.RV6();j.j41(0,"app-subscription-status",11),j.bIt("reinstatementRequested",function(){C.eBV(t);const i=j.XpG(3);return C.Njj(i.reinstate())}),j.k0s()}if(2&t){const t=j.XpG(3);j.Y8G("organizationSubscriptionResponse",t.sub)}}function Di(t,i){if(1&t&&(j.j41(0,"span",16),j.EFF(1),j.nI1(2,"i18n"),j.k0s()),2&t){const t=j.XpG(4);j.R7$(),j.JRh(j.i5U(2,1,"providerDiscount",null==t.customerDiscount?null:t.customerDiscount.percentOff))}}function Xi(t,i){if(1&t&&(j.j41(0,"span"),j.EFF(1),j.nI1(2,"i18n"),j.k0s()),2&t){const t=j.XpG().$implicit;j.R7$(),j.SpI("",j.bMT(2,1,t.productName)," -")}}function Oi(t,i){1&t&&(j.qex(0),j.EFF(1),j.nI1(2,"i18n"),j.bVm()),2&t&&(j.R7$(),j.SpI(" ",j.bMT(2,1,"freeForOneYear")," "))}function Yi(t,i){if(1&t&&(j.j41(0,"span",23),j.EFF(1),j.nI1(2,"currency"),j.nI1(3,"i18n"),j.k0s()),2&t){const t=j.XpG(2).$implicit;j.R7$(),j.Lme("",j.i5U(2,2,t.quantity*t.originalAmount,"$")," / ",j.bMT(3,5,"year"))}}function Ni(t,i){if(1&t&&(j.j41(0,"div",21)(1,"span"),j.EFF(2),j.nI1(3,"currency"),j.nI1(4,"i18n"),j.k0s(),j.DNE(5,Yi,4,7,"span",22),j.k0s()),2&t){const t=j.XpG().$implicit,i=j.XpG(6);j.R7$(2),j.Lme(" ",j.i5U(3,3,t.quantity*t.amount,"$")," / ",j.bMT(4,6,t.interval)," "),j.R7$(3),j.Y8G("ngIf",(null==i.customerDiscount?null:i.customerDiscount.percentOff)&&i.discountAppliesToProduct(t.productId))}}function Vi(t,i){if(1&t&&(j.j41(0,"tr",18)(1,"td",19),j.DNE(2,Xi,3,3,"span",5),j.EFF(3),j.nI1(4,"currency"),j.k0s(),j.j41(5,"td",20),j.DNE(6,Oi,3,3,"ng-container",6)(7,Ni,6,8,"ng-template",null,2,j.C5r),j.k0s()()),2&t){const t=i.$implicit,n=j.sdS(8),e=j.XpG(6);j.R7$(),j.Y8G("ngClass",j.eq3(10,Pi,t.addonSubscriptionItem)),j.R7$(),j.Y8G("ngIf",!t.addonSubscriptionItem),j.R7$(),j.E5c(" ",t.name," ",t.quantity>1?"×"+t.quantity:""," @ ",j.i5U(4,7,t.amount,"$")," "),j.R7$(3),j.Y8G("ngIf",e.isSecretsManagerTrial()&&"passwordManager"===t.productName)("ngIfElse",n)}}function Li(t,i){if(1&t&&(j.qex(0),j.DNE(1,Vi,9,12,"tr",17),j.bVm()),2&t){const t=j.XpG(5);j.R7$(),j.Y8G("ngForOf",t.subscriptionLineItems)}}function qi(t,i){1&t&&(j.j41(0,"tr",18)(1,"td",25),j.EFF(2),j.nI1(3,"i18n"),j.nI1(4,"i18n"),j.k0s(),j.j41(5,"td",20),j.EFF(6),j.nI1(7,"i18n"),j.k0s()()),2&t&&(j.R7$(2),j.Lme("",j.bMT(3,3,"passwordManager")," - ",j.bMT(4,5,"freeOrganization")),j.R7$(4),j.JRh(j.bMT(7,7,"free")))}function Ji(t,i){1&t&&(j.j41(0,"tr",18)(1,"td",25),j.EFF(2),j.nI1(3,"i18n"),j.nI1(4,"i18n"),j.k0s(),j.j41(5,"td",20),j.EFF(6),j.nI1(7,"i18n"),j.k0s()()),2&t&&(j.R7$(2),j.Lme("",j.bMT(3,3,"secretsManager")," - ",j.bMT(4,5,"freeOrganization")),j.R7$(4),j.JRh(j.bMT(7,7,"free")))}function _i(t,i){if(1&t&&(j.qex(0),j.DNE(1,qi,8,9,"tr",24)(2,Ji,8,9,"tr",24),j.bVm()),2&t){const t=j.XpG(5);j.R7$(),j.Y8G("ngIf",t.userOrg.usePasswordManager),j.R7$(),j.Y8G("ngIf",t.userOrg.useSecretsManager)}}function Wi(t,i){if(1&t&&j.DNE(0,Li,2,1,"ng-container",5)(1,_i,3,2,"ng-container",5),2&t){const t=j.XpG(4);j.Y8G("ngIf",t.subscription&&!t.userOrg.isFreeOrg),j.R7$(),j.Y8G("ngIf",t.userOrg.isFreeOrg)}}function Zi(t,i){if(1&t&&(j.qex(0),j.j41(1,"div",12)(2,"strong",13),j.EFF(3),j.nI1(4,"i18n"),j.DNE(5,Di,3,4,"span",14),j.k0s(),j.j41(6,"bit-table"),j.DNE(7,Wi,2,2,"ng-template",15),j.k0s()(),j.bVm()),2&t){const t=j.XpG(3);j.R7$(3),j.SpI(" ",j.bMT(4,2,"details")," "),j.R7$(2),j.Y8G("ngIf",(null==t.customerDiscount?null:t.customerDiscount.percentOff)>0&&!t.isSecretsManagerTrial())}}function Hi(t,i){if(1&t){const t=j.RV6();j.j41(0,"button",29),j.bIt("click",function(){C.eBV(t);const i=j.XpG(4);return C.Njj(i.changePlan())}),j.EFF(1),j.nI1(2,"i18n"),j.k0s()}2&t&&(j.R7$(),j.SpI(" ",j.bMT(2,1,"changeBillingPlan")," "))}function Ki(t,i){if(1&t){const t=j.RV6();j.j41(0,"app-change-plan",30),j.bIt("onChanged",function(){C.eBV(t);const i=j.XpG(4);return C.Njj(i.closeChangePlan())})("onCanceled",function(){C.eBV(t);const i=j.XpG(4);return C.Njj(i.closeChangePlan())}),j.k0s()}if(2&t){const t=j.XpG(4);j.Y8G("organizationId",t.organizationId)("currentPlan",t.sub.plan)("preSelectedProductTier",t.preSelectedProductTier)}}function Qi(t,i){if(1&t&&(j.qex(0),j.j41(1,"div",26),j.DNE(2,Hi,3,3,"button",27)(3,Ki,1,3,"app-change-plan",28),j.k0s(),j.bVm()),2&t){const t=j.XpG(3);j.R7$(2),j.Y8G("ngIf",t.showChangePlanButton),j.R7$(),j.Y8G("ngIf",t.showChangePlan)}}function tn(t,i){if(1&t){const t=j.RV6();j.qex(0),j.j41(1,"div",31)(2,"sm-subscribe-standalone",32),j.bIt("onSubscribe",function(){C.eBV(t);const i=j.XpG(3);return C.Njj(i.subscriptionAdjusted())}),j.k0s()(),j.bVm()}if(2&t){const t=j.XpG(3);j.R7$(2),j.Y8G("plan",t.sub.plan)("organization",t.userOrg)("customerDiscount",t.customerDiscount)}}function nn(t,i){1&t&&(j.j41(0,"p",35),j.EFF(1),j.nI1(2,"i18n"),j.nI1(3,"i18n"),j.nI1(4,"i18n"),j.j41(5,"a",37),j.EFF(6),j.nI1(7,"i18n"),j.k0s()()),2&t&&(j.R7$(),j.E5c(" ",j.bMT(2,4,"smStandaloneTrialSeatCountUpdateMessageFragment1")," ",j.bMT(3,6,"passwordManager")," ",j.bMT(4,8,"smStandaloneTrialSeatCountUpdateMessageFragment2")," "),j.R7$(5),j.SpI("",j.bMT(7,10,"contactSupportShort"),". "))}function en(t,i){if(1&t){const t=j.RV6();j.qex(0),j.j41(1,"h3",38),j.EFF(2),j.nI1(3,"i18n"),j.k0s(),j.j41(4,"app-adjust-subscription",39),j.bIt("onAdjusted",function(){C.eBV(t);const i=j.XpG(4);return C.Njj(i.subscriptionAdjusted())}),j.k0s(),j.bVm()}if(2&t){const t=j.XpG(4);j.R7$(2),j.JRh(j.bMT(3,6,"passwordManager")),j.R7$(2),j.Y8G("seatPrice",t.seatPrice)("organizationId",t.organizationId)("interval",t.billingInterval)("currentSeatCount",t.seats)("maxAutoscaleSeats",t.maxAutoscaleSeats)}}function sn(t,i){if(1&t&&(j.j41(0,"button",40),j.EFF(1),j.nI1(2,"i18n"),j.k0s()),2&t){const t=j.XpG(4);j.Y8G("bitAction",t.removeSponsorship),j.R7$(),j.SpI(" ",j.bMT(2,2,"removeSponsorship")," ")}}function on(t,i){if(1&t&&(j.qex(0),j.j41(1,"div",43)(2,"div",44)(3,"button",45),j.EFF(4),j.nI1(5,"i18n"),j.k0s(),j.j41(6,"button",45),j.EFF(7),j.nI1(8,"i18n"),j.k0s()()(),j.bVm()),2&t){const t=j.XpG(5);j.R7$(3),j.Y8G("bitAction",t.adjustStorage(!0)),j.R7$(),j.SpI(" ",j.bMT(5,4,"addStorage")," "),j.R7$(2),j.Y8G("bitAction",t.adjustStorage(!1)),j.R7$(),j.SpI(" ",j.bMT(8,6,"removeStorage")," ")}}function an(t,i){if(1&t&&(j.qex(0),j.j41(1,"h4",41),j.EFF(2),j.nI1(3,"i18n"),j.k0s(),j.j41(4,"p",35),j.EFF(5),j.nI1(6,"i18n"),j.k0s(),j.nrm(7,"bit-progress",42),j.DNE(8,on,9,8,"ng-container",5),j.bVm()),2&t){const t=j.XpG(4);j.R7$(2),j.JRh(j.bMT(3,4,"storage")),j.R7$(3),j.SpI(" ",j.brH(6,6,"subscriptionStorage",t.sub.maxStorageGb||0,t.sub.storageName||"0 MB")," "),j.R7$(2),j.Y8G("barWidth",t.storagePercentage),j.R7$(),j.Y8G("ngIf",t.subscription&&!t.subscription.cancelled&&!t.subscriptionMarkedForCancel)}}function rn(t,i){if(1&t){const t=j.RV6();j.qex(0),j.j41(1,"h3",46),j.EFF(2),j.nI1(3,"i18n"),j.k0s(),j.j41(4,"app-sm-adjust-subscription",47),j.bIt("onAdjusted",function(){C.eBV(t);const i=j.XpG(4);return C.Njj(i.subscriptionAdjusted())}),j.k0s(),j.bVm()}if(2&t){const t=j.XpG(4);j.R7$(2),j.JRh(j.bMT(3,3,"secretsManager")),j.R7$(2),j.Y8G("organizationId",t.organizationId)("options",t.smOptions)}}function cn(t,i){if(1&t&&(j.qex(0),j.j41(1,"h2",33),j.EFF(2),j.nI1(3,"i18n"),j.k0s(),j.DNE(4,nn,8,12,"p",34),j.j41(5,"p",35),j.EFF(6),j.k0s(),j.DNE(7,en,5,8,"ng-container",5)(8,sn,3,4,"button",36)(9,an,9,10,"ng-container",5)(10,rn,5,5,"ng-container",5),j.bVm()),2&t){const t=j.XpG(3);j.R7$(2),j.JRh(j.bMT(3,7,"manageSubscription")),j.R7$(2),j.Y8G("ngIf","sm-standalone"===(null==t.customerDiscount?null:t.customerDiscount.id)),j.R7$(2),j.JRh(t.subscriptionDesc),j.R7$(),j.Y8G("ngIf",t.subscription&&t.canAdjustSeats&&!t.subscription.cancelled&&!t.subscriptionMarkedForCancel&&(!t.customerDiscount||"sm-standalone"!=t.customerDiscount.id)),j.R7$(),j.Y8G("ngIf",t.isSponsoredSubscription),j.R7$(),j.Y8G("ngIf",!t.customerDiscount||"sm-standalone"!=t.customerDiscount.id),j.R7$(),j.Y8G("ngIf",t.showAdjustSecretsManager)}}function ln(t,i){1&t&&j.eu8(0)}function un(t,i){if(1&t){const t=j.RV6();j.j41(0,"button",49),j.bIt("click",function(){C.eBV(t);const i=j.XpG(4);return C.Njj(i.cancelSubscription())}),j.EFF(1),j.nI1(2,"i18n"),j.k0s()}2&t&&(j.R7$(),j.SpI(" ",j.bMT(2,1,"cancelSubscription")," "))}function dn(t,i){if(1&t&&(j.qex(0),j.j41(1,"h2",33),j.EFF(2),j.nI1(3,"i18n"),j.k0s(),j.j41(4,"p",35),j.EFF(5),j.nI1(6,"i18n"),j.k0s(),j.j41(7,"div",44),j.DNE(8,un,3,3,"button",48),j.k0s(),j.bVm()),2&t){const t=j.XpG(3);j.R7$(2),j.JRh(j.bMT(3,3,"additionalOptions")),j.R7$(3),j.SpI(" ",j.bMT(6,5,"additionalOptionsDesc")," "),j.R7$(3),j.Y8G("ngIf",t.subscription&&!t.subscription.cancelled&&!t.subscriptionMarkedForCancel)}}function pn(t,i){if(1&t&&(j.qex(0),j.DNE(1,zi,1,1,"app-subscription-status",9)(2,Zi,8,4,"ng-container",5)(3,Qi,4,2,"ng-container",5)(4,tn,3,3,"ng-container",5)(5,cn,11,9,"ng-container",5)(6,ln,1,0,"ng-container",10)(7,dn,9,7,"ng-container",5),j.bVm()),2&t){const t=j.XpG(2),i=j.sdS(6);j.R7$(),j.Y8G("ngIf",!t.userOrg.isFreeOrg),j.R7$(),j.Y8G("ngIf",t.userOrg.canEditSubscription),j.R7$(),j.Y8G("ngIf",t.userOrg.canEditSubscription),j.R7$(),j.Y8G("ngIf",t.showSecretsManagerSubscribe),j.R7$(),j.Y8G("ngIf",t.userOrg.canEditSubscription),j.R7$(),j.Y8G("ngTemplateOutlet",i),j.R7$(),j.Y8G("ngIf",t.userOrg.canEditSubscription)}}function hn(t,i){if(1&t&&(j.j41(0,"bit-container"),j.DNE(1,pn,8,7,"ng-container",5),j.k0s()),2&t){const t=j.XpG();j.R7$(),j.Y8G("ngIf",t.sub&&!t.loading)}}function bn(t,i){if(1&t&&(j.j41(0,"p",35),j.EFF(1),j.nI1(2,"i18n"),j.j41(3,"a",52),j.EFF(4),j.nI1(5,"i18n"),j.k0s(),j.EFF(6,". "),j.k0s()),2&t){const t=j.XpG(4);j.R7$(),j.SpI(" ",j.bMT(2,3,"manageSubscriptionFromThe")," "),j.R7$(2),j.Y8G("routerLink",j.eq3(7,Bi,t.userOrg.providerId)),j.R7$(),j.JRh(j.bMT(5,5,"providerPortal"))}}function gn(t,i){if(1&t&&(j.j41(0,"p"),j.EFF(1),j.nI1(2,"i18n"),j.nI1(3,"i18n"),j.k0s()),2&t){const t=j.XpG(4);j.R7$(),j.Lme(" ",j.i5U(2,2,"billingManagedByProvider",t.userOrg.providerName),". ",j.bMT(3,5,"billingContactProviderForAssistance"),". ")}}function mn(t,i){1&t&&j.eu8(0)}function vn(t,i){if(1&t&&(j.qex(0),j.j41(1,"h2",50),j.EFF(2),j.nI1(3,"i18n"),j.k0s(),j.DNE(4,bn,7,9,"p",51)(5,gn,4,7,"ng-template",null,4,j.C5r)(7,mn,1,0,"ng-container",10),j.bVm()),2&t){const t=j.sdS(6),i=j.XpG(3),n=j.sdS(6);j.R7$(2),j.JRh(j.bMT(3,4,"manageSubscription")),j.R7$(2),j.Y8G("ngIf",i.userOrg.isProviderUser)("ngIfElse",t),j.R7$(3),j.Y8G("ngTemplateOutlet",n)}}function fn(t,i){if(1&t&&(j.j41(0,"div",53)(1,"div",54),j.nrm(2,"bit-svg",55),j.k0s(),j.j41(3,"p",56),j.EFF(4),j.nI1(5,"i18n"),j.k0s(),j.j41(6,"p"),j.EFF(7),j.nI1(8,"i18n"),j.k0s()()),2&t){const t=j.XpG(3);j.R7$(2),j.Y8G("content",t.gearIcon),j.R7$(2),j.JRh(j.i5U(5,3,"billingManagedByProvider",t.userOrg.providerName)),j.R7$(3),j.JRh(j.bMT(8,6,"billingContactProviderForAssistance"))}}function Sn(t,i){if(1&t&&(j.j41(0,"bit-container"),j.DNE(1,vn,8,6,"ng-container",6)(2,fn,9,8,"ng-template",null,3,j.C5r),j.k0s()),2&t){const t=j.sdS(3),i=j.XpG(2);j.R7$(),j.Y8G("ngIf",i.organizationIsManagedByConsolidatedBillingMSP)("ngIfElse",t)}}function yn(t,i){if(1&t&&j.DNE(0,Sn,4,2,"bit-container",5),2&t){const t=j.XpG();j.Y8G("ngIf",!t.loading)}}function In(t,i){if(1&t&&(j.qex(0),j.j41(1,"h2",33),j.EFF(2),j.nI1(3,"i18n"),j.k0s(),j.j41(4,"p",35),j.EFF(5),j.k0s(),j.bVm()),2&t){const t=j.XpG(2);j.R7$(2),j.JRh(j.bMT(3,2,"manageSubscription")),j.R7$(3),j.JRh(t.resellerSeatsRemainingMessage)}}function wn(t,i){if(1&t){const t=j.RV6();j.j41(0,"button",29),j.bIt("click",function(){C.eBV(t);const i=j.XpG(3);return C.Njj(i.manageBillingSync())}),j.EFF(1),j.nI1(2,"i18n"),j.k0s()}if(2&t){const t=j.XpG(3);j.R7$(),j.SpI(" ",j.bMT(2,1,t.hasBillingSyncToken?"viewBillingToken":"setUpBillingSync")," ")}}function Rn(t,i){if(1&t){const t=j.RV6();j.qex(0),j.j41(1,"h2",33),j.EFF(2),j.nI1(3,"i18n"),j.k0s(),j.j41(4,"p",35),j.EFF(5),j.nI1(6,"i18n"),j.k0s(),j.j41(7,"div",44)(8,"button",29),j.bIt("click",function(){C.eBV(t);const i=j.XpG(2);return C.Njj(i.downloadLicense())}),j.EFF(9),j.nI1(10,"i18n"),j.k0s(),j.DNE(11,wn,3,3,"button",27),j.k0s(),j.bVm()}if(2&t){const t=j.XpG(2);j.R7$(2),j.SpI(" ",j.bMT(3,4,"selfHostingTitleProper")," "),j.R7$(3),j.SpI(" ",j.bMT(6,6,"toHostBitwardenOnYourOwnServer")," "),j.R7$(4),j.SpI(" ",j.bMT(10,8,"downloadLicense")," "),j.R7$(2),j.Y8G("ngIf",t.canUseBillingSync)}}function $n(t,i){if(1&t&&j.DNE(0,In,6,4,"ng-container",5)(1,Rn,12,10,"ng-container",5),2&t){const t=j.XpG();j.Y8G("ngIf",t.userOrg.hasReseller&&t.resellerSeatsRemainingMessage),j.R7$(),j.Y8G("ngIf",t.showSelfHost)}}class Fn{constructor(t,i,n,e,s,o,a,r,c,l){this.apiService=t,this.i18nService=i,this.logService=n,this.organizationService=e,this.accountService=s,this.organizationApiService=o,this.route=a,this.dialogService=r,this.toastService=c,this.organizationUserApiService=l,this.lineItems=[],this.showChangePlan=!1,this.showAdjustSecretsManager=!1,this.showSecretsManagerSubscribe=!1,this.loading=!0,this.preSelectedProductTier=dt.K_.Free,this.showSubscription=!0,this.showSelfHost=!1,this.organizationIsManagedByConsolidatedBillingMSP=!1,this.gearIcon=ut,this.teamsStarter=dt.K_.TeamsStarter,this.destroy$=new m.B,this.cancelSubscription=()=>Ei(this,void 0,void 0,function*(){const t=(0,bt.GM)(this.dialogService,{data:{type:"Organization",id:this.organizationId,plan:this.sub.plan.type}});(yield(0,v.s)(t.closed))!==bt.vD.Closed&&(yield this.load())}),this.reinstate=()=>Ei(this,void 0,void 0,function*(){if(this.loading)return;if(yield this.dialogService.openSimpleDialog({title:{key:"reinstateSubscription"},content:{key:"reinstateConfirmation"},type:"warning"}))try{yield this.organizationApiService.reinstate(this.organizationId),this.toastService.showToast({variant:"success",title:null,message:this.i18nService.t("reinstated")}),yield this.load()}catch(t){this.logService.error(t)}}),this.adjustStorage=t=>()=>Ei(this,void 0,void 0,function*(){const i=ht.A.open(this.dialogService,{data:{price:this.storageGbPrice,cadence:this.billingInterval,type:t?"Add":"Remove",organizationId:this.organizationId}});(yield(0,v.s)(i.closed))===ht.W.Submitted&&(yield this.load())}),this.removeSponsorship=()=>Ei(this,void 0,void 0,function*(){if(yield this.dialogService.openSimpleDialog({title:{key:"removeSponsorship"},content:{key:"removeSponsorshipConfirmation"},acceptButtonText:{key:"remove"},type:"warning"}))try{yield this.apiService.deleteRemoveSponsorship(this.organizationId),this.toastService.showToast({variant:"success",title:null,message:this.i18nService.t("removeSponsorshipSuccess")}),yield this.load()}catch(t){this.logService.error(t)}}),this.discountPrice=(t,i=null)=>{var n;return t-(!(null===(n=this.customerDiscount)||void 0===n?void 0:n.active)||i&&this.customerDiscount.appliesTo.length&&!this.customerDiscount.appliesTo.includes(i)?0:t*(this.customerDiscount.percentOff/100))}}ngOnInit(){return Ei(this,void 0,void 0,function*(){if(this.organizationId=this.route.snapshot.params[Fn.ROUTE_PARAM_ORGANIZATION_ID],yield this.load(),this.route.snapshot.queryParams[Fn.QUERY_PARAM_UPGRADE]){yield this.changePlan();const t=this.route.snapshot.queryParamMap.get("productTierType");if(null!=t){const i=Number(t);Object.values(dt.K_).includes(i)&&(this.preSelectedProductTier=i)}}if(this.userOrg.hasReseller){const t=(yield this.organizationUserApiService.getAllUsers(this.userOrg.id)).data.filter(t=>[Z.Zx.Invited,Z.Zx.Accepted,Z.Zx.Confirmed].includes(t.status)).length,i=this.userOrg.seats-t,n=this.i18nService.t("seatsRemaining",i.toString(),this.userOrg.seats.toString());this.resellerSeatsRemainingMessage=n}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}load(){return Ei(this,void 0,void 0,function*(){var t,i,n,e,s,o,a,r,l;this.loading=!0,this.locale=yield(0,p._)(this.i18nService.locale$);const u=yield(0,p._)((0,R.F6)(this.accountService.activeAccount$));this.userOrg=yield(0,p._)(this.organizationService.organizations$(u).pipe((0,c.Sw)(this.organizationId)));const d=!this.userOrg.hasProvider&&this.userOrg.isOwner,h=this.userOrg.hasReseller&&this.userOrg.isOwner,b=this.userOrg.hasProvider&&this.userOrg.isProviderUser;this.organizationIsManagedByConsolidatedBillingMSP=this.userOrg.hasProvider&&this.userOrg.hasBillableProvider,this.showSubscription=d||h||b&&!this.organizationIsManagedByConsolidatedBillingMSP,this.showSelfHost=this.userOrg.productTierType===dt.K_.Families||this.userOrg.productTierType===dt.K_.Enterprise,this.showSubscription&&(this.sub=yield this.organizationApiService.getSubscription(this.organizationId),this.lineItems=null===(i=null===(t=this.sub)||void 0===t?void 0:t.subscription)||void 0===i?void 0:i.items,this.lineItems&&this.lineItems.length&&(this.lineItems=this.lineItems.map(t=>{var i,n;const e=t.amount*t.quantity,s=(null===(n=null===(i=this.sub.plan)||void 0===i?void 0:i.SecretsManager)||void 0===n?void 0:n.seatPrice)*t.quantity;return t.productName=e===s||t.name.includes("Service Accounts")?"secretsManager":"passwordManager",t}).sort(Tn)),100==(null===(e=null===(n=this.sub)||void 0===n?void 0:n.customerDiscount)||void 0===e?void 0:e.percentOff)&&this.lineItems.reverse());const g=yield this.organizationApiService.getApiKeyInformation(this.organizationId);this.hasBillingSyncToken=g.data.some(t=>t.keyType===Z.pC.BillingSync),this.showSecretsManagerSubscribe=this.userOrg.canEditSubscription&&!this.userOrg.hasProvider&&(null===(o=null===(s=this.sub)||void 0===s?void 0:s.plan)||void 0===o?void 0:o.SecretsManager)&&!this.userOrg.useSecretsManager&&!(null===(a=this.subscription)||void 0===a?void 0:a.cancelled)&&!this.subscriptionMarkedForCancel,this.showAdjustSecretsManager=this.userOrg.canEditSubscription&&this.userOrg.useSecretsManager&&null!=this.subscription&&(null===(l=null===(r=this.sub.plan)||void 0===r?void 0:r.SecretsManager)||void 0===l?void 0:l.hasAdditionalSeatsOption)&&!this.subscription.cancelled&&!this.subscriptionMarkedForCancel,this.loading=!1})}get subscription(){return null!=this.sub?this.sub.subscription:null}get subscriptionLineItems(){return this.lineItems.map(t=>({name:t.name,originalAmount:t.amount,amount:this.discountPrice(t.amount,t.productId),quantity:t.quantity,interval:t.interval,sponsoredSubscriptionItem:t.sponsoredSubscriptionItem,addonSubscriptionItem:t.addonSubscriptionItem,productName:t.productName,productId:t.productId}))}get nextInvoice(){return null!=this.sub?this.sub.upcomingInvoice:null}get customerDiscount(){return null!=this.sub?this.sub.customerDiscount:null}get isExpired(){const t=this.nextInvoice;return null!=t&&new Date(t.date).getTime()<Date.now()}get storagePercentage(){return null!=this.sub&&this.sub.maxStorageGb?+(this.sub.storageGb/this.sub.maxStorageGb*100).toFixed(2):0}get billingInterval(){return!this.sub.plan.isAnnual?"month":"year"}get storageGbPrice(){return this.sub.plan.PasswordManager.additionalStoragePricePerGb}get seatPrice(){return this.discountPrice(this.sub.plan.PasswordManager.seatPrice)}get seats(){return this.sub.seats}get smOptions(){return{seatCount:this.sub.smSeats,maxAutoscaleSeats:this.sub.maxAutoscaleSmSeats,seatPrice:this.sub.plan.SecretsManager.seatPrice,maxAutoscaleServiceAccounts:this.sub.maxAutoscaleSmServiceAccounts,additionalServiceAccounts:this.sub.smServiceAccounts-this.sub.plan.SecretsManager.baseServiceAccount,interval:this.sub.plan.isAnnual?"year":"month",additionalServiceAccountPrice:this.sub.plan.SecretsManager.additionalPricePerServiceAccount,baseServiceAccountCount:this.sub.plan.SecretsManager.baseServiceAccount}}get maxAutoscaleSeats(){return this.sub.maxAutoscaleSeats}get canAdjustSeats(){return this.sub.plan.PasswordManager.hasAdditionalSeatsOption}get isSponsoredSubscription(){var t;return null===(t=this.sub.subscription)||void 0===t?void 0:t.items.some(t=>t.sponsoredSubscriptionItem)}get subscriptionDesc(){if(this.sub.planType===dt.OL.Free)return this.i18nService.t("subscriptionFreePlan",this.sub.seats.toString());if(this.sub.planType===dt.OL.FamiliesAnnually||this.sub.planType===dt.OL.FamiliesAnnually2025||this.sub.planType===dt.OL.FamiliesAnnually2019||this.sub.planType===dt.OL.TeamsStarter2023||this.sub.planType===dt.OL.TeamsStarter)return this.isSponsoredSubscription?this.i18nService.t("subscriptionSponsoredFamiliesPlan",this.sub.seats.toString()):this.i18nService.t("subscriptionUpgrade",this.sub.seats.toString());if(this.sub.maxAutoscaleSeats===this.sub.seats&&null!=this.sub.seats){const t=this.sub.plan.isAnnual?"annualSubscriptionUserSeatsMessage":"monthlySubscriptionUserSeatsMessage";return this.i18nService.t(t+"subscriptionSeatMaxReached",this.sub.seats.toString())}if(this.userOrg.productTierType===dt.K_.TeamsStarter)return this.i18nService.t("subscriptionUserSeatsWithoutAdditionalSeatsOption",10);if(null==this.sub.maxAutoscaleSeats){const t=this.sub.plan.isAnnual?"annualSubscriptionUserSeatsMessage":"monthlySubscriptionUserSeatsMessage";return this.i18nService.t(t)}{const t=this.sub.plan.isAnnual?"annualSubscriptionUserSeatsMessage":"monthlySubscriptionUserSeatsMessage";return this.i18nService.t(t,this.sub.maxAutoscaleSeats.toString())}}get subscriptionMarkedForCancel(){return null!=this.subscription&&!this.subscription.cancelled&&this.subscription.cancelAtEndDate}changePlan(){return Ei(this,void 0,void 0,function*(){const t=(0,Wt.IO)(this.dialogService,{data:{organizationId:this.organizationId,subscription:this.sub,productTierType:this.userOrg.productTierType}});(yield(0,v.s)(t.closed))!==Wt.d1.Closed&&(yield this.load())})}isSecretsManagerTrial(){var t,i,n,e,s,o;const a="sm-standalone"===(null===(i=null===(t=this.sub)||void 0===t?void 0:t.customerDiscount)||void 0===i?void 0:i.id),r=null!==(o=null===(s=null===(e=null===(n=this.sub)||void 0===n?void 0:n.subscription)||void 0===e?void 0:e.items)||void 0===s?void 0:s.some(t=>this.discountAppliesToProduct(t.productId)))&&void 0!==o&&o;return a&&r}discountAppliesToProduct(t){var i,n,e,s;return null!==(s=null===(e=null===(n=null===(i=this.sub)||void 0===i?void 0:i.customerDiscount)||void 0===n?void 0:n.appliesTo)||void 0===e?void 0:e.includes(t))&&void 0!==s&&s}closeChangePlan(){this.showChangePlan=!1}downloadLicense(){return Ei(this,void 0,void 0,function*(){ii.open(this.dialogService,{data:{organizationId:this.organizationId}})})}manageBillingSync(){return Ei(this,void 0,void 0,function*(){const t=Jt.open(this.dialogService,{organizationId:this.organizationId,hasBillingToken:this.hasBillingSyncToken});yield(0,p._)(t.closed),yield this.load()})}subscriptionAdjusted(){return Ei(this,void 0,void 0,function*(){yield this.load()})}get showChangePlanButton(){var t,i;return!this.showChangePlan&&this.sub.plan.productTier!==dt.K_.Enterprise&&!(null===(t=this.sub.subscription)||void 0===t?void 0:t.cancelled)||(null===(i=this.sub.subscription)||void 0===i?void 0:i.cancelled)&&this.sub.plan.productTier===dt.K_.Free}get canUseBillingSync(){return this.userOrg.productTierType===dt.K_.Enterprise}}function Tn(t,i){return t.productName==i.productName?t.addonSubscriptionItem==i.addonSubscriptionItem?0:t.addonSubscriptionItem?1:-1:t.productName.localeCompare(i.productName)}Fn.QUERY_PARAM_UPGRADE="upgrade",Fn.ROUTE_PARAM_ORGANIZATION_ID="organizationId",Fn.ɵfac=function(t){return new(t||Fn)(j.rXU(yt.G),j.rXU(wt.W),j.rXU(pt.K),j.rXU(c.PV),j.rXU(E.D),j.rXU(Rt.X),j.rXU(P.nX),j.rXU(B.o3),j.rXU($t.f),j.rXU(lt.uB))},Fn.ɵcmp=j.VBU({type:Fn,selectors:[["ng-component"]],standalone:!1,decls:7,vars:3,consts:[["hideSubscription",""],["setupSelfHost",""],["calculateElse",""],["organizationIsNotManagedByConsolidatedBillingMSP",""],["isOrganizationOwner",""],[4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"bwi","bwi-spinner","bwi-spin","tw-text-muted",3,"title"],[1,"tw-sr-only"],[3,"organizationSubscriptionResponse","reinstatementRequested",4,"ngIf"],[4,"ngTemplateOutlet"],[3,"reinstatementRequested","organizationSubscriptionResponse"],[1,"tw-flex-col"],[1,"tw-flex","tw-items-center","tw-gap-3","tw-border-0","tw-border-b","tw-border-solid","tw-border-secondary-300","tw-pb-2"],["bitBadge","","variant","success","class","tw-inline-flex tw-items-center",4,"ngIf"],["body",""],["bitBadge","","variant","success",1,"tw-inline-flex","tw-items-center"],["bitRow","",4,"ngFor","ngForOf"],["bitRow",""],["bitCell","",1,"tw-align-middle",3,"ngClass"],["bitCell","",1,"tw-text-right"],[1,"tw-flex","tw-flex-col"],["class","tw-line-through !tw-text-muted",4,"ngIf"],[1,"tw-line-through","!tw-text-muted"],["bitRow","",4,"ngIf"],["bitCell",""],[1,"tw-mt-5"],["bitButton","","buttonType","secondary","type","button",3,"click",4,"ngIf"],[3,"organizationId","currentPlan","preSelectedProductTier","onChanged","onCanceled",4,"ngIf"],["bitButton","","buttonType","secondary","type","button",3,"click"],[3,"onChanged","onCanceled","organizationId","currentPlan","preSelectedProductTier"],[1,"tw-mt-7"],[3,"onSubscribe","plan","organization","customerDiscount"],["bitTypography","h2",1,"tw-mt-7"],["bitTypography","body1",4,"ngIf"],["bitTypography","body1"],["bitButton","","buttonType","danger","type","button",3,"bitAction",4,"ngIf"],["href","https://bitwarden.com/contact/","target","_blank","rel","noreferrer"],["bitTypography","h3",1,"tw-mt-7"],[3,"onAdjusted","seatPrice","organizationId","interval","currentSeatCount","maxAutoscaleSeats"],["bitButton","","buttonType","danger","type","button",3,"bitAction"],["bitTypography","h4",1,"tw-mt-9"],["bgColor","success",3,"barWidth"],[1,"tw-mt-3"],[1,"tw-flex","tw-space-x-2"],["bitButton","","buttonType","secondary","type","button",3,"bitAction"],["bitTypography","h3",1,"tw-mt-9"],[3,"onAdjusted","organizationId","options"],["bitButton","","buttonType","danger","type","button",3,"click",4,"ngIf"],["bitButton","","buttonType","danger","type","button",3,"click"],["bitTypography","h2"],["bitTypography","body1",4,"ngIf","ngIfElse"],[3,"routerLink"],[1,"tw-flex","tw-flex-col","tw-items-center","tw-text-info"],[1,"tw-size-56","tw-content-center"],["aria-hidden","true",3,"content"],[1,"tw-font-medium"]],template:function(t,i){if(1&t&&(j.nrm(0,"app-header"),j.DNE(1,Ui,6,7,"ng-container",5)(2,hn,2,1,"bit-container",6)(3,yn,1,1,"ng-template",null,0,j.C5r)(5,$n,2,2,"ng-template",null,1,j.C5r)),2&t){const t=j.sdS(4);j.R7$(),j.Y8G("ngIf",i.loading),j.R7$(),j.Y8G("ngIf",i.showSubscription)("ngIfElse",t)}},dependencies:[r.Wk,D.YU,D.Sq,D.bT,D.T3,Kt.p,ni.n,nt.Q,z.H,ei.k,si.X,oi.Q,ai.Y,ri._,ri.O,ci.r,U.f,gi,fi,$i,Ai,Ci,D.oe,X.$],encapsulation:2});var Gn=n(20702);class Mn extends Gn.r{constructor(t){if(super(t),null==t)return;this.billingSyncKey=this.getResponseProperty("BillingSyncKey");const i=this.getResponseProperty("LastLicenseSync");i&&(this.lastLicenseSync=new Date(i))}}class An{constructor(t){null!=t&&(this.planName=t.plan.name,this.expirationWithGracePeriod=null!=t.expiration?new Date(t.expiration):null,this.expirationWithoutGracePeriod=null!=t.expirationWithoutGracePeriod?new Date(t.expirationWithoutGracePeriod):null)}get hasSeparateGracePeriod(){return null!=this.expirationWithGracePeriod&&null!=this.expirationWithoutGracePeriod}get hasExpiration(){return null!=this.expirationWithGracePeriod}get isExpiredWithoutGracePeriod(){return this.hasSeparateGracePeriod&&this.expirationWithoutGracePeriod<new Date}get isExpiredAndOutsideGracePeriod(){return this.hasExpiration&&this.expirationWithGracePeriod<new Date}get isInTrial(){return this.expirationWithGracePeriod&&this.expirationWithoutGracePeriod&&this.expirationWithGracePeriod.getTime()===this.expirationWithoutGracePeriod.getTime()}}var kn=n(29377),xn=n(83516);class jn{constructor(t,i,n,e){this.organizationId=t,this.type=i,this.enabled=n,this.config=e}}class Cn{constructor(t){this.billingSyncKey=t}}var En=n(49519),Pn=n(57083),Bn=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};class Un{constructor(t,i,n,e){this.dialogRef=t,this.data=i,this.apiService=n,this.logService=e,this.submit=()=>Bn(this,void 0,void 0,function*(){var t;try{const i=new jn(this.entityId,Z.eH.CloudBillingSync,!0,new Cn(this.formGroup.value.billingSyncKey)),n=null==this.existingConnectionId?yield this.apiService.createOrganizationConnection(i,Mn):yield this.apiService.updateOrganizationConnection(i,Mn,this.existingConnectionId);this.existingConnectionId=null==n?void 0:n.id,this.billingSyncKey=null===(t=null==n?void 0:n.config)||void 0===t?void 0:t.billingSyncKey,this.setParentConnection(n),this.dialogRef.close()}catch(i){this.logService.error(i)}}),this.deleteConnection=()=>Bn(this,void 0,void 0,function*(){yield this.apiService.deleteOrganizationConnection(this.existingConnectionId),this.setParentConnection(null),this.dialogRef.close()}),this.entityId=i.entityId,this.existingConnectionId=i.existingConnectionId,this.billingSyncKey=i.billingSyncKey,this.setParentConnection=i.setParentConnection,this.formGroup=new gt.gE({billingSyncKey:new gt.MJ(this.billingSyncKey,gt.k0.required)})}static open(t,i){return t.open(Un,{data:i})}}Un.ɵfac=function(t){return new(t||Un)(j.rXU(B.ce),j.rXU(ft.Qs),j.rXU(yt.G),j.rXU(pt.K))},Un.ɵcmp=j.VBU({type:Un,selectors:[["ng-component"]],standalone:!1,decls:23,vars:22,consts:[[3,"formGroup","bitSubmit"],["bitDialogTitle",""],["bitDialogContent",""],["bitInput","","id","billingSyncKey","type","text","formControlName","billingSyncKey","appAutofocus","","appInputVerbatim",""],["bitDialogFooter",""],["type","submit","bitButton","","bitFormButton","","buttonType","primary"],["bitButton","","bitDialogClose","","type","button"],["type","button","buttonType","danger","bitIconButton","bwi-trash","bitFormButton","",1,"tw-ml-auto",3,"bitAction","label"]],template:function(t,i){1&t&&(j.j41(0,"form",0)(1,"bit-dialog")(2,"span",1),j.EFF(3),j.nI1(4,"i18n"),j.k0s(),j.j41(5,"div",2)(6,"p"),j.EFF(7),j.nI1(8,"i18n"),j.k0s(),j.j41(9,"bit-form-field")(10,"bit-label"),j.EFF(11),j.nI1(12,"i18n"),j.k0s(),j.nrm(13,"input",3),j.k0s()(),j.qex(14,4),j.j41(15,"button",5),j.EFF(16),j.nI1(17,"i18n"),j.k0s(),j.j41(18,"button",6),j.EFF(19),j.nI1(20,"i18n"),j.k0s(),j.nrm(21,"button",7),j.nI1(22,"i18n"),j.bVm(),j.k0s()()),2&t&&(j.Y8G("formGroup",i.formGroup)("bitSubmit",i.submit),j.R7$(3),j.SpI(" ",j.bMT(4,10,"manageBillingTokenSync")," "),j.R7$(4),j.JRh(j.bMT(8,12,"billingSyncKeyDesc")),j.R7$(4),j.SpI(" ",j.bMT(12,14,"billingSyncKey")," "),j.R7$(5),j.SpI(" ",j.bMT(17,16,"save")," "),j.R7$(3),j.SpI(" ",j.bMT(20,18,"cancel")," "),j.R7$(2),j.Y8G("label",j.mNQ(j.bMT(22,20,"delete")))("bitAction",i.deleteConnection))},dependencies:[gt.qT,gt.me,gt.BC,gt.cb,gt.j4,gt.JD,En.B,Pn.q,Kt.p,Gt.$,Mt.L,nt.Q,kt.I,xt.m,jt.j,Ct.J,Et.h,Bt.s,X.$],encapsulation:2});var zn=n(24374),Dn=n(17721),Xn=n(13583);class On{constructor(){this.gearIcon=ut}}On.ɵfac=function(t){return new(t||On)},On.ɵcmp=j.VBU({type:On,selectors:[["app-org-subscription-hidden"]],inputs:{providerName:"providerName"},standalone:!1,decls:9,vars:8,consts:[[1,"tw-flex","tw-flex-col","tw-items-center","tw-text-info"],[1,"tw-size-56","tw-content-center"],["aria-hidden","true",3,"content"],[1,"tw-font-medium"]],template:function(t,i){1&t&&(j.j41(0,"div",0)(1,"div",1),j.nrm(2,"bit-svg",2),j.k0s(),j.j41(3,"p",3),j.EFF(4),j.nI1(5,"i18n"),j.k0s(),j.j41(6,"p"),j.EFF(7),j.nI1(8,"i18n"),j.k0s()()),2&t&&(j.R7$(2),j.Y8G("content",i.gearIcon),j.R7$(2),j.JRh(j.i5U(5,3,"billingManagedByProvider",i.providerName)),j.R7$(3),j.JRh(j.bMT(8,6,"billingContactProviderForAssistance")))},dependencies:[ei.k,X.$],encapsulation:2});var Yn=function(t,i,n,e){return new(n||(n=Promise))(function(s,o){function a(t){try{c(e.next(t))}catch(i){o(i)}}function r(t){try{c(e.throw(t))}catch(i){o(i)}}function c(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,r)}c((e=e.apply(t,i||[])).next())})};const Nn=t=>({"tw-text-danger":t});function Vn(t,i){1&t&&(j.qex(0),j.nrm(1,"i",2),j.nI1(2,"i18n"),j.j41(3,"span",3),j.EFF(4),j.nI1(5,"i18n"),j.k0s(),j.bVm()),2&t&&(j.R7$(),j.Y8G("title",j.mNQ(j.bMT(2,3,"loading"))),j.R7$(3),j.JRh(j.bMT(5,5,"loading")))}function Ln(t,i){if(1&t&&j.nrm(0,"app-org-subscription-hidden",4),2&t){const t=j.XpG();j.Y8G("providerName",t.userOrg.providerName)}}function qn(t,i){if(1&t&&(j.qex(0),j.j41(1,"dt"),j.EFF(2),j.nI1(3,"i18n"),j.k0s(),j.j41(4,"dd"),j.EFF(5),j.nI1(6,"date"),j.nI1(7,"i18n"),j.k0s(),j.bVm()),2&t){const t=j.XpG(2);j.R7$(2),j.JRh(j.bMT(3,2,"lastLicenseSync")),j.R7$(3),j.SpI(" ",null!=t.lastLicenseSync?j.i5U(6,4,t.lastLicenseSync,"medium"):j.bMT(7,7,"never")," ")}}function Jn(t,i){if(1&t&&(j.j41(0,"div",17),j.EFF(1),j.nI1(2,"date"),j.nI1(3,"i18n"),j.k0s()),2&t){const t=j.XpG(3);j.R7$(),j.SpI(" ",j.i5U(3,4,"selfHostGracePeriodHelp",j.i5U(2,1,t.subscription.expirationWithGracePeriod,"mediumDate"))," ")}}function _n(t,i){if(1&t&&(j.j41(0,"dd",6),j.EFF(1),j.nI1(2,"date"),j.DNE(3,Jn,4,7,"div",16),j.k0s()),2&t){const t=j.XpG(2);j.Y8G("ngClass",j.eq3(6,Nn,t.showAsExpired)),j.R7$(),j.SpI(" ",j.i5U(2,3,t.subscription.hasSeparateGracePeriod?t.subscription.expirationWithoutGracePeriod:t.subscription.expirationWithGracePeriod,"mediumDate")," "),j.R7$(2),j.Y8G("ngIf",t.subscription.hasSeparateGracePeriod&&!t.subscription.isInTrial)}}function Wn(t,i){1&t&&(j.j41(0,"dd"),j.EFF(1),j.nI1(2,"i18n"),j.k0s()),2&t&&(j.R7$(),j.JRh(j.bMT(2,1,"neverExpires")))}function Zn(t,i){if(1&t&&(j.j41(0,"bit-radio-button",18)(1,"bit-label"),j.EFF(2),j.nI1(3,"i18n"),j.j41(4,"a",19),j.nrm(5,"i",8),j.j41(6,"span",3),j.EFF(7),j.nI1(8,"i18n"),j.k0s()()(),j.j41(9,"bit-hint"),j.EFF(10),j.nI1(11,"i18n"),j.k0s()()),2&t){const t=j.XpG(2);j.Y8G("value",t.licenseOptions.SYNC)("disabled",t.disableLicenseSyncControl),j.R7$(2),j.SpI("",j.bMT(3,5,"automaticSync")," "),j.R7$(5),j.JRh(j.bMT(8,7,"billingSyncHelp")),j.R7$(3),j.SpI(" ",j.bMT(11,9,"automaticBillingSyncDesc")," ")}}function Hn(t,i){if(1&t){const t=j.RV6();j.qex(0),j.j41(1,"div",20)(2,"button",21),j.bIt("click",function(){C.eBV(t);const i=j.XpG(2);return C.Njj(i.manageBillingSyncSelfHosted())}),j.EFF(3),j.nI1(4,"i18n"),j.k0s(),j.j41(5,"button",22),j.EFF(6),j.nI1(7,"i18n"),j.k0s()(),j.bVm()}if(2&t){const t=j.XpG(2);j.R7$(3),j.SpI(" ",j.bMT(4,4,"manageBillingTokenSync")," "),j.R7$(2),j.Y8G("bitAction",t.syncLicense)("disabled",!t.billingSyncEnabled),j.R7$(),j.SpI(" ",j.bMT(7,6,"syncLicense")," ")}}function Kn(t,i){if(1&t&&(j.j41(0,"bit-radio-button",23)(1,"bit-label"),j.EFF(2),j.nI1(3,"i18n"),j.k0s(),j.j41(4,"bit-hint"),j.EFF(5),j.nI1(6,"i18n"),j.k0s()()),2&t){const t=j.XpG(2);j.Y8G("value",t.licenseOptions.UPLOAD),j.R7$(2),j.JRh(j.bMT(3,3,"manualUpload")),j.R7$(3),j.SpI(" ",j.bMT(6,5,"manualBillingTokenUploadDesc")," ")}}function Qn(t,i){1&t&&(j.j41(0,"bit-label",27),j.EFF(1),j.nI1(2,"i18n"),j.k0s()),2&t&&(j.R7$(),j.SpI(" ",j.bMT(2,1,"licenseAndBillingManagementDesc")," "))}function te(t,i){1&t&&(j.j41(0,"h3",28),j.EFF(1),j.nI1(2,"i18n"),j.k0s()),2&t&&(j.R7$(),j.SpI(" ",j.bMT(2,1,"uploadLicense")," "))}function ie(t,i){if(1&t){const t=j.RV6();j.qex(0),j.DNE(1,Qn,3,3,"bit-label",24)(2,te,3,3,"h3",25),j.j41(3,"app-update-license",26),j.bIt("onUpdated",function(){C.eBV(t);const i=j.XpG(2);return C.Njj(i.licenseUploaded())}),j.k0s(),j.bVm()}if(2&t){const t=j.XpG(2);j.R7$(),j.Y8G("ngIf",!t.showAutomaticSyncAndManualUpload),j.R7$(),j.Y8G("ngIf",t.showAutomaticSyncAndManualUpload),j.R7$(),j.Y8G("showAutomaticSyncAndManualUpload",t.showAutomaticSyncAndManualUpload)("organizationId",t.organizationId)("showCancel",!1)}}function ne(t,i){if(1&t&&(j.qex(0),j.j41(1,"dl",5)(2,"dt"),j.EFF(3),j.nI1(4,"i18n"),j.k0s(),j.j41(5,"dd"),j.EFF(6),j.k0s(),j.DNE(7,qn,8,9,"ng-container",0),j.j41(8,"dt")(9,"span",6),j.EFF(10),j.nI1(11,"i18n"),j.k0s(),j.j41(12,"a",7),j.nI1(13,"i18n"),j.nrm(14,"i",8),j.j41(15,"span",3),j.EFF(16),j.nI1(17,"i18n"),j.k0s()()(),j.DNE(18,_n,4,8,"dd",9)(19,Wn,3,3,"dd",0),j.k0s(),j.j41(20,"a",10),j.EFF(21),j.nI1(22,"i18n"),j.k0s(),j.j41(23,"form",11)(24,"bit-radio-group",12)(25,"h2",13),j.EFF(26),j.nI1(27,"i18n"),j.k0s(),j.DNE(28,Zn,12,11,"bit-radio-button",14)(29,Hn,8,8,"ng-container",0)(30,Kn,7,7,"bit-radio-button",15)(31,ie,4,5,"ng-container",0),j.k0s()(),j.bVm()),2&t){const t=j.XpG();j.R7$(3),j.JRh(j.bMT(4,19,"billingPlan")),j.R7$(3),j.JRh(t.subscription.planName),j.R7$(),j.Y8G("ngIf",t.billingSyncSetUp),j.R7$(2),j.Y8G("ngClass",j.eq3(31,Nn,t.showAsExpired)),j.R7$(),j.JRh(j.bMT(11,21,"subscriptionExpiration")),j.R7$(2),j.Y8G("appA11yTitle",j.bMT(13,23,"licensePaidFeaturesHelp")),j.R7$(4),j.JRh(j.bMT(17,25,"licensePaidFeaturesHelp")),j.R7$(2),j.Y8G("ngIf",t.subscription.hasExpiration),j.R7$(),j.Y8G("ngIf",!t.subscription.hasExpiration),j.R7$(),j.Y8G("href",j.mNQ(t.cloudWebVaultUrl),j.B4B),j.R7$(),j.SpI(" ",j.bMT(22,27,"launchCloudSubscription")," "),j.R7$(2),j.Y8G("formGroup",t.form),j.R7$(),j.Y8G("block",!0),j.R7$(2),j.SpI(" ",j.bMT(27,29,"licenseAndBillingManagement")," "),j.R7$(2),j.Y8G("ngIf",t.showAutomaticSyncAndManualUpload),j.R7$(),j.Y8G("ngIf",t.updateMethod===t.licenseOptions.SYNC),j.R7$(),j.Y8G("ngIf",t.showAutomaticSyncAndManualUpload),j.R7$(),j.Y8G("ngIf",t.updateMethod===t.licenseOptions.UPLOAD)}}var ee;!function(t){t[t.SYNC=0]="SYNC",t[t.UPLOAD=1]="UPLOAD"}(ee||(ee={}));class se{set existingBillingSyncConnection(t){this._existingBillingSyncConnection=t,this.form.get("updateMethod").setValue(this.billingSyncEnabled?ee.SYNC:ee.UPLOAD)}get existingBillingSyncConnection(){return this._existingBillingSyncConnection}get billingSyncEnabled(){var t;return null===(t=this.existingBillingSyncConnection)||void 0===t?void 0:t.enabled}get showAsExpired(){return this.subscription.hasSeparateGracePeriod?this.subscription.isExpiredWithoutGracePeriod:this.subscription.isExpiredAndOutsideGracePeriod}constructor(t,i,n,e,s,o,a,r,c,l,u){this.messagingService=t,this.apiService=i,this.organizationService=n,this.accountService=e,this.route=s,this.organizationApiService=o,this.platformUtilsService=a,this.i18nService=r,this.environmentService=c,this.dialogService=l,this.toastService=u,this.licenseOptions=ee,this.form=new gt.gE({updateMethod:new gt.MJ(ee.UPLOAD)}),this.disableLicenseSyncControl=!1,this.firstLoaded=!1,this.loading=!1,this.destroy$=new m.B,this.syncLicense=()=>Yn(this,void 0,void 0,function*(){this.form.get("updateMethod").setValue(ee.SYNC),yield this.organizationApiService.selfHostedSyncLicense(this.organizationId),this.load(),yield this.loadOrganizationConnection(),this.messagingService.send("updatedOrgLicense"),this.toastService.showToast({variant:"success",title:null,message:this.i18nService.t("licenseSyncSuccess")})})}ngOnInit(){return Yn(this,void 0,void 0,function*(){this.cloudWebVaultUrl=yield(0,p._)(this.environmentService.cloudWebVaultUrl$),this.route.params.pipe((0,tt.H)(t=>Yn(this,void 0,void 0,function*(){this.organizationId=t.organizationId,yield this.load(),yield this.loadOrganizationConnection(),this.firstLoaded=!0})),(0,I.Q)(this.destroy$)).subscribe()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}load(){return Yn(this,void 0,void 0,function*(){if(this.loading)return;this.loading=!0;const t=yield(0,p._)((0,R.F6)(this.accountService.activeAccount$));if(this.userOrg=yield(0,p._)(this.organizationService.organizations$(t).pipe((0,c.Sw)(this.organizationId))),this.showAutomaticSyncAndManualUpload=this.userOrg.productTierType!=dt.K_.Families,this.userOrg.canViewSubscription){const t=yield this.organizationApiService.getSubscription(this.organizationId);this.subscription=new An(t)}this.loading=!1})}loadOrganizationConnection(){return Yn(this,void 0,void 0,function*(){if(!this.firstLoaded){const t=yield this.apiService.getCloudCommunicationsEnabled();this.disableLicenseSyncControl=!t}this.disableLicenseSyncControl||(this.existingBillingSyncConnection=yield this.apiService.getOrganizationConnection(this.organizationId,Z.eH.CloudBillingSync,Mn))})}licenseUploaded(){this.load(),this.messagingService.send("updatedOrgLicense")}manageBillingSyncSelfHosted(){var t,i,n;Un.open(this.dialogService,{entityId:this.organizationId,existingConnectionId:null===(t=this.existingBillingSyncConnection)||void 0===t?void 0:t.id,billingSyncKey:null===(n=null===(i=this.existingBillingSyncConnection)||void 0===i?void 0:i.config)||void 0===n?void 0:n.billingSyncKey,setParentConnection:t=>{this.existingBillingSyncConnection=t}})}get billingSyncSetUp(){var t;return null!=(null===(t=this.existingBillingSyncConnection)||void 0===t?void 0:t.id)}get updateMethod(){return this.form.get("updateMethod").value}get lastLicenseSync(){var t,i;return null===(i=null===(t=this.existingBillingSyncConnection)||void 0===t?void 0:t.config)||void 0===i?void 0:i.lastLicenseSync}}se.ɵfac=function(t){return new(t||se)(j.rXU(xn.U),j.rXU(yt.G),j.rXU(c.PV),j.rXU(E.D),j.rXU(P.nX),j.rXU(Rt.X),j.rXU(It.y),j.rXU(wt.W),j.rXU(kn.v),j.rXU(B.o3),j.rXU($t.f))},se.ɵcmp=j.VBU({type:se,selectors:[["ng-component"]],standalone:!1,decls:5,vars:3,consts:[[4,"ngIf"],[3,"providerName",4,"ngIf"],[1,"bwi","bwi-spinner","bwi-spin","tw-text-muted",3,"title"],[1,"tw-sr-only"],[3,"providerName"],[1,"tw-mb-2"],[3,"ngClass"],["href","https://bitwarden.com/help/licensing-on-premise/#update-organization-license","target","_blank","rel","noreferrer",3,"appA11yTitle"],["aria-hidden","true",1,"bwi","bwi-question-circle"],[3,"ngClass",4,"ngIf"],["bitButton","","buttonType","secondary","target","_blank","rel","noreferrer",1,"tw-mb-4",3,"href"],[3,"formGroup"],["formControlName","updateMethod",3,"block"],[1,"tw-mt-5"],["id","automatic-sync",3,"value","disabled",4,"ngIf"],["id","manual-upload","class","tw-mt-6",3,"value",4,"ngIf"],["class","tw-text-muted tw-break-words tw-whitespace-normal tw-max-w-fit tw-inline-block",4,"ngIf"],[1,"tw-text-muted","tw-break-words","tw-whitespace-normal","tw-max-w-fit","tw-inline-block"],["id","automatic-sync",3,"value","disabled"],["href","https://bitwarden.com/help/families-for-enterprise-self-hosted/","target","_blank","rel","noreferrer","slot","end","bitLink",""],[1,"tw-mt-6","tw-flex","tw-gap-2"],["bitButton","","buttonType","secondary","type","button",3,"click"],["bitButton","","buttonType","primary","type","button",3,"bitAction","disabled"],["id","manual-upload",1,"tw-mt-6",3,"value"],["class","tw-mb-6 tw-block",4,"ngIf"],["class","tw-font-medium tw-mt-6",4,"ngIf"],[3,"onUpdated","showAutomaticSyncAndManualUpload","organizationId","showCancel"],[1,"tw-mb-6","tw-block"],[1,"tw-font-medium","tw-mt-6"]],template:function(t,i){1&t&&(j.nrm(0,"app-header"),j.j41(1,"bit-container"),j.DNE(2,Vn,6,7,"ng-container",0)(3,Ln,1,1,"app-org-subscription-hidden",1)(4,ne,32,33,"ng-container",0),j.k0s()),2&t&&(j.R7$(2),j.Y8G("ngIf",!i.firstLoaded&&i.loading),j.R7$(),j.Y8G("ngIf",i.firstLoaded&&!i.userOrg.canViewSubscription),j.R7$(),j.Y8G("ngIf",i.subscription&&i.firstLoaded))},dependencies:[D.YU,D.bT,gt.qT,gt.BC,gt.cb,gt.j4,gt.JD,Ht.C,Kt.p,nt.Q,z.H,jt.j,hi.I,Qt.g,zn.d,Dn.Y,Xn.m,U.f,On,D.vh,X.$],encapsulation:2});const oe=[{path:"",canActivate:[(0,J.V)(c.Vc)],children:[{path:"",pathMatch:"full",redirectTo:"subscription"},{path:"subscription",component:Q._.isSelfHost()?se:Fn,data:{titleId:"subscription"}},{path:"payment-details",component:q,canActivate:[(0,J.V)(t=>t.canEditPaymentMethods),K],data:{titleId:"paymentDetails"}},{path:"history",component:ct,canActivate:[(0,J.V)(t=>t.canViewBillingHistory),K],data:{titleId:"billingHistory"}}]}];class ae{}ae.ɵfac=function(t){return new(t||ae)},ae.ɵmod=j.$C({type:ae}),ae.ɵinj=C.G2t({imports:[r.iI.forChild(oe),r.iI]});class re{}re.ɵfac=function(t){return new(t||re)},re.ɵmod=j.$C({type:re}),re.ɵinj=C.G2t({imports:[ae,s.R6,a.rd,mi.v,o.G,e.H]})}}]);
//# sourceMappingURL=614.bc9d8f19426e193192ca.js.map